(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,21351,(e,t,r)=>{e.e,function(t){"use strict";let r;var n,i,s,a,o,l,u,h,c,d,f,g,p,m,y,w,E,C,I,_,A,S,T=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},b=function(e){function t(){this.constructor=r}function r(t){var r,n,i,s,a=this.constructor,o=e.call(this,t)||this;return Object.defineProperty(o,"name",{value:a.name,enumerable:!1}),r=a.prototype,(n=Object.setPrototypeOf)?n(o,r):o.__proto__=r,void 0===i&&(i=o.constructor),(s=Error.captureStackTrace)&&s(o,i),o}return T(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t),r}(Error);class v extends b{constructor(e){super(e),this.message=e}getKind(){return this.constructor.kind}}v.kind="Exception";class N extends v{}N.kind="ArgumentException";class D extends v{}D.kind="IllegalArgumentException";class R{constructor(e){if(this.binarizer=e,null===e)throw new D("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(e,t){return this.binarizer.getBlackRow(e,t)}getBlackMatrix(){return(null===this.matrix||void 0===this.matrix)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(e,t,r,n){let i=this.binarizer.getLuminanceSource().crop(e,t,r,n);return new R(this.binarizer.createBinarizer(i))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){let e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new R(this.binarizer.createBinarizer(e))}rotateCounterClockwise45(){let e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new R(this.binarizer.createBinarizer(e))}toString(){try{return this.getBlackMatrix().toString()}catch(e){return""}}}class M extends v{static getChecksumInstance(){return new M}}M.kind="ChecksumException";class O{constructor(e){this.source=e}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class x{static arraycopy(e,t,r,n,i){for(;i--;)r[n++]=e[t++]}static currentTimeMillis(){return Date.now()}}class L extends v{}L.kind="IndexOutOfBoundsException";class P extends L{constructor(e,t){super(t),this.index=e,this.message=t}}P.kind="ArrayIndexOutOfBoundsException";class k{static fill(e,t){for(let r=0,n=e.length;r<n;r++)e[r]=t}static fillWithin(e,t,r,n){k.rangeCheck(e.length,t,r);for(let i=t;i<r;i++)e[i]=n}static rangeCheck(e,t,r){if(t>r)throw new D("fromIndex("+t+") > toIndex("+r+")");if(t<0)throw new P(t);if(r>e)throw new P(r)}static asList(...e){return e}static create(e,t,r){return Array.from({length:e}).map(e=>Array.from({length:t}).fill(r))}static createInt32Array(e,t,r){return Array.from({length:e}).map(e=>Int32Array.from({length:t}).fill(r))}static equals(e,t){if(!e||!t||!e.length||!t.length||e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}static hashCode(e){if(null===e)return 0;let t=1;for(let r of e)t=31*t+r;return t}static fillUint8Array(e,t){for(let r=0;r!==e.length;r++)e[r]=t}static copyOf(e,t){return e.slice(0,t)}static copyOfUint8Array(e,t){if(e.length<=t){let r=new Uint8Array(t);return r.set(e),r}return e.slice(0,t)}static copyOfRange(e,t,r){let n=r-t,i=new Int32Array(n);return x.arraycopy(e,t,i,0,n),i}static binarySearch(e,t,r){void 0===r&&(r=k.numberComparator);let n=0,i=e.length-1;for(;n<=i;){let s=i+n>>1,a=r(t,e[s]);if(a>0)n=s+1;else{if(!(a<0))return s;i=s-1}}return-n-1}static numberComparator(e,t){return e-t}}class B{static numberOfTrailingZeros(e){let t;if(0===e)return 32;let r=31;return 0!=(t=e<<16)&&(r-=16,e=t),0!=(t=e<<8)&&(r-=8,e=t),0!=(t=e<<4)&&(r-=4,e=t),0!=(t=e<<2)&&(r-=2,e=t),r-(e<<1>>>31)}static numberOfLeadingZeros(e){if(0===e)return 32;let t=1;return e>>>16==0&&(t+=16,e<<=16),e>>>24==0&&(t+=8,e<<=8),e>>>28==0&&(t+=4,e<<=4),e>>>30==0&&(t+=2,e<<=2),t-=e>>>31}static toHexString(e){return e.toString(16)}static toBinaryString(e){return String(parseInt(String(e),2))}static bitCount(e){return e-=e>>>1&0x55555555,e=(e=(0x33333333&e)+(e>>>2&0x33333333))+(e>>>4)&0xf0f0f0f,e+=e>>>8,63&(e+=e>>>16)}static truncDivision(e,t){return Math.trunc(e/t)}static parseInt(e,t){return parseInt(e,t)}}B.MIN_VALUE_32_BITS=-0x80000000,B.MAX_VALUE=Number.MAX_SAFE_INTEGER;class F{constructor(e,t){void 0===e?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,null==t?this.bits=F.makeArray(e):this.bits=t)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(e){if(e>32*this.bits.length){let t=F.makeArray(e);x.arraycopy(this.bits,0,t,0,this.bits.length),this.bits=t}}get(e){return(this.bits[Math.floor(e/32)]&1<<(31&e))!=0}set(e){this.bits[Math.floor(e/32)]|=1<<(31&e)}flip(e){this.bits[Math.floor(e/32)]^=1<<(31&e)}getNextSet(e){let t=this.size;if(e>=t)return t;let r=this.bits,n=Math.floor(e/32),i=r[n];i&=~((1<<(31&e))-1);let s=r.length;for(;0===i;){if(++n===s)return t;i=r[n]}let a=32*n+B.numberOfTrailingZeros(i);return a>t?t:a}getNextUnset(e){let t=this.size;if(e>=t)return t;let r=this.bits,n=Math.floor(e/32),i=~r[n];i&=~((1<<(31&e))-1);let s=r.length;for(;0===i;){if(++n===s)return t;i=~r[n]}let a=32*n+B.numberOfTrailingZeros(i);return a>t?t:a}setBulk(e,t){this.bits[Math.floor(e/32)]=t}setRange(e,t){if(t<e||e<0||t>this.size)throw new D;if(t===e)return;let r=Math.floor(e/32),n=Math.floor(--t/32),i=this.bits;for(let s=r;s<=n;s++){let a=s>r?0:31&e,o=(2<<(s<n?31:31&t))-(1<<a);i[s]|=o}}clear(){let e=this.bits.length,t=this.bits;for(let r=0;r<e;r++)t[r]=0}isRange(e,t,r){if(t<e||e<0||t>this.size)throw new D;if(t===e)return!0;let n=Math.floor(e/32),i=Math.floor(--t/32),s=this.bits;for(let a=n;a<=i;a++){let o=a>n?0:31&e,l=(2<<(a<i?31:31&t))-(1<<o)|0;if((s[a]&l)!==(r?l:0))return!1}return!0}appendBit(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++}appendBits(e,t){if(t<0||t>32)throw new D("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(let r=t;r>0;r--)this.appendBit((e>>r-1&1)==1)}appendBitArray(e){let t=e.size;this.ensureCapacity(this.size+t);for(let r=0;r<t;r++)this.appendBit(e.get(r))}xor(e){if(this.size!==e.size)throw new D("Sizes don't match");let t=this.bits;for(let r=0,n=t.length;r<n;r++)t[r]^=e.bits[r]}toBytes(e,t,r,n){for(let i=0;i<n;i++){let n=0;for(let t=0;t<8;t++)this.get(e)&&(n|=1<<7-t),e++;t[r+i]=n}}getBitArray(){return this.bits}reverse(){let e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),r=t+1,n=this.bits;for(let i=0;i<r;i++){let r=n[i];r=(r=(r=(r=(r=r>>1&0x55555555|(0x55555555&r)<<1)>>2&0x33333333|(0x33333333&r)<<2)>>4&0xf0f0f0f|(0xf0f0f0f&r)<<4)>>8&0xff00ff|(0xff00ff&r)<<8)>>16&65535|(65535&r)<<16,e[t-i]=r}if(this.size!==32*r){let t=32*r-this.size,n=e[0]>>>t;for(let i=1;i<r;i++){let r=e[i];n|=r<<32-t,e[i-1]=n,n=r>>>t}e[r-1]=n}this.bits=e}static makeArray(e){return new Int32Array(Math.floor((e+31)/32))}equals(e){return e instanceof F&&this.size===e.size&&k.equals(this.bits,e.bits)}hashCode(){return 31*this.size+k.hashCode(this.bits)}toString(){let e="";for(let t=0,r=this.size;t<r;t++)(7&t)==0&&(e+=" "),e+=this.get(t)?"X":".";return e}clone(){return new F(this.size,this.bits.slice())}}(n=g||(g={}))[n.OTHER=0]="OTHER",n[n.PURE_BARCODE=1]="PURE_BARCODE",n[n.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",n[n.TRY_HARDER=3]="TRY_HARDER",n[n.CHARACTER_SET=4]="CHARACTER_SET",n[n.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",n[n.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",n[n.ASSUME_GS1=7]="ASSUME_GS1",n[n.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",n[n.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",n[n.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS";var U=g;class V extends v{static getFormatInstance(){return new V}}V.kind="FormatException",(i=p||(p={}))[i.Cp437=0]="Cp437",i[i.ISO8859_1=1]="ISO8859_1",i[i.ISO8859_2=2]="ISO8859_2",i[i.ISO8859_3=3]="ISO8859_3",i[i.ISO8859_4=4]="ISO8859_4",i[i.ISO8859_5=5]="ISO8859_5",i[i.ISO8859_6=6]="ISO8859_6",i[i.ISO8859_7=7]="ISO8859_7",i[i.ISO8859_8=8]="ISO8859_8",i[i.ISO8859_9=9]="ISO8859_9",i[i.ISO8859_10=10]="ISO8859_10",i[i.ISO8859_11=11]="ISO8859_11",i[i.ISO8859_13=12]="ISO8859_13",i[i.ISO8859_14=13]="ISO8859_14",i[i.ISO8859_15=14]="ISO8859_15",i[i.ISO8859_16=15]="ISO8859_16",i[i.SJIS=16]="SJIS",i[i.Cp1250=17]="Cp1250",i[i.Cp1251=18]="Cp1251",i[i.Cp1252=19]="Cp1252",i[i.Cp1256=20]="Cp1256",i[i.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",i[i.UTF8=22]="UTF8",i[i.ASCII=23]="ASCII",i[i.Big5=24]="Big5",i[i.GB18030=25]="GB18030",i[i.EUC_KR=26]="EUC_KR";class j{constructor(e,t,r,...n){this.valueIdentifier=e,this.name=r,"number"==typeof t?this.values=Int32Array.from([t]):this.values=t,this.otherEncodingNames=n,j.VALUE_IDENTIFIER_TO_ECI.set(e,this),j.NAME_TO_ECI.set(r,this);const i=this.values;for(let e=0,t=i.length;e!==t;e++){const t=i[e];j.VALUES_TO_ECI.set(t,this)}for(const e of n)j.NAME_TO_ECI.set(e,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(e){if(e<0||e>=900)throw new V("incorect value");let t=j.VALUES_TO_ECI.get(e);if(void 0===t)throw new V("incorect value");return t}static getCharacterSetECIByName(e){let t=j.NAME_TO_ECI.get(e);if(void 0===t)throw new V("incorect value");return t}equals(e){return e instanceof j&&this.getName()===e.getName()}}j.VALUE_IDENTIFIER_TO_ECI=new Map,j.VALUES_TO_ECI=new Map,j.NAME_TO_ECI=new Map,j.Cp437=new j(p.Cp437,Int32Array.from([0,2]),"Cp437"),j.ISO8859_1=new j(p.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),j.ISO8859_2=new j(p.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),j.ISO8859_3=new j(p.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),j.ISO8859_4=new j(p.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),j.ISO8859_5=new j(p.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),j.ISO8859_6=new j(p.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),j.ISO8859_7=new j(p.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),j.ISO8859_8=new j(p.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),j.ISO8859_9=new j(p.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),j.ISO8859_10=new j(p.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),j.ISO8859_11=new j(p.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),j.ISO8859_13=new j(p.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),j.ISO8859_14=new j(p.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),j.ISO8859_15=new j(p.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),j.ISO8859_16=new j(p.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),j.SJIS=new j(p.SJIS,20,"SJIS","Shift_JIS"),j.Cp1250=new j(p.Cp1250,21,"Cp1250","windows-1250"),j.Cp1251=new j(p.Cp1251,22,"Cp1251","windows-1251"),j.Cp1252=new j(p.Cp1252,23,"Cp1252","windows-1252"),j.Cp1256=new j(p.Cp1256,24,"Cp1256","windows-1256"),j.UnicodeBigUnmarked=new j(p.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),j.UTF8=new j(p.UTF8,26,"UTF8","UTF-8"),j.ASCII=new j(p.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),j.Big5=new j(p.Big5,28,"Big5"),j.GB18030=new j(p.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),j.EUC_KR=new j(p.EUC_KR,30,"EUC_KR","EUC-KR");class z extends v{}z.kind="UnsupportedOperationException";class H{static decode(e,t){let r=this.encodingName(t);return this.customDecoder?this.customDecoder(e,r):"u"<typeof TextDecoder||this.shouldDecodeOnFallback(r)?this.decodeFallback(e,r):new TextDecoder(r).decode(e)}static shouldDecodeOnFallback(e){return!H.isBrowser()&&"ISO-8859-1"===e}static encode(e,t){let r=this.encodingName(t);return this.customEncoder?this.customEncoder(e,r):"u"<typeof TextEncoder?this.encodeFallback(e):new TextEncoder().encode(e)}static isBrowser(){return"u">typeof window&&"[object Window]"===({}).toString.call(window)}static encodingName(e){return"string"==typeof e?e:e.getName()}static encodingCharacterSet(e){return e instanceof j?e:j.getCharacterSetECIByName(e)}static decodeFallback(e,t){let r=this.encodingCharacterSet(t);if(H.isDecodeFallbackSupported(r)){let t="";for(let r=0,n=e.length;r<n;r++){let n=e[r].toString(16);n.length<2&&(n="0"+n),t+="%"+n}return decodeURIComponent(t)}if(r.equals(j.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new z(`Encoding ${this.encodingName(t)} not supported by fallback.`)}static isDecodeFallbackSupported(e){return e.equals(j.UTF8)||e.equals(j.ISO8859_1)||e.equals(j.ASCII)}static encodeFallback(e){let t=btoa(unescape(encodeURIComponent(e))).split(""),r=[];for(let e=0;e<t.length;e++)r.push(t[e].charCodeAt(0));return new Uint8Array(r)}}class G{static castAsNonUtf8Char(e,t=null){let r=t?t.getName():this.ISO88591;return H.decode(new Uint8Array([e]),r)}static guessEncoding(e,t){if(null!=t&&void 0!==t.get(U.CHARACTER_SET))return t.get(U.CHARACTER_SET).toString();let r=e.length,n=!0,i=!0,s=!0,a=0,o=0,l=0,u=0,h=0,c=0,d=0,f=0,g=0,p=0,m=0,y=e.length>3&&239===e[0]&&187===e[1]&&191===e[2];for(let t=0;t<r&&(n||i||s);t++){let r=255&e[t];s&&(a>0?(128&r)==0?s=!1:a--:(128&r)!=0&&((64&r)==0?s=!1:(a++,(32&r)==0?o++:(a++,(16&r)==0?l++:(a++,(8&r)==0?u++:s=!1))))),n&&(r>127&&r<160?n=!1:r>159&&(r<192||215===r||247===r)&&m++),i&&(h>0?r<64||127===r||r>252?i=!1:h--:128===r||160===r||r>239?i=!1:r>160&&r<224?(c++,f=0,++d>g&&(g=d)):r>127?(h++,d=0,++f>p&&(p=f)):(d=0,f=0))}return(s&&a>0&&(s=!1),i&&h>0&&(i=!1),s&&(y||o+l+u>0))?G.UTF8:i&&(G.ASSUME_SHIFT_JIS||g>=3||p>=3)?G.SHIFT_JIS:n&&i?2===g&&2===c||10*m>=r?G.SHIFT_JIS:G.ISO88591:n?G.ISO88591:i?G.SHIFT_JIS:s?G.UTF8:G.PLATFORM_DEFAULT_ENCODING}static format(e,...t){let r=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(e,n,i,s,a,o){let l;if("%%"===e)return"%";if(void 0===t[++r])return;e=s?parseInt(s.substr(1)):void 0;let u=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[r];break;case"c":l=t[r][0];break;case"f":l=parseFloat(t[r]).toFixed(e);break;case"p":l=parseFloat(t[r]).toPrecision(e);break;case"e":l=parseFloat(t[r]).toExponential(e);break;case"x":l=parseInt(t[r]).toString(u||16);break;case"d":l=parseFloat(parseInt(t[r],u||10).toPrecision(e)).toFixed(0)}l="object"==typeof l?JSON.stringify(l):(+l).toString(u);let h=parseInt(i),c=i&&i[0]+""=="0"?"0":" ";for(;l.length<h;)l=void 0!==n?l+c:c+l;return l})}static getBytes(e,t){return H.encode(e,t)}static getCharCode(e,t=0){return e.charCodeAt(t)}static getCharAt(e){return String.fromCharCode(e)}}G.SHIFT_JIS=j.SJIS.getName(),G.GB2312="GB2312",G.ISO88591=j.ISO8859_1.getName(),G.EUC_JP="EUC_JP",G.UTF8=j.UTF8.getName(),G.PLATFORM_DEFAULT_ENCODING=G.UTF8,G.ASSUME_SHIFT_JIS=!1;class q{constructor(e=""){this.value=e}enableDecoding(e){return this.encoding=e,this}append(e){return"string"==typeof e?this.value+=e.toString():this.encoding?this.value+=G.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this}appendChars(e,t,r){for(let n=t;t<t+r;n++)this.append(e[n]);return this}length(){return this.value.length}charAt(e){return this.value.charAt(e)}deleteCharAt(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)}setCharAt(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)}substring(e,t){return this.value.substring(e,t)}setLengthToZero(){this.value=""}toString(){return this.value}insert(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+t.length)}}class W{constructor(e,t,r,n){if(this.width=e,this.height=t,this.rowSize=r,this.bits=n,null==t&&(t=e),this.height=t,e<1||t<1)throw new D("Both dimensions must be greater than 0");null==r&&(r=Math.floor((e+31)/32)),this.rowSize=r,null==n&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(e){let t=e.length,r=e[0].length,n=new W(r,t);for(let i=0;i<t;i++){let t=e[i];for(let e=0;e<r;e++)t[e]&&n.set(e,i)}return n}static parseFromString(e,t,r){if(null===e)throw new D("stringRepresentation cannot be null");let n=Array(e.length),i=0,s=0,a=-1,o=0,l=0;for(;l<e.length;)if("\n"===e.charAt(l)||"\r"===e.charAt(l)){if(i>s){if(-1===a)a=i-s;else if(i-s!==a)throw new D("row lengths do not match");s=i,o++}l++}else if(e.substring(l,l+t.length)===t)l+=t.length,n[i]=!0,i++;else if(e.substring(l,l+r.length)===r)l+=r.length,n[i]=!1,i++;else throw new D("illegal character encountered: "+e.substring(l));if(i>s){if(-1===a)a=i-s;else if(i-s!==a)throw new D("row lengths do not match");o++}let u=new W(a,o);for(let e=0;e<i;e++)n[e]&&u.set(Math.floor(e%a),Math.floor(e/a));return u}get(e,t){let r=t*this.rowSize+Math.floor(e/32);return(this.bits[r]>>>(31&e)&1)!=0}set(e,t){let r=t*this.rowSize+Math.floor(e/32);this.bits[r]|=1<<(31&e)}unset(e,t){let r=t*this.rowSize+Math.floor(e/32);this.bits[r]&=~(1<<(31&e))}flip(e,t){let r=t*this.rowSize+Math.floor(e/32);this.bits[r]^=1<<(31&e)}xor(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new D("input matrix dimensions do not match");let t=new F(Math.floor(this.width/32)+1),r=this.rowSize,n=this.bits;for(let i=0,s=this.height;i<s;i++){let s=i*r,a=e.getRow(i,t).getBitArray();for(let e=0;e<r;e++)n[s+e]^=a[e]}}clear(){let e=this.bits,t=e.length;for(let r=0;r<t;r++)e[r]=0}setRegion(e,t,r,n){if(t<0||e<0)throw new D("Left and top must be nonnegative");if(n<1||r<1)throw new D("Height and width must be at least 1");let i=e+r,s=t+n;if(s>this.height||i>this.width)throw new D("The region must fit inside the matrix");let a=this.rowSize,o=this.bits;for(let r=t;r<s;r++){let t=r*a;for(let r=e;r<i;r++)o[t+Math.floor(r/32)]|=1<<(31&r)}}getRow(e,t){null==t||t.getSize()<this.width?t=new F(this.width):t.clear();let r=this.rowSize,n=this.bits,i=e*r;for(let e=0;e<r;e++)t.setBulk(32*e,n[i+e]);return t}setRow(e,t){x.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)}rotate180(){let e=this.getWidth(),t=this.getHeight(),r=new F(e),n=new F(e);for(let e=0,i=Math.floor((t+1)/2);e<i;e++)r=this.getRow(e,r),n=this.getRow(t-1-e,n),r.reverse(),n.reverse(),this.setRow(e,n),this.setRow(t-1-e,r)}getEnclosingRectangle(){let e=this.width,t=this.height,r=this.rowSize,n=this.bits,i=e,s=t,a=-1,o=-1;for(let e=0;e<t;e++)for(let t=0;t<r;t++){let l=n[e*r+t];if(0!==l){if(e<s&&(s=e),e>o&&(o=e),32*t<i){let e=0;for(;l<<31-e==0;)e++;32*t+e<i&&(i=32*t+e)}if(32*t+31>a){let e=31;for(;l>>>e==0;)e--;32*t+e>a&&(a=32*t+e)}}}return a<i||o<s?null:Int32Array.from([i,s,a-i+1,o-s+1])}getTopLeftOnBit(){let e=this.rowSize,t=this.bits,r=0;for(;r<t.length&&0===t[r];)r++;if(r===t.length)return null;let n=r/e,i=r%e*32,s=t[r],a=0;for(;s<<31-a==0;)a++;return i+=a,Int32Array.from([i,n])}getBottomRightOnBit(){let e=this.rowSize,t=this.bits,r=t.length-1;for(;r>=0&&0===t[r];)r--;if(r<0)return null;let n=Math.floor(r/e),i=32*Math.floor(r%e),s=t[r],a=31;for(;s>>>a==0;)a--;return i+=a,Int32Array.from([i,n])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(e){return e instanceof W&&this.width===e.width&&this.height===e.height&&this.rowSize===e.rowSize&&k.equals(this.bits,e.bits)}hashCode(){let e=this.width;return 31*(e=31*(e=31*(e=31*e+this.width)+this.height)+this.rowSize)+k.hashCode(this.bits)}toString(e="X ",t="  ",r="\n"){return this.buildToString(e,t,r)}buildToString(e,t,r){let n=new q;for(let i=0,s=this.height;i<s;i++){for(let r=0,s=this.width;r<s;r++)n.append(this.get(r,i)?e:t);n.append(r)}return n.toString()}clone(){return new W(this.width,this.height,this.rowSize,this.bits.slice())}}class Y extends v{static getNotFoundInstance(){return new Y}}Y.kind="NotFoundException";class K extends O{constructor(e){super(e),this.luminances=K.EMPTY,this.buckets=new Int32Array(K.LUMINANCE_BUCKETS)}getBlackRow(e,t){let r=this.getLuminanceSource(),n=r.getWidth();null==t||t.getSize()<n?t=new F(n):t.clear(),this.initArrays(n);let i=r.getRow(e,this.luminances),s=this.buckets;for(let e=0;e<n;e++)s[(255&i[e])>>K.LUMINANCE_SHIFT]++;let a=K.estimateBlackPoint(s);if(n<3)for(let e=0;e<n;e++)(255&i[e])<a&&t.set(e);else{let e=255&i[0],r=255&i[1];for(let s=1;s<n-1;s++){let n=255&i[s+1];(4*r-e-n)/2<a&&t.set(s),e=r,r=n}}return t}getBlackMatrix(){let e=this.getLuminanceSource(),t=e.getWidth(),r=e.getHeight(),n=new W(t,r);this.initArrays(t);let i=this.buckets;for(let n=1;n<5;n++){let s=Math.floor(r*n/5),a=e.getRow(s,this.luminances),o=Math.floor(4*t/5);for(let e=Math.floor(t/5);e<o;e++){let t=255&a[e];i[t>>K.LUMINANCE_SHIFT]++}}let s=K.estimateBlackPoint(i),a=e.getMatrix();for(let e=0;e<r;e++){let r=e*t;for(let i=0;i<t;i++)(255&a[r+i])<s&&n.set(i,e)}return n}createBinarizer(e){return new K(e)}initArrays(e){this.luminances.length<e&&(this.luminances=new Uint8ClampedArray(e));let t=this.buckets;for(let e=0;e<K.LUMINANCE_BUCKETS;e++)t[e]=0}static estimateBlackPoint(e){let t=e.length,r=0,n=0,i=0;for(let s=0;s<t;s++)e[s]>i&&(n=s,i=e[s]),e[s]>r&&(r=e[s]);let s=0,a=0;for(let r=0;r<t;r++){let t=r-n,i=e[r]*t*t;i>a&&(s=r,a=i)}if(n>s){let e=n;n=s,s=e}if(s-n<=t/16)throw new Y;let o=s-1,l=-1;for(let t=s-1;t>n;t--){let i=t-n,a=i*i*(s-t)*(r-e[t]);a>l&&(o=t,l=a)}return o<<K.LUMINANCE_SHIFT}}K.LUMINANCE_BITS=5,K.LUMINANCE_SHIFT=8-K.LUMINANCE_BITS,K.LUMINANCE_BUCKETS=1<<K.LUMINANCE_BITS,K.EMPTY=Uint8ClampedArray.from([0]);class X extends K{constructor(e){super(e),this.matrix=null}getBlackMatrix(){if(null!==this.matrix)return this.matrix;let e=this.getLuminanceSource(),t=e.getWidth(),r=e.getHeight();if(t>=X.MINIMUM_DIMENSION&&r>=X.MINIMUM_DIMENSION){let n=e.getMatrix(),i=t>>X.BLOCK_SIZE_POWER;(t&X.BLOCK_SIZE_MASK)!=0&&i++;let s=r>>X.BLOCK_SIZE_POWER;(r&X.BLOCK_SIZE_MASK)!=0&&s++;let a=X.calculateBlackPoints(n,i,s,t,r),o=new W(t,r);X.calculateThresholdForBlock(n,i,s,t,r,a,o),this.matrix=o}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(e){return new X(e)}static calculateThresholdForBlock(e,t,r,n,i,s,a){let o=i-X.BLOCK_SIZE,l=n-X.BLOCK_SIZE;for(let i=0;i<r;i++){let u=i<<X.BLOCK_SIZE_POWER;u>o&&(u=o);let h=X.cap(i,2,r-3);for(let r=0;r<t;r++){let i=r<<X.BLOCK_SIZE_POWER;i>l&&(i=l);let o=X.cap(r,2,t-3),c=0;for(let e=-2;e<=2;e++){let t=s[h+e];c+=t[o-2]+t[o-1]+t[o]+t[o+1]+t[o+2]}let d=c/25;X.thresholdBlock(e,i,u,d,n,a)}}}static cap(e,t,r){return e<t?t:e>r?r:e}static thresholdBlock(e,t,r,n,i,s){for(let a=0,o=r*i+t;a<X.BLOCK_SIZE;a++,o+=i)for(let i=0;i<X.BLOCK_SIZE;i++)(255&e[o+i])<=n&&s.set(t+i,r+a)}static calculateBlackPoints(e,t,r,n,i){let s=i-X.BLOCK_SIZE,a=n-X.BLOCK_SIZE,o=Array(r);for(let i=0;i<r;i++){o[i]=new Int32Array(t);let r=i<<X.BLOCK_SIZE_POWER;r>s&&(r=s);for(let s=0;s<t;s++){let t=s<<X.BLOCK_SIZE_POWER;t>a&&(t=a);let l=0,u=255,h=0;for(let i=0,s=r*n+t;i<X.BLOCK_SIZE;i++,s+=n){for(let t=0;t<X.BLOCK_SIZE;t++){let r=255&e[s+t];l+=r,r<u&&(u=r),r>h&&(h=r)}if(h-u>X.MIN_DYNAMIC_RANGE)for(i++,s+=n;i<X.BLOCK_SIZE;i++,s+=n)for(let t=0;t<X.BLOCK_SIZE;t++)l+=255&e[s+t]}let c=l>>2*X.BLOCK_SIZE_POWER;if(h-u<=X.MIN_DYNAMIC_RANGE&&(c=u/2,i>0&&s>0)){let e=(o[i-1][s]+2*o[i][s-1]+o[i-1][s-1])/4;u<e&&(c=e)}o[i][s]=c}}return o}}X.BLOCK_SIZE_POWER=3,X.BLOCK_SIZE=1<<X.BLOCK_SIZE_POWER,X.BLOCK_SIZE_MASK=X.BLOCK_SIZE-1,X.MINIMUM_DIMENSION=5*X.BLOCK_SIZE,X.MIN_DYNAMIC_RANGE=24;class Q{constructor(e,t){this.width=e,this.height=t}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(e,t,r,n){throw new z("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new z("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new z("This luminance source does not support rotation by 45 degrees.")}toString(){let e=new Uint8ClampedArray(this.width),t=new q;for(let r=0;r<this.height;r++){let n=this.getRow(r,e);for(let e=0;e<this.width;e++){let r,i=255&n[e];r=i<64?"#":i<128?"+":i<192?".":" ",t.append(r)}t.append("\n")}return t.toString()}}class $ extends Q{constructor(e){super(e.getWidth(),e.getHeight()),this.delegate=e}getRow(e,t){let r=this.delegate.getRow(e,t),n=this.getWidth();for(let e=0;e<n;e++)r[e]=255-(255&r[e]);return r}getMatrix(){let e=this.delegate.getMatrix(),t=this.getWidth()*this.getHeight(),r=new Uint8ClampedArray(t);for(let n=0;n<t;n++)r[n]=255-(255&e[n]);return r}isCropSupported(){return this.delegate.isCropSupported()}crop(e,t,r,n){return new $(this.delegate.crop(e,t,r,n))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new $(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new $(this.delegate.rotateCounterClockwise45())}}class Z extends Q{constructor(e){super(e.width,e.height),this.canvas=e,this.tempCanvasElement=null,this.buffer=Z.makeBufferFromCanvasImageData(e)}static makeBufferFromCanvasImageData(e){let t=e.getContext("2d").getImageData(0,0,e.width,e.height);return Z.toGrayscaleBuffer(t.data,e.width,e.height)}static toGrayscaleBuffer(e,t,r){let n=new Uint8ClampedArray(t*r);for(let t=0,r=0,i=e.length;t<i;t+=4,r++){let i;i=0===e[t+3]?255:306*e[t]+601*e[t+1]+117*e[t+2]+512>>10,n[r]=i}return n}getRow(e,t){if(e<0||e>=this.getHeight())throw new D("Requested row is outside the image: "+e);let r=this.getWidth(),n=e*r;return null===t?t=this.buffer.slice(n,n+r):(t.length<r&&(t=new Uint8ClampedArray(r)),t.set(this.buffer.slice(n,n+r))),t}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(e,t,r,n){return super.crop(e,t,r,n),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(null===this.tempCanvasElement){let e=this.canvas.ownerDocument.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height,this.tempCanvasElement=e}return this.tempCanvasElement}rotate(e){let t=this.getTempCanvasElement(),r=t.getContext("2d"),n=e*Z.DEGREE_TO_RADIANS,i=this.canvas.width,s=this.canvas.height,a=Math.ceil(Math.abs(Math.cos(n))*i+Math.abs(Math.sin(n))*s),o=Math.ceil(Math.abs(Math.sin(n))*i+Math.abs(Math.cos(n))*s);return t.width=a,t.height=o,r.translate(a/2,o/2),r.rotate(n),r.drawImage(this.canvas,-(i/2),-(s/2)),this.buffer=Z.makeBufferFromCanvasImageData(t),this}invert(){return new $(this)}}Z.DEGREE_TO_RADIANS=Math.PI/180;class J{constructor(e,t,r){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=r||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var ee=(globalThis||e.g||self||window||void 0)&&(globalThis||e.g||self||window||void 0).__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})};class et{constructor(e,t=500,r){this.reader=e,this.timeBetweenScansMillis=t,this._hints=r,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return"u">typeof navigator}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(e){this._timeBetweenDecodingAttempts=e<0?0:e}set hints(e){this._hints=e||null}get hints(){return this._hints}listVideoInputDevices(){return ee(this,void 0,void 0,function*(){if(!this.hasNavigator)throw Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw Error("Can't enumerate devices, method not supported.");let e=yield navigator.mediaDevices.enumerateDevices(),t=[];for(let r of e){let e="video"===r.kind?"videoinput":r.kind;if("videoinput"!==e)continue;let n=r.deviceId||r.id,i={deviceId:n,label:r.label||`Video device ${t.length+1}`,kind:e,groupId:r.groupId};t.push(i)}return t})}getVideoInputDevices(){return ee(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(e=>new J(e.deviceId,e.label))})}findDeviceById(e){return ee(this,void 0,void 0,function*(){let t=yield this.listVideoInputDevices();return t?t.find(t=>t.deviceId===e):null})}decodeFromInputVideoDevice(e,t){return ee(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(e,t)})}decodeOnceFromVideoDevice(e,t){return ee(this,void 0,void 0,function*(){return this.reset(),yield this.decodeOnceFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},t)})}decodeOnceFromConstraints(e,t){return ee(this,void 0,void 0,function*(){let r=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeOnceFromStream(r,t)})}decodeOnceFromStream(e,t){return ee(this,void 0,void 0,function*(){this.reset();let r=yield this.attachStreamToVideo(e,t);return yield this.decodeOnce(r)})}decodeFromInputVideoDeviceContinuously(e,t,r){return ee(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(e,t,r)})}decodeFromVideoDevice(e,t,r){return ee(this,void 0,void 0,function*(){return yield this.decodeFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},t,r)})}decodeFromConstraints(e,t,r){return ee(this,void 0,void 0,function*(){let n=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeFromStream(n,t,r)})}decodeFromStream(e,t,r){return ee(this,void 0,void 0,function*(){this.reset();let n=yield this.attachStreamToVideo(e,t);return yield this.decodeContinuously(n,r)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(e,t){return ee(this,void 0,void 0,function*(){let r=this.prepareVideoElement(t);return this.addVideoSource(r,e),this.videoElement=r,this.stream=e,yield this.playVideoOnLoadAsync(r),r})}playVideoOnLoadAsync(e){return new Promise((t,r)=>this.playVideoOnLoad(e,()=>t()))}playVideoOnLoad(e,t){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(e),e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)}isVideoPlaying(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}tryPlayVideo(e){return ee(this,void 0,void 0,function*(){if(this.isVideoPlaying(e))return void console.warn("Trying to play video that is already playing.");try{yield e.play()}catch(e){console.warn("It was not possible to play the video.")}})}getMediaElement(e,t){let r=document.getElementById(e);if(!r)throw new N(`element with id '${e}' not found`);if(r.nodeName.toLowerCase()!==t.toLowerCase())throw new N(`element with id '${e}' must be an ${t} element`);return r}decodeFromImage(e,t){if(!e&&!t)throw new N("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)}decodeFromVideo(e,t){if(!e&&!t)throw new N("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)}decodeFromVideoContinuously(e,t,r){if(void 0===e&&void 0===t)throw new N("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,r):this.decodeFromVideoElementContinuously(e,r)}decodeFromImageElement(e){if(!e)throw new N("An image element must be provided.");this.reset();let t=this.prepareImageElement(e);return this.imageElement=t,this.isImageLoaded(t)?this.decodeOnce(t,!1,!0):this._decodeOnLoadImage(t)}decodeFromVideoElement(e){let t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)}decodeFromVideoElementContinuously(e,t){let r=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(r,t)}_decodeFromVideoElementSetup(e){if(!e)throw new N("A video element must be provided.");this.reset();let t=this.prepareVideoElement(e);return this.videoElement=t,t}decodeFromImageUrl(e){if(!e)throw new N("An URL must be provided.");this.reset();let t=this.prepareImageElement();this.imageElement=t;let r=this._decodeOnLoadImage(t);return t.src=e,r}decodeFromVideoUrl(e){if(!e)throw new N("An URL must be provided.");this.reset();let t=this.prepareVideoElement(),r=this.decodeFromVideoElement(t);return t.src=e,r}decodeFromVideoUrlContinuously(e,t){if(!e)throw new N("An URL must be provided.");this.reset();let r=this.prepareVideoElement(),n=this.decodeFromVideoElementContinuously(r,t);return r.src=e,n}_decodeOnLoadImage(e){return new Promise((t,r)=>{this.imageLoadedListener=()=>this.decodeOnce(e,!1,!0).then(t,r),e.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(e){return ee(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(e),yield this.decodeOnce(e)})}_decodeOnLoadVideoContinuously(e,t){return ee(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(e),this.decodeContinuously(e,t)})}isImageLoaded(e){return!!e.complete&&0!==e.naturalWidth}prepareImageElement(e){let t;return void 0===e&&((t=document.createElement("img")).width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t}prepareVideoElement(e){let t;return!e&&"u">typeof document&&((t=document.createElement("video")).width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t}decodeOnce(e,t=!0,r=!0){this._stopAsyncDecode=!1;let n=(i,s)=>{if(this._stopAsyncDecode){s(new Y("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{let t=this.decode(e);i(t)}catch(o){let e=t&&o instanceof Y,a=o instanceof M||o instanceof V;if(e||a&&r)return setTimeout(n,this._timeBetweenDecodingAttempts,i,s);s(o)}};return new Promise((e,t)=>n(e,t))}decodeContinuously(e,t){this._stopContinuousDecode=!1;let r=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{let n=this.decode(e);t(n,null),setTimeout(r,this.timeBetweenScansMillis)}catch(i){t(null,i);let e=i instanceof M||i instanceof V,n=i instanceof Y;(e||n)&&setTimeout(r,this._timeBetweenDecodingAttempts)}};r()}decode(e){let t=this.createBinaryBitmap(e);return this.decodeBitmap(t)}_isHTMLVideoElement(e){return 0!==e.videoWidth}drawFrameOnCanvas(e,t,r){t||(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),r||(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}drawImageOnCanvas(e,t,r=this.captureCanvasContext){t||(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),r||(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}createBinaryBitmap(e){return this.getCaptureCanvasContext(e),this._isHTMLVideoElement(e)?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e),new R(new X(new Z(this.getCaptureCanvas(e))))}getCaptureCanvasContext(e){if(!this.captureCanvasContext){let t=this.getCaptureCanvas(e).getContext("2d");this.captureCanvasContext=t}return this.captureCanvasContext}getCaptureCanvas(e){if(!this.captureCanvas){let t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas}decodeBitmap(e){return this.reader.decode(e,this._hints)}createCaptureCanvas(e){let t,r;if("u"<typeof document)return this._destroyCaptureCanvas(),null;let n=document.createElement("canvas");return void 0!==e&&(e instanceof HTMLVideoElement?(t=e.videoWidth,r=e.videoHeight):e instanceof HTMLImageElement&&(t=e.naturalWidth||e.width,r=e.naturalHeight||e.height)),n.style.width=t+"px",n.style.height=r+"px",n.width=t,n.height=r,n}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(e=>e.stop()),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(void 0!==this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),void 0!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),void 0!==this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(e,t){try{e.srcObject=t}catch(r){e.src=URL.createObjectURL(t)}}cleanVideoSource(e){try{e.srcObject=null}catch(t){e.src=""}this.videoElement.removeAttribute("src")}}class er{constructor(e,t,r=null==t?0:8*t.length,n,i,s=x.currentTimeMillis()){this.text=e,this.rawBytes=t,this.numBits=r,this.resultPoints=n,this.format=i,this.timestamp=s,this.text=e,this.rawBytes=t,null==r?this.numBits=null==t?0:8*t.length:this.numBits=r,this.resultPoints=n,this.format=i,this.resultMetadata=null,null==s?this.timestamp=x.currentTimeMillis():this.timestamp=s}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(e,t){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)}putAllMetadata(e){null!==e&&(null===this.resultMetadata?this.resultMetadata=e:this.resultMetadata=new Map(e))}addResultPoints(e){let t=this.resultPoints;if(null===t)this.resultPoints=e;else if(null!==e&&e.length>0){let r=Array(t.length+e.length);x.arraycopy(t,0,r,0,t.length),x.arraycopy(e,0,r,t.length,e.length),this.resultPoints=r}}getTimestamp(){return this.timestamp}toString(){return this.text}}(s=m||(m={}))[s.AZTEC=0]="AZTEC",s[s.CODABAR=1]="CODABAR",s[s.CODE_39=2]="CODE_39",s[s.CODE_93=3]="CODE_93",s[s.CODE_128=4]="CODE_128",s[s.DATA_MATRIX=5]="DATA_MATRIX",s[s.EAN_8=6]="EAN_8",s[s.EAN_13=7]="EAN_13",s[s.ITF=8]="ITF",s[s.MAXICODE=9]="MAXICODE",s[s.PDF_417=10]="PDF_417",s[s.QR_CODE=11]="QR_CODE",s[s.RSS_14=12]="RSS_14",s[s.RSS_EXPANDED=13]="RSS_EXPANDED",s[s.UPC_A=14]="UPC_A",s[s.UPC_E=15]="UPC_E",s[s.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";var en=m;(a=y||(y={}))[a.OTHER=0]="OTHER",a[a.ORIENTATION=1]="ORIENTATION",a[a.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",a[a.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",a[a.ISSUE_NUMBER=4]="ISSUE_NUMBER",a[a.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",a[a.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",a[a.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",a[a.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",a[a.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",a[a.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY";var ei=y;class es{constructor(e,t,r,n,i=-1,s=-1){this.rawBytes=e,this.text=t,this.byteSegments=r,this.ecLevel=n,this.structuredAppendSequenceNumber=i,this.structuredAppendParity=s,this.numBits=null==e?0:8*e.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(e){this.numBits=e}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(e){this.errorsCorrected=e}getErasures(){return this.erasures}setErasures(e){this.erasures=e}getOther(){return this.other}setOther(e){this.other=e}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class ea{exp(e){return this.expTable[e]}log(e){if(0===e)throw new D;return this.logTable[e]}static addOrSubtract(e,t){return e^t}}class eo{constructor(e,t){if(0===t.length)throw new D;this.field=e;const r=t.length;if(r>1&&0===t[0]){let e=1;for(;e<r&&0===t[e];)e++;e===r?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(r-e),x.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){let t;if(0===e)return this.getCoefficient(0);let r=this.coefficients;if(1===e){t=0;for(let e=0,n=r.length;e!==n;e++){let n=r[e];t=ea.addOrSubtract(t,n)}return t}t=r[0];let n=r.length,i=this.field;for(let s=1;s<n;s++)t=ea.addOrSubtract(i.multiply(e,t),r[s]);return t}addOrSubtract(e){if(!this.field.equals(e.field))throw new D("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,r=e.coefficients;if(t.length>r.length){let e=t;t=r,r=e}let n=new Int32Array(r.length),i=r.length-t.length;x.arraycopy(r,0,n,0,i);for(let e=i;e<r.length;e++)n[e]=ea.addOrSubtract(t[e-i],r[e]);return new eo(this.field,n)}multiply(e){if(!this.field.equals(e.field))throw new D("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();let t=this.coefficients,r=t.length,n=e.coefficients,i=n.length,s=new Int32Array(r+i-1),a=this.field;for(let e=0;e<r;e++){let r=t[e];for(let t=0;t<i;t++)s[e+t]=ea.addOrSubtract(s[e+t],a.multiply(r,n[t]))}return new eo(a,s)}multiplyScalar(e){if(0===e)return this.field.getZero();if(1===e)return this;let t=this.coefficients.length,r=this.field,n=new Int32Array(t),i=this.coefficients;for(let s=0;s<t;s++)n[s]=r.multiply(i[s],e);return new eo(r,n)}multiplyByMonomial(e,t){if(e<0)throw new D;if(0===t)return this.field.getZero();let r=this.coefficients,n=r.length,i=new Int32Array(n+e),s=this.field;for(let e=0;e<n;e++)i[e]=s.multiply(r[e],t);return new eo(s,i)}divide(e){if(!this.field.equals(e.field))throw new D("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new D("Divide by 0");let t=this.field,r=t.getZero(),n=this,i=e.getCoefficient(e.getDegree()),s=t.inverse(i);for(;n.getDegree()>=e.getDegree()&&!n.isZero();){let i=n.getDegree()-e.getDegree(),a=t.multiply(n.getCoefficient(n.getDegree()),s),o=e.multiplyByMonomial(i,a),l=t.buildMonomial(i,a);r=r.addOrSubtract(l),n=n.addOrSubtract(o)}return[r,n]}toString(){let e="";for(let t=this.getDegree();t>=0;t--){let r=this.getCoefficient(t);if(0!==r){if(r<0?(e+=" - ",r=-r):e.length>0&&(e+=" + "),0===t||1!==r){let t=this.field.log(r);0===t?e+="1":1===t?e+="a":(e+="a^",e+=t)}0!==t&&(1===t?e+="x":(e+="x^",e+=t))}}return e}}class el extends v{}el.kind="ArithmeticException";class eu extends ea{constructor(e,t,r){super(),this.primitive=e,this.size=t,this.generatorBase=r;const n=new Int32Array(t);let i=1;for(let r=0;r<t;r++)n[r]=i,(i*=2)>=t&&(i^=e,i&=t-1);this.expTable=n;const s=new Int32Array(t);for(let e=0;e<t-1;e++)s[n[e]]=e;this.logTable=s,this.zero=new eo(this,Int32Array.from([0])),this.one=new eo(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new D;if(0===t)return this.zero;let r=new Int32Array(e+1);return r[0]=t,new eo(this,r)}inverse(e){if(0===e)throw new el;return this.expTable[this.size-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+B.toHexString(this.primitive)+","+this.size+")"}equals(e){return e===this}}eu.AZTEC_DATA_12=new eu(4201,4096,1),eu.AZTEC_DATA_10=new eu(1033,1024,1),eu.AZTEC_DATA_6=new eu(67,64,1),eu.AZTEC_PARAM=new eu(19,16,1),eu.QR_CODE_FIELD_256=new eu(285,256,0),eu.DATA_MATRIX_FIELD_256=new eu(301,256,1),eu.AZTEC_DATA_8=eu.DATA_MATRIX_FIELD_256,eu.MAXICODE_FIELD_64=eu.AZTEC_DATA_6;class eh extends v{}eh.kind="ReedSolomonException";class ec extends v{}ec.kind="IllegalStateException";class ed{constructor(e){this.field=e}decode(e,t){let r=this.field,n=new eo(r,e),i=new Int32Array(t),s=!0;for(let e=0;e<t;e++){let t=n.evaluateAt(r.exp(e+r.getGeneratorBase()));i[i.length-1-e]=t,0!==t&&(s=!1)}if(s)return;let a=new eo(r,i),o=this.runEuclideanAlgorithm(r.buildMonomial(t,1),a,t),l=o[0],u=o[1],h=this.findErrorLocations(l),c=this.findErrorMagnitudes(u,h);for(let t=0;t<h.length;t++){let n=e.length-1-r.log(h[t]);if(n<0)throw new eh("Bad error location");e[n]=eu.addOrSubtract(e[n],c[t])}}runEuclideanAlgorithm(e,t,r){if(e.getDegree()<t.getDegree()){let r=e;e=t,t=r}let n=this.field,i=e,s=t,a=n.getZero(),o=n.getOne();for(;s.getDegree()>=(r/2|0);){let e=i,t=a;if(i=s,a=o,i.isZero())throw new eh("r_{i-1} was zero");s=e;let r=n.getZero(),l=i.getCoefficient(i.getDegree()),u=n.inverse(l);for(;s.getDegree()>=i.getDegree()&&!s.isZero();){let e=s.getDegree()-i.getDegree(),t=n.multiply(s.getCoefficient(s.getDegree()),u);r=r.addOrSubtract(n.buildMonomial(e,t)),s=s.addOrSubtract(i.multiplyByMonomial(e,t))}if(o=r.multiply(a).addOrSubtract(t),s.getDegree()>=i.getDegree())throw new ec("Division algorithm failed to reduce polynomial?")}let l=o.getCoefficient(0);if(0===l)throw new eh("sigmaTilde(0) was zero");let u=n.inverse(l);return[o.multiplyScalar(u),s.multiplyScalar(u)]}findErrorLocations(e){let t=e.getDegree();if(1===t)return Int32Array.from([e.getCoefficient(1)]);let r=new Int32Array(t),n=0,i=this.field;for(let s=1;s<i.getSize()&&n<t;s++)0===e.evaluateAt(s)&&(r[n]=i.inverse(s),n++);if(n!==t)throw new eh("Error locator degree does not match number of roots");return r}findErrorMagnitudes(e,t){let r=t.length,n=new Int32Array(r),i=this.field;for(let s=0;s<r;s++){let a=i.inverse(t[s]),o=1;for(let e=0;e<r;e++)if(s!==e){let r=i.multiply(t[e],a),n=(1&r)==0?1|r:-2&r;o=i.multiply(o,n)}n[s]=i.multiply(e.evaluateAt(a),i.inverse(o)),0!==i.getGeneratorBase()&&(n[s]=i.multiply(n[s],a))}return n}}(o=w||(w={}))[o.UPPER=0]="UPPER",o[o.LOWER=1]="LOWER",o[o.MIXED=2]="MIXED",o[o.DIGIT=3]="DIGIT",o[o.PUNCT=4]="PUNCT",o[o.BINARY=5]="BINARY";class ef{decode(e){this.ddata=e;let t=e.getBits(),r=this.extractBits(t),n=this.correctBits(r),i=new es(ef.convertBoolArrayToByteArray(n),ef.getEncodedData(n),null,null);return i.setNumBits(n.length),i}static highLevelDecode(e){return this.getEncodedData(e)}static getEncodedData(e){let t=e.length,r=w.UPPER,n=w.UPPER,i="",s=0;for(;s<t;)if(n===w.BINARY){if(t-s<5)break;let a=ef.readCode(e,s,5);if(s+=5,0===a){if(t-s<11)break;a=ef.readCode(e,s,11)+31,s+=11}for(let r=0;r<a;r++){if(t-s<8){s=t;break}let r=ef.readCode(e,s,8);i+=G.castAsNonUtf8Char(r),s+=8}n=r}else{let a=n===w.DIGIT?4:5;if(t-s<a)break;let o=ef.readCode(e,s,a);s+=a;let l=ef.getCharacter(n,o);l.startsWith("CTRL_")?(r=n,n=ef.getTable(l.charAt(5)),"L"===l.charAt(6)&&(r=n)):(i+=l,n=r)}return i}static getTable(e){switch(e){case"L":return w.LOWER;case"P":return w.PUNCT;case"M":return w.MIXED;case"D":return w.DIGIT;case"B":return w.BINARY;default:return w.UPPER}}static getCharacter(e,t){switch(e){case w.UPPER:return ef.UPPER_TABLE[t];case w.LOWER:return ef.LOWER_TABLE[t];case w.MIXED:return ef.MIXED_TABLE[t];case w.PUNCT:return ef.PUNCT_TABLE[t];case w.DIGIT:return ef.DIGIT_TABLE[t];default:throw new ec("Bad table")}}correctBits(e){let t,r;2>=this.ddata.getNbLayers()?(r=6,t=eu.AZTEC_DATA_6):8>=this.ddata.getNbLayers()?(r=8,t=eu.AZTEC_DATA_8):22>=this.ddata.getNbLayers()?(r=10,t=eu.AZTEC_DATA_10):(r=12,t=eu.AZTEC_DATA_12);let n=this.ddata.getNbDatablocks(),i=e.length/r;if(i<n)throw new V;let s=e.length%r,a=new Int32Array(i);for(let t=0;t<i;t++,s+=r)a[t]=ef.readCode(e,s,r);try{new ed(t).decode(a,i-n)}catch(e){throw new V(e)}let o=(1<<r)-1,l=0;for(let e=0;e<n;e++){let t=a[e];if(0===t||t===o)throw new V;(1===t||t===o-1)&&l++}let u=Array(n*r-l),h=0;for(let e=0;e<n;e++){let t=a[e];if(1===t||t===o-1)u.fill(t>1,h,h+r-1),h+=r-1;else for(let e=r-1;e>=0;--e)u[h++]=(t&1<<e)!=0}return u}extractBits(e){let t=this.ddata.isCompact(),r=this.ddata.getNbLayers(),n=(t?11:14)+4*r,i=new Int32Array(n),s=Array(this.totalBitsInLayer(r,t));if(t)for(let e=0;e<i.length;e++)i[e]=e;else{let e=n+1+2*B.truncDivision(B.truncDivision(n,2)-1,15),t=n/2,r=B.truncDivision(e,2);for(let e=0;e<t;e++){let n=e+B.truncDivision(e,15);i[t-e-1]=r-n-1,i[t+e]=r+n+1}}for(let a=0,o=0;a<r;a++){let l=(r-a)*4+(t?9:12),u=2*a,h=n-1-u;for(let t=0;t<l;t++){let r=2*t;for(let n=0;n<2;n++)s[o+r+n]=e.get(i[u+n],i[u+t]),s[o+2*l+r+n]=e.get(i[u+t],i[h-n]),s[o+4*l+r+n]=e.get(i[h-n],i[h-t]),s[o+6*l+r+n]=e.get(i[h-t],i[u+n])}o+=8*l}return s}static readCode(e,t,r){let n=0;for(let i=t;i<t+r;i++)n<<=1,e[i]&&(n|=1);return n}static readByte(e,t){let r=e.length-t;return r>=8?ef.readCode(e,t,8):ef.readCode(e,t,r)<<8-r}static convertBoolArrayToByteArray(e){let t=new Uint8Array((e.length+7)/8);for(let r=0;r<t.length;r++)t[r]=ef.readByte(e,8*r);return t}totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}ef.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],ef.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],ef.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],ef.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],ef.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class eg{static round(e){return e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0}static distance(e,t,r,n){let i=e-r,s=t-n;return Math.sqrt(i*i+s*s)}static sum(e){let t=0;for(let r=0,n=e.length;r!==n;r++)t+=e[r];return t}}class ep{static floatToIntBits(e){return e}}ep.MAX_VALUE=Number.MAX_SAFE_INTEGER;class em{constructor(e,t){this.x=e,this.y=t}getX(){return this.x}getY(){return this.y}equals(e){return e instanceof em&&this.x===e.x&&this.y===e.y}hashCode(){return 31*ep.floatToIntBits(this.x)+ep.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(e){let t,r,n,i=this.distance(e[0],e[1]),s=this.distance(e[1],e[2]),a=this.distance(e[0],e[2]);if(s>=i&&s>=a?(r=e[0],t=e[1],n=e[2]):a>=s&&a>=i?(r=e[1],t=e[0],n=e[2]):(r=e[2],t=e[0],n=e[1]),0>this.crossProductZ(t,r,n)){let e=t;t=n,n=e}e[0]=t,e[1]=r,e[2]=n}static distance(e,t){return eg.distance(e.x,e.y,t.x,t.y)}static crossProductZ(e,t,r){let n=t.x,i=t.y;return(r.x-n)*(e.y-i)-(r.y-i)*(e.x-n)}}class ey{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class ew extends ey{constructor(e,t,r,n,i){super(e,t),this.compact=r,this.nbDatablocks=n,this.nbLayers=i}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class eE{constructor(e,t,r,n){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),null==t&&(t=eE.INIT_SIZE),null==r&&(r=e.getWidth()/2|0),null==n&&(n=e.getHeight()/2|0);const i=t/2|0;if(this.leftInit=r-i,this.rightInit=r+i,this.upInit=n-i,this.downInit=n+i,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Y}detect(){let e=this.leftInit,t=this.rightInit,r=this.upInit,n=this.downInit,i=!1,s=!0,a=!1,o=!1,l=!1,u=!1,h=!1,c=this.width,d=this.height;for(;s;){s=!1;let f=!0;for(;(f||!o)&&t<c;)(f=this.containsBlackPoint(r,n,t,!1))?(t++,s=!0,o=!0):!o&&t++;if(t>=c){i=!0;break}let g=!0;for(;(g||!l)&&n<d;)(g=this.containsBlackPoint(e,t,n,!0))?(n++,s=!0,l=!0):!l&&n++;if(n>=d){i=!0;break}let p=!0;for(;(p||!u)&&e>=0;)(p=this.containsBlackPoint(r,n,e,!1))?(e--,s=!0,u=!0):!u&&e--;if(e<0){i=!0;break}let m=!0;for(;(m||!h)&&r>=0;)(m=this.containsBlackPoint(e,t,r,!0))?(r--,s=!0,h=!0):!h&&r--;if(r<0){i=!0;break}s&&(a=!0)}if(!i&&a){let i=t-e,s=null;for(let t=1;null===s&&t<i;t++)s=this.getBlackPointOnSegment(e,n-t,e+t,n);if(null==s)throw new Y;let a=null;for(let t=1;null===a&&t<i;t++)a=this.getBlackPointOnSegment(e,r+t,e+t,r);if(null==a)throw new Y;let o=null;for(let e=1;null===o&&e<i;e++)o=this.getBlackPointOnSegment(t,r+e,t-e,r);if(null==o)throw new Y;let l=null;for(let e=1;null===l&&e<i;e++)l=this.getBlackPointOnSegment(t,n-e,t-e,n);if(null==l)throw new Y;return this.centerEdges(l,s,o,a)}throw new Y}getBlackPointOnSegment(e,t,r,n){let i=eg.round(eg.distance(e,t,r,n)),s=(r-e)/i,a=(n-t)/i,o=this.image;for(let r=0;r<i;r++){let n=eg.round(e+r*s),i=eg.round(t+r*a);if(o.get(n,i))return new em(n,i)}return null}centerEdges(e,t,r,n){let i=e.getX(),s=e.getY(),a=t.getX(),o=t.getY(),l=r.getX(),u=r.getY(),h=n.getX(),c=n.getY(),d=eE.CORR;return i<this.width/2?[new em(h-d,c+d),new em(a+d,o+d),new em(l-d,u-d),new em(i+d,s-d)]:[new em(h+d,c+d),new em(a+d,o-d),new em(l-d,u+d),new em(i-d,s-d)]}containsBlackPoint(e,t,r,n){let i=this.image;if(n){for(let n=e;n<=t;n++)if(i.get(n,r))return!0}else for(let n=e;n<=t;n++)if(i.get(r,n))return!0;return!1}}eE.INIT_SIZE=10,eE.CORR=1;class eC{static checkAndNudgePoints(e,t){let r=e.getWidth(),n=e.getHeight(),i=!0;for(let e=0;e<t.length&&i;e+=2){let s=Math.floor(t[e]),a=Math.floor(t[e+1]);if(s<-1||s>r||a<-1||a>n)throw new Y;i=!1,-1===s?(t[e]=0,i=!0):s===r&&(t[e]=r-1,i=!0),-1===a?(t[e+1]=0,i=!0):a===n&&(t[e+1]=n-1,i=!0)}i=!0;for(let e=t.length-2;e>=0&&i;e-=2){let s=Math.floor(t[e]),a=Math.floor(t[e+1]);if(s<-1||s>r||a<-1||a>n)throw new Y;i=!1,-1===s?(t[e]=0,i=!0):s===r&&(t[e]=r-1,i=!0),-1===a?(t[e+1]=0,i=!0):a===n&&(t[e+1]=n-1,i=!0)}}}class eI{constructor(e,t,r,n,i,s,a,o,l){this.a11=e,this.a21=t,this.a31=r,this.a12=n,this.a22=i,this.a32=s,this.a13=a,this.a23=o,this.a33=l}static quadrilateralToQuadrilateral(e,t,r,n,i,s,a,o,l,u,h,c,d,f,g,p){let m=eI.quadrilateralToSquare(e,t,r,n,i,s,a,o);return eI.squareToQuadrilateral(l,u,h,c,d,f,g,p).times(m)}transformPoints(e){let t=e.length,r=this.a11,n=this.a12,i=this.a13,s=this.a21,a=this.a22,o=this.a23,l=this.a31,u=this.a32,h=this.a33;for(let c=0;c<t;c+=2){let t=e[c],d=e[c+1],f=i*t+o*d+h;e[c]=(r*t+s*d+l)/f,e[c+1]=(n*t+a*d+u)/f}}transformPointsWithValues(e,t){let r=this.a11,n=this.a12,i=this.a13,s=this.a21,a=this.a22,o=this.a23,l=this.a31,u=this.a32,h=this.a33,c=e.length;for(let d=0;d<c;d++){let c=e[d],f=t[d],g=i*c+o*f+h;e[d]=(r*c+s*f+l)/g,t[d]=(n*c+a*f+u)/g}}static squareToQuadrilateral(e,t,r,n,i,s,a,o){let l=e-r+i-a,u=t-n+s-o;if(0===l&&0===u)return new eI(r-e,i-r,e,n-t,s-n,t,0,0,1);{let h=r-i,c=a-i,d=n-s,f=o-s,g=h*f-c*d,p=(l*f-c*u)/g,m=(h*u-l*d)/g;return new eI(r-e+p*r,a-e+m*a,e,n-t+p*n,o-t+m*o,t,p,m,1)}}static quadrilateralToSquare(e,t,r,n,i,s,a,o){return eI.squareToQuadrilateral(e,t,r,n,i,s,a,o).buildAdjoint()}buildAdjoint(){return new eI(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(e){return new eI(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}class e_ extends eC{sampleGrid(e,t,r,n,i,s,a,o,l,u,h,c,d,f,g,p,m,y,w){let E=eI.quadrilateralToQuadrilateral(n,i,s,a,o,l,u,h,c,d,f,g,p,m,y,w);return this.sampleGridWithTransform(e,t,r,E)}sampleGridWithTransform(e,t,r,n){if(t<=0||r<=0)throw new Y;let i=new W(t,r),s=new Float32Array(2*t);for(let t=0;t<r;t++){let r=s.length,a=t+.5;for(let e=0;e<r;e+=2)s[e]=e/2+.5,s[e+1]=a;n.transformPoints(s),eC.checkAndNudgePoints(e,s);try{for(let n=0;n<r;n+=2)e.get(Math.floor(s[n]),Math.floor(s[n+1]))&&i.set(n/2,t)}catch(e){throw new Y}}return i}}class eA{static setGridSampler(e){eA.gridSampler=e}static getInstance(){return eA.gridSampler}}eA.gridSampler=new e_;class eS{constructor(e,t){this.x=e,this.y=t}toResultPoint(){return new em(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class eT{constructor(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}detect(){return this.detectMirror(!1)}detectMirror(e){let t=this.getMatrixCenter(),r=this.getBullsEyeCorners(t);if(e){let e=r[0];r[0]=r[2],r[2]=e}return this.extractParameters(r),new ew(this.sampleGrid(this.image,r[this.shift%4],r[(this.shift+1)%4],r[(this.shift+2)%4],r[(this.shift+3)%4]),this.getMatrixCornerPoints(r),this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(e){if(!this.isValidPoint(e[0])||!this.isValidPoint(e[1])||!this.isValidPoint(e[2])||!this.isValidPoint(e[3]))throw new Y;let t=2*this.nbCenterLayers,r=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(r,t);let n=0;for(let e=0;e<4;e++){let t=r[(this.shift+e)%4];this.compact?(n<<=7,n+=t>>1&127):(n<<=10,n+=(t>>2&992)+(t>>1&31))}let i=this.getCorrectedParameterData(n,this.compact);this.compact?(this.nbLayers=(i>>6)+1,this.nbDataBlocks=(63&i)+1):(this.nbLayers=(i>>11)+1,this.nbDataBlocks=(2047&i)+1)}getRotation(e,t){let r=0;e.forEach((e,n,i)=>{r=(r<<3)+((e>>t-2<<1)+(1&e))}),r=((1&r)<<11)+(r>>1);for(let e=0;e<4;e++)if(2>=B.bitCount(r^this.EXPECTED_CORNER_BITS[e]))return e;throw new Y}getCorrectedParameterData(e,t){let r,n;t?(r=7,n=2):(r=10,n=4);let i=r-n,s=new Int32Array(r);for(let t=r-1;t>=0;--t)s[t]=15&e,e>>=4;try{new ed(eu.AZTEC_PARAM).decode(s,i)}catch(e){throw new Y}let a=0;for(let e=0;e<n;e++)a=(a<<4)+s[e];return a}getBullsEyeCorners(e){let t=e,r=e,n=e,i=e,s=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let e=this.getFirstDifferent(t,s,1,-1),a=this.getFirstDifferent(r,s,1,1),o=this.getFirstDifferent(n,s,-1,1),l=this.getFirstDifferent(i,s,-1,-1);if(this.nbCenterLayers>2){let r=this.distancePoint(l,e)*this.nbCenterLayers/(this.distancePoint(i,t)*(this.nbCenterLayers+2));if(r<.75||r>1.25||!this.isWhiteOrBlackRectangle(e,a,o,l))break}t=e,r=a,n=o,i=l,s=!s}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new Y;this.compact=5===this.nbCenterLayers;let a=new em(t.getX()+.5,t.getY()-.5),o=new em(r.getX()+.5,r.getY()+.5),l=new em(n.getX()-.5,n.getY()+.5),u=new em(i.getX()-.5,i.getY()-.5);return this.expandSquare([a,o,l,u],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let e,t,r,n;try{let i=new eE(this.image).detect();e=i[0],t=i[1],r=i[2],n=i[3]}catch(a){let i=this.image.getWidth()/2,s=this.image.getHeight()/2;e=this.getFirstDifferent(new eS(i+7,s-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new eS(i+7,s+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new eS(i-7,s+7),!1,-1,1).toResultPoint(),n=this.getFirstDifferent(new eS(i-7,s-7),!1,-1,-1).toResultPoint()}let i=eg.round((e.getX()+n.getX()+t.getX()+r.getX())/4),s=eg.round((e.getY()+n.getY()+t.getY()+r.getY())/4);try{let a=new eE(this.image,15,i,s).detect();e=a[0],t=a[1],r=a[2],n=a[3]}catch(a){e=this.getFirstDifferent(new eS(i+7,s-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new eS(i+7,s+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new eS(i-7,s+7),!1,-1,1).toResultPoint(),n=this.getFirstDifferent(new eS(i-7,s-7),!1,-1,-1).toResultPoint()}return new eS(i=eg.round((e.getX()+n.getX()+t.getX()+r.getX())/4),s=eg.round((e.getY()+n.getY()+t.getY()+r.getY())/4))}getMatrixCornerPoints(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())}sampleGrid(e,t,r,n,i){let s=eA.getInstance(),a=this.getDimension(),o=a/2-this.nbCenterLayers,l=a/2+this.nbCenterLayers;return s.sampleGrid(e,a,a,o,o,l,o,l,l,o,l,t.getX(),t.getY(),r.getX(),r.getY(),n.getX(),n.getY(),i.getX(),i.getY())}sampleLine(e,t,r){let n=0,i=this.distanceResultPoint(e,t),s=i/r,a=e.getX(),o=e.getY(),l=s*(t.getX()-e.getX())/i,u=s*(t.getY()-e.getY())/i;for(let e=0;e<r;e++)this.image.get(eg.round(a+e*l),eg.round(o+e*u))&&(n|=1<<r-e-1);return n}isWhiteOrBlackRectangle(e,t,r,n){e=new eS(e.getX()-3,e.getY()+3),t=new eS(t.getX()-3,t.getY()-3),r=new eS(r.getX()+3,r.getY()-3),n=new eS(n.getX()+3,n.getY()+3);let i=this.getColor(n,e);if(0===i)return!1;let s=this.getColor(e,t);return s===i&&(s=this.getColor(t,r))===i&&(s=this.getColor(r,n))===i}getColor(e,t){let r=this.distancePoint(e,t),n=(t.getX()-e.getX())/r,i=(t.getY()-e.getY())/r,s=0,a=e.getX(),o=e.getY(),l=this.image.get(e.getX(),e.getY()),u=Math.ceil(r);for(let e=0;e<u;e++)a+=n,o+=i,this.image.get(eg.round(a),eg.round(o))!==l&&s++;let h=s/r;return h>.1&&h<.9?0:h<=.1===l?1:-1}getFirstDifferent(e,t,r,n){let i=e.getX()+r,s=e.getY()+n;for(;this.isValid(i,s)&&this.image.get(i,s)===t;)i+=r,s+=n;for(i-=r,s-=n;this.isValid(i,s)&&this.image.get(i,s)===t;)i+=r;for(i-=r;this.isValid(i,s)&&this.image.get(i,s)===t;)s+=n;return new eS(i,s-=n)}expandSquare(e,t,r){let n=r/(2*t),i=e[0].getX()-e[2].getX(),s=e[0].getY()-e[2].getY(),a=(e[0].getX()+e[2].getX())/2,o=(e[0].getY()+e[2].getY())/2,l=new em(a+n*i,o+n*s),u=new em(a-n*i,o-n*s);return i=e[1].getX()-e[3].getX(),s=e[1].getY()-e[3].getY(),[l,new em((a=(e[1].getX()+e[3].getX())/2)+n*i,(o=(e[1].getY()+e[3].getY())/2)+n*s),u,new em(a-n*i,o-n*s)]}isValid(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()}isValidPoint(e){let t=eg.round(e.getX()),r=eg.round(e.getY());return this.isValid(t,r)}distancePoint(e,t){return eg.distance(e.getX(),e.getY(),t.getX(),t.getY())}distanceResultPoint(e,t){return eg.distance(e.getX(),e.getY(),t.getX(),t.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(B.truncDivision(this.nbLayers-4,8)+1)+15}}class eb{decode(e,t=null){let r=null,n=new eT(e.getBlackMatrix()),i=null,s=null;try{let e=n.detectMirror(!1);i=e.getPoints(),this.reportFoundResultPoints(t,i),s=new ef().decode(e)}catch(e){r=e}if(null==s)try{let e=n.detectMirror(!0);i=e.getPoints(),this.reportFoundResultPoints(t,i),s=new ef().decode(e)}catch(e){if(null!=r)throw r;throw e}let a=new er(s.getText(),s.getRawBytes(),s.getNumBits(),i,en.AZTEC,x.currentTimeMillis()),o=s.getByteSegments();null!=o&&a.putMetadata(ei.BYTE_SEGMENTS,o);let l=s.getECLevel();return null!=l&&a.putMetadata(ei.ERROR_CORRECTION_LEVEL,l),a}reportFoundResultPoints(e,t){if(null!=e){let r=e.get(U.NEED_RESULT_POINT_CALLBACK);null!=r&&t.forEach((e,t,n)=>{r.foundPossibleResultPoint(e)})}}reset(){}}class ev{decode(e,t){try{return this.doDecode(e,t)}catch(r){if(t&&!0===t.get(U.TRY_HARDER)&&e.isRotateSupported()){let r=e.rotateCounterClockwise(),n=this.doDecode(r,t),i=n.getResultMetadata(),s=270;null!==i&&!0===i.get(ei.ORIENTATION)&&(s+=i.get(ei.ORIENTATION)%360),n.putMetadata(ei.ORIENTATION,s);let a=n.getResultPoints();if(null!==a){let e=r.getHeight();for(let t=0;t<a.length;t++)a[t]=new em(e-a[t].getY()-1,a[t].getX())}return n}throw new Y}}reset(){}doDecode(e,t){let r,n=e.getWidth(),i=e.getHeight(),s=new F(n),a=t&&!0===t.get(U.TRY_HARDER),o=Math.max(1,i>>(a?8:5));r=a?i:15;let l=Math.trunc(i/2);for(let a=0;a<r;a++){let r=Math.trunc((a+1)/2),u=l+o*((1&a)==0?r:-r);if(u<0||u>=i)break;try{s=e.getBlackRow(u,s)}catch(e){continue}for(let e=0;e<2;e++){if(1===e&&(s.reverse(),t&&!0===t.get(U.NEED_RESULT_POINT_CALLBACK))){let e=new Map;t.forEach((t,r)=>e.set(r,t)),e.delete(U.NEED_RESULT_POINT_CALLBACK),t=e}try{let r=this.decodeRow(u,s,t);if(1===e){r.putMetadata(ei.ORIENTATION,180);let e=r.getResultPoints();null!==e&&(e[0]=new em(n-e[0].getX()-1,e[0].getY()),e[1]=new em(n-e[1].getX()-1,e[1].getY()))}return r}catch(e){}}}throw new Y}static recordPattern(e,t,r){let n=r.length;for(let e=0;e<n;e++)r[e]=0;let i=e.getSize();if(t>=i)throw new Y;let s=!e.get(t),a=0,o=t;for(;o<i;){if(e.get(o)!==s)r[a]++;else if(++a===n)break;else r[a]=1,s=!s;o++}if(a!==n&&(a!==n-1||o!==i))throw new Y}static recordPatternInReverse(e,t,r){let n=r.length,i=e.get(t);for(;t>0&&n>=0;)e.get(--t)!==i&&(n--,i=!i);if(n>=0)throw new Y;ev.recordPattern(e,t+1,r)}static patternMatchVariance(e,t,r){let n=e.length,i=0,s=0;for(let r=0;r<n;r++)i+=e[r],s+=t[r];if(i<s)return 1/0;let a=i/s;r*=a;let o=0;for(let i=0;i<n;i++){let n=e[i],s=t[i]*a,l=n>s?n-s:s-n;if(l>r)return 1/0;o+=l}return o/i}}class eN extends ev{static findStartPattern(e){let t=e.getSize(),r=e.getNextSet(0),n=0,i=Int32Array.from([0,0,0,0,0,0]),s=r,a=!1;for(let o=r;o<t;o++)if(e.get(o)!==a)i[n]++;else{if(5===n){let t=eN.MAX_AVG_VARIANCE,r=-1;for(let e=eN.CODE_START_A;e<=eN.CODE_START_C;e++){let n=ev.patternMatchVariance(i,eN.CODE_PATTERNS[e],eN.MAX_INDIVIDUAL_VARIANCE);n<t&&(t=n,r=e)}if(r>=0&&e.isRange(Math.max(0,s-(o-s)/2),s,!1))return Int32Array.from([s,o,r]);s+=i[0]+i[1],(i=i.slice(2,i.length-1))[n-1]=0,i[n]=0,n--}else n++;i[n]=1,a=!a}throw new Y}static decodeCode(e,t,r){ev.recordPattern(e,r,t);let n=eN.MAX_AVG_VARIANCE,i=-1;for(let e=0;e<eN.CODE_PATTERNS.length;e++){let r=eN.CODE_PATTERNS[e],s=this.patternMatchVariance(t,r,eN.MAX_INDIVIDUAL_VARIANCE);s<n&&(n=s,i=e)}if(i>=0)return i;throw new Y}decodeRow(e,t,r){let n,i=r&&!0===r.get(U.ASSUME_GS1),s=eN.findStartPattern(t),a=s[2],o=0,l=new Uint8Array(20);switch(l[o++]=a,a){case eN.CODE_START_A:n=eN.CODE_CODE_A;break;case eN.CODE_START_B:n=eN.CODE_CODE_B;break;case eN.CODE_START_C:n=eN.CODE_CODE_C;break;default:throw new V}let u=!1,h=!1,c="",d=s[0],f=s[1],g=Int32Array.from([0,0,0,0,0,0]),p=0,m=0,y=a,w=0,E=!0,C=!1,I=!1;for(;!u;){let e=h;switch(h=!1,p=m,m=eN.decodeCode(t,g,f),l[o++]=m,m!==eN.CODE_STOP&&(E=!0),m!==eN.CODE_STOP&&(y+=++w*m),d=f,f+=g.reduce((e,t)=>e+t,0),m){case eN.CODE_START_A:case eN.CODE_START_B:case eN.CODE_START_C:throw new V}switch(n){case eN.CODE_CODE_A:if(m<64)I===C?c+=String.fromCharCode(32+m):c+=String.fromCharCode(32+m+128),I=!1;else if(m<96)I===C?c+=String.fromCharCode(m-64):c+=String.fromCharCode(m+64),I=!1;else switch(m!==eN.CODE_STOP&&(E=!1),m){case eN.CODE_FNC_1:i&&(0===c.length?c+="]C1":c+="\x1d");break;case eN.CODE_FNC_2:case eN.CODE_FNC_3:break;case eN.CODE_FNC_4_A:!C&&I?(C=!0,I=!1):C&&I?(C=!1,I=!1):I=!0;break;case eN.CODE_SHIFT:h=!0,n=eN.CODE_CODE_B;break;case eN.CODE_CODE_B:n=eN.CODE_CODE_B;break;case eN.CODE_CODE_C:n=eN.CODE_CODE_C;break;case eN.CODE_STOP:u=!0}break;case eN.CODE_CODE_B:if(m<96)I===C?c+=String.fromCharCode(32+m):c+=String.fromCharCode(32+m+128),I=!1;else switch(m!==eN.CODE_STOP&&(E=!1),m){case eN.CODE_FNC_1:i&&(0===c.length?c+="]C1":c+="\x1d");break;case eN.CODE_FNC_2:case eN.CODE_FNC_3:break;case eN.CODE_FNC_4_B:!C&&I?(C=!0,I=!1):C&&I?(C=!1,I=!1):I=!0;break;case eN.CODE_SHIFT:h=!0,n=eN.CODE_CODE_A;break;case eN.CODE_CODE_A:n=eN.CODE_CODE_A;break;case eN.CODE_CODE_C:n=eN.CODE_CODE_C;break;case eN.CODE_STOP:u=!0}break;case eN.CODE_CODE_C:if(m<100)m<10&&(c+="0"),c+=m;else switch(m!==eN.CODE_STOP&&(E=!1),m){case eN.CODE_FNC_1:i&&(0===c.length?c+="]C1":c+="\x1d");break;case eN.CODE_CODE_A:n=eN.CODE_CODE_A;break;case eN.CODE_CODE_B:n=eN.CODE_CODE_B;break;case eN.CODE_STOP:u=!0}}e&&(n=n===eN.CODE_CODE_A?eN.CODE_CODE_B:eN.CODE_CODE_A)}let _=f-d;if(f=t.getNextUnset(f),!t.isRange(f,Math.min(t.getSize(),f+(f-d)/2),!1))throw new Y;if((y-=w*p)%103!==p)throw new M;let A=c.length;if(0===A)throw new Y;A>0&&E&&(c=n===eN.CODE_CODE_C?c.substring(0,A-2):c.substring(0,A-1));let S=(s[1]+s[0])/2,T=d+_/2,b=l.length,v=new Uint8Array(b);for(let e=0;e<b;e++)v[e]=l[e];return new er(c,v,0,[new em(S,e),new em(T,e)],en.CODE_128,new Date().getTime())}}eN.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],eN.MAX_AVG_VARIANCE=.25,eN.MAX_INDIVIDUAL_VARIANCE=.7,eN.CODE_SHIFT=98,eN.CODE_CODE_C=99,eN.CODE_CODE_B=100,eN.CODE_CODE_A=101,eN.CODE_FNC_1=102,eN.CODE_FNC_2=97,eN.CODE_FNC_3=96,eN.CODE_FNC_4_A=101,eN.CODE_FNC_4_B=100,eN.CODE_START_A=103,eN.CODE_START_B=104,eN.CODE_START_C=105,eN.CODE_STOP=106;class eD extends ev{constructor(e=!1,t=!1){super(),this.usingCheckDigit=e,this.extendedMode=t,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(e,t,r){let n,i,s,a=this.counters;a.fill(0),this.decodeRowResult="";let o=eD.findAsteriskPattern(t,a),l=t.getNextSet(o[1]),u=t.getSize();do{eD.recordPattern(t,l,a);let e=eD.toNarrowWidePattern(a);if(e<0)throw new Y;for(let t of(n=eD.patternToChar(e),this.decodeRowResult+=n,i=l,a))l+=t;l=t.getNextSet(l)}while("*"!==n)this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let h=0;for(let e of a)h+=e;let c=l-i-h;if(l!==u&&2*c<h)throw new Y;if(this.usingCheckDigit){let e=this.decodeRowResult.length-1,t=0;for(let r=0;r<e;r++)t+=eD.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(r));if(this.decodeRowResult.charAt(e)!==eD.ALPHABET_STRING.charAt(t%43))throw new M;this.decodeRowResult=this.decodeRowResult.substring(0,e)}if(0===this.decodeRowResult.length)throw new Y;s=this.extendedMode?eD.decodeExtended(this.decodeRowResult):this.decodeRowResult;let d=(o[1]+o[0])/2,f=i+h/2;return new er(s,null,0,[new em(d,e),new em(f,e)],en.CODE_39,new Date().getTime())}static findAsteriskPattern(e,t){let r=e.getSize(),n=e.getNextSet(0),i=0,s=n,a=!1,o=t.length;for(let l=n;l<r;l++)if(e.get(l)!==a)t[i]++;else{if(i===o-1){if(this.toNarrowWidePattern(t)===eD.ASTERISK_ENCODING&&e.isRange(Math.max(0,s-Math.floor((l-s)/2)),s,!1))return[s,l];s+=t[0]+t[1],t.copyWithin(0,2,2+i-1),t[i-1]=0,t[i]=0,i--}else i++;t[i]=1,a=!a}throw new Y}static toNarrowWidePattern(e){let t,r=e.length,n=0;do{let i=0x7fffffff;for(let t of e)t<i&&t>n&&(i=t);n=i,t=0;let s=0,a=0;for(let i=0;i<r;i++){let o=e[i];o>n&&(a|=1<<r-1-i,t++,s+=o)}if(3===t){for(let i=0;i<r&&t>0;i++){let r=e[i];if(r>n&&(t--,2*r>=s))return -1}return a}}while(t>3)return -1}static patternToChar(e){for(let t=0;t<eD.CHARACTER_ENCODINGS.length;t++)if(eD.CHARACTER_ENCODINGS[t]===e)return eD.ALPHABET_STRING.charAt(t);if(e===eD.ASTERISK_ENCODING)return"*";throw new Y}static decodeExtended(e){let t=e.length,r="";for(let n=0;n<t;n++){let t=e.charAt(n);if("+"===t||"$"===t||"%"===t||"/"===t){let i=e.charAt(n+1),s="\0";switch(t){case"+":if(i>="A"&&i<="Z")s=String.fromCharCode(i.charCodeAt(0)+32);else throw new V;break;case"$":if(i>="A"&&i<="Z")s=String.fromCharCode(i.charCodeAt(0)-64);else throw new V;break;case"%":if(i>="A"&&i<="E")s=String.fromCharCode(i.charCodeAt(0)-38);else if(i>="F"&&i<="J")s=String.fromCharCode(i.charCodeAt(0)-11);else if(i>="K"&&i<="O")s=String.fromCharCode(i.charCodeAt(0)+16);else if(i>="P"&&i<="T")s=String.fromCharCode(i.charCodeAt(0)+43);else if("U"===i)s="\0";else if("V"===i)s="@";else if("W"===i)s="`";else if("X"===i||"Y"===i||"Z"===i)s="";else throw new V;break;case"/":if(i>="A"&&i<="O")s=String.fromCharCode(i.charCodeAt(0)-32);else if("Z"===i)s=":";else throw new V}r+=s,n++}else r+=t}return r}}eD.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",eD.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],eD.ASTERISK_ENCODING=148;class eR extends ev{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(e,t,r){let n=this.decodeStart(t),i=this.decodeEnd(t),s=new q;eR.decodeMiddle(t,n[1],i[0],s);let a=s.toString(),o=null;null!=r&&(o=r.get(U.ALLOWED_LENGTHS)),null==o&&(o=eR.DEFAULT_ALLOWED_LENGTHS);let l=a.length,u=!1,h=0;for(let e of o){if(l===e){u=!0;break}e>h&&(h=e)}if(!u&&l>h&&(u=!0),!u)throw new V;return new er(a,null,0,[new em(n[1],e),new em(i[0],e)],en.ITF,new Date().getTime())}static decodeMiddle(e,t,r,n){let i=new Int32Array(10),s=new Int32Array(5),a=new Int32Array(5);for(i.fill(0),s.fill(0),a.fill(0);t<r;){ev.recordPattern(e,t,i);for(let e=0;e<5;e++){let t=2*e;s[e]=i[t],a[e]=i[t+1]}let r=eR.decodeDigit(s);n.append(r.toString()),r=this.decodeDigit(a),n.append(r.toString()),i.forEach(function(e){t+=e})}}decodeStart(e){let t=eR.skipWhiteSpace(e),r=eR.findGuardPattern(e,t,eR.START_PATTERN);return this.narrowLineWidth=(r[1]-r[0])/4,this.validateQuietZone(e,r[0]),r}validateQuietZone(e,t){let r=10*this.narrowLineWidth;r=r<t?r:t;for(let n=t-1;r>0&&n>=0&&!e.get(n);n--)r--;if(0!==r)throw new Y}static skipWhiteSpace(e){let t=e.getSize(),r=e.getNextSet(0);if(r===t)throw new Y;return r}decodeEnd(e){e.reverse();try{let t,r=eR.skipWhiteSpace(e);try{t=eR.findGuardPattern(e,r,eR.END_PATTERN_REVERSED[0])}catch(n){n instanceof Y&&(t=eR.findGuardPattern(e,r,eR.END_PATTERN_REVERSED[1]))}this.validateQuietZone(e,t[0]);let n=t[0];return t[0]=e.getSize()-t[1],t[1]=e.getSize()-n,t}finally{e.reverse()}}static findGuardPattern(e,t,r){let n=r.length,i=new Int32Array(n),s=e.getSize(),a=!1,o=0,l=t;i.fill(0);for(let u=t;u<s;u++)if(e.get(u)!==a)i[o]++;else{if(o===n-1){if(ev.patternMatchVariance(i,r,eR.MAX_INDIVIDUAL_VARIANCE)<eR.MAX_AVG_VARIANCE)return[l,u];l+=i[0]+i[1],x.arraycopy(i,2,i,0,o-1),i[o-1]=0,i[o]=0,o--}else o++;i[o]=1,a=!a}throw new Y}static decodeDigit(e){let t=eR.MAX_AVG_VARIANCE,r=-1,n=eR.PATTERNS.length;for(let i=0;i<n;i++){let n=eR.PATTERNS[i],s=ev.patternMatchVariance(e,n,eR.MAX_INDIVIDUAL_VARIANCE);s<t?(t=s,r=i):s===t&&(r=-1)}if(r>=0)return r%10;throw new Y}}eR.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],eR.MAX_AVG_VARIANCE=.38,eR.MAX_INDIVIDUAL_VARIANCE=.5,eR.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],eR.START_PATTERN=Int32Array.from([1,1,1,1]),eR.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class eM extends ev{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(e){let t,r=!1,n=0,i=Int32Array.from([0,0,0]);for(;!r;){i=Int32Array.from([0,0,0]);let s=(t=eM.findGuardPattern(e,n,!1,this.START_END_PATTERN,i))[0],a=s-((n=t[1])-s);a>=0&&(r=e.isRange(a,s,!1))}return t}static checkChecksum(e){return eM.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let r=parseInt(e.charAt(t-1),10);return eM.getStandardUPCEANChecksum(e.substring(0,t-1))===r}static getStandardUPCEANChecksum(e){let t=e.length,r=0;for(let n=t-1;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-48;if(t<0||t>9)throw new V;r+=t}r*=3;for(let n=t-2;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-48;if(t<0||t>9)throw new V;r+=t}return(1e3-r)%10}static decodeEnd(e,t){return eM.findGuardPattern(e,t,!1,eM.START_END_PATTERN,new Int32Array(eM.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(e,t,r,n){return this.findGuardPattern(e,t,r,n,new Int32Array(n.length))}static findGuardPattern(e,t,r,n,i){let s=e.getSize();t=r?e.getNextUnset(t):e.getNextSet(t);let a=0,o=t,l=n.length,u=r;for(let r=t;r<s;r++)if(e.get(r)!==u)i[a]++;else{if(a===l-1){if(ev.patternMatchVariance(i,n,eM.MAX_INDIVIDUAL_VARIANCE)<eM.MAX_AVG_VARIANCE)return Int32Array.from([o,r]);o+=i[0]+i[1];let e=i.slice(2,i.length-1);for(let t=0;t<a-1;t++)i[t]=e[t];i[a-1]=0,i[a]=0,a--}else a++;i[a]=1,u=!u}throw new Y}static decodeDigit(e,t,r,n){this.recordPattern(e,r,t);let i=this.MAX_AVG_VARIANCE,s=-1,a=n.length;for(let e=0;e<a;e++){let r=n[e],a=ev.patternMatchVariance(t,r,eM.MAX_INDIVIDUAL_VARIANCE);a<i&&(i=a,s=e)}if(s>=0)return s;throw new Y}}eM.MAX_AVG_VARIANCE=.48,eM.MAX_INDIVIDUAL_VARIANCE=.7,eM.START_END_PATTERN=Int32Array.from([1,1,1]),eM.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),eM.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),eM.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class eO{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,r){let n=this.decodeRowStringBuffer,i=this.decodeMiddle(t,r,n),s=n.toString(),a=eO.parseExtensionString(s),o=new er(s,null,0,[new em((r[0]+r[1])/2,e),new em(i,e)],en.UPC_EAN_EXTENSION,new Date().getTime());return null!=a&&o.putAllMetadata(a),o}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let t=0;t<5&&s<i;t++){let i=eM.decodeDigit(e,n,s,eM.L_AND_G_PATTERNS);for(let e of(r+=String.fromCharCode(48+i%10),n))s+=e;i>=10&&(a|=1<<4-t),4!==t&&(s=e.getNextSet(s),s=e.getNextUnset(s))}if(5!==r.length)throw new Y;let o=this.determineCheckDigit(a);if(eO.extensionChecksum(r.toString())!==o)throw new Y;return s}static extensionChecksum(e){let t=e.length,r=0;for(let n=t-2;n>=0;n-=2)r+=e.charAt(n).charCodeAt(0)-48;r*=3;for(let n=t-1;n>=0;n-=2)r+=e.charAt(n).charCodeAt(0)-48;return(r*=3)%10}determineCheckDigit(e){for(let t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new Y}static parseExtensionString(e){if(5!==e.length)return null;let t=eO.parseExtension5String(e);return null==t?null:new Map([[ei.SUGGESTED_PRICE,t]])}static parseExtension5String(e){let t;switch(e.charAt(0)){case"0":t="";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t=""}let r=parseInt(e.substring(1)),n=(r/100).toString(),i=r%100;return t+n+"."+(i<10?"0"+i:i.toString())}}class ex{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,r){let n=this.decodeRowStringBuffer,i=this.decodeMiddle(t,r,n),s=n.toString(),a=ex.parseExtensionString(s),o=new er(s,null,0,[new em((r[0]+r[1])/2,e),new em(i,e)],en.UPC_EAN_EXTENSION,new Date().getTime());return null!=a&&o.putAllMetadata(a),o}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let t=0;t<2&&s<i;t++){let i=eM.decodeDigit(e,n,s,eM.L_AND_G_PATTERNS);for(let e of(r+=String.fromCharCode(48+i%10),n))s+=e;i>=10&&(a|=1<<1-t),1!==t&&(s=e.getNextSet(s),s=e.getNextUnset(s))}if(2!==r.length||parseInt(r.toString())%4!==a)throw new Y;return s}static parseExtensionString(e){return 2!==e.length?null:new Map([[ei.ISSUE_NUMBER,parseInt(e)]])}}class eL{static decodeRow(e,t,r){let n=eM.findGuardPattern(t,r,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new eO().decodeRow(e,t,n)}catch(r){return new ex().decodeRow(e,t,n)}}}eL.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class eP extends eM{constructor(){super(),this.decodeRowStringBuffer="",eP.L_AND_G_PATTERNS=eP.L_PATTERNS.map(e=>Int32Array.from(e));for(let e=10;e<20;e++){let t=eP.L_PATTERNS[e-10],r=new Int32Array(t.length);for(let e=0;e<t.length;e++)r[e]=t[t.length-e-1];eP.L_AND_G_PATTERNS[e]=r}}decodeRow(e,t,r){let n=eP.findStartGuardPattern(t),i=null==r?null:r.get(U.NEED_RESULT_POINT_CALLBACK);if(null!=i){let t=new em((n[0]+n[1])/2,e);i.foundPossibleResultPoint(t)}let s=this.decodeMiddle(t,n,this.decodeRowStringBuffer),a=s.rowOffset,o=s.resultString;if(null!=i){let t=new em(a,e);i.foundPossibleResultPoint(t)}let l=this.decodeEnd(t,a);if(null!=i){let t=new em((l[0]+l[1])/2,e);i.foundPossibleResultPoint(t)}let u=l[1],h=u+(u-l[0]);if(h>=t.getSize()||!t.isRange(u,h,!1))throw new Y;let c=o.toString();if(c.length<8)throw new V;if(!eP.checkChecksum(c))throw new M;let d=(n[1]+n[0])/2,f=(l[1]+l[0])/2,g=this.getBarcodeFormat(),p=new er(c,null,0,[new em(d,e),new em(f,e)],g,new Date().getTime()),m=0;try{let r=eL.decodeRow(e,t,l[1]);p.putMetadata(ei.UPC_EAN_EXTENSION,r.getText()),p.putAllMetadata(r.getResultMetadata()),p.addResultPoints(r.getResultPoints()),m=r.getText().length}catch(e){}let y=null==r?null:r.get(U.ALLOWED_EAN_EXTENSIONS);if(null!=y){let e=!1;for(let t in y)if(m.toString()===t){e=!0;break}if(!e)throw new Y}return p}decodeEnd(e,t){return eP.findGuardPattern(e,t,!1,eP.START_END_PATTERN,new Int32Array(eP.START_END_PATTERN.length).fill(0))}static checkChecksum(e){return eP.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let r=parseInt(e.charAt(t-1),10);return eP.getStandardUPCEANChecksum(e.substring(0,t-1))===r}static getStandardUPCEANChecksum(e){let t=e.length,r=0;for(let n=t-1;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-48;if(t<0||t>9)throw new V;r+=t}r*=3;for(let n=t-2;n>=0;n-=2){let t=e.charAt(n).charCodeAt(0)-48;if(t<0||t>9)throw new V;r+=t}return(1e3-r)%10}}class ek extends eP{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let t=0;t<6&&s<i;t++){let i=eP.decodeDigit(e,n,s,eP.L_AND_G_PATTERNS);for(let e of(r+=String.fromCharCode(48+i%10),n))s+=e;i>=10&&(a|=1<<5-t)}r=ek.determineFirstDigit(r,a),s=eP.findGuardPattern(e,s,!0,eP.MIDDLE_PATTERN,new Int32Array(eP.MIDDLE_PATTERN.length).fill(0))[1];for(let t=0;t<6&&s<i;t++){let t=eP.decodeDigit(e,n,s,eP.L_PATTERNS);for(let e of(r+=String.fromCharCode(48+t),n))s+=e}return{rowOffset:s,resultString:r}}getBarcodeFormat(){return en.EAN_13}static determineFirstDigit(e,t){for(let r=0;r<10;r++)if(t===this.FIRST_DIGIT_ENCODINGS[r])return e=String.fromCharCode(48+r)+e;throw new Y}}ek.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class eB extends eP{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters;n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1];for(let t=0;t<4&&s<i;t++){let t=eP.decodeDigit(e,n,s,eP.L_PATTERNS);for(let e of(r+=String.fromCharCode(48+t),n))s+=e}s=eP.findGuardPattern(e,s,!0,eP.MIDDLE_PATTERN,new Int32Array(eP.MIDDLE_PATTERN.length).fill(0))[1];for(let t=0;t<4&&s<i;t++){let t=eP.decodeDigit(e,n,s,eP.L_PATTERNS);for(let e of(r+=String.fromCharCode(48+t),n))s+=e}return{rowOffset:s,resultString:r}}getBarcodeFormat(){return en.EAN_8}}class eF extends eP{constructor(){super(...arguments),this.ean13Reader=new ek}getBarcodeFormat(){return en.UPC_A}decode(e,t){return this.maybeReturnResult(this.ean13Reader.decode(e))}decodeRow(e,t,r){return this.maybeReturnResult(this.ean13Reader.decodeRow(e,t,r))}decodeMiddle(e,t,r){return this.ean13Reader.decodeMiddle(e,t,r)}maybeReturnResult(e){let t=e.getText();if("0"===t.charAt(0)){let r=new er(t.substring(1),null,null,e.getResultPoints(),en.UPC_A);return null!=e.getResultMetadata()&&r.putAllMetadata(e.getResultMetadata()),r}throw new Y}reset(){this.ean13Reader.reset()}}class eU extends eP{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(e,t,r){let n=this.decodeMiddleCounters.map(e=>e);n[0]=0,n[1]=0,n[2]=0,n[3]=0;let i=e.getSize(),s=t[1],a=0;for(let t=0;t<6&&s<i;t++){let i=eU.decodeDigit(e,n,s,eU.L_AND_G_PATTERNS);for(let e of(r+=String.fromCharCode(48+i%10),n))s+=e;i>=10&&(a|=1<<5-t)}return{rowOffset:s,resultString:eU.determineNumSysAndCheckDigit(r,a)}}decodeEnd(e,t){return eU.findGuardPatternWithoutCounters(e,t,!0,eU.MIDDLE_END_PATTERN)}checkChecksum(e){return eP.checkChecksum(eU.convertUPCEtoUPCA(e))}static determineNumSysAndCheckDigit(e,t){for(let r=0;r<=1;r++)for(let n=0;n<10;n++)if(t===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[r][n])return String.fromCharCode(48+r)+e+String.fromCharCode(48+n);throw Y.getNotFoundInstance()}getBarcodeFormat(){return en.UPC_E}static convertUPCEtoUPCA(e){let t=e.slice(1,7).split("").map(e=>e.charCodeAt(0)),r=new q;r.append(e.charAt(0));let n=t[5];switch(n){case 0:case 1:case 2:r.appendChars(t,0,2),r.append(n),r.append("0000"),r.appendChars(t,2,3);break;case 3:r.appendChars(t,0,3),r.append("00000"),r.appendChars(t,3,2);break;case 4:r.appendChars(t,0,4),r.append("00000"),r.append(t[4]);break;default:r.appendChars(t,0,5),r.append("0000"),r.append(n)}return e.length>=8&&r.append(e.charAt(7)),r.toString()}}eU.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),eU.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class eV extends ev{constructor(e){super();let t=null==e?null:e.get(U.POSSIBLE_FORMATS),r=[];null==t?(r.push(new ek),r.push(new eF),r.push(new eB),r.push(new eU)):(t.indexOf(en.EAN_13)>-1&&r.push(new ek),t.indexOf(en.UPC_A)>-1&&r.push(new eF),t.indexOf(en.EAN_8)>-1&&r.push(new eB),t.indexOf(en.UPC_E)>-1&&r.push(new eU)),this.readers=r}decodeRow(e,t,r){for(let n of this.readers)try{let i=n.decodeRow(e,t,r),s=i.getBarcodeFormat()===en.EAN_13&&"0"===i.getText().charAt(0),a=null==r?null:r.get(U.POSSIBLE_FORMATS),o=null==a||a.includes(en.UPC_A);if(s&&o){let e=i.getRawBytes(),t=new er(i.getText().substring(1),e,e?e.length:null,i.getResultPoints(),en.UPC_A);return t.putAllMetadata(i.getResultMetadata()),t}return i}catch(e){}throw new Y}reset(){for(let e of this.readers)e.reset()}}class ej extends ev{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=[,,,,],this.evenRoundingErrors=[,,,,],this.oddCounts=Array(this.dataCharacterCounters.length/2),this.evenCounts=Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(e,t){for(let r=0;r<t.length;r++)if(ev.patternMatchVariance(e,t[r],ej.MAX_INDIVIDUAL_VARIANCE)<ej.MAX_AVG_VARIANCE)return r;throw new Y}static count(e){return eg.sum(new Int32Array(e))}static increment(e,t){let r=0,n=t[0];for(let i=1;i<e.length;i++)t[i]>n&&(n=t[i],r=i);e[r]++}static decrement(e,t){let r=0,n=t[0];for(let i=1;i<e.length;i++)t[i]<n&&(n=t[i],r=i);e[r]--}static isFinderPattern(e){let t=e[0]+e[1],r=t+e[2]+e[3],n=t/r;if(n>=ej.MIN_FINDER_PATTERN_RATIO&&n<=ej.MAX_FINDER_PATTERN_RATIO){let t=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let n of e)n>r&&(r=n),n<t&&(t=n);return r<10*t}return!1}}ej.MAX_AVG_VARIANCE=.2,ej.MAX_INDIVIDUAL_VARIANCE=.45,ej.MIN_FINDER_PATTERN_RATIO=9.5/12,ej.MAX_FINDER_PATTERN_RATIO=12.5/14;class ez{constructor(e,t){this.value=e,this.checksumPortion=t}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(e){return e instanceof ez&&this.value===e.value&&this.checksumPortion===e.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class eH{constructor(e,t,r,n,i){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=[],this.resultPoints.push(new em(r,i)),this.resultPoints.push(new em(n,i))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(e){return e instanceof eH&&this.value===e.value}hashCode(){return this.value}}class eG{static getRSSvalue(e,t,r){let n=0;for(let t of e)n+=t;let i=0,s=0,a=e.length;for(let o=0;o<a-1;o++){let l;for(l=1,s|=1<<o;l<e[o];l++,s&=~(1<<o)){let e=eG.combins(n-l-1,a-o-2);if(r&&0===s&&n-l-(a-o-1)>=a-o-1&&(e-=eG.combins(n-l-(a-o),a-o-2)),a-o-1>1){let r=0;for(let e=n-l-(a-o-2);e>t;e--)r+=eG.combins(n-l-e-1,a-o-3);e-=r*(a-1-o)}else n-l>t&&e--;i+=e}n-=l}return i}static combins(e,t){let r,n;e-t>t?(n=t,r=e-t):(n=e-t,r=t);let i=1,s=1;for(let t=e;t>r;t--)i*=t,s<=n&&(i/=s,s++);for(;s<=n;)i/=s,s++;return i}}class eq{static buildBitArray(e){let t=2*e.length-1;null==e[e.length-1].getRightChar()&&(t-=1);let r=new F(12*t),n=0,i=e[0].getRightChar().getValue();for(let e=11;e>=0;--e)(i&1<<e)!=0&&r.set(n),n++;for(let t=1;t<e.length;++t){let i=e[t],s=i.getLeftChar().getValue();for(let e=11;e>=0;--e)(s&1<<e)!=0&&r.set(n),n++;if(null!=i.getRightChar()){let e=i.getRightChar().getValue();for(let t=11;t>=0;--t)(e&1<<t)!=0&&r.set(n),n++}}return r}}class eW{constructor(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class eY{constructor(e){this.newPosition=e}getNewPosition(){return this.newPosition}}class eK extends eY{constructor(e,t){super(e),this.value=t}getValue(){return this.value}isFNC1(){return this.value===eK.FNC1}}eK.FNC1="$";class eX extends eY{constructor(e,t,r){super(e),r?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=t}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class eQ extends eY{constructor(e,t,r){if(super(e),t<0||t>10||r<0||r>10)throw new V;this.firstDigit=t,this.secondDigit=r}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return 10*this.firstDigit+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===eQ.FNC1}isSecondDigitFNC1(){return this.secondDigit===eQ.FNC1}isAnyFNC1(){return this.firstDigit===eQ.FNC1||this.secondDigit===eQ.FNC1}}eQ.FNC1=10;class e${static parseFieldsInGeneralPurpose(e){if(!e)return null;if(e.length<2)throw new Y;let t=e.substring(0,2);for(let r of e$.TWO_DIGIT_DATA_LENGTH)if(r[0]===t){if(r[1]===e$.VARIABLE_LENGTH)return e$.processVariableAI(2,r[2],e);return e$.processFixedAI(2,r[1],e)}if(e.length<3)throw new Y;let r=e.substring(0,3);for(let t of e$.THREE_DIGIT_DATA_LENGTH)if(t[0]===r){if(t[1]===e$.VARIABLE_LENGTH)return e$.processVariableAI(3,t[2],e);return e$.processFixedAI(3,t[1],e)}for(let t of e$.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(t[0]===r){if(t[1]===e$.VARIABLE_LENGTH)return e$.processVariableAI(4,t[2],e);return e$.processFixedAI(4,t[1],e)}if(e.length<4)throw new Y;let n=e.substring(0,4);for(let t of e$.FOUR_DIGIT_DATA_LENGTH)if(t[0]===n){if(t[1]===e$.VARIABLE_LENGTH)return e$.processVariableAI(4,t[2],e);return e$.processFixedAI(4,t[1],e)}throw new Y}static processFixedAI(e,t,r){if(r.length<e)throw new Y;let n=r.substring(0,e);if(r.length<e+t)throw new Y;let i=r.substring(e,e+t),s=r.substring(e+t),a="("+n+")"+i,o=e$.parseFieldsInGeneralPurpose(s);return null==o?a:a+o}static processVariableAI(e,t,r){let n,i=r.substring(0,e);n=r.length<e+t?r.length:e+t;let s=r.substring(e,n),a=r.substring(n),o="("+i+")"+s,l=e$.parseFieldsInGeneralPurpose(a);return null==l?o:o+l}}e$.VARIABLE_LENGTH=[],e$.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",e$.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",e$.VARIABLE_LENGTH,20],["22",e$.VARIABLE_LENGTH,29],["30",e$.VARIABLE_LENGTH,8],["37",e$.VARIABLE_LENGTH,8],["90",e$.VARIABLE_LENGTH,30],["91",e$.VARIABLE_LENGTH,30],["92",e$.VARIABLE_LENGTH,30],["93",e$.VARIABLE_LENGTH,30],["94",e$.VARIABLE_LENGTH,30],["95",e$.VARIABLE_LENGTH,30],["96",e$.VARIABLE_LENGTH,30],["97",e$.VARIABLE_LENGTH,3],["98",e$.VARIABLE_LENGTH,30],["99",e$.VARIABLE_LENGTH,30]],e$.THREE_DIGIT_DATA_LENGTH=[["240",e$.VARIABLE_LENGTH,30],["241",e$.VARIABLE_LENGTH,30],["242",e$.VARIABLE_LENGTH,6],["250",e$.VARIABLE_LENGTH,30],["251",e$.VARIABLE_LENGTH,30],["253",e$.VARIABLE_LENGTH,17],["254",e$.VARIABLE_LENGTH,20],["400",e$.VARIABLE_LENGTH,30],["401",e$.VARIABLE_LENGTH,30],["402",17],["403",e$.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",e$.VARIABLE_LENGTH,20],["421",e$.VARIABLE_LENGTH,15],["422",3],["423",e$.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],e$.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",e$.VARIABLE_LENGTH,15],["391",e$.VARIABLE_LENGTH,18],["392",e$.VARIABLE_LENGTH,15],["393",e$.VARIABLE_LENGTH,18],["703",e$.VARIABLE_LENGTH,30]],e$.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",e$.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",e$.VARIABLE_LENGTH,20],["8003",e$.VARIABLE_LENGTH,30],["8004",e$.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",e$.VARIABLE_LENGTH,30],["8008",e$.VARIABLE_LENGTH,12],["8018",18],["8020",e$.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",e$.VARIABLE_LENGTH,70],["8200",e$.VARIABLE_LENGTH,70]];class eZ{constructor(e){this.buffer=new q,this.information=e}decodeAllCodes(e,t){let r=t,n=null;for(;;){let t=this.decodeGeneralPurposeField(r,n),i=e$.parseFieldsInGeneralPurpose(t.getNewString());if(null!=i&&e.append(i),n=t.isRemaining()?""+t.getRemainingValue():null,r===t.getNewPosition())break;r=t.getNewPosition()}return e.toString()}isStillNumeric(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(let t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)}decodeNumeric(e){if(e+7>this.information.getSize()){let t=this.extractNumericValueFromBitArray(e,4);return 0===t?new eQ(this.information.getSize(),eQ.FNC1,eQ.FNC1):new eQ(this.information.getSize(),t-1,eQ.FNC1)}let t=this.extractNumericValueFromBitArray(e,7);return new eQ(e+7,(t-8)/11,(t-8)%11)}extractNumericValueFromBitArray(e,t){return eZ.extractNumericValueFromBitArray(this.information,e,t)}static extractNumericValueFromBitArray(e,t,r){let n=0;for(let i=0;i<r;++i)e.get(t+i)&&(n|=1<<r-i-1);return n}decodeGeneralPurposeField(e,t){this.buffer.setLengthToZero(),null!=t&&this.buffer.append(t),this.current.setPosition(e);let r=this.parseBlocks();return null!=r&&r.isRemaining()?new eX(this.current.getPosition(),this.buffer.toString(),r.getRemainingValue()):new eX(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let e,t;do{let r=this.current.getPosition();if(e=this.current.isAlpha()?(t=this.parseAlphaBlock()).isFinished():this.current.isIsoIec646()?(t=this.parseIsoIec646Block()).isFinished():(t=this.parseNumericBlock()).isFinished(),r===this.current.getPosition()&&!e)break}while(!e)return t.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1())return new eW(!0,e.isSecondDigitFNC1()?new eX(this.current.getPosition(),this.buffer.toString()):new eX(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()));if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1())return new eW(!0,new eX(this.current.getPosition(),this.buffer.toString()));this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new eW(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1())return new eW(!0,new eX(this.current.getPosition(),this.buffer.toString()));this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new eW(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1())return new eW(!0,new eX(this.current.getPosition(),this.buffer.toString()));this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new eW(!1)}isStillIsoIec646(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<116)return!0;if(e+8>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,8);return n>=232&&n<253}decodeIsoIec646(e){let t,r=this.extractNumericValueFromBitArray(e,5);if(15===r)return new eK(e+5,eK.FNC1);if(r>=5&&r<15)return new eK(e+5,"0"+(r-5));let n=this.extractNumericValueFromBitArray(e,7);if(n>=64&&n<90)return new eK(e+7,""+(n+1));if(n>=90&&n<116)return new eK(e+7,""+(n+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:t="!";break;case 233:t='"';break;case 234:t="%";break;case 235:t="&";break;case 236:t="'";break;case 237:t="(";break;case 238:t=")";break;case 239:t="*";break;case 240:t="+";break;case 241:t=",";break;case 242:t="-";break;case 243:t=".";break;case 244:t="/";break;case 245:t=":";break;case 246:t=";";break;case 247:t="<";break;case 248:t="=";break;case 249:t=">";break;case 250:t="?";break;case 251:t="_";break;case 252:t=" ";break;default:throw new V}return new eK(e+8,t)}isStillAlpha(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,6);return r>=16&&r<63}decodeAlphanumeric(e){let t,r=this.extractNumericValueFromBitArray(e,5);if(15===r)return new eK(e+5,eK.FNC1);if(r>=5&&r<15)return new eK(e+5,"0"+(r-5));let n=this.extractNumericValueFromBitArray(e,6);if(n>=32&&n<58)return new eK(e+6,""+(n+33));switch(n){case 58:t="*";break;case 59:t=",";break;case 60:t="-";break;case 61:t=".";break;case 62:t="/";break;default:throw new ec("Decoding invalid alphanumeric value: "+n)}return new eK(e+6,t)}isAlphaTo646ToAlphaLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<5&&t+e<this.information.getSize();++t)if(2===t){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0}isAlphaOr646ToNumericLatch(e){if(e+3>this.information.getSize())return!1;for(let t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0}isNumericToAlphaNumericLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0}}class eJ{constructor(e){this.information=e,this.generalDecoder=new eZ(e)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class e1 extends eJ{constructor(e){super(e)}encodeCompressedGtin(e,t){e.append("(01)");let r=e.length();e.append("9"),this.encodeCompressedGtinWithoutAI(e,t,r)}encodeCompressedGtinWithoutAI(e,t,r){for(let r=0;r<4;++r){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t+10*r,10);n/100==0&&e.append("0"),n/10==0&&e.append("0"),e.append(n)}e1.appendCheckDigit(e,r)}static appendCheckDigit(e,t){let r=0;for(let n=0;n<13;n++){let i=e.charAt(n+t).charCodeAt(0)-48;r+=(1&n)==0?3*i:i}10==(r=10-r%10)&&(r=0),e.append(r)}}e1.GTIN_SIZE=40;class e0 extends e1{constructor(e){super(e)}parseInformation(){let e=new q;e.append("(01)");let t=e.length(),r=this.getGeneralDecoder().extractNumericValueFromBitArray(e0.HEADER_SIZE,4);return e.append(r),this.encodeCompressedGtinWithoutAI(e,e0.HEADER_SIZE+4,t),this.getGeneralDecoder().decodeAllCodes(e,e0.HEADER_SIZE+44)}}e0.HEADER_SIZE=4;class e2 extends eJ{constructor(e){super(e)}parseInformation(){let e=new q;return this.getGeneralDecoder().decodeAllCodes(e,e2.HEADER_SIZE)}}e2.HEADER_SIZE=5;class e3 extends e1{constructor(e){super(e)}encodeCompressedWeight(e,t,r){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t,r);this.addWeightCode(e,n);let i=this.checkWeight(n),s=1e5;for(let t=0;t<5;++t)i/s==0&&e.append("0"),s/=10;e.append(i)}}class e4 extends e3{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()!=e4.HEADER_SIZE+e3.GTIN_SIZE+e4.WEIGHT_SIZE)throw new Y;let e=new q;return this.encodeCompressedGtin(e,e4.HEADER_SIZE),this.encodeCompressedWeight(e,e4.HEADER_SIZE+e3.GTIN_SIZE,e4.WEIGHT_SIZE),e.toString()}}e4.HEADER_SIZE=5,e4.WEIGHT_SIZE=15;class e6 extends e4{constructor(e){super(e)}addWeightCode(e,t){e.append("(3103)")}checkWeight(e){return e}}class e8 extends e4{constructor(e){super(e)}addWeightCode(e,t){t<1e4?e.append("(3202)"):e.append("(3203)")}checkWeight(e){return e<1e4?e:e-1e4}}class e5 extends e1{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<e5.HEADER_SIZE+e1.GTIN_SIZE)throw new Y;let e=new q;this.encodeCompressedGtin(e,e5.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(e5.HEADER_SIZE+e1.GTIN_SIZE,e5.LAST_DIGIT_SIZE);e.append("(392"),e.append(t),e.append(")");let r=this.getGeneralDecoder().decodeGeneralPurposeField(e5.HEADER_SIZE+e1.GTIN_SIZE+e5.LAST_DIGIT_SIZE,null);return e.append(r.getNewString()),e.toString()}}e5.HEADER_SIZE=8,e5.LAST_DIGIT_SIZE=2;class e7 extends e1{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<e7.HEADER_SIZE+e1.GTIN_SIZE)throw new Y;let e=new q;this.encodeCompressedGtin(e,e7.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(e7.HEADER_SIZE+e1.GTIN_SIZE,e7.LAST_DIGIT_SIZE);e.append("(393"),e.append(t),e.append(")");let r=this.getGeneralDecoder().extractNumericValueFromBitArray(e7.HEADER_SIZE+e1.GTIN_SIZE+e7.LAST_DIGIT_SIZE,e7.FIRST_THREE_DIGITS_SIZE);r/100==0&&e.append("0"),r/10==0&&e.append("0"),e.append(r);let n=this.getGeneralDecoder().decodeGeneralPurposeField(e7.HEADER_SIZE+e1.GTIN_SIZE+e7.LAST_DIGIT_SIZE+e7.FIRST_THREE_DIGITS_SIZE,null);return e.append(n.getNewString()),e.toString()}}e7.HEADER_SIZE=8,e7.LAST_DIGIT_SIZE=2,e7.FIRST_THREE_DIGITS_SIZE=10;class e9 extends e3{constructor(e,t,r){super(e),this.dateCode=r,this.firstAIdigits=t}parseInformation(){if(this.getInformation().getSize()!=e9.HEADER_SIZE+e9.GTIN_SIZE+e9.WEIGHT_SIZE+e9.DATE_SIZE)throw new Y;let e=new q;return this.encodeCompressedGtin(e,e9.HEADER_SIZE),this.encodeCompressedWeight(e,e9.HEADER_SIZE+e9.GTIN_SIZE,e9.WEIGHT_SIZE),this.encodeCompressedDate(e,e9.HEADER_SIZE+e9.GTIN_SIZE+e9.WEIGHT_SIZE),e.toString()}encodeCompressedDate(e,t){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(t,e9.DATE_SIZE);if(38400==r)return;e.append("("),e.append(this.dateCode),e.append(")");let n=r%32,i=(r/=32)%12+1,s=r/=12;s/10==0&&e.append("0"),e.append(s),i/10==0&&e.append("0"),e.append(i),n/10==0&&e.append("0"),e.append(n)}addWeightCode(e,t){e.append("("),e.append(this.firstAIdigits),e.append(t/1e5),e.append(")")}checkWeight(e){return e%1e5}}function te(e){try{if(e.get(1))return new e0(e);if(!e.get(2))return new e2(e);switch(eZ.extractNumericValueFromBitArray(e,1,4)){case 4:return new e6(e);case 5:return new e8(e)}switch(eZ.extractNumericValueFromBitArray(e,1,5)){case 12:return new e5(e);case 13:return new e7(e)}switch(eZ.extractNumericValueFromBitArray(e,1,7)){case 56:return new e9(e,"310","11");case 57:return new e9(e,"320","11");case 58:return new e9(e,"310","13");case 59:return new e9(e,"320","13");case 60:return new e9(e,"310","15");case 61:return new e9(e,"320","15");case 62:return new e9(e,"310","17");case 63:return new e9(e,"320","17")}}catch(t){throw console.log(t),new ec("unknown decoder: "+e)}}e9.HEADER_SIZE=8,e9.WEIGHT_SIZE=20,e9.DATE_SIZE=16;class tt{constructor(e,t,r,n){this.leftchar=e,this.rightchar=t,this.finderpattern=r,this.maybeLast=n}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return null==this.rightchar}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"}static equals(e,t){return e instanceof tt&&tt.equalsOrNull(e.leftchar,t.leftchar)&&tt.equalsOrNull(e.rightchar,t.rightchar)&&tt.equalsOrNull(e.finderpattern,t.finderpattern)}static equalsOrNull(e,t){return null===e?null===t:tt.equals(e,t)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class tr{constructor(e,t,r){this.pairs=e,this.rowNumber=t,this.wasReversed=r}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(e){return this.checkEqualitity(this,e)}toString(){return"{ "+this.pairs+" }"}equals(e,t){return e instanceof tr&&this.checkEqualitity(e,t)&&e.wasReversed===t.wasReversed}checkEqualitity(e,t){let r;if(e&&t)return e.forEach((e,n)=>{t.forEach(t=>{e.getLeftChar().getValue()===t.getLeftChar().getValue()&&e.getRightChar().getValue()===t.getRightChar().getValue()&&e.getFinderPatter().getValue()===t.getFinderPatter().getValue()&&(r=!0)})}),r}}class tn extends ej{constructor(e){super(...arguments),this.pairs=Array(tn.MAX_PAIRS),this.rows=[],this.startEnd=[2],this.verbose=!0===e}decodeRow(e,t,r){this.pairs.length=0,this.startFromEven=!1;try{return tn.constructResult(this.decodeRow2pairs(e,t))}catch(e){this.verbose&&console.log(e)}return this.pairs.length=0,this.startFromEven=!0,tn.constructResult(this.decodeRow2pairs(e,t))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(e,t){let r,n=!1;for(;!n;)try{this.pairs.push(this.retrieveNextPair(t,this.pairs,e))}catch(e){if(e instanceof Y){if(!this.pairs.length)throw new Y;n=!0}}if(this.checkChecksum())return this.pairs;if(r=!!this.rows.length,this.storeRow(e,!1),r){let e=this.checkRowsBoolean(!1);if(null!=e||null!=(e=this.checkRowsBoolean(!0)))return e}throw new Y}checkRowsBoolean(e){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,e&&(this.rows=this.rows.reverse());let t=null;try{t=this.checkRows([],0)}catch(e){this.verbose&&console.log(e)}return e&&(this.rows=this.rows.reverse()),t}checkRows(e,t){for(let r=t;r<this.rows.length;r++){let t=this.rows[r];for(let t of(this.pairs.length=0,e))this.pairs.push(t.getPairs());if(this.pairs.push(t.getPairs()),!tn.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let n=Array(e);n.push(t);try{return this.checkRows(n,r+1)}catch(e){this.verbose&&console.log(e)}}throw new Y}static isValidSequence(e){for(let t of tn.FINDER_PATTERN_SEQUENCES){if(e.length>t.length)continue;let r=!0;for(let n=0;n<e.length;n++)if(e[n].getFinderPattern().getValue()!=t[n]){r=!1;break}if(r)return!0}return!1}storeRow(e,t){let r=0,n=!1,i=!1;for(;r<this.rows.length;){let t=this.rows[r];if(t.getRowNumber()>e){i=t.isEquivalent(this.pairs);break}n=t.isEquivalent(this.pairs),r++}i||n||tn.isPartialRow(this.pairs,this.rows)||(this.rows.push(r,new tr(this.pairs,e,t)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(e,t){for(let r of t)if(r.getPairs().length!==e.length){for(let t of r.getPairs())for(let r of e)if(tt.equals(t,r))break}}static isPartialRow(e,t){for(let r of t){let t=!0;for(let n of e){let e=!1;for(let t of r.getPairs())if(n.equals(t)){e=!0;break}if(!e){t=!1;break}}if(t)return!0}return!1}getRows(){return this.rows}static constructResult(e){let t=te(eq.buildBitArray(e)).parseInformation(),r=e[0].getFinderPattern().getResultPoints(),n=e[e.length-1].getFinderPattern().getResultPoints();return new er(t,null,null,[r[0],r[1],n[0],n[1]],en.RSS_EXPANDED,null)}checkChecksum(){let e=this.pairs.get(0),t=e.getLeftChar(),r=e.getRightChar();if(null==r)return!1;let n=r.getChecksumPortion(),i=2;for(let e=1;e<this.pairs.size();++e){let t=this.pairs.get(e);n+=t.getLeftChar().getChecksumPortion(),i++;let r=t.getRightChar();null!=r&&(n+=r.getChecksumPortion(),i++)}return 211*(i-4)+(n%=211)==t.getValue()}static getNextSecondBar(e,t){let r;return e.get(t)?(r=e.getNextUnset(t),r=e.getNextSet(r)):(r=e.getNextSet(t),r=e.getNextUnset(r)),r}retrieveNextPair(e,t,r){let n,i,s=t.length%2==0;this.startFromEven&&(s=!s);let a=!0,o=-1;do this.findNextPair(e,t,o),null==(n=this.parseFoundFinderPattern(e,r,s))?o=tn.getNextSecondBar(e,this.startEnd[0]):a=!1;while(a)let l=this.decodeDataCharacter(e,n,s,!0);if(!this.isEmptyPair(t)&&t[t.length-1].mustBeLast())throw new Y;try{i=this.decodeDataCharacter(e,n,s,!1)}catch(e){i=null,this.verbose&&console.log(e)}return new tt(l,i,n,!0)}isEmptyPair(e){return 0===e.length}findNextPair(e,t,r){let n,i=this.getDecodeFinderCounters();i[0]=0,i[1]=0,i[2]=0,i[3]=0;let s=e.getSize();n=r>=0?r:this.isEmptyPair(t)?0:t[t.length-1].getFinderPattern().getStartEnd()[1];let a=t.length%2!=0;this.startFromEven&&(a=!a);let o=!1;for(;n<s&&(o=!e.get(n));)n++;let l=0,u=n;for(let t=n;t<s;t++)if(e.get(t)!=o)i[l]++;else{if(3==l){if(a&&tn.reverseCounters(i),tn.isFinderPattern(i)){this.startEnd[0]=u,this.startEnd[1]=t;return}a&&tn.reverseCounters(i),u+=i[0]+i[1],i[0]=i[2],i[1]=i[3],i[2]=0,i[3]=0,l--}else l++;i[l]=1,o=!o}throw new Y}static reverseCounters(e){let t=e.length;for(let r=0;r<t/2;++r){let n=e[r];e[r]=e[t-r-1],e[t-r-1]=n}}parseFoundFinderPattern(e,t,r){let n,i,s,a;if(r){let t=this.startEnd[0]-1;for(;t>=0&&!e.get(t);)t--;t++,n=this.startEnd[0]-t,i=t,s=this.startEnd[1]}else i=this.startEnd[0],n=(s=e.getNextUnset(this.startEnd[1]+1))-this.startEnd[1];let o=this.getDecodeFinderCounters();x.arraycopy(o,0,o,1,o.length-1),o[0]=n;try{a=this.parseFinderValue(o,tn.FINDER_PATTERNS)}catch(e){return null}return new eH(a,[i,s],i,s,t)}decodeDataCharacter(e,t,r,n){let i=this.getDataCharacterCounters();for(let e=0;e<i.length;e++)i[e]=0;if(n)tn.recordPatternInReverse(e,t.getStartEnd()[0],i);else{tn.recordPattern(e,t.getStartEnd()[1],i);for(let e=0,t=i.length-1;e<t;e++,t--){let r=i[e];i[e]=i[t],i[t]=r}}let s=eg.sum(new Int32Array(i))/17,a=(t.getStartEnd()[1]-t.getStartEnd()[0])/15;if(Math.abs(s-a)/a>.3)throw new Y;let o=this.getOddCounts(),l=this.getEvenCounts(),u=this.getOddRoundingErrors(),h=this.getEvenRoundingErrors();for(let e=0;e<i.length;e++){let t=i[e]/s,r=t+.5;if(r<1){if(t<.3)throw new Y;r=1}else if(r>8){if(t>8.7)throw new Y;r=8}let n=e/2;(1&e)==0?(o[n]=r,u[n]=t-r):(l[n]=r,h[n]=t-r)}this.adjustOddEvenCounts(17);let c=4*t.getValue()+2*!r+ +!n-1,d=0,f=0;for(let e=o.length-1;e>=0;e--){if(tn.isNotA1left(t,r,n)){let t=tn.WEIGHTS[c][2*e];f+=o[e]*t}d+=o[e]}let g=0;for(let e=l.length-1;e>=0;e--)if(tn.isNotA1left(t,r,n)){let t=tn.WEIGHTS[c][2*e+1];g+=l[e]*t}let p=f+g;if((1&d)!=0||d>13||d<4)throw new Y;let m=(13-d)/2,y=tn.SYMBOL_WIDEST[m],w=eG.getRSSvalue(o,y,!0),E=eG.getRSSvalue(l,9-y,!1);return new ez(w*tn.EVEN_TOTAL_SUBSET[m]+E+tn.GSUM[m],p)}static isNotA1left(e,t,r){return!(0==e.getValue()&&t&&r)}adjustOddEvenCounts(e){let t=eg.sum(new Int32Array(this.getOddCounts())),r=eg.sum(new Int32Array(this.getEvenCounts())),n=!1,i=!1;t>13?i=!0:t<4&&(n=!0);let s=!1,a=!1;r>13?a=!0:r<4&&(s=!0);let o=t+r-e,l=(1&t)==1,u=(1&r)==0;if(1==o)if(l){if(u)throw new Y;i=!0}else{if(!u)throw new Y;a=!0}else if(-1==o)if(l){if(u)throw new Y;n=!0}else{if(!u)throw new Y;s=!0}else if(0==o){if(l){if(!u)throw new Y;t<r?(n=!0,a=!0):(i=!0,s=!0)}else if(u)throw new Y}else throw new Y;if(n){if(i)throw new Y;tn.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&tn.decrement(this.getOddCounts(),this.getOddRoundingErrors()),s){if(a)throw new Y;tn.increment(this.getEvenCounts(),this.getOddRoundingErrors())}a&&tn.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}tn.SYMBOL_WIDEST=[7,5,4,3,1],tn.EVEN_TOTAL_SUBSET=[4,20,52,104,204],tn.GSUM=[0,348,1388,2948,3988],tn.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],tn.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],tn.FINDER_PAT_A=0,tn.FINDER_PAT_B=1,tn.FINDER_PAT_C=2,tn.FINDER_PAT_D=3,tn.FINDER_PAT_E=4,tn.FINDER_PAT_F=5,tn.FINDER_PATTERN_SEQUENCES=[[tn.FINDER_PAT_A,tn.FINDER_PAT_A],[tn.FINDER_PAT_A,tn.FINDER_PAT_B,tn.FINDER_PAT_B],[tn.FINDER_PAT_A,tn.FINDER_PAT_C,tn.FINDER_PAT_B,tn.FINDER_PAT_D],[tn.FINDER_PAT_A,tn.FINDER_PAT_E,tn.FINDER_PAT_B,tn.FINDER_PAT_D,tn.FINDER_PAT_C],[tn.FINDER_PAT_A,tn.FINDER_PAT_E,tn.FINDER_PAT_B,tn.FINDER_PAT_D,tn.FINDER_PAT_D,tn.FINDER_PAT_F],[tn.FINDER_PAT_A,tn.FINDER_PAT_E,tn.FINDER_PAT_B,tn.FINDER_PAT_D,tn.FINDER_PAT_E,tn.FINDER_PAT_F,tn.FINDER_PAT_F],[tn.FINDER_PAT_A,tn.FINDER_PAT_A,tn.FINDER_PAT_B,tn.FINDER_PAT_B,tn.FINDER_PAT_C,tn.FINDER_PAT_C,tn.FINDER_PAT_D,tn.FINDER_PAT_D],[tn.FINDER_PAT_A,tn.FINDER_PAT_A,tn.FINDER_PAT_B,tn.FINDER_PAT_B,tn.FINDER_PAT_C,tn.FINDER_PAT_C,tn.FINDER_PAT_D,tn.FINDER_PAT_E,tn.FINDER_PAT_E],[tn.FINDER_PAT_A,tn.FINDER_PAT_A,tn.FINDER_PAT_B,tn.FINDER_PAT_B,tn.FINDER_PAT_C,tn.FINDER_PAT_C,tn.FINDER_PAT_D,tn.FINDER_PAT_E,tn.FINDER_PAT_F,tn.FINDER_PAT_F],[tn.FINDER_PAT_A,tn.FINDER_PAT_A,tn.FINDER_PAT_B,tn.FINDER_PAT_B,tn.FINDER_PAT_C,tn.FINDER_PAT_D,tn.FINDER_PAT_D,tn.FINDER_PAT_E,tn.FINDER_PAT_E,tn.FINDER_PAT_F,tn.FINDER_PAT_F]],tn.MAX_PAIRS=11;class ti extends ez{constructor(e,t,r){super(e,t),this.count=0,this.finderPattern=r}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ts extends ej{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(e,t,r){let n=this.decodePair(t,!1,e,r);ts.addOrTally(this.possibleLeftPairs,n),t.reverse();let i=this.decodePair(t,!0,e,r);for(let e of(ts.addOrTally(this.possibleRightPairs,i),t.reverse(),this.possibleLeftPairs))if(e.getCount()>1){for(let t of this.possibleRightPairs)if(t.getCount()>1&&ts.checkChecksum(e,t))return ts.constructResult(e,t)}throw new Y}static addOrTally(e,t){if(null==t)return;let r=!1;for(let n of e)if(n.getValue()===t.getValue()){n.incrementCount(),r=!0;break}r||e.push(t)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(e,t){let r=new String(4537077*e.getValue()+t.getValue()).toString(),n=new q;for(let e=13-r.length;e>0;e--)n.append("0");n.append(r);let i=0;for(let e=0;e<13;e++){let t=n.charAt(e).charCodeAt(0)-48;i+=(1&e)==0?3*t:t}10==(i=10-i%10)&&(i=0),n.append(i.toString());let s=e.getFinderPattern().getResultPoints(),a=t.getFinderPattern().getResultPoints();return new er(n.toString(),null,0,[s[0],s[1],a[0],a[1]],en.RSS_14,new Date().getTime())}static checkChecksum(e,t){let r=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,n=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return n>72&&n--,n>8&&n--,r===n}decodePair(e,t,r,n){try{let i=this.findFinderPattern(e,t),s=this.parseFoundFinderPattern(e,r,t,i),a=null==n?null:n.get(U.NEED_RESULT_POINT_CALLBACK);if(null!=a){let n=(i[0]+i[1])/2;t&&(n=e.getSize()-1-n),a.foundPossibleResultPoint(new em(n,r))}let o=this.decodeDataCharacter(e,s,!0),l=this.decodeDataCharacter(e,s,!1);return new ti(1597*o.getValue()+l.getValue(),o.getChecksumPortion()+4*l.getChecksumPortion(),s)}catch(e){return null}}decodeDataCharacter(e,t,r){let n=this.getDataCharacterCounters();for(let e=0;e<n.length;e++)n[e]=0;if(r)ev.recordPatternInReverse(e,t.getStartEnd()[0],n);else{ev.recordPattern(e,t.getStartEnd()[1]+1,n);for(let e=0,t=n.length-1;e<t;e++,t--){let r=n[e];n[e]=n[t],n[t]=r}}let i=r?16:15,s=eg.sum(new Int32Array(n))/i,a=this.getOddCounts(),o=this.getEvenCounts(),l=this.getOddRoundingErrors(),u=this.getEvenRoundingErrors();for(let e=0;e<n.length;e++){let t=n[e]/s,r=Math.floor(t+.5);r<1?r=1:r>8&&(r=8);let i=Math.floor(e/2);(1&e)==0?(a[i]=r,l[i]=t-r):(o[i]=r,u[i]=t-r)}this.adjustOddEvenCounts(r,i);let h=0,c=0;for(let e=a.length-1;e>=0;e--)c*=9,c+=a[e],h+=a[e];let d=0,f=0;for(let e=o.length-1;e>=0;e--)d*=9,d+=o[e],f+=o[e];let g=c+3*d;if(r){if((1&h)!=0||h>12||h<4)throw new Y;let e=(12-h)/2,t=ts.OUTSIDE_ODD_WIDEST[e],r=eG.getRSSvalue(a,t,!1),n=eG.getRSSvalue(o,9-t,!0);return new ez(r*ts.OUTSIDE_EVEN_TOTAL_SUBSET[e]+n+ts.OUTSIDE_GSUM[e],g)}{if((1&f)!=0||f>10||f<4)throw new Y;let e=(10-f)/2,t=ts.INSIDE_ODD_WIDEST[e],r=eG.getRSSvalue(a,t,!0);return new ez(eG.getRSSvalue(o,9-t,!1)*ts.INSIDE_ODD_TOTAL_SUBSET[e]+r+ts.INSIDE_GSUM[e],g)}}findFinderPattern(e,t){let r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;let n=e.getSize(),i=!1,s=0;for(;s<n&&t!==(i=!e.get(s));)s++;let a=0,o=s;for(let t=s;t<n;t++)if(e.get(t)!==i)r[a]++;else{if(3===a){if(ej.isFinderPattern(r))return[o,t];o+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,a--}else a++;r[a]=1,i=!i}throw new Y}parseFoundFinderPattern(e,t,r,n){let i=e.get(n[0]),s=n[0]-1;for(;s>=0&&i!==e.get(s);)s--;s++;let a=n[0]-s,o=this.getDecodeFinderCounters(),l=new Int32Array(o.length);x.arraycopy(o,0,l,1,o.length-1),l[0]=a;let u=this.parseFinderValue(l,ts.FINDER_PATTERNS),h=s,c=n[1];return r&&(h=e.getSize()-1-h,c=e.getSize()-1-c),new eH(u,[s,n[1]],h,c,t)}adjustOddEvenCounts(e,t){let r=eg.sum(new Int32Array(this.getOddCounts())),n=eg.sum(new Int32Array(this.getEvenCounts())),i=!1,s=!1,a=!1,o=!1;e?(r>12?s=!0:r<4&&(i=!0),n>12?o=!0:n<4&&(a=!0)):(r>11?s=!0:r<5&&(i=!0),n>10?o=!0:n<4&&(a=!0));let l=r+n-t,u=(1&r)==+!!e,h=(1&n)==1;if(1===l)if(u){if(h)throw new Y;s=!0}else{if(!h)throw new Y;o=!0}else if(-1===l)if(u){if(h)throw new Y;i=!0}else{if(!h)throw new Y;a=!0}else if(0===l){if(u){if(!h)throw new Y;r<n?(i=!0,o=!0):(s=!0,a=!0)}else if(h)throw new Y}else throw new Y;if(i){if(s)throw new Y;ej.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(s&&ej.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(o)throw new Y;ej.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&ej.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ts.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ts.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ts.OUTSIDE_GSUM=[0,161,961,2015,2715],ts.INSIDE_GSUM=[0,336,1036,1516],ts.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ts.INSIDE_ODD_WIDEST=[2,4,6,8],ts.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class ta extends ev{constructor(e,t){super(),this.readers=[],this.verbose=!0===t;const r=e?e.get(U.POSSIBLE_FORMATS):null,n=e&&void 0!==e.get(U.ASSUME_CODE_39_CHECK_DIGIT);r?((r.includes(en.EAN_13)||r.includes(en.UPC_A)||r.includes(en.EAN_8)||r.includes(en.UPC_E))&&this.readers.push(new eV(e)),r.includes(en.CODE_39)&&this.readers.push(new eD(n)),r.includes(en.CODE_128)&&this.readers.push(new eN),r.includes(en.ITF)&&this.readers.push(new eR),r.includes(en.RSS_14)&&this.readers.push(new ts),r.includes(en.RSS_EXPANDED)&&this.readers.push(new tn(this.verbose))):(this.readers.push(new eV(e)),this.readers.push(new eD),this.readers.push(new eV(e)),this.readers.push(new eN),this.readers.push(new eR),this.readers.push(new ts),this.readers.push(new tn(this.verbose)))}decodeRow(e,t,r){for(let n=0;n<this.readers.length;n++)try{return this.readers[n].decodeRow(e,t,r)}catch(e){}throw new Y}reset(){this.readers.forEach(e=>e.reset())}}class to{constructor(e,t,r){this.ecCodewords=e,this.ecBlocks=[t],r&&this.ecBlocks.push(r)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class tl{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class tu{constructor(e,t,r,n,i,s){this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=r,this.dataRegionSizeRows=n,this.dataRegionSizeColumns=i,this.ecBlocks=s;let a=0;const o=s.getECCodewords();for(let e of s.getECBlocks())a+=e.getCount()*(e.getDataCodewords()+o);this.totalCodewords=a}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(e,t){if((1&e)!=0||(1&t)!=0)throw new V;for(let r of tu.VERSIONS)if(r.symbolSizeRows===e&&r.symbolSizeColumns===t)return r;throw new V}toString(){return""+this.versionNumber}static buildVersions(){return[new tu(1,10,10,8,8,new to(5,new tl(1,3))),new tu(2,12,12,10,10,new to(7,new tl(1,5))),new tu(3,14,14,12,12,new to(10,new tl(1,8))),new tu(4,16,16,14,14,new to(12,new tl(1,12))),new tu(5,18,18,16,16,new to(14,new tl(1,18))),new tu(6,20,20,18,18,new to(18,new tl(1,22))),new tu(7,22,22,20,20,new to(20,new tl(1,30))),new tu(8,24,24,22,22,new to(24,new tl(1,36))),new tu(9,26,26,24,24,new to(28,new tl(1,44))),new tu(10,32,32,14,14,new to(36,new tl(1,62))),new tu(11,36,36,16,16,new to(42,new tl(1,86))),new tu(12,40,40,18,18,new to(48,new tl(1,114))),new tu(13,44,44,20,20,new to(56,new tl(1,144))),new tu(14,48,48,22,22,new to(68,new tl(1,174))),new tu(15,52,52,24,24,new to(42,new tl(2,102))),new tu(16,64,64,14,14,new to(56,new tl(2,140))),new tu(17,72,72,16,16,new to(36,new tl(4,92))),new tu(18,80,80,18,18,new to(48,new tl(4,114))),new tu(19,88,88,20,20,new to(56,new tl(4,144))),new tu(20,96,96,22,22,new to(68,new tl(4,174))),new tu(21,104,104,24,24,new to(56,new tl(6,136))),new tu(22,120,120,18,18,new to(68,new tl(6,175))),new tu(23,132,132,20,20,new to(62,new tl(8,163))),new tu(24,144,144,22,22,new to(62,new tl(8,156),new tl(2,155))),new tu(25,8,18,6,16,new to(7,new tl(1,5))),new tu(26,8,32,6,14,new to(11,new tl(1,10))),new tu(27,12,26,10,24,new to(14,new tl(1,16))),new tu(28,12,36,10,16,new to(18,new tl(1,22))),new tu(29,16,36,14,16,new to(24,new tl(1,32))),new tu(30,16,48,14,22,new to(28,new tl(1,49)))]}}tu.VERSIONS=tu.buildVersions();class th{constructor(e){const t=e.getHeight();if(t<8||t>144||(1&t)!=0)throw new V;this.version=th.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new W(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(e){let t=e.getHeight(),r=e.getWidth();return tu.getVersionForDimensions(t,r)}readCodewords(){let e=new Int8Array(this.version.getTotalCodewords()),t=0,r=4,n=0,i=this.mappingBitMatrix.getHeight(),s=this.mappingBitMatrix.getWidth(),a=!1,o=!1,l=!1,u=!1;do if(r!==i||0!==n||a)if(r!==i-2||0!==n||(3&s)==0||o)if(r!==i+4||2!==n||(7&s)!=0||l)if(r!==i-2||0!==n||(7&s)!=4||u){do r<i&&n>=0&&!this.readMappingMatrix.get(n,r)&&(e[t++]=255&this.readUtah(r,n,i,s)),r-=2,n+=2;while(r>=0&&n<s)r+=1,n+=3;do r>=0&&n<s&&!this.readMappingMatrix.get(n,r)&&(e[t++]=255&this.readUtah(r,n,i,s)),r+=2,n-=2;while(r<i&&n>=0)r+=3,n+=1}else e[t++]=255&this.readCorner4(i,s),r-=2,n+=2,u=!0;else e[t++]=255&this.readCorner3(i,s),r-=2,n+=2,l=!0;else e[t++]=255&this.readCorner2(i,s),r-=2,n+=2,o=!0;else e[t++]=255&this.readCorner1(i,s),r-=2,n+=2,a=!0;while(r<i||n<s)if(t!==this.version.getTotalCodewords())throw new V;return e}readModule(e,t,r,n){return e<0&&(e+=r,t+=4-(r+4&7)),t<0&&(t+=n,e+=4-(n+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)}readUtah(e,t,r,n){let i=0;return this.readModule(e-2,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e-2,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e-1,t,r,n)&&(i|=1),i<<=1,this.readModule(e,t-2,r,n)&&(i|=1),i<<=1,this.readModule(e,t-1,r,n)&&(i|=1),i<<=1,this.readModule(e,t,r,n)&&(i|=1),i}readCorner1(e,t){let r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,1,e,t)&&(r|=1),r<<=1,this.readModule(e-1,2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r}readCorner2(e,t){let r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-4,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r}readCorner3(e,t){let r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-3,e,t)&&(r|=1),r<<=1,this.readModule(1,t-2,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r}readCorner4(e,t){let r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r}extractDataRegion(e){let t=this.version.getSymbolSizeRows(),r=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new D("Dimension of bitMatrix must match the version size");let n=this.version.getDataRegionSizeRows(),i=this.version.getDataRegionSizeColumns(),s=t/n|0,a=r/i|0,o=new W(a*i,s*n);for(let t=0;t<s;++t){let r=t*n;for(let s=0;s<a;++s){let a=s*i;for(let l=0;l<n;++l){let u=t*(n+2)+1+l,h=r+l;for(let t=0;t<i;++t){let r=s*(i+2)+1+t;if(e.get(r,u)){let e=a+t;o.set(e,h)}}}}}return o}}class tc{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t){let r=t.getECBlocks(),n=0,i=r.getECBlocks();for(let e of i)n+=e.getCount();let s=Array(n),a=0;for(let e of i)for(let t=0;t<e.getCount();t++){let t=e.getDataCodewords(),n=r.getECCodewords()+t;s[a++]=new tc(t,new Uint8Array(n))}let o=s[0].codewords.length-r.getECCodewords(),l=o-1,u=0;for(let t=0;t<l;t++)for(let r=0;r<a;r++)s[r].codewords[t]=e[u++];let h=24===t.getVersionNumber(),c=h?8:a;for(let t=0;t<c;t++)s[t].codewords[o-1]=e[u++];let d=s[0].codewords.length;for(let t=o;t<d;t++)for(let r=0;r<a;r++){let n=h?(r+8)%a:r,i=h&&n>7?t-1:t;s[n].codewords[i]=e[u++]}if(u!==e.length)throw new D;return s}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class td{constructor(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(e){if(e<1||e>32||e>this.available())throw new D(""+e);let t=0,r=this.bitOffset,n=this.byteOffset,i=this.bytes;if(r>0){let s=8-r,a=e<s?e:s,o=s-a;t=(i[n]&255>>8-a<<o)>>o,e-=a,8===(r+=a)&&(r=0,n++)}if(e>0){for(;e>=8;)t=t<<8|255&i[n],n++,e-=8;if(e>0){let s=8-e;t=t<<e|(i[n]&255>>s<<s)>>s,r+=e}}return this.bitOffset=r,this.byteOffset=n,t}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}(l=E||(E={}))[l.PAD_ENCODE=0]="PAD_ENCODE",l[l.ASCII_ENCODE=1]="ASCII_ENCODE",l[l.C40_ENCODE=2]="C40_ENCODE",l[l.TEXT_ENCODE=3]="TEXT_ENCODE",l[l.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",l[l.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",l[l.BASE256_ENCODE=6]="BASE256_ENCODE";class tf{static decode(e){let t=new td(e),r=new q,n=new q,i=[],s=E.ASCII_ENCODE;do if(s===E.ASCII_ENCODE)s=this.decodeAsciiSegment(t,r,n);else{switch(s){case E.C40_ENCODE:this.decodeC40Segment(t,r);break;case E.TEXT_ENCODE:this.decodeTextSegment(t,r);break;case E.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,r);break;case E.EDIFACT_ENCODE:this.decodeEdifactSegment(t,r);break;case E.BASE256_ENCODE:this.decodeBase256Segment(t,r,i);break;default:throw new V}s=E.ASCII_ENCODE}while(s!==E.PAD_ENCODE&&t.available()>0)return n.length()>0&&r.append(n.toString()),new es(e,r.toString(),0===i.length?null:i,null)}static decodeAsciiSegment(e,t,r){let n=!1;do{let i=e.readBits(8);if(0===i)throw new V;if(i<=128){n&&(i+=128),t.append(String.fromCharCode(i-1));break}if(129===i)return E.PAD_ENCODE;else if(i<=229){let e=i-130;e<10&&t.append("0"),t.append(""+e)}else switch(i){case 230:return E.C40_ENCODE;case 231:return E.BASE256_ENCODE;case 232:t.append("\x1d");break;case 233:case 234:case 241:break;case 235:n=!0;break;case 236:t.append("[)>\x1e05\x1d"),r.insert(0,"\x1e\x04");break;case 237:t.append("[)>\x1e06\x1d"),r.insert(0,"\x1e\x04");break;case 238:return E.ANSIX12_ENCODE;case 239:return E.TEXT_ENCODE;case 240:return E.EDIFACT_ENCODE;default:if(254!==i||0!==e.available())throw new V}}while(e.available()>0)return E.ASCII_ENCODE}static decodeC40Segment(e,t){let r=!1,n=[],i=0;do{if(8===e.available())return;let s=e.readBits(8);if(254===s)return;this.parseTwoBytes(s,e.readBits(8),n);for(let e=0;e<3;e++){let s=n[e];switch(i){case 0:if(s<3)i=s+1;else if(s<this.C40_BASIC_SET_CHARS.length){let e=this.C40_BASIC_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}else throw new V;break;case 1:r?(t.append(String.fromCharCode(s+128)),r=!1):t.append(String.fromCharCode(s)),i=0;break;case 2:if(s<this.C40_SHIFT2_SET_CHARS.length){let e=this.C40_SHIFT2_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}else switch(s){case 27:t.append("\x1d");break;case 30:r=!0;break;default:throw new V}i=0;break;case 3:r?(t.append(String.fromCharCode(s+224)),r=!1):t.append(String.fromCharCode(s+96)),i=0;break;default:throw new V}}}while(e.available()>0)}static decodeTextSegment(e,t){let r=!1,n=[],i=0;do{if(8===e.available())return;let s=e.readBits(8);if(254===s)return;this.parseTwoBytes(s,e.readBits(8),n);for(let e=0;e<3;e++){let s=n[e];switch(i){case 0:if(s<3)i=s+1;else if(s<this.TEXT_BASIC_SET_CHARS.length){let e=this.TEXT_BASIC_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}else throw new V;break;case 1:r?(t.append(String.fromCharCode(s+128)),r=!1):t.append(String.fromCharCode(s)),i=0;break;case 2:if(s<this.TEXT_SHIFT2_SET_CHARS.length){let e=this.TEXT_SHIFT2_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e)}else switch(s){case 27:t.append("\x1d");break;case 30:r=!0;break;default:throw new V}i=0;break;case 3:if(s<this.TEXT_SHIFT3_SET_CHARS.length){let e=this.TEXT_SHIFT3_SET_CHARS[s];r?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),r=!1):t.append(e),i=0}else throw new V;break;default:throw new V}}}while(e.available()>0)}static decodeAnsiX12Segment(e,t){let r=[];do{if(8===e.available())return;let n=e.readBits(8);if(254===n)return;this.parseTwoBytes(n,e.readBits(8),r);for(let e=0;e<3;e++){let n=r[e];switch(n){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(n<14)t.append(String.fromCharCode(n+44));else if(n<40)t.append(String.fromCharCode(n+51));else throw new V}}}while(e.available()>0)}static parseTwoBytes(e,t,r){let n=(e<<8)+t-1,i=Math.floor(n/1600);r[0]=i,n-=1600*i,i=Math.floor(n/40),r[1]=i,r[2]=n-40*i}static decodeEdifactSegment(e,t){do{if(16>=e.available())return;for(let r=0;r<4;r++){let r=e.readBits(6);if(31===r){let t=8-e.getBitOffset();8!==t&&e.readBits(t);return}(32&r)==0&&(r|=64),t.append(String.fromCharCode(r))}}while(e.available()>0)}static decodeBase256Segment(e,t,r){let n,i=1+e.getByteOffset(),s=this.unrandomize255State(e.readBits(8),i++);if((n=0===s?e.available()/8|0:s<250?s:250*(s-249)+this.unrandomize255State(e.readBits(8),i++))<0)throw new V;let a=new Uint8Array(n);for(let t=0;t<n;t++){if(8>e.available())throw new V;a[t]=this.unrandomize255State(e.readBits(8),i++)}r.push(a);try{t.append(H.decode(a,G.ISO88591))}catch(e){throw new ec("Platform does not support required encoding: "+e.message)}}static unrandomize255State(e,t){let r=e-(149*t%255+1);return r>=0?r:r+256}}tf.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],tf.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],tf.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],tf.TEXT_SHIFT2_SET_CHARS=tf.C40_SHIFT2_SET_CHARS,tf.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class tg{constructor(){this.rsDecoder=new ed(eu.DATA_MATRIX_FIELD_256)}decode(e){let t=new th(e),r=t.getVersion(),n=t.readCodewords(),i=tc.getDataBlocks(n,r),s=0;for(let e of i)s+=e.getNumDataCodewords();let a=new Uint8Array(s),o=i.length;for(let e=0;e<o;e++){let t=i[e],r=t.getCodewords(),n=t.getNumDataCodewords();this.correctErrors(r,n);for(let t=0;t<n;t++)a[t*o+e]=r[t]}return tf.decode(a)}correctErrors(e,t){let r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch(e){throw new M}for(let n=0;n<t;n++)e[n]=r[n]}}class tp{constructor(e){this.image=e,this.rectangleDetector=new eE(this.image)}detect(){let e=this.rectangleDetector.detect(),t=this.detectSolid1(e);if((t=this.detectSolid2(t))[3]=this.correctTopRight(t),!t[3])throw new Y;let r=(t=this.shiftToModuleCenter(t))[0],n=t[1],i=t[2],s=t[3],a=this.transitionsBetween(r,s)+1,o=this.transitionsBetween(i,s)+1;return(1&a)==1&&(a+=1),(1&o)==1&&(o+=1),4*a<7*o&&4*o<7*a&&(a=o=Math.max(a,o)),new ey(tp.sampleGrid(this.image,r,n,i,s,a,o),[r,n,i,s])}static shiftPoint(e,t,r){let n=(t.getX()-e.getX())/(r+1),i=(t.getY()-e.getY())/(r+1);return new em(e.getX()+n,e.getY()+i)}static moveAway(e,t,r){let n=e.getX(),i=e.getY();return n<t?n-=1:n+=1,i<r?i-=1:i+=1,new em(n,i)}detectSolid1(e){let t=e[0],r=e[1],n=e[3],i=e[2],s=this.transitionsBetween(t,r),a=this.transitionsBetween(r,n),o=this.transitionsBetween(n,i),l=this.transitionsBetween(i,t),u=s,h=[i,t,r,n];return u>a&&(u=a,h[0]=t,h[1]=r,h[2]=n,h[3]=i),u>o&&(u=o,h[0]=r,h[1]=n,h[2]=i,h[3]=t),u>l&&(h[0]=n,h[1]=i,h[2]=t,h[3]=r),h}detectSolid2(e){let t=e[0],r=e[1],n=e[2],i=e[3],s=this.transitionsBetween(t,i),a=tp.shiftPoint(r,n,(s+1)*4),o=tp.shiftPoint(n,r,(s+1)*4);return this.transitionsBetween(a,t)<this.transitionsBetween(o,i)?(e[0]=t,e[1]=r,e[2]=n,e[3]=i):(e[0]=r,e[1]=n,e[2]=i,e[3]=t),e}correctTopRight(e){let t=e[0],r=e[1],n=e[2],i=e[3],s=this.transitionsBetween(t,i),a=this.transitionsBetween(r,i),o=tp.shiftPoint(t,r,(a+1)*4),l=tp.shiftPoint(n,r,(s+1)*4);s=this.transitionsBetween(o,i),a=this.transitionsBetween(l,i);let u=new em(i.getX()+(n.getX()-r.getX())/(s+1),i.getY()+(n.getY()-r.getY())/(s+1)),h=new em(i.getX()+(t.getX()-r.getX())/(a+1),i.getY()+(t.getY()-r.getY())/(a+1));return this.isValid(u)?this.isValid(h)?this.transitionsBetween(o,u)+this.transitionsBetween(l,u)>this.transitionsBetween(o,h)+this.transitionsBetween(l,h)?u:h:u:this.isValid(h)?h:null}shiftToModuleCenter(e){let t,r,n=e[0],i=e[1],s=e[2],a=e[3],o=this.transitionsBetween(n,a)+1,l=this.transitionsBetween(s,a)+1,u=tp.shiftPoint(n,i,4*l),h=tp.shiftPoint(s,i,4*o);o=this.transitionsBetween(u,a)+1,l=this.transitionsBetween(h,a)+1,(1&o)==1&&(o+=1),(1&l)==1&&(l+=1);let c=(n.getX()+i.getX()+s.getX()+a.getX())/4,d=(n.getY()+i.getY()+s.getY()+a.getY())/4;return n=tp.moveAway(n,c,d),i=tp.moveAway(i,c,d),s=tp.moveAway(s,c,d),a=tp.moveAway(a,c,d),u=tp.shiftPoint(n,i,4*l),u=tp.shiftPoint(u,a,4*o),t=tp.shiftPoint(i,n,4*l),t=tp.shiftPoint(t,s,4*o),h=tp.shiftPoint(s,a,4*l),h=tp.shiftPoint(h,i,4*o),r=tp.shiftPoint(a,s,4*l),[u,t,h,r=tp.shiftPoint(r,n,4*o)]}isValid(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()}static sampleGrid(e,t,r,n,i,s,a){return eA.getInstance().sampleGrid(e,s,a,.5,.5,s-.5,.5,s-.5,a-.5,.5,a-.5,t.getX(),t.getY(),i.getX(),i.getY(),n.getX(),n.getY(),r.getX(),r.getY())}transitionsBetween(e,t){let r=Math.trunc(e.getX()),n=Math.trunc(e.getY()),i=Math.trunc(t.getX()),s=Math.trunc(t.getY()),a=Math.abs(s-n)>Math.abs(i-r);if(a){let e=r;r=n,n=e,e=i,i=s,s=e}let o=Math.abs(i-r),l=Math.abs(s-n),u=-o/2,h=n<s?1:-1,c=r<i?1:-1,d=0,f=this.image.get(a?n:r,a?r:n);for(let e=r,t=n;e!==i;e+=c){let r=this.image.get(a?t:e,a?e:t);if(r!==f&&(d++,f=r),(u+=l)>0){if(t===s)break;t+=h,u-=o}}return d}}class tm{constructor(){this.decoder=new tg}decode(e,t=null){let r,n;if(null!=t&&t.has(U.PURE_BARCODE)){let t=tm.extractPureBits(e.getBlackMatrix());r=this.decoder.decode(t),n=tm.NO_POINTS}else{let t=new tp(e.getBlackMatrix()).detect();r=this.decoder.decode(t.getBits()),n=t.getPoints()}let i=r.getRawBytes(),s=new er(r.getText(),i,8*i.length,n,en.DATA_MATRIX,x.currentTimeMillis()),a=r.getByteSegments();null!=a&&s.putMetadata(ei.BYTE_SEGMENTS,a);let o=r.getECLevel();return null!=o&&s.putMetadata(ei.ERROR_CORRECTION_LEVEL,o),s}reset(){}static extractPureBits(e){let t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null==t||null==r)throw new Y;let n=this.moduleSize(t,e),i=t[1],s=r[1],a=t[0],o=(r[0]-a+1)/n,l=(s-i+1)/n;if(o<=0||l<=0)throw new Y;let u=n/2;i+=u,a+=u;let h=new W(o,l);for(let t=0;t<l;t++){let r=i+t*n;for(let i=0;i<o;i++)e.get(a+i*n,r)&&h.set(i,t)}return h}static moduleSize(e,t){let r=t.getWidth(),n=e[0],i=e[1];for(;n<r&&t.get(n,i);)n++;if(n===r)throw new Y;let s=n-e[0];if(0===s)throw new Y;return s}}tm.NO_POINTS=[],(u=C||(C={}))[u.L=0]="L",u[u.M=1]="M",u[u.Q=2]="Q",u[u.H=3]="H";class ty{constructor(e,t,r){this.value=e,this.stringValue=t,this.bits=r,ty.FOR_BITS.set(r,this),ty.FOR_VALUE.set(e,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(e){switch(e){case"L":return ty.L;case"M":return ty.M;case"Q":return ty.Q;case"H":return ty.H;default:throw new N(e+"not available")}}toString(){return this.stringValue}equals(e){return e instanceof ty&&this.value===e.value}static forBits(e){if(e<0||e>=ty.FOR_BITS.size)throw new D;return ty.FOR_BITS.get(e)}}ty.FOR_BITS=new Map,ty.FOR_VALUE=new Map,ty.L=new ty(C.L,"L",1),ty.M=new ty(C.M,"M",0),ty.Q=new ty(C.Q,"Q",3),ty.H=new ty(C.H,"H",2);class tw{constructor(e){this.errorCorrectionLevel=ty.forBits(e>>3&3),this.dataMask=7&e}static numBitsDiffering(e,t){return B.bitCount(e^t)}static decodeFormatInformation(e,t){let r=tw.doDecodeFormatInformation(e,t);return null!==r?r:tw.doDecodeFormatInformation(e^tw.FORMAT_INFO_MASK_QR,t^tw.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(e,t){let r=Number.MAX_SAFE_INTEGER,n=0;for(let i of tw.FORMAT_INFO_DECODE_LOOKUP){let s=i[0];if(s===e||s===t)return new tw(i[1]);let a=tw.numBitsDiffering(e,s);a<r&&(n=i[1],r=a),e!==t&&(a=tw.numBitsDiffering(t,s))<r&&(n=i[1],r=a)}return r<=3?new tw(n):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(e){return e instanceof tw&&this.errorCorrectionLevel===e.errorCorrectionLevel&&this.dataMask===e.dataMask}}tw.FORMAT_INFO_MASK_QR=21522,tw.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class tE{constructor(e,...t){this.ecCodewordsPerBlock=e,this.ecBlocks=t}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let e=0;for(let t of this.ecBlocks)e+=t.getCount();return e}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class tC{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class tI{constructor(e,t,...r){this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=r;let n=0;const i=r[0].getECCodewordsPerBlock();for(const e of r[0].getECBlocks())n+=e.getCount()*(e.getDataCodewords()+i);this.totalCodewords=n}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(e){return this.ecBlocks[e.getValue()]}static getProvisionalVersionForDimension(e){if(e%4!=1)throw new V;try{return this.getVersionForNumber((e-17)/4)}catch(e){throw new V}}static getVersionForNumber(e){if(e<1||e>40)throw new D;return tI.VERSIONS[e-1]}static decodeVersionInformation(e){let t=Number.MAX_SAFE_INTEGER,r=0;for(let n=0;n<tI.VERSION_DECODE_INFO.length;n++){let i=tI.VERSION_DECODE_INFO[n];if(i===e)return tI.getVersionForNumber(n+7);let s=tw.numBitsDiffering(e,i);s<t&&(r=n+7,t=s)}return t<=3?tI.getVersionForNumber(r):null}buildFunctionPattern(){let e=this.getDimensionForVersion(),t=new W(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);let r=this.alignmentPatternCenters.length;for(let e=0;e<r;e++){let n=this.alignmentPatternCenters[e]-2;for(let i=0;i<r;i++)(0!==e||0!==i&&i!==r-1)&&(e!==r-1||0!==i)&&t.setRegion(this.alignmentPatternCenters[i]-2,n,5,5)}return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t}toString(){return""+this.versionNumber}}tI.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),tI.VERSIONS=[new tI(1,new Int32Array(0),new tE(7,new tC(1,19)),new tE(10,new tC(1,16)),new tE(13,new tC(1,13)),new tE(17,new tC(1,9))),new tI(2,Int32Array.from([6,18]),new tE(10,new tC(1,34)),new tE(16,new tC(1,28)),new tE(22,new tC(1,22)),new tE(28,new tC(1,16))),new tI(3,Int32Array.from([6,22]),new tE(15,new tC(1,55)),new tE(26,new tC(1,44)),new tE(18,new tC(2,17)),new tE(22,new tC(2,13))),new tI(4,Int32Array.from([6,26]),new tE(20,new tC(1,80)),new tE(18,new tC(2,32)),new tE(26,new tC(2,24)),new tE(16,new tC(4,9))),new tI(5,Int32Array.from([6,30]),new tE(26,new tC(1,108)),new tE(24,new tC(2,43)),new tE(18,new tC(2,15),new tC(2,16)),new tE(22,new tC(2,11),new tC(2,12))),new tI(6,Int32Array.from([6,34]),new tE(18,new tC(2,68)),new tE(16,new tC(4,27)),new tE(24,new tC(4,19)),new tE(28,new tC(4,15))),new tI(7,Int32Array.from([6,22,38]),new tE(20,new tC(2,78)),new tE(18,new tC(4,31)),new tE(18,new tC(2,14),new tC(4,15)),new tE(26,new tC(4,13),new tC(1,14))),new tI(8,Int32Array.from([6,24,42]),new tE(24,new tC(2,97)),new tE(22,new tC(2,38),new tC(2,39)),new tE(22,new tC(4,18),new tC(2,19)),new tE(26,new tC(4,14),new tC(2,15))),new tI(9,Int32Array.from([6,26,46]),new tE(30,new tC(2,116)),new tE(22,new tC(3,36),new tC(2,37)),new tE(20,new tC(4,16),new tC(4,17)),new tE(24,new tC(4,12),new tC(4,13))),new tI(10,Int32Array.from([6,28,50]),new tE(18,new tC(2,68),new tC(2,69)),new tE(26,new tC(4,43),new tC(1,44)),new tE(24,new tC(6,19),new tC(2,20)),new tE(28,new tC(6,15),new tC(2,16))),new tI(11,Int32Array.from([6,30,54]),new tE(20,new tC(4,81)),new tE(30,new tC(1,50),new tC(4,51)),new tE(28,new tC(4,22),new tC(4,23)),new tE(24,new tC(3,12),new tC(8,13))),new tI(12,Int32Array.from([6,32,58]),new tE(24,new tC(2,92),new tC(2,93)),new tE(22,new tC(6,36),new tC(2,37)),new tE(26,new tC(4,20),new tC(6,21)),new tE(28,new tC(7,14),new tC(4,15))),new tI(13,Int32Array.from([6,34,62]),new tE(26,new tC(4,107)),new tE(22,new tC(8,37),new tC(1,38)),new tE(24,new tC(8,20),new tC(4,21)),new tE(22,new tC(12,11),new tC(4,12))),new tI(14,Int32Array.from([6,26,46,66]),new tE(30,new tC(3,115),new tC(1,116)),new tE(24,new tC(4,40),new tC(5,41)),new tE(20,new tC(11,16),new tC(5,17)),new tE(24,new tC(11,12),new tC(5,13))),new tI(15,Int32Array.from([6,26,48,70]),new tE(22,new tC(5,87),new tC(1,88)),new tE(24,new tC(5,41),new tC(5,42)),new tE(30,new tC(5,24),new tC(7,25)),new tE(24,new tC(11,12),new tC(7,13))),new tI(16,Int32Array.from([6,26,50,74]),new tE(24,new tC(5,98),new tC(1,99)),new tE(28,new tC(7,45),new tC(3,46)),new tE(24,new tC(15,19),new tC(2,20)),new tE(30,new tC(3,15),new tC(13,16))),new tI(17,Int32Array.from([6,30,54,78]),new tE(28,new tC(1,107),new tC(5,108)),new tE(28,new tC(10,46),new tC(1,47)),new tE(28,new tC(1,22),new tC(15,23)),new tE(28,new tC(2,14),new tC(17,15))),new tI(18,Int32Array.from([6,30,56,82]),new tE(30,new tC(5,120),new tC(1,121)),new tE(26,new tC(9,43),new tC(4,44)),new tE(28,new tC(17,22),new tC(1,23)),new tE(28,new tC(2,14),new tC(19,15))),new tI(19,Int32Array.from([6,30,58,86]),new tE(28,new tC(3,113),new tC(4,114)),new tE(26,new tC(3,44),new tC(11,45)),new tE(26,new tC(17,21),new tC(4,22)),new tE(26,new tC(9,13),new tC(16,14))),new tI(20,Int32Array.from([6,34,62,90]),new tE(28,new tC(3,107),new tC(5,108)),new tE(26,new tC(3,41),new tC(13,42)),new tE(30,new tC(15,24),new tC(5,25)),new tE(28,new tC(15,15),new tC(10,16))),new tI(21,Int32Array.from([6,28,50,72,94]),new tE(28,new tC(4,116),new tC(4,117)),new tE(26,new tC(17,42)),new tE(28,new tC(17,22),new tC(6,23)),new tE(30,new tC(19,16),new tC(6,17))),new tI(22,Int32Array.from([6,26,50,74,98]),new tE(28,new tC(2,111),new tC(7,112)),new tE(28,new tC(17,46)),new tE(30,new tC(7,24),new tC(16,25)),new tE(24,new tC(34,13))),new tI(23,Int32Array.from([6,30,54,78,102]),new tE(30,new tC(4,121),new tC(5,122)),new tE(28,new tC(4,47),new tC(14,48)),new tE(30,new tC(11,24),new tC(14,25)),new tE(30,new tC(16,15),new tC(14,16))),new tI(24,Int32Array.from([6,28,54,80,106]),new tE(30,new tC(6,117),new tC(4,118)),new tE(28,new tC(6,45),new tC(14,46)),new tE(30,new tC(11,24),new tC(16,25)),new tE(30,new tC(30,16),new tC(2,17))),new tI(25,Int32Array.from([6,32,58,84,110]),new tE(26,new tC(8,106),new tC(4,107)),new tE(28,new tC(8,47),new tC(13,48)),new tE(30,new tC(7,24),new tC(22,25)),new tE(30,new tC(22,15),new tC(13,16))),new tI(26,Int32Array.from([6,30,58,86,114]),new tE(28,new tC(10,114),new tC(2,115)),new tE(28,new tC(19,46),new tC(4,47)),new tE(28,new tC(28,22),new tC(6,23)),new tE(30,new tC(33,16),new tC(4,17))),new tI(27,Int32Array.from([6,34,62,90,118]),new tE(30,new tC(8,122),new tC(4,123)),new tE(28,new tC(22,45),new tC(3,46)),new tE(30,new tC(8,23),new tC(26,24)),new tE(30,new tC(12,15),new tC(28,16))),new tI(28,Int32Array.from([6,26,50,74,98,122]),new tE(30,new tC(3,117),new tC(10,118)),new tE(28,new tC(3,45),new tC(23,46)),new tE(30,new tC(4,24),new tC(31,25)),new tE(30,new tC(11,15),new tC(31,16))),new tI(29,Int32Array.from([6,30,54,78,102,126]),new tE(30,new tC(7,116),new tC(7,117)),new tE(28,new tC(21,45),new tC(7,46)),new tE(30,new tC(1,23),new tC(37,24)),new tE(30,new tC(19,15),new tC(26,16))),new tI(30,Int32Array.from([6,26,52,78,104,130]),new tE(30,new tC(5,115),new tC(10,116)),new tE(28,new tC(19,47),new tC(10,48)),new tE(30,new tC(15,24),new tC(25,25)),new tE(30,new tC(23,15),new tC(25,16))),new tI(31,Int32Array.from([6,30,56,82,108,134]),new tE(30,new tC(13,115),new tC(3,116)),new tE(28,new tC(2,46),new tC(29,47)),new tE(30,new tC(42,24),new tC(1,25)),new tE(30,new tC(23,15),new tC(28,16))),new tI(32,Int32Array.from([6,34,60,86,112,138]),new tE(30,new tC(17,115)),new tE(28,new tC(10,46),new tC(23,47)),new tE(30,new tC(10,24),new tC(35,25)),new tE(30,new tC(19,15),new tC(35,16))),new tI(33,Int32Array.from([6,30,58,86,114,142]),new tE(30,new tC(17,115),new tC(1,116)),new tE(28,new tC(14,46),new tC(21,47)),new tE(30,new tC(29,24),new tC(19,25)),new tE(30,new tC(11,15),new tC(46,16))),new tI(34,Int32Array.from([6,34,62,90,118,146]),new tE(30,new tC(13,115),new tC(6,116)),new tE(28,new tC(14,46),new tC(23,47)),new tE(30,new tC(44,24),new tC(7,25)),new tE(30,new tC(59,16),new tC(1,17))),new tI(35,Int32Array.from([6,30,54,78,102,126,150]),new tE(30,new tC(12,121),new tC(7,122)),new tE(28,new tC(12,47),new tC(26,48)),new tE(30,new tC(39,24),new tC(14,25)),new tE(30,new tC(22,15),new tC(41,16))),new tI(36,Int32Array.from([6,24,50,76,102,128,154]),new tE(30,new tC(6,121),new tC(14,122)),new tE(28,new tC(6,47),new tC(34,48)),new tE(30,new tC(46,24),new tC(10,25)),new tE(30,new tC(2,15),new tC(64,16))),new tI(37,Int32Array.from([6,28,54,80,106,132,158]),new tE(30,new tC(17,122),new tC(4,123)),new tE(28,new tC(29,46),new tC(14,47)),new tE(30,new tC(49,24),new tC(10,25)),new tE(30,new tC(24,15),new tC(46,16))),new tI(38,Int32Array.from([6,32,58,84,110,136,162]),new tE(30,new tC(4,122),new tC(18,123)),new tE(28,new tC(13,46),new tC(32,47)),new tE(30,new tC(48,24),new tC(14,25)),new tE(30,new tC(42,15),new tC(32,16))),new tI(39,Int32Array.from([6,26,54,82,110,138,166]),new tE(30,new tC(20,117),new tC(4,118)),new tE(28,new tC(40,47),new tC(7,48)),new tE(30,new tC(43,24),new tC(22,25)),new tE(30,new tC(10,15),new tC(67,16))),new tI(40,Int32Array.from([6,30,58,86,114,142,170]),new tE(30,new tC(19,118),new tC(6,119)),new tE(28,new tC(18,47),new tC(31,48)),new tE(30,new tC(34,24),new tC(34,25)),new tE(30,new tC(20,15),new tC(61,16)))],(h=I||(I={}))[h.DATA_MASK_000=0]="DATA_MASK_000",h[h.DATA_MASK_001=1]="DATA_MASK_001",h[h.DATA_MASK_010=2]="DATA_MASK_010",h[h.DATA_MASK_011=3]="DATA_MASK_011",h[h.DATA_MASK_100=4]="DATA_MASK_100",h[h.DATA_MASK_101=5]="DATA_MASK_101",h[h.DATA_MASK_110=6]="DATA_MASK_110",h[h.DATA_MASK_111=7]="DATA_MASK_111";class t_{constructor(e,t){this.value=e,this.isMasked=t}unmaskBitMatrix(e,t){for(let r=0;r<t;r++)for(let n=0;n<t;n++)this.isMasked(r,n)&&e.flip(n,r)}}t_.values=new Map([[I.DATA_MASK_000,new t_(I.DATA_MASK_000,(e,t)=>(e+t&1)==0)],[I.DATA_MASK_001,new t_(I.DATA_MASK_001,(e,t)=>(1&e)==0)],[I.DATA_MASK_010,new t_(I.DATA_MASK_010,(e,t)=>t%3==0)],[I.DATA_MASK_011,new t_(I.DATA_MASK_011,(e,t)=>(e+t)%3==0)],[I.DATA_MASK_100,new t_(I.DATA_MASK_100,(e,t)=>(Math.floor(e/2)+Math.floor(t/3)&1)==0)],[I.DATA_MASK_101,new t_(I.DATA_MASK_101,(e,t)=>e*t%6==0)],[I.DATA_MASK_110,new t_(I.DATA_MASK_110,(e,t)=>e*t%6<3)],[I.DATA_MASK_111,new t_(I.DATA_MASK_111,(e,t)=>(e+t+e*t%3&1)==0)]]);class tA{constructor(e){const t=e.getHeight();if(t<21||(3&t)!=1)throw new V;this.bitMatrix=e}readFormatInformation(){if(null!==this.parsedFormatInfo&&void 0!==this.parsedFormatInfo)return this.parsedFormatInfo;let e=0;for(let t=0;t<6;t++)e=this.copyBit(t,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(let t=5;t>=0;t--)e=this.copyBit(8,t,e);let t=this.bitMatrix.getHeight(),r=0,n=t-7;for(let e=t-1;e>=n;e--)r=this.copyBit(8,e,r);for(let e=t-8;e<t;e++)r=this.copyBit(e,8,r);if(this.parsedFormatInfo=tw.decodeFormatInformation(e,r),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new V}readVersion(){if(null!==this.parsedVersion&&void 0!==this.parsedVersion)return this.parsedVersion;let e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return tI.getVersionForNumber(t);let r=0,n=e-11;for(let t=5;t>=0;t--)for(let i=e-9;i>=n;i--)r=this.copyBit(i,t,r);let i=tI.decodeVersionInformation(r);if(null!==i&&i.getDimensionForVersion()===e)return this.parsedVersion=i,i;r=0;for(let t=5;t>=0;t--)for(let i=e-9;i>=n;i--)r=this.copyBit(t,i,r);if(null!==(i=tI.decodeVersionInformation(r))&&i.getDimensionForVersion()===e)return this.parsedVersion=i,i;throw new V}copyBit(e,t,r){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?r<<1|1:r<<1}readCodewords(){let e=this.readFormatInformation(),t=this.readVersion(),r=t_.values.get(e.getDataMask()),n=this.bitMatrix.getHeight();r.unmaskBitMatrix(this.bitMatrix,n);let i=t.buildFunctionPattern(),s=!0,a=new Uint8Array(t.getTotalCodewords()),o=0,l=0,u=0;for(let e=n-1;e>0;e-=2){6===e&&e--;for(let t=0;t<n;t++){let r=s?n-1-t:t;for(let t=0;t<2;t++)i.get(e-t,r)||(u++,l<<=1,this.bitMatrix.get(e-t,r)&&(l|=1),8===u&&(a[o++]=l,u=0,l=0))}s=!s}if(o!==t.getTotalCodewords())throw new V;return a}remask(){if(null===this.parsedFormatInfo)return;let e=t_.values[this.parsedFormatInfo.getDataMask()],t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}setMirror(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e}mirror(){let e=this.bitMatrix;for(let t=0,r=e.getWidth();t<r;t++)for(let r=t+1,n=e.getHeight();r<n;r++)e.get(t,r)!==e.get(r,t)&&(e.flip(r,t),e.flip(t,r))}}class tS{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t,r){if(e.length!==t.getTotalCodewords())throw new D;let n=t.getECBlocksForLevel(r),i=0,s=n.getECBlocks();for(let e of s)i+=e.getCount();let a=Array(i),o=0;for(let e of s)for(let t=0;t<e.getCount();t++){let t=e.getDataCodewords(),r=n.getECCodewordsPerBlock()+t;a[o++]=new tS(t,new Uint8Array(r))}let l=a[0].codewords.length,u=a.length-1;for(;u>=0&&a[u].codewords.length!==l;)u--;u++;let h=l-n.getECCodewordsPerBlock(),c=0;for(let t=0;t<h;t++)for(let r=0;r<o;r++)a[r].codewords[t]=e[c++];for(let t=u;t<o;t++)a[t].codewords[h]=e[c++];let d=a[0].codewords.length;for(let t=h;t<d;t++)for(let r=0;r<o;r++){let n=r<u?t:t+1;a[r].codewords[n]=e[c++]}return a}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}(c=_||(_={}))[c.TERMINATOR=0]="TERMINATOR",c[c.NUMERIC=1]="NUMERIC",c[c.ALPHANUMERIC=2]="ALPHANUMERIC",c[c.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",c[c.BYTE=4]="BYTE",c[c.ECI=5]="ECI",c[c.KANJI=6]="KANJI",c[c.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",c[c.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",c[c.HANZI=9]="HANZI";class tT{constructor(e,t,r,n){this.value=e,this.stringValue=t,this.characterCountBitsForVersions=r,this.bits=n,tT.FOR_BITS.set(n,this),tT.FOR_VALUE.set(e,this)}static forBits(e){let t=tT.FOR_BITS.get(e);if(void 0===t)throw new D;return t}getCharacterCountBits(e){let t,r=e.getVersionNumber();return t=r<=9?0:r<=26?1:2,this.characterCountBitsForVersions[t]}getValue(){return this.value}getBits(){return this.bits}equals(e){return e instanceof tT&&this.value===e.value}toString(){return this.stringValue}}tT.FOR_BITS=new Map,tT.FOR_VALUE=new Map,tT.TERMINATOR=new tT(_.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),tT.NUMERIC=new tT(_.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),tT.ALPHANUMERIC=new tT(_.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),tT.STRUCTURED_APPEND=new tT(_.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),tT.BYTE=new tT(_.BYTE,"BYTE",Int32Array.from([8,16,16]),4),tT.ECI=new tT(_.ECI,"ECI",Int32Array.from([0,0,0]),7),tT.KANJI=new tT(_.KANJI,"KANJI",Int32Array.from([8,10,12]),8),tT.FNC1_FIRST_POSITION=new tT(_.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),tT.FNC1_SECOND_POSITION=new tT(_.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),tT.HANZI=new tT(_.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class tb{static decode(e,t,r,n){let i=new td(e),s=new q,a=[],o=-1,l=-1;try{let e,r=null,u=!1;do{if(4>i.available())e=tT.TERMINATOR;else{let t=i.readBits(4);e=tT.forBits(t)}switch(e){case tT.TERMINATOR:break;case tT.FNC1_FIRST_POSITION:case tT.FNC1_SECOND_POSITION:u=!0;break;case tT.STRUCTURED_APPEND:if(16>i.available())throw new V;o=i.readBits(8),l=i.readBits(8);break;case tT.ECI:let h=tb.parseECIValue(i);if(r=j.getCharacterSetECIByValue(h),null===r)throw new V;break;case tT.HANZI:let c=i.readBits(4),d=i.readBits(e.getCharacterCountBits(t));c===tb.GB2312_SUBSET&&tb.decodeHanziSegment(i,s,d);break;default:let f=i.readBits(e.getCharacterCountBits(t));switch(e){case tT.NUMERIC:tb.decodeNumericSegment(i,s,f);break;case tT.ALPHANUMERIC:tb.decodeAlphanumericSegment(i,s,f,u);break;case tT.BYTE:tb.decodeByteSegment(i,s,f,r,a,n);break;case tT.KANJI:tb.decodeKanjiSegment(i,s,f);break;default:throw new V}}}while(e!==tT.TERMINATOR)}catch(e){throw new V}return new es(e,s.toString(),0===a.length?null:a,null===r?null:r.toString(),o,l)}static decodeHanziSegment(e,t,r){if(13*r>e.available())throw new V;let n=new Uint8Array(2*r),i=0;for(;r>0;){let t=e.readBits(13),s=t/96<<8|t%96;s<959?s+=41377:s+=42657,n[i]=s>>8&255,n[i+1]=255&s,i+=2,r--}try{t.append(H.decode(n,G.GB2312))}catch(e){throw new V(e)}}static decodeKanjiSegment(e,t,r){if(13*r>e.available())throw new V;let n=new Uint8Array(2*r),i=0;for(;r>0;){let t=e.readBits(13),s=t/192<<8|t%192;s<7936?s+=33088:s+=49472,n[i]=s>>8,n[i+1]=s,i+=2,r--}try{t.append(H.decode(n,G.SHIFT_JIS))}catch(e){throw new V(e)}}static decodeByteSegment(e,t,r,n,i,s){let a;if(8*r>e.available())throw new V;let o=new Uint8Array(r);for(let t=0;t<r;t++)o[t]=e.readBits(8);a=null===n?G.guessEncoding(o,s):n.getName();try{t.append(H.decode(o,a))}catch(e){throw new V(e)}i.push(o)}static toAlphaNumericChar(e){if(e>=tb.ALPHANUMERIC_CHARS.length)throw new V;return tb.ALPHANUMERIC_CHARS[e]}static decodeAlphanumericSegment(e,t,r,n){let i=t.length();for(;r>1;){if(11>e.available())throw new V;let n=e.readBits(11);t.append(tb.toAlphaNumericChar(Math.floor(n/45))),t.append(tb.toAlphaNumericChar(n%45)),r-=2}if(1===r){if(6>e.available())throw new V;t.append(tb.toAlphaNumericChar(e.readBits(6)))}if(n)for(let e=i;e<t.length();e++)"%"===t.charAt(e)&&(e<t.length()-1&&"%"===t.charAt(e+1)?t.deleteCharAt(e+1):t.setCharAt(e,"\x1d"))}static decodeNumericSegment(e,t,r){for(;r>=3;){if(10>e.available())throw new V;let n=e.readBits(10);if(n>=1e3)throw new V;t.append(tb.toAlphaNumericChar(Math.floor(n/100))),t.append(tb.toAlphaNumericChar(Math.floor(n/10)%10)),t.append(tb.toAlphaNumericChar(n%10)),r-=3}if(2===r){if(7>e.available())throw new V;let r=e.readBits(7);if(r>=100)throw new V;t.append(tb.toAlphaNumericChar(Math.floor(r/10))),t.append(tb.toAlphaNumericChar(r%10))}else if(1===r){if(4>e.available())throw new V;let r=e.readBits(4);if(r>=10)throw new V;t.append(tb.toAlphaNumericChar(r))}}static parseECIValue(e){let t=e.readBits(8);if((128&t)==0)return 127&t;if((192&t)==128)return(63&t)<<8|e.readBits(8);if((224&t)==192)return(31&t)<<16|e.readBits(16);throw new V}}tb.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",tb.GB2312_SUBSET=1;class tv{constructor(e){this.mirrored=e}isMirrored(){return this.mirrored}applyMirroredCorrection(e){if(!this.mirrored||null===e||e.length<3)return;let t=e[0];e[0]=e[2],e[2]=t}}class tN{constructor(){this.rsDecoder=new ed(eu.QR_CODE_FIELD_256)}decodeBooleanArray(e,t){return this.decodeBitMatrix(W.parseFromBooleanArray(e),t)}decodeBitMatrix(e,t){let r=new tA(e),n=null;try{return this.decodeBitMatrixParser(r,t)}catch(e){n=e}try{r.remask(),r.setMirror(!0),r.readVersion(),r.readFormatInformation(),r.mirror();let e=this.decodeBitMatrixParser(r,t);return e.setOther(new tv(!0)),e}catch(e){if(null!==n)throw n;throw e}}decodeBitMatrixParser(e,t){let r=e.readVersion(),n=e.readFormatInformation().getErrorCorrectionLevel(),i=e.readCodewords(),s=tS.getDataBlocks(i,r,n),a=0;for(let e of s)a+=e.getNumDataCodewords();let o=new Uint8Array(a),l=0;for(let e of s){let t=e.getCodewords(),r=e.getNumDataCodewords();this.correctErrors(t,r);for(let e=0;e<r;e++)o[l++]=t[e]}return tb.decode(o,r,n,t)}correctErrors(e,t){let r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch(e){throw new M}for(let n=0;n<t;n++)e[n]=r[n]}}class tD extends em{constructor(e,t,r){super(e,t),this.estimatedModuleSize=r}aboutEquals(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){let t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,r){return new tD((this.getX()+t)/2,(this.getY()+e)/2,(this.estimatedModuleSize+r)/2)}}class tR{constructor(e,t,r,n,i,s,a){this.image=e,this.startX=t,this.startY=r,this.width=n,this.height=i,this.moduleSize=s,this.resultPointCallback=a,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){let e=this.startX,t=this.height,r=e+this.width,n=this.startY+t/2,i=new Int32Array(3),s=this.image;for(let a=0;a<t;a++){let t=n+((1&a)==0?Math.floor((a+1)/2):-Math.floor((a+1)/2));i[0]=0,i[1]=0,i[2]=0;let o=e;for(;o<r&&!s.get(o,t);)o++;let l=0;for(;o<r;){if(s.get(o,t))if(1===l)i[1]++;else if(2===l){if(this.foundPatternCross(i)){let e=this.handlePossibleCenter(i,t,o);if(null!==e)return e}i[0]=i[2],i[1]=1,i[2]=0,l=1}else i[++l]++;else 1===l&&l++,i[l]++;o++}if(this.foundPatternCross(i)){let e=this.handlePossibleCenter(i,t,r);if(null!==e)return e}}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new Y}static centerFromEnd(e,t){return t-e[2]-e[1]/2}foundPatternCross(e){let t=this.moduleSize,r=t/2;for(let n=0;n<3;n++)if(Math.abs(t-e[n])>=r)return!1;return!0}crossCheckVertical(e,t,r,n){let i=this.image,s=i.getHeight(),a=this.crossCheckStateCount;a[0]=0,a[1]=0,a[2]=0;let o=e;for(;o>=0&&i.get(t,o)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&!i.get(t,o)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(t,o)&&a[1]<=r;)a[1]++,o++;if(o===s||a[1]>r)return NaN;for(;o<s&&!i.get(t,o)&&a[2]<=r;)a[2]++,o++;return a[2]>r||5*Math.abs(a[0]+a[1]+a[2]-n)>=2*n?NaN:this.foundPatternCross(a)?tR.centerFromEnd(a,o):NaN}handlePossibleCenter(e,t,r){let n=e[0]+e[1]+e[2],i=tR.centerFromEnd(e,r),s=this.crossCheckVertical(t,i,2*e[1],n);if(!isNaN(s)){let t=(e[0]+e[1]+e[2])/3;for(let e of this.possibleCenters)if(e.aboutEquals(t,s,i))return e.combineEstimate(s,i,t);let r=new tD(i,s,t);this.possibleCenters.push(r),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(r)}return null}}class tM extends em{constructor(e,t,r,n){super(e,t),this.estimatedModuleSize=r,this.count=n,void 0===n&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){let t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,r){let n=this.count+1;return new tM((this.count*this.getX()+t)/n,(this.count*this.getY()+e)/n,(this.count*this.estimatedModuleSize+r)/n,n)}}class tO{constructor(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class tx{constructor(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(e){let t=null!=e&&void 0!==e.get(U.TRY_HARDER),r=null!=e&&void 0!==e.get(U.PURE_BARCODE),n=this.image,i=n.getHeight(),s=n.getWidth(),a=Math.floor(3*i/(4*tx.MAX_MODULES));(a<tx.MIN_SKIP||t)&&(a=tx.MIN_SKIP);let o=!1,l=new Int32Array(5);for(let e=a-1;e<i&&!o;e+=a){l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0;let t=0;for(let i=0;i<s;i++)if(n.get(i,e))(1&t)==1&&t++,l[t]++;else if((1&t)==0)if(4===t)if(tx.foundPatternCross(l)){if(!0===this.handlePossibleCenter(l,e,i,r))if(a=2,!0===this.hasSkipped)o=this.haveMultiplyConfirmedCenters();else{let t=this.findRowSkip();t>l[2]&&(e+=t-l[2]-a,i=s-1)}else{l[0]=l[2],l[1]=l[3],l[2]=l[4],l[3]=1,l[4]=0,t=3;continue}t=0,l[0]=0,l[1]=0,l[2]=0,l[3]=0,l[4]=0}else l[0]=l[2],l[1]=l[3],l[2]=l[4],l[3]=1,l[4]=0,t=3;else l[++t]++;else l[t]++;tx.foundPatternCross(l)&&!0===this.handlePossibleCenter(l,e,s,r)&&(a=l[0],this.hasSkipped&&(o=this.haveMultiplyConfirmedCenters()))}let u=this.selectBestPatterns();return em.orderBestPatterns(u),new tO(u)}static centerFromEnd(e,t){return t-e[4]-e[3]-e[2]/2}static foundPatternCross(e){let t=0;for(let r=0;r<5;r++){let n=e[r];if(0===n)return!1;t+=n}if(t<7)return!1;let r=t/7,n=r/2;return Math.abs(r-e[0])<n&&Math.abs(r-e[1])<n&&Math.abs(3*r-e[2])<3*n&&Math.abs(r-e[3])<n&&Math.abs(r-e[4])<n}getCrossCheckStateCount(){let e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e}crossCheckDiagonal(e,t,r,n){let i=this.getCrossCheckStateCount(),s=0,a=this.image;for(;e>=s&&t>=s&&a.get(t-s,e-s);)i[2]++,s++;if(e<s||t<s)return!1;for(;e>=s&&t>=s&&!a.get(t-s,e-s)&&i[1]<=r;)i[1]++,s++;if(e<s||t<s||i[1]>r)return!1;for(;e>=s&&t>=s&&a.get(t-s,e-s)&&i[0]<=r;)i[0]++,s++;if(i[0]>r)return!1;let o=a.getHeight(),l=a.getWidth();for(s=1;e+s<o&&t+s<l&&a.get(t+s,e+s);)i[2]++,s++;if(e+s>=o||t+s>=l)return!1;for(;e+s<o&&t+s<l&&!a.get(t+s,e+s)&&i[3]<r;)i[3]++,s++;if(e+s>=o||t+s>=l||i[3]>=r)return!1;for(;e+s<o&&t+s<l&&a.get(t+s,e+s)&&i[4]<r;)i[4]++,s++;return!(i[4]>=r)&&Math.abs(i[0]+i[1]+i[2]+i[3]+i[4]-n)<2*n&&tx.foundPatternCross(i)}crossCheckVertical(e,t,r,n){let i=this.image,s=i.getHeight(),a=this.getCrossCheckStateCount(),o=e;for(;o>=0&&i.get(t,o);)a[2]++,o--;if(o<0)return NaN;for(;o>=0&&!i.get(t,o)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&i.get(t,o)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(t,o);)a[2]++,o++;if(o===s)return NaN;for(;o<s&&!i.get(t,o)&&a[3]<r;)a[3]++,o++;if(o===s||a[3]>=r)return NaN;for(;o<s&&i.get(t,o)&&a[4]<r;)a[4]++,o++;return a[4]>=r||5*Math.abs(a[0]+a[1]+a[2]+a[3]+a[4]-n)>=2*n?NaN:tx.foundPatternCross(a)?tx.centerFromEnd(a,o):NaN}crossCheckHorizontal(e,t,r,n){let i=this.image,s=i.getWidth(),a=this.getCrossCheckStateCount(),o=e;for(;o>=0&&i.get(o,t);)a[2]++,o--;if(o<0)return NaN;for(;o>=0&&!i.get(o,t)&&a[1]<=r;)a[1]++,o--;if(o<0||a[1]>r)return NaN;for(;o>=0&&i.get(o,t)&&a[0]<=r;)a[0]++,o--;if(a[0]>r)return NaN;for(o=e+1;o<s&&i.get(o,t);)a[2]++,o++;if(o===s)return NaN;for(;o<s&&!i.get(o,t)&&a[3]<r;)a[3]++,o++;if(o===s||a[3]>=r)return NaN;for(;o<s&&i.get(o,t)&&a[4]<r;)a[4]++,o++;return a[4]>=r||5*Math.abs(a[0]+a[1]+a[2]+a[3]+a[4]-n)>=n?NaN:tx.foundPatternCross(a)?tx.centerFromEnd(a,o):NaN}handlePossibleCenter(e,t,r,n){let i=e[0]+e[1]+e[2]+e[3]+e[4],s=tx.centerFromEnd(e,r),a=this.crossCheckVertical(t,Math.floor(s),e[2],i);if(!isNaN(a)&&!isNaN(s=this.crossCheckHorizontal(Math.floor(s),Math.floor(a),e[2],i))&&(!n||this.crossCheckDiagonal(Math.floor(a),Math.floor(s),e[2],i))){let e=i/7,t=!1,r=this.possibleCenters;for(let n=0,i=r.length;n<i;n++){let i=r[n];if(i.aboutEquals(e,a,s)){r[n]=i.combineEstimate(a,s,e),t=!0;break}}if(!t){let t=new tM(s,a,e);r.push(t),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(t)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let e=null;for(let t of this.possibleCenters)if(t.getCount()>=tx.CENTER_QUORUM)if(null!=e)return this.hasSkipped=!0,Math.floor((Math.abs(e.getX()-t.getX())-Math.abs(e.getY()-t.getY()))/2);else e=t;return 0}haveMultiplyConfirmedCenters(){let e=0,t=0,r=this.possibleCenters.length;for(let r of this.possibleCenters)r.getCount()>=tx.CENTER_QUORUM&&(e++,t+=r.getEstimatedModuleSize());if(e<3)return!1;let n=t/r,i=0;for(let e of this.possibleCenters)i+=Math.abs(e.getEstimatedModuleSize()-n);return i<=.05*t}selectBestPatterns(){let e,t=this.possibleCenters.length;if(t<3)throw new Y;let r=this.possibleCenters;if(t>3){let n=0,i=0;for(let e of this.possibleCenters){let t=e.getEstimatedModuleSize();n+=t,i+=t*t}e=n/t;let s=Math.sqrt(i/t-e*e);r.sort((t,r)=>{let n=Math.abs(r.getEstimatedModuleSize()-e),i=Math.abs(t.getEstimatedModuleSize()-e);return n<i?-1:+(n>i)});let a=Math.max(.2*e,s);for(let t=0;t<r.length&&r.length>3;t++)Math.abs(r[t].getEstimatedModuleSize()-e)>a&&(r.splice(t,1),t--)}if(r.length>3){let t=0;for(let e of r)t+=e.getEstimatedModuleSize();e=t/r.length,r.sort((t,r)=>{if(r.getCount()!==t.getCount())return r.getCount()-t.getCount();{let n=Math.abs(r.getEstimatedModuleSize()-e),i=Math.abs(t.getEstimatedModuleSize()-e);return n<i?1:n>i?-1:0}}),r.splice(3)}return[r[0],r[1],r[2]]}}tx.CENTER_QUORUM=2,tx.MIN_SKIP=3,tx.MAX_MODULES=57;class tL{constructor(e){this.image=e}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(e){this.resultPointCallback=null==e?null:e.get(U.NEED_RESULT_POINT_CALLBACK);let t=new tx(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(t)}processFinderPatternInfo(e){let t=e.getTopLeft(),r=e.getTopRight(),n=e.getBottomLeft(),i=this.calculateModuleSize(t,r,n);if(i<1)throw new Y("No pattern found in proccess finder.");let s=tL.computeDimension(t,r,n,i),a=tI.getProvisionalVersionForDimension(s),o=a.getDimensionForVersion()-7,l=null;if(a.getAlignmentPatternCenters().length>0){let e=r.getX()-t.getX()+n.getX(),s=r.getY()-t.getY()+n.getY(),a=1-3/o,u=Math.floor(t.getX()+a*(e-t.getX())),h=Math.floor(t.getY()+a*(s-t.getY()));for(let e=4;e<=16;e<<=1)try{l=this.findAlignmentInRegion(i,u,h,e);break}catch(e){if(!(e instanceof Y))throw e}}let u=tL.createTransform(t,r,n,l,s);return new ey(tL.sampleGrid(this.image,u,s),null===l?[n,t,r]:[n,t,r,l])}static createTransform(e,t,r,n,i){let s,a,o,l,u=i-3.5;return null!==n?(s=n.getX(),a=n.getY(),l=o=u-3):(s=t.getX()-e.getX()+r.getX(),a=t.getY()-e.getY()+r.getY(),o=u,l=u),eI.quadrilateralToQuadrilateral(3.5,3.5,u,3.5,o,l,3.5,u,e.getX(),e.getY(),t.getX(),t.getY(),s,a,r.getX(),r.getY())}static sampleGrid(e,t,r){return eA.getInstance().sampleGridWithTransform(e,r,r,t)}static computeDimension(e,t,r,n){let i=Math.floor((eg.round(em.distance(e,t)/n)+eg.round(em.distance(e,r)/n))/2)+7;switch(3&i){case 0:i++;break;case 2:i--;break;case 3:throw new Y("Dimensions could be not found.")}return i}calculateModuleSize(e,t,r){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,r))/2}calculateModuleSizeOneWay(e,t){let r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(r)?n/7:isNaN(n)?r/7:(r+n)/14}sizeOfBlackWhiteBlackRunBothWays(e,t,r,n){let i=this.sizeOfBlackWhiteBlackRun(e,t,r,n),s=1,a=e-(r-e);a<0?(s=e/(e-a),a=0):a>=this.image.getWidth()&&(s=(this.image.getWidth()-1-e)/(a-e),a=this.image.getWidth()-1);let o=Math.floor(t-(n-t)*s);return s=1,o<0?(s=t/(t-o),o=0):o>=this.image.getHeight()&&(s=(this.image.getHeight()-1-t)/(o-t),o=this.image.getHeight()-1),a=Math.floor(e+(a-e)*s),(i+=this.sizeOfBlackWhiteBlackRun(e,t,a,o))-1}sizeOfBlackWhiteBlackRun(e,t,r,n){let i=Math.abs(n-t)>Math.abs(r-e);if(i){let i=e;e=t,t=i,i=r,r=n,n=i}let s=Math.abs(r-e),a=Math.abs(n-t),o=-s/2,l=e<r?1:-1,u=t<n?1:-1,h=0,c=r+l;for(let r=e,d=t;r!==c;r+=l){let l=i?d:r,c=i?r:d;if(1===h===this.image.get(l,c)){if(2===h)return eg.distance(r,d,e,t);h++}if((o+=a)>0){if(d===n)break;d+=u,o-=s}}return 2===h?eg.distance(r+l,n,e,t):NaN}findAlignmentInRegion(e,t,r,n){let i=Math.floor(n*e),s=Math.max(0,t-i),a=Math.min(this.image.getWidth()-1,t+i);if(a-s<3*e)throw new Y("Alignment top exceeds estimated module size.");let o=Math.max(0,r-i),l=Math.min(this.image.getHeight()-1,r+i);if(l-o<3*e)throw new Y("Alignment bottom exceeds estimated module size.");return new tR(this.image,s,o,a-s,l-o,e,this.resultPointCallback).find()}}class tP{constructor(){this.decoder=new tN}getDecoder(){return this.decoder}decode(e,t){let r,n;if(null!=t&&void 0!==t.get(U.PURE_BARCODE)){let i=tP.extractPureBits(e.getBlackMatrix());r=this.decoder.decodeBitMatrix(i,t),n=tP.NO_POINTS}else{let i=new tL(e.getBlackMatrix()).detect(t);r=this.decoder.decodeBitMatrix(i.getBits(),t),n=i.getPoints()}r.getOther()instanceof tv&&r.getOther().applyMirroredCorrection(n);let i=new er(r.getText(),r.getRawBytes(),void 0,n,en.QR_CODE,void 0),s=r.getByteSegments();null!==s&&i.putMetadata(ei.BYTE_SEGMENTS,s);let a=r.getECLevel();return null!==a&&i.putMetadata(ei.ERROR_CORRECTION_LEVEL,a),r.hasStructuredAppend()&&(i.putMetadata(ei.STRUCTURED_APPEND_SEQUENCE,r.getStructuredAppendSequenceNumber()),i.putMetadata(ei.STRUCTURED_APPEND_PARITY,r.getStructuredAppendParity())),i}reset(){}static extractPureBits(e){let t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(null===t||null===r)throw new Y;let n=this.moduleSize(t,e),i=t[1],s=r[1],a=t[0],o=r[0];if(a>=o||i>=s||s-i!=o-a&&(o=a+(s-i))>=e.getWidth())throw new Y;let l=Math.round((o-a+1)/n),u=Math.round((s-i+1)/n);if(l<=0||u<=0||u!==l)throw new Y;let h=Math.floor(n/2);i+=h;let c=(a+=h)+Math.floor((l-1)*n)-o;if(c>0){if(c>h)throw new Y;a-=c}let d=i+Math.floor((u-1)*n)-s;if(d>0){if(d>h)throw new Y;i-=d}let f=new W(l,u);for(let t=0;t<u;t++){let r=i+Math.floor(t*n);for(let i=0;i<l;i++)e.get(a+Math.floor(i*n),r)&&f.set(i,t)}return f}static moduleSize(e,t){let r=t.getHeight(),n=t.getWidth(),i=e[0],s=e[1],a=!0,o=0;for(;i<n&&s<r;){if(a!==t.get(i,s)){if(5==++o)break;a=!a}i++,s++}if(i===n||s===r)throw new Y;return(i-e[0])/7}}tP.NO_POINTS=[];class tk{PDF417Common(){}static getBitCountSum(e){return eg.sum(e)}static toIntArray(e){if(null==e||!e.length)return tk.EMPTY_INT_ARRAY;let t=new Int32Array(e.length),r=0;for(let n of e)t[r++]=n;return t}static getCodeword(e){let t=k.binarySearch(tk.SYMBOL_TABLE,262143&e);return t<0?-1:(tk.CODEWORD_TABLE[t]-1)%tk.NUMBER_OF_CODEWORDS}}tk.NUMBER_OF_CODEWORDS=929,tk.MAX_CODEWORDS_IN_BARCODE=tk.NUMBER_OF_CODEWORDS-1,tk.MIN_ROWS_IN_BARCODE=3,tk.MAX_ROWS_IN_BARCODE=90,tk.MODULES_IN_CODEWORD=17,tk.MODULES_IN_STOP_PATTERN=18,tk.BARS_IN_MODULE=8,tk.EMPTY_INT_ARRAY=new Int32Array([]),tk.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),tk.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class tB{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class tF{static detectMultiple(e,t,r){let n=e.getBlackMatrix(),i=tF.detect(r,n);return i.length||((n=n.clone()).rotate180(),i=tF.detect(r,n)),new tB(n,i)}static detect(e,t){let r=[],n=0,i=0,s=!1;for(;n<t.getHeight();){let a=tF.findVertices(t,n,i);if(null==a[0]&&null==a[3]){if(!s)break;for(let e of(s=!1,i=0,r))null!=e[1]&&(n=Math.trunc(Math.max(n,e[1].getY()))),null!=e[3]&&(n=Math.max(n,Math.trunc(e[3].getY())));n+=tF.ROW_STEP;continue}if(s=!0,r.push(a),!e)break;null!=a[2]?(i=Math.trunc(a[2].getX()),n=Math.trunc(a[2].getY())):(i=Math.trunc(a[4].getX()),n=Math.trunc(a[4].getY()))}return r}static findVertices(e,t,r){let n=e.getHeight(),i=e.getWidth(),s=Array(8);return tF.copyToResult(s,tF.findRowsWithPattern(e,n,i,t,r,tF.START_PATTERN),tF.INDEXES_START_PATTERN),null!=s[4]&&(r=Math.trunc(s[4].getX()),t=Math.trunc(s[4].getY())),tF.copyToResult(s,tF.findRowsWithPattern(e,n,i,t,r,tF.STOP_PATTERN),tF.INDEXES_STOP_PATTERN),s}static copyToResult(e,t,r){for(let n=0;n<r.length;n++)e[r[n]]=t[n]}static findRowsWithPattern(e,t,r,n,i,s){let a=[,,,,],o=!1,l=new Int32Array(s.length);for(;n<t;n+=tF.ROW_STEP){let t=tF.findGuardPattern(e,i,n,r,!1,s,l);if(null!=t){for(;n>0;){let a=tF.findGuardPattern(e,i,--n,r,!1,s,l);if(null!=a)t=a;else{n++;break}}a[0]=new em(t[0],n),a[1]=new em(t[1],n),o=!0;break}}let u=n+1;if(o){let n=0,i=Int32Array.from([Math.trunc(a[0].getX()),Math.trunc(a[1].getX())]);for(;u<t;u++){let t=tF.findGuardPattern(e,i[0],u,r,!1,s,l);if(null!=t&&Math.abs(i[0]-t[0])<tF.MAX_PATTERN_DRIFT&&Math.abs(i[1]-t[1])<tF.MAX_PATTERN_DRIFT)i=t,n=0;else if(n>tF.SKIPPED_ROW_COUNT_MAX)break;else n++}u-=n+1,a[2]=new em(i[0],u),a[3]=new em(i[1],u)}return u-n<tF.BARCODE_MIN_HEIGHT&&k.fill(a,null),a}static findGuardPattern(e,t,r,n,i,s,a){k.fillWithin(a,0,a.length,0);let o=t,l=0;for(;e.get(o,r)&&o>0&&l++<tF.MAX_PIXEL_DRIFT;)o--;let u=o,h=0,c=s.length;for(let t=i;u<n;u++)if(e.get(u,r)!==t)a[h]++;else{if(h===c-1){if(tF.patternMatchVariance(a,s,tF.MAX_INDIVIDUAL_VARIANCE)<tF.MAX_AVG_VARIANCE)return new Int32Array([o,u]);o+=a[0]+a[1],x.arraycopy(a,2,a,0,h-1),a[h-1]=0,a[h]=0,h--}else h++;a[h]=1,t=!t}return h===c-1&&tF.patternMatchVariance(a,s,tF.MAX_INDIVIDUAL_VARIANCE)<tF.MAX_AVG_VARIANCE?new Int32Array([o,u-1]):null}static patternMatchVariance(e,t,r){let n=e.length,i=0,s=0;for(let r=0;r<n;r++)i+=e[r],s+=t[r];if(i<s)return 1/0;let a=i/s;r*=a;let o=0;for(let i=0;i<n;i++){let n=e[i],s=t[i]*a,l=n>s?n-s:s-n;if(l>r)return 1/0;o+=l}return o/i}}tF.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),tF.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),tF.MAX_AVG_VARIANCE=.42,tF.MAX_INDIVIDUAL_VARIANCE=.8,tF.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),tF.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),tF.MAX_PIXEL_DRIFT=3,tF.MAX_PATTERN_DRIFT=5,tF.SKIPPED_ROW_COUNT_MAX=25,tF.ROW_STEP=5,tF.BARCODE_MIN_HEIGHT=10;class tU{constructor(e,t){if(0===t.length)throw new D;this.field=e;let r=t.length;if(r>1&&0===t[0]){let e=1;for(;e<r&&0===t[e];)e++;e===r?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(r-e),x.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);if(1===e){let e=0;for(let t of this.coefficients)e=this.field.add(e,t);return e}let t=this.coefficients[0],r=this.coefficients.length;for(let n=1;n<r;n++)t=this.field.add(this.field.multiply(e,t),this.coefficients[n]);return t}add(e){if(!this.field.equals(e.field))throw new D("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,r=e.coefficients;if(t.length>r.length){let e=t;t=r,r=e}let n=new Int32Array(r.length),i=r.length-t.length;x.arraycopy(r,0,n,0,i);for(let e=i;e<r.length;e++)n[e]=this.field.add(t[e-i],r[e]);return new tU(this.field,n)}subtract(e){if(!this.field.equals(e.field))throw new D("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())}multiply(e){return e instanceof tU?this.multiplyOther(e):this.multiplyScalar(e)}multiplyOther(e){if(!this.field.equals(e.field))throw new D("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new tU(this.field,new Int32Array([0]));let t=this.coefficients,r=t.length,n=e.coefficients,i=n.length,s=new Int32Array(r+i-1);for(let e=0;e<r;e++){let r=t[e];for(let t=0;t<i;t++)s[e+t]=this.field.add(s[e+t],this.field.multiply(r,n[t]))}return new tU(this.field,s)}negative(){let e=this.coefficients.length,t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=this.field.subtract(0,this.coefficients[r]);return new tU(this.field,t)}multiplyScalar(e){if(0===e)return new tU(this.field,new Int32Array([0]));if(1===e)return this;let t=this.coefficients.length,r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=this.field.multiply(this.coefficients[n],e);return new tU(this.field,r)}multiplyByMonomial(e,t){if(e<0)throw new D;if(0===t)return new tU(this.field,new Int32Array([0]));let r=this.coefficients.length,n=new Int32Array(r+e);for(let e=0;e<r;e++)n[e]=this.field.multiply(this.coefficients[e],t);return new tU(this.field,n)}toString(){let e=new q;for(let t=this.getDegree();t>=0;t--){let r=this.getCoefficient(t);0!==r&&(r<0?(e.append(" - "),r=-r):e.length()>0&&e.append(" + "),(0===t||1!==r)&&e.append(r),0!==t&&(1===t?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()}}class tV{add(e,t){return(e+t)%this.modulus}subtract(e,t){return(this.modulus+e-t)%this.modulus}exp(e){return this.expTable[e]}log(e){if(0===e)throw new D;return this.logTable[e]}inverse(e){if(0===e)throw new el;return this.expTable[this.modulus-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]}getSize(){return this.modulus}equals(e){return e===this}}class tj extends tV{constructor(e,t){super(),this.modulus=e,this.expTable=new Int32Array(e),this.logTable=new Int32Array(e);let r=1;for(let n=0;n<e;n++)this.expTable[n]=r,r=r*t%e;for(let t=0;t<e-1;t++)this.logTable[this.expTable[t]]=t;this.zero=new tU(this,new Int32Array([0])),this.one=new tU(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new D;if(0===t)return this.zero;let r=new Int32Array(e+1);return r[0]=t,new tU(this,r)}}tj.PDF417_GF=new tj(tk.NUMBER_OF_CODEWORDS,3);class tz{constructor(){this.field=tj.PDF417_GF}decode(e,t,r){let n=new tU(this.field,e),i=new Int32Array(t),s=!1;for(let e=t;e>0;e--){let r=n.evaluateAt(this.field.exp(e));i[t-e]=r,0!==r&&(s=!0)}if(!s)return 0;let a=this.field.getOne();if(null!=r)for(let t of r){let r=this.field.exp(e.length-1-t),n=new tU(this.field,new Int32Array([this.field.subtract(0,r),1]));a=a.multiply(n)}let o=new tU(this.field,i),l=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),o,t),u=l[0],h=l[1],c=this.findErrorLocations(u),d=this.findErrorMagnitudes(h,u,c);for(let t=0;t<c.length;t++){let r=e.length-1-this.field.log(c[t]);if(r<0)throw M.getChecksumInstance();e[r]=this.field.subtract(e[r],d[t])}return c.length}runEuclideanAlgorithm(e,t,r){if(e.getDegree()<t.getDegree()){let r=e;e=t,t=r}let n=e,i=t,s=this.field.getZero(),a=this.field.getOne();for(;i.getDegree()>=Math.round(r/2);){let e=n,t=s;if(n=i,s=a,n.isZero())throw M.getChecksumInstance();i=e;let r=this.field.getZero(),o=n.getCoefficient(n.getDegree()),l=this.field.inverse(o);for(;i.getDegree()>=n.getDegree()&&!i.isZero();){let e=i.getDegree()-n.getDegree(),t=this.field.multiply(i.getCoefficient(i.getDegree()),l);r=r.add(this.field.buildMonomial(e,t)),i=i.subtract(n.multiplyByMonomial(e,t))}a=r.multiply(s).subtract(t).negative()}let o=a.getCoefficient(0);if(0===o)throw M.getChecksumInstance();let l=this.field.inverse(o);return[a.multiply(l),i.multiply(l)]}findErrorLocations(e){let t=e.getDegree(),r=new Int32Array(t),n=0;for(let i=1;i<this.field.getSize()&&n<t;i++)0===e.evaluateAt(i)&&(r[n]=this.field.inverse(i),n++);if(n!==t)throw M.getChecksumInstance();return r}findErrorMagnitudes(e,t,r){let n=t.getDegree(),i=new Int32Array(n);for(let e=1;e<=n;e++)i[n-e]=this.field.multiply(e,t.getCoefficient(e));let s=new tU(this.field,i),a=r.length,o=new Int32Array(a);for(let t=0;t<a;t++){let n=this.field.inverse(r[t]),i=this.field.subtract(0,e.evaluateAt(n)),a=this.field.inverse(s.evaluateAt(n));o[t]=this.field.multiply(i,a)}return o}}class tH{constructor(e,t,r,n,i){e instanceof tH?this.constructor_2(e):this.constructor_1(e,t,r,n,i)}constructor_1(e,t,r,n,i){let s=null==t||null==r,a=null==n||null==i;if(s&&a)throw new Y;s?(t=new em(0,n.getY()),r=new em(0,i.getY())):a&&(n=new em(e.getWidth()-1,t.getY()),i=new em(e.getWidth()-1,r.getY())),this.image=e,this.topLeft=t,this.bottomLeft=r,this.topRight=n,this.bottomRight=i,this.minX=Math.trunc(Math.min(t.getX(),r.getX())),this.maxX=Math.trunc(Math.max(n.getX(),i.getX())),this.minY=Math.trunc(Math.min(t.getY(),n.getY())),this.maxY=Math.trunc(Math.max(r.getY(),i.getY()))}constructor_2(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()}static merge(e,t){return null==e?t:null==t?e:new tH(e.image,e.topLeft,e.bottomLeft,t.topRight,t.bottomRight)}addMissingRows(e,t,r){let n=this.topLeft,i=this.bottomLeft,s=this.topRight,a=this.bottomRight;if(e>0){let t=r?this.topLeft:this.topRight,i=Math.trunc(t.getY()-e);i<0&&(i=0);let a=new em(t.getX(),i);r?n=a:s=a}if(t>0){let e=r?this.bottomLeft:this.bottomRight,n=Math.trunc(e.getY()+t);n>=this.image.getHeight()&&(n=this.image.getHeight()-1);let s=new em(e.getX(),n);r?i=s:a=s}return new tH(this.image,n,i,s,a)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class tG{constructor(e,t,r,n){this.columnCount=e,this.errorCorrectionLevel=n,this.rowCountUpperPart=t,this.rowCountLowerPart=r,this.rowCount=t+r}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class tq{constructor(){this.buffer=""}static form(e,t){let r=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function(e,n,i,s,a,o){let l;if("%%"===e)return"%";if(void 0===t[++r])return;e=s?parseInt(s.substr(1)):void 0;let u=a?parseInt(a.substr(1)):void 0;switch(o){case"s":l=t[r];break;case"c":l=t[r][0];break;case"f":l=parseFloat(t[r]).toFixed(e);break;case"p":l=parseFloat(t[r]).toPrecision(e);break;case"e":l=parseFloat(t[r]).toExponential(e);break;case"x":l=parseInt(t[r]).toString(u||16);break;case"d":l=parseFloat(parseInt(t[r],u||10).toPrecision(e)).toFixed(0)}l="object"==typeof l?JSON.stringify(l):(+l).toString(u);let h=parseInt(i),c=i&&i[0]+""=="0"?"0":" ";for(;l.length<h;)l=void 0!==n?l+c:c+l;return l})}format(e,...t){this.buffer+=tq.form(e,t)}toString(){return this.buffer}}class tW{constructor(e){this.boundingBox=new tH(e),this.codewords=Array(e.getMaxY()-e.getMinY()+1)}getCodewordNearby(e){let t=this.getCodeword(e);if(null!=t)return t;for(let r=1;r<tW.MAX_NEARBY_DISTANCE;r++){let n=this.imageRowToCodewordIndex(e)-r;if(n>=0&&null!=(t=this.codewords[n])||(n=this.imageRowToCodewordIndex(e)+r)<this.codewords.length&&null!=(t=this.codewords[n]))return t}return null}imageRowToCodewordIndex(e){return e-this.boundingBox.getMinY()}setCodeword(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t}getCodeword(e){return this.codewords[this.imageRowToCodewordIndex(e)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){let e=new tq,t=0;for(let r of this.codewords){if(null==r){e.format("%3d:    |   %n",t++);continue}e.format("%3d: %3d|%3d%n",t++,r.getRowNumber(),r.getValue())}return e.toString()}}tW.MAX_NEARBY_DISTANCE=5;class tY{constructor(){this.values=new Map}setValue(e){e=Math.trunc(e);let t=this.values.get(e);null==t&&(t=0),t++,this.values.set(e,t)}getValue(){let e=-1,t=[];for(let[r,n]of this.values.entries()){let i=()=>r,s=()=>n;s()>e?(e=s(),(t=[]).push(i())):s()===e&&t.push(i())}return tk.toIntArray(t)}getConfidence(e){return this.values.get(e)}}class tK extends tW{constructor(e,t){super(e),this._isLeft=t}setRowNumbers(){for(let e of this.getCodewords())null!=e&&e.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(e){let t=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(t,e);let r=this.getBoundingBox(),n=this._isLeft?r.getTopLeft():r.getTopRight(),i=this._isLeft?r.getBottomLeft():r.getBottomRight(),s=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.imageRowToCodewordIndex(Math.trunc(i.getY())),o=-1,l=1,u=0;for(let r=s;r<a;r++){if(null==t[r])continue;let n=t[r],i=n.getRowNumber()-o;if(0===i)u++;else if(1===i)l=Math.max(l,u),u=1,o=n.getRowNumber();else if(i<0||n.getRowNumber()>=e.getRowCount()||i>r)t[r]=null;else{let e,s=(e=l>2?(l-2)*i:i)>=r;for(let n=1;n<=e&&!s;n++)s=null!=t[r-n];s?t[r]=null:(o=n.getRowNumber(),u=1)}}}getRowHeights(){let e=this.getBarcodeMetadata();if(null==e)return null;this.adjustIncompleteIndicatorColumnRowNumbers(e);let t=new Int32Array(e.getRowCount());for(let e of this.getCodewords())if(null!=e){let r=e.getRowNumber();if(r>=t.length)continue;t[r]++}return t}adjustIncompleteIndicatorColumnRowNumbers(e){let t=this.getBoundingBox(),r=this._isLeft?t.getTopLeft():t.getTopRight(),n=this._isLeft?t.getBottomLeft():t.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(r.getY())),s=this.imageRowToCodewordIndex(Math.trunc(n.getY())),a=this.getCodewords(),o=-1;for(let t=i;t<s;t++){if(null==a[t])continue;let r=a[t];r.setRowNumberAsRowIndicatorColumn();let n=r.getRowNumber()-o;0===n||(1===n?o=r.getRowNumber():r.getRowNumber()>=e.getRowCount()?a[t]=null:o=r.getRowNumber())}}getBarcodeMetadata(){let e=this.getCodewords(),t=new tY,r=new tY,n=new tY,i=new tY;for(let s of e){if(null==s)continue;s.setRowNumberAsRowIndicatorColumn();let e=s.getValue()%30,a=s.getRowNumber();switch(!this._isLeft&&(a+=2),a%3){case 0:r.setValue(3*e+1);break;case 1:i.setValue(e/3),n.setValue(e%3);break;case 2:t.setValue(e+1)}}if(0===t.getValue().length||0===r.getValue().length||0===n.getValue().length||0===i.getValue().length||t.getValue()[0]<1||r.getValue()[0]+n.getValue()[0]<tk.MIN_ROWS_IN_BARCODE||r.getValue()[0]+n.getValue()[0]>tk.MAX_ROWS_IN_BARCODE)return null;let s=new tG(t.getValue()[0],r.getValue()[0],n.getValue()[0],i.getValue()[0]);return this.removeIncorrectCodewords(e,s),s}removeIncorrectCodewords(e,t){for(let r=0;r<e.length;r++){let n=e[r];if(null==e[r])continue;let i=n.getValue()%30,s=n.getRowNumber();if(s>t.getRowCount()){e[r]=null;continue}switch(!this._isLeft&&(s+=2),s%3){case 0:3*i+1!==t.getRowCountUpperPart()&&(e[r]=null);break;case 1:(Math.trunc(i/3)!==t.getErrorCorrectionLevel()||i%3!==t.getRowCountLowerPart())&&(e[r]=null);break;case 2:i+1!==t.getColumnCount()&&(e[r]=null)}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+"\n"+super.toString()}}class tX{constructor(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){let e;this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let t=tk.MAX_CODEWORDS_IN_BARCODE;do e=t,t=this.adjustRowNumbersAndGetCount();while(t>0&&t<e)return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(e){null!=e&&e.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let e=this.adjustRowNumbersByRow();if(0===e)return 0;for(let e=1;e<this.barcodeColumnCount+1;e++){let t=this.detectionResultColumns[e].getCodewords();for(let r=0;r<t.length;r++)null!=t[r]&&(t[r].hasValidRowNumber()||this.adjustRowNumbers(e,r,t))}return e}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(null==this.detectionResultColumns[0]||null==this.detectionResultColumns[this.barcodeColumnCount+1])return;let e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let r=0;r<e.length;r++)if(null!=e[r]&&null!=t[r]&&e[r].getRowNumber()===t[r].getRowNumber())for(let t=1;t<=this.barcodeColumnCount;t++){let n=this.detectionResultColumns[t].getCodewords()[r];null!=n&&(n.setRowNumber(e[r].getRowNumber()),n.hasValidRowNumber()||(this.detectionResultColumns[t].getCodewords()[r]=null))}}adjustRowNumbersFromRRI(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;let e=0,t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let r=0;r<t.length;r++){if(null==t[r])continue;let n=t[r].getRowNumber(),i=0;for(let t=this.barcodeColumnCount+1;t>0&&i<this.ADJUST_ROW_NUMBER_SKIP;t--){let s=this.detectionResultColumns[t].getCodewords()[r];null!=s&&(i=tX.adjustRowNumberIfValid(n,i,s),!s.hasValidRowNumber()&&e++)}}return e}adjustRowNumbersFromLRI(){if(null==this.detectionResultColumns[0])return 0;let e=0,t=this.detectionResultColumns[0].getCodewords();for(let r=0;r<t.length;r++){if(null==t[r])continue;let n=t[r].getRowNumber(),i=0;for(let t=1;t<this.barcodeColumnCount+1&&i<this.ADJUST_ROW_NUMBER_SKIP;t++){let s=this.detectionResultColumns[t].getCodewords()[r];null!=s&&(i=tX.adjustRowNumberIfValid(n,i,s),!s.hasValidRowNumber()&&e++)}}return e}static adjustRowNumberIfValid(e,t,r){return null==r||!r.hasValidRowNumber()&&(r.isValidRowNumber(e)?(r.setRowNumber(e),t=0):++t),t}adjustRowNumbers(e,t,r){if(!this.detectionResultColumns[e-1])return;let n=r[t],i=this.detectionResultColumns[e-1].getCodewords(),s=i;null!=this.detectionResultColumns[e+1]&&(s=this.detectionResultColumns[e+1].getCodewords());let a=Array(14);for(let e of(a[2]=i[t],a[3]=s[t],t>0&&(a[0]=r[t-1],a[4]=i[t-1],a[5]=s[t-1]),t>1&&(a[8]=r[t-2],a[10]=i[t-2],a[11]=s[t-2]),t<r.length-1&&(a[1]=r[t+1],a[6]=i[t+1],a[7]=s[t+1]),t<r.length-2&&(a[9]=r[t+2],a[12]=i[t+2],a[13]=s[t+2]),a))if(tX.adjustRowNumber(n,e))return}static adjustRowNumber(e,t){return null!=t&&!!t.hasValidRowNumber()&&t.getBucket()===e.getBucket()&&(e.setRowNumber(t.getRowNumber()),!0)}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(e){this.boundingBox=e}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(e,t){this.detectionResultColumns[e]=t}getDetectionResultColumn(e){return this.detectionResultColumns[e]}toString(){let e=this.detectionResultColumns[0];null==e&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);let t=new tq;for(let r=0;r<e.getCodewords().length;r++){t.format("CW %3d:",r);for(let e=0;e<this.barcodeColumnCount+2;e++){if(null==this.detectionResultColumns[e]){t.format("    |   ");continue}let n=this.detectionResultColumns[e].getCodewords()[r];if(null==n){t.format("    |   ");continue}t.format(" %3d|%3d",n.getRowNumber(),n.getValue())}t.format("%n")}return t.toString()}}class tQ{constructor(e,t,r,n){this.rowNumber=tQ.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(t),this.bucket=Math.trunc(r),this.value=Math.trunc(n)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(e){return e!==tQ.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(e){this.rowNumber=e}toString(){return this.rowNumber+"|"+this.value}}tQ.BARCODE_ROW_UNKNOWN=-1;class t${static initialize(){for(let e=0;e<tk.SYMBOL_TABLE.length;e++){let t=tk.SYMBOL_TABLE[e],r=1&t;for(let n=0;n<tk.BARS_IN_MODULE;n++){let i=0;for(;(1&t)===r;)i+=1,t>>=1;r=1&t,t$.RATIOS_TABLE[e]||(t$.RATIOS_TABLE[e]=Array(tk.BARS_IN_MODULE)),t$.RATIOS_TABLE[e][tk.BARS_IN_MODULE-n-1]=Math.fround(i/tk.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(e){let t=t$.getDecodedCodewordValue(t$.sampleBitCounts(e));return -1!==t?t:t$.getClosestDecodedValue(e)}static sampleBitCounts(e){let t=eg.sum(e),r=new Int32Array(tk.BARS_IN_MODULE),n=0,i=0;for(let s=0;s<tk.MODULES_IN_CODEWORD;s++){let a=t/(2*tk.MODULES_IN_CODEWORD)+s*t/tk.MODULES_IN_CODEWORD;i+e[n]<=a&&(i+=e[n],n++),r[n]++}return r}static getDecodedCodewordValue(e){let t=t$.getBitValue(e);return -1===tk.getCodeword(t)?-1:t}static getBitValue(e){let t=0;for(let r=0;r<e.length;r++)for(let n=0;n<e[r];n++)t=t<<1|r%2==0;return Math.trunc(t)}static getClosestDecodedValue(e){let t=eg.sum(e),r=Array(tk.BARS_IN_MODULE);if(t>1)for(let n=0;n<r.length;n++)r[n]=Math.fround(e[n]/t);let n=ep.MAX_VALUE,i=-1;this.bSymbolTableReady||t$.initialize();for(let e=0;e<t$.RATIOS_TABLE.length;e++){let t=0,s=t$.RATIOS_TABLE[e];for(let e=0;e<tk.BARS_IN_MODULE;e++){let i=Math.fround(s[e]-r[e]);if((t+=Math.fround(i*i))>=n)break}t<n&&(n=t,i=tk.SYMBOL_TABLE[e])}return i}}t$.bSymbolTableReady=!1,t$.RATIOS_TABLE=Array(tk.SYMBOL_TABLE.length).map(e=>Array(tk.BARS_IN_MODULE));class tZ{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(e){this.segmentIndex=e}getFileId(){return this.fileId}setFileId(e){this.fileId=e}getOptionalData(){return this.optionalData}setOptionalData(e){this.optionalData=e}isLastSegment(){return this.lastSegment}setLastSegment(e){this.lastSegment=e}getSegmentCount(){return this.segmentCount}setSegmentCount(e){this.segmentCount=e}getSender(){return this.sender||null}setSender(e){this.sender=e}getAddressee(){return this.addressee||null}setAddressee(e){this.addressee=e}getFileName(){return this.fileName}setFileName(e){this.fileName=e}getFileSize(){return this.fileSize}setFileSize(e){this.fileSize=e}getChecksum(){return this.checksum}setChecksum(e){this.checksum=e}getTimestamp(){return this.timestamp}setTimestamp(e){this.timestamp=e}}class tJ{static parseLong(e,t){return parseInt(e,t)}}class t1 extends v{}t1.kind="NullPointerException";class t0{writeBytes(e){this.writeBytesOffset(e,0,e.length)}writeBytesOffset(e,t,r){if(null==e)throw new t1;if(t<0||t>e.length||r<0||t+r>e.length||t+r<0)throw new L;if(0!==r)for(let n=0;n<r;n++)this.write(e[t+n])}flush(){}close(){}}class t2 extends v{}class t3 extends t0{constructor(e=32){if(super(),this.count=0,e<0)throw new D("Negative initial size: "+e);this.buf=new Uint8Array(e)}ensureCapacity(e){e-this.buf.length>0&&this.grow(e)}grow(e){let t=this.buf.length<<1;if(t-e<0&&(t=e),t<0){if(e<0)throw new t2;t=B.MAX_VALUE}this.buf=k.copyOfUint8Array(this.buf,t)}write(e){this.ensureCapacity(this.count+1),this.buf[this.count]=e,this.count+=1}writeBytesOffset(e,t,r){if(t<0||t>e.length||r<0||t+r-e.length>0)throw new L;this.ensureCapacity(this.count+r),x.arraycopy(e,t,this.buf,this.count,r),this.count+=r}writeTo(e){e.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return k.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(e){return e?"string"==typeof e?this.toString_string(e):this.toString_number(e):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(e){return new String(this.buf).toString()}toString_number(e){return new String(this.buf).toString()}close(){}}function t4(){return"u">typeof window?window.BigInt||null:e.g.BigInt||null}function t6(e){if(void 0===r&&(r=t4()),null===r)throw Error("BigInt is not supported!");return r(e)}(d=A||(A={}))[d.ALPHA=0]="ALPHA",d[d.LOWER=1]="LOWER",d[d.MIXED=2]="MIXED",d[d.PUNCT=3]="PUNCT",d[d.ALPHA_SHIFT=4]="ALPHA_SHIFT",d[d.PUNCT_SHIFT=5]="PUNCT_SHIFT";class t8{static decode(e,t){let r=new q(""),n=j.ISO8859_1;r.enableDecoding(n);let i=1,s=e[i++],a=new tZ;for(;i<e[0];){switch(s){case t8.TEXT_COMPACTION_MODE_LATCH:i=t8.textCompaction(e,i,r);break;case t8.BYTE_COMPACTION_MODE_LATCH:case t8.BYTE_COMPACTION_MODE_LATCH_6:i=t8.byteCompaction(s,e,n,i,r);break;case t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[i++]);break;case t8.NUMERIC_COMPACTION_MODE_LATCH:i=t8.numericCompaction(e,i,r);break;case t8.ECI_CHARSET:j.getCharacterSetECIByValue(e[i++]);break;case t8.ECI_GENERAL_PURPOSE:i+=2;break;case t8.ECI_USER_DEFINED:i++;break;case t8.BEGIN_MACRO_PDF417_CONTROL_BLOCK:i=t8.decodeMacroBlock(e,i,a);break;case t8.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case t8.MACRO_PDF417_TERMINATOR:throw new V;default:i--,i=t8.textCompaction(e,i,r)}if(i<e.length)s=e[i++];else throw V.getFormatInstance()}if(0===r.length())throw V.getFormatInstance();let o=new es(null,r.toString(),null,t);return o.setOther(a),o}static decodeMacroBlock(e,t,r){if(t+t8.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw V.getFormatInstance();let n=new Int32Array(t8.NUMBER_OF_SEQUENCE_CODEWORDS);for(let r=0;r<t8.NUMBER_OF_SEQUENCE_CODEWORDS;r++,t++)n[r]=e[t];r.setSegmentIndex(B.parseInt(t8.decodeBase900toBase10(n,t8.NUMBER_OF_SEQUENCE_CODEWORDS)));let i=new q;t=t8.textCompaction(e,t,i),r.setFileId(i.toString());let s=-1;for(e[t]===t8.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(s=t+1);t<e[0];)switch(e[t]){case t8.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e[++t]){case t8.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let n=new q;t=t8.textCompaction(e,t+1,n),r.setFileName(n.toString());break;case t8.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let i=new q;t=t8.textCompaction(e,t+1,i),r.setSender(i.toString());break;case t8.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let s=new q;t=t8.textCompaction(e,t+1,s),r.setAddressee(s.toString());break;case t8.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let a=new q;t=t8.numericCompaction(e,t+1,a),r.setSegmentCount(B.parseInt(a.toString()));break;case t8.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let o=new q;t=t8.numericCompaction(e,t+1,o),r.setTimestamp(tJ.parseLong(o.toString()));break;case t8.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let l=new q;t=t8.numericCompaction(e,t+1,l),r.setChecksum(B.parseInt(l.toString()));break;case t8.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let u=new q;t=t8.numericCompaction(e,t+1,u),r.setFileSize(tJ.parseLong(u.toString()));break;default:throw V.getFormatInstance()}break;case t8.MACRO_PDF417_TERMINATOR:t++,r.setLastSegment(!0);break;default:throw V.getFormatInstance()}if(-1!==s){let n=t-s;r.isLastSegment()&&n--,r.setOptionalData(k.copyOfRange(e,s,s+n))}return t}static textCompaction(e,t,r){let n=new Int32Array((e[0]-t)*2),i=new Int32Array((e[0]-t)*2),s=0,a=!1;for(;t<e[0]&&!a;){let r=e[t++];if(r<t8.TEXT_COMPACTION_MODE_LATCH)n[s]=r/30,n[s+1]=r%30,s+=2;else switch(r){case t8.TEXT_COMPACTION_MODE_LATCH:n[s++]=t8.TEXT_COMPACTION_MODE_LATCH;break;case t8.BYTE_COMPACTION_MODE_LATCH:case t8.BYTE_COMPACTION_MODE_LATCH_6:case t8.NUMERIC_COMPACTION_MODE_LATCH:case t8.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case t8.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case t8.MACRO_PDF417_TERMINATOR:t--,a=!0;break;case t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n[s]=t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,r=e[t++],i[s]=r,s++}}return t8.decodeTextCompaction(n,i,s,r),t}static decodeTextCompaction(e,t,r,n){let i=A.ALPHA,s=A.ALPHA,a=0;for(;a<r;){let r=e[a],o="";switch(i){case A.ALPHA:if(r<26)o=String.fromCharCode(65+r);else switch(r){case 26:o=" ";break;case t8.LL:i=A.LOWER;break;case t8.ML:i=A.MIXED;break;case t8.PS:s=i,i=A.PUNCT_SHIFT;break;case t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case t8.TEXT_COMPACTION_MODE_LATCH:i=A.ALPHA}break;case A.LOWER:if(r<26)o=String.fromCharCode(97+r);else switch(r){case 26:o=" ";break;case t8.AS:s=i,i=A.ALPHA_SHIFT;break;case t8.ML:i=A.MIXED;break;case t8.PS:s=i,i=A.PUNCT_SHIFT;break;case t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case t8.TEXT_COMPACTION_MODE_LATCH:i=A.ALPHA}break;case A.MIXED:if(r<t8.PL)o=t8.MIXED_CHARS[r];else switch(r){case t8.PL:i=A.PUNCT;break;case 26:o=" ";break;case t8.LL:i=A.LOWER;break;case t8.AL:i=A.ALPHA;break;case t8.PS:s=i,i=A.PUNCT_SHIFT;break;case t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case t8.TEXT_COMPACTION_MODE_LATCH:i=A.ALPHA}break;case A.PUNCT:if(r<t8.PAL)o=t8.PUNCT_CHARS[r];else switch(r){case t8.PAL:i=A.ALPHA;break;case t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case t8.TEXT_COMPACTION_MODE_LATCH:i=A.ALPHA}break;case A.ALPHA_SHIFT:if(i=s,r<26)o=String.fromCharCode(65+r);else switch(r){case 26:o=" ";break;case t8.TEXT_COMPACTION_MODE_LATCH:i=A.ALPHA}break;case A.PUNCT_SHIFT:if(i=s,r<t8.PAL)o=t8.PUNCT_CHARS[r];else switch(r){case t8.PAL:i=A.ALPHA;break;case t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[a]);break;case t8.TEXT_COMPACTION_MODE_LATCH:i=A.ALPHA}}""!==o&&n.append(o),a++}}static byteCompaction(e,t,r,n,i){let s=new t3,a=0,o=0,l=!1;switch(e){case t8.BYTE_COMPACTION_MODE_LATCH:let u=new Int32Array(6),h=t[n++];for(;n<t[0]&&!l;)switch(u[a++]=h,o=900*o+h,h=t[n++]){case t8.TEXT_COMPACTION_MODE_LATCH:case t8.BYTE_COMPACTION_MODE_LATCH:case t8.NUMERIC_COMPACTION_MODE_LATCH:case t8.BYTE_COMPACTION_MODE_LATCH_6:case t8.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case t8.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case t8.MACRO_PDF417_TERMINATOR:n--,l=!0;break;default:if(a%5==0&&a>0){for(let e=0;e<6;++e)s.write(Number(t6(o)>>t6(8*(5-e))));o=0,a=0}}n===t[0]&&h<t8.TEXT_COMPACTION_MODE_LATCH&&(u[a++]=h);for(let e=0;e<a;e++)s.write(u[e]);break;case t8.BYTE_COMPACTION_MODE_LATCH_6:for(;n<t[0]&&!l;){let e=t[n++];if(e<t8.TEXT_COMPACTION_MODE_LATCH)a++,o=900*o+e;else switch(e){case t8.TEXT_COMPACTION_MODE_LATCH:case t8.BYTE_COMPACTION_MODE_LATCH:case t8.NUMERIC_COMPACTION_MODE_LATCH:case t8.BYTE_COMPACTION_MODE_LATCH_6:case t8.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case t8.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case t8.MACRO_PDF417_TERMINATOR:n--,l=!0}if(a%5==0&&a>0){for(let e=0;e<6;++e)s.write(Number(t6(o)>>t6(8*(5-e))));o=0,a=0}}}return i.append(H.decode(s.toByteArray(),r)),n}static numericCompaction(e,t,r){let n=0,i=!1,s=new Int32Array(t8.MAX_NUMERIC_CODEWORDS);for(;t<e[0]&&!i;){let a=e[t++];if(t===e[0]&&(i=!0),a<t8.TEXT_COMPACTION_MODE_LATCH)s[n]=a,n++;else switch(a){case t8.TEXT_COMPACTION_MODE_LATCH:case t8.BYTE_COMPACTION_MODE_LATCH:case t8.BYTE_COMPACTION_MODE_LATCH_6:case t8.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case t8.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case t8.MACRO_PDF417_TERMINATOR:t--,i=!0}(n%t8.MAX_NUMERIC_CODEWORDS==0||a===t8.NUMERIC_COMPACTION_MODE_LATCH||i)&&n>0&&(r.append(t8.decodeBase900toBase10(s,n)),n=0)}return t}static decodeBase900toBase10(e,t){let r=t6(0);for(let n=0;n<t;n++)r+=t8.EXP900[t-n-1]*t6(e[n]);let n=r.toString();if("1"!==n.charAt(0))throw new V;return n.substring(1)}}t8.TEXT_COMPACTION_MODE_LATCH=900,t8.BYTE_COMPACTION_MODE_LATCH=901,t8.NUMERIC_COMPACTION_MODE_LATCH=902,t8.BYTE_COMPACTION_MODE_LATCH_6=924,t8.ECI_USER_DEFINED=925,t8.ECI_GENERAL_PURPOSE=926,t8.ECI_CHARSET=927,t8.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,t8.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,t8.MACRO_PDF417_TERMINATOR=922,t8.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,t8.MAX_NUMERIC_CODEWORDS=15,t8.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,t8.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,t8.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,t8.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,t8.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,t8.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,t8.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,t8.PL=25,t8.LL=27,t8.AS=27,t8.ML=28,t8.AL=28,t8.PS=29,t8.PAL=29,t8.PUNCT_CHARS=";<>@[\\]_`~!\r	,:\n-.$/\"|*()?{}'",t8.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",t8.EXP900=t4()?function(){let e=[];e[0]=t6(1);let t=t6(900);e[1]=t;for(let r=2;r<16;r++)e[r]=e[r-1]*t;return e}():[],t8.NUMBER_OF_SEQUENCE_CODEWORDS=2;class t5{static decode(e,t,r,n,i,s,a){let o,l=new tH(e,t,r,n,i),u=null,h=null;for(let r=!0;;r=!1){if(null!=t&&(u=t5.getRowIndicatorColumn(e,l,t,!0,s,a)),null!=n&&(h=t5.getRowIndicatorColumn(e,l,n,!1,s,a)),null==(o=t5.merge(u,h)))throw Y.getNotFoundInstance();let i=o.getBoundingBox();if(r&&null!=i&&(i.getMinY()<l.getMinY()||i.getMaxY()>l.getMaxY()))l=i;else break}o.setBoundingBox(l);let c=o.getBarcodeColumnCount()+1;o.setDetectionResultColumn(0,u),o.setDetectionResultColumn(c,h);let d=null!=u;for(let t=1;t<=c;t++){let r,n=d?t:c-t;if(void 0!==o.getDetectionResultColumn(n))continue;r=0===n||n===c?new tK(l,0===n):new tW(l),o.setDetectionResultColumn(n,r);let i=-1,u=-1;for(let t=l.getMinY();t<=l.getMaxY();t++){if((i=t5.getStartColumn(o,n,t,d))<0||i>l.getMaxX()){if(-1===u)continue;i=u}let h=t5.detectCodeword(e,l.getMinX(),l.getMaxX(),d,i,t,s,a);null!=h&&(r.setCodeword(t,h),u=i,s=Math.min(s,h.getWidth()),a=Math.max(a,h.getWidth()))}}return t5.createDecoderResult(o)}static merge(e,t){if(null==e&&null==t)return null;let r=t5.getBarcodeMetadata(e,t);return null==r?null:new tX(r,tH.merge(t5.adjustBoundingBox(e),t5.adjustBoundingBox(t)))}static adjustBoundingBox(e){if(null==e)return null;let t=e.getRowHeights();if(null==t)return null;let r=t5.getMax(t),n=0;for(let e of t)if(n+=r-e,e>0)break;let i=e.getCodewords();for(let e=0;n>0&&null==i[e];e++)n--;let s=0;for(let e=t.length-1;e>=0&&(s+=r-t[e],!(t[e]>0));e--);for(let e=i.length-1;s>0&&null==i[e];e--)s--;return e.getBoundingBox().addMissingRows(n,s,e.isLeft())}static getMax(e){let t=-1;for(let r of e)t=Math.max(t,r);return t}static getBarcodeMetadata(e,t){let r,n;return null==e||null==(r=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(n=t.getBarcodeMetadata())?r:r.getColumnCount()!==n.getColumnCount()&&r.getErrorCorrectionLevel()!==n.getErrorCorrectionLevel()&&r.getRowCount()!==n.getRowCount()?null:r}static getRowIndicatorColumn(e,t,r,n,i,s){let a=new tK(t,n);for(let o=0;o<2;o++){let l=0===o?1:-1,u=Math.trunc(Math.trunc(r.getX()));for(let o=Math.trunc(Math.trunc(r.getY()));o<=t.getMaxY()&&o>=t.getMinY();o+=l){let t=t5.detectCodeword(e,0,e.getWidth(),n,u,o,i,s);null!=t&&(a.setCodeword(o,t),u=n?t.getStartX():t.getEndX())}}return a}static adjustCodewordCount(e,t){let r=t[0][1],n=r.getValue(),i=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-t5.getNumberOfECCodeWords(e.getBarcodeECLevel());if(0===n.length){if(i<1||i>tk.MAX_CODEWORDS_IN_BARCODE)throw Y.getNotFoundInstance();r.setValue(i)}else n[0]!==i&&r.setValue(i)}static createDecoderResult(e){let t=t5.createBarcodeMatrix(e);t5.adjustCodewordCount(e,t);let r=[],n=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),i=[],s=[];for(let a=0;a<e.getBarcodeRowCount();a++)for(let o=0;o<e.getBarcodeColumnCount();o++){let l=t[a][o+1].getValue(),u=a*e.getBarcodeColumnCount()+o;0===l.length?r.push(u):1===l.length?n[u]=l[0]:(s.push(u),i.push(l))}let a=Array(i.length);for(let e=0;e<a.length;e++)a[e]=i[e];return t5.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),n,tk.toIntArray(r),tk.toIntArray(s),a)}static createDecoderResultFromAmbiguousValues(e,t,r,n,i){let s=new Int32Array(n.length),a=100;for(;a-- >0;){for(let e=0;e<s.length;e++)t[n[e]]=i[e][s[e]];try{return t5.decodeCodewords(t,e,r)}catch(e){if(!(e instanceof M))throw e}if(0===s.length)break;for(let e=0;e<s.length;e++)if(s[e]<i[e].length-1){s[e]++;break}else if(s[e]=0,e===s.length-1)throw M.getChecksumInstance()}throw M.getChecksumInstance()}static createBarcodeMatrix(e){let t=Array.from({length:e.getBarcodeRowCount()},()=>Array(e.getBarcodeColumnCount()+2));for(let e=0;e<t.length;e++)for(let r=0;r<t[e].length;r++)t[e][r]=new tY;let r=0;for(let n of e.getDetectionResultColumns()){if(null!=n){for(let e of n.getCodewords())if(null!=e){let n=e.getRowNumber();if(n>=0){if(n>=t.length)continue;t[n][r].setValue(e.getValue())}}}r++}return t}static isValidBarcodeColumn(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1}static getStartColumn(e,t,r,n){let i=n?1:-1,s=null;if(t5.isValidBarcodeColumn(e,t-i)&&(s=e.getDetectionResultColumn(t-i).getCodeword(r)),null!=s)return n?s.getEndX():s.getStartX();if(null!=(s=e.getDetectionResultColumn(t).getCodewordNearby(r)))return n?s.getStartX():s.getEndX();if(t5.isValidBarcodeColumn(e,t-i)&&(s=e.getDetectionResultColumn(t-i).getCodewordNearby(r)),null!=s)return n?s.getEndX():s.getStartX();let a=0;for(;t5.isValidBarcodeColumn(e,t-i);){for(let r of(t-=i,e.getDetectionResultColumn(t).getCodewords()))if(null!=r)return(n?r.getEndX():r.getStartX())+i*a*(r.getEndX()-r.getStartX());a++}return n?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()}static detectCodeword(e,t,r,n,i,s,a,o){let l;i=t5.adjustCodewordStartColumn(e,t,r,n,i,s);let u=t5.getModuleBitCount(e,t,r,n,i,s);if(null==u)return null;let h=eg.sum(u);if(n)l=i+h;else{for(let e=0;e<u.length/2;e++){let t=u[e];u[e]=u[u.length-1-e],u[u.length-1-e]=t}i=(l=i)-h}if(!t5.checkCodewordSkew(h,a,o))return null;let c=t$.getDecodedValue(u),d=tk.getCodeword(c);return -1===d?null:new tQ(i,l,t5.getCodewordBucketNumber(c),d)}static getModuleBitCount(e,t,r,n,i,s){let a=i,o=new Int32Array(8),l=0,u=n?1:-1,h=n;for(;(n?a<r:a>=t)&&l<o.length;)e.get(a,s)===h?(o[l]++,a+=u):(l++,h=!h);return l===o.length||a===(n?r:t)&&l===o.length-1?o:null}static getNumberOfECCodeWords(e){return 2<<e}static adjustCodewordStartColumn(e,t,r,n,i,s){let a=i,o=n?-1:1;for(let l=0;l<2;l++){for(;(n?a>=t:a<r)&&n===e.get(a,s);){if(Math.abs(i-a)>t5.CODEWORD_SKEW_SIZE)return i;a+=o}o=-o,n=!n}return a}static checkCodewordSkew(e,t,r){return t-t5.CODEWORD_SKEW_SIZE<=e&&e<=r+t5.CODEWORD_SKEW_SIZE}static decodeCodewords(e,t,r){if(0===e.length)throw V.getFormatInstance();let n=1<<t+1,i=t5.correctErrors(e,r,n);t5.verifyCodewordCount(e,n);let s=t8.decode(e,""+t);return s.setErrorsCorrected(i),s.setErasures(r.length),s}static correctErrors(e,t,r){if(null!=t&&t.length>r/2+t5.MAX_ERRORS||r<0||r>t5.MAX_EC_CODEWORDS)throw M.getChecksumInstance();return t5.errorCorrection.decode(e,r,t)}static verifyCodewordCount(e,t){if(e.length<4)throw V.getFormatInstance();let r=e[0];if(r>e.length)throw V.getFormatInstance();if(0===r)if(t<e.length)e[0]=e.length-t;else throw V.getFormatInstance()}static getBitCountForCodeword(e){let t=new Int32Array(8),r=0,n=t.length-1;for(;!((1&e)!==r&&(r=1&e,--n<0));)t[n]++,e>>=1;return t}static getCodewordBucketNumber(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)}static getCodewordBucketNumber_number(e){return t5.getCodewordBucketNumber(t5.getBitCountForCodeword(e))}static getCodewordBucketNumber_Int32Array(e){return(e[0]-e[2]+e[4]-e[6]+9)%9}static toString(e){let t=new tq;for(let r=0;r<e.length;r++){t.format("Row %2d: ",r);for(let n=0;n<e[r].length;n++){let i=e[r][n];0===i.getValue().length?t.format("        ",null):t.format("%4d(%2d)",i.getValue()[0],i.getConfidence(i.getValue()[0]))}t.format("%n")}return t.toString()}}t5.CODEWORD_SKEW_SIZE=2,t5.MAX_ERRORS=3,t5.MAX_EC_CODEWORDS=512,t5.errorCorrection=new tz;class t7{decode(e,t=null){let r=t7.decode(e,t,!1);if(null==r||0===r.length||null==r[0])throw Y.getNotFoundInstance();return r[0]}decodeMultiple(e,t=null){try{return t7.decode(e,t,!0)}catch(e){if(e instanceof V||e instanceof M)throw Y.getNotFoundInstance();throw e}}static decode(e,t,r){let n=[],i=tF.detectMultiple(e,t,r);for(let e of i.getPoints()){let t=t5.decode(i.getBits(),e[4],e[5],e[6],e[7],t7.getMinCodewordWidth(e),t7.getMaxCodewordWidth(e)),r=new er(t.getText(),t.getRawBytes(),void 0,e,en.PDF_417);r.putMetadata(ei.ERROR_CORRECTION_LEVEL,t.getECLevel());let s=t.getOther();null!=s&&r.putMetadata(ei.PDF417_EXTRA_METADATA,s),n.push(r)}return n.map(e=>e)}static getMaxWidth(e,t){return null==e||null==t?0:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMinWidth(e,t){return null==e||null==t?B.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMaxCodewordWidth(e){return Math.floor(Math.max(Math.max(t7.getMaxWidth(e[0],e[4]),t7.getMaxWidth(e[6],e[2])*tk.MODULES_IN_CODEWORD/tk.MODULES_IN_STOP_PATTERN),Math.max(t7.getMaxWidth(e[1],e[5]),t7.getMaxWidth(e[7],e[3])*tk.MODULES_IN_CODEWORD/tk.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(e){return Math.floor(Math.min(Math.min(t7.getMinWidth(e[0],e[4]),t7.getMinWidth(e[6],e[2])*tk.MODULES_IN_CODEWORD/tk.MODULES_IN_STOP_PATTERN),Math.min(t7.getMinWidth(e[1],e[5]),t7.getMinWidth(e[7],e[3])*tk.MODULES_IN_CODEWORD/tk.MODULES_IN_STOP_PATTERN)))}reset(){}}class t9 extends v{}t9.kind="ReaderException";class re{constructor(e,t){this.verbose=!0===e,t&&this.setHints(t)}decode(e,t){return t&&this.setHints(t),this.decodeInternal(e)}decodeWithState(e){return(null===this.readers||void 0===this.readers)&&this.setHints(null),this.decodeInternal(e)}setHints(e){this.hints=e;let t=null!=e&&!0===e.get(U.TRY_HARDER),r=null==e?null:e.get(U.POSSIBLE_FORMATS),n=[];if(null!=r){let i=r.some(e=>e===en.UPC_A||e===en.UPC_E||e===en.EAN_13||e===en.EAN_8||e===en.CODABAR||e===en.CODE_39||e===en.CODE_93||e===en.CODE_128||e===en.ITF||e===en.RSS_14||e===en.RSS_EXPANDED);i&&!t&&n.push(new ta(e,this.verbose)),r.includes(en.QR_CODE)&&n.push(new tP),r.includes(en.DATA_MATRIX)&&n.push(new tm),r.includes(en.AZTEC)&&n.push(new eb),r.includes(en.PDF_417)&&n.push(new t7),i&&t&&n.push(new ta(e,this.verbose))}0===n.length&&(t||n.push(new ta(e,this.verbose)),n.push(new tP),n.push(new tm),n.push(new eb),n.push(new t7),t&&n.push(new ta(e,this.verbose))),this.readers=n}reset(){if(null!==this.readers)for(let e of this.readers)e.reset()}decodeInternal(e){if(null===this.readers)throw new t9("No readers where selected, nothing can be read.");for(let t of this.readers)try{return t.decode(e,this.hints)}catch(e){if(e instanceof t9)continue}throw new Y("No MultiFormat Readers were able to detect the code.")}}(f=S||(S={}))[f.ERROR_CORRECTION=0]="ERROR_CORRECTION",f[f.CHARACTER_SET=1]="CHARACTER_SET",f[f.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",f[f.MIN_SIZE=3]="MIN_SIZE",f[f.MAX_SIZE=4]="MAX_SIZE",f[f.MARGIN=5]="MARGIN",f[f.PDF417_COMPACT=6]="PDF417_COMPACT",f[f.PDF417_COMPACTION=7]="PDF417_COMPACTION",f[f.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",f[f.AZTEC_LAYERS=9]="AZTEC_LAYERS",f[f.QR_VERSION=10]="QR_VERSION";var rt=S;class rr{constructor(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new eo(e,Int32Array.from([1])))}buildGenerator(e){let t=this.cachedGenerators;if(e>=t.length){let r=t[t.length-1],n=this.field;for(let i=t.length;i<=e;i++){let e=r.multiply(new eo(n,Int32Array.from([1,n.exp(i-1+n.getGeneratorBase())])));t.push(e),r=e}}return t[e]}encode(e,t){if(0===t)throw new D("No error correction bytes");let r=e.length-t;if(r<=0)throw new D("No data bytes provided");let n=this.buildGenerator(t),i=new Int32Array(r);x.arraycopy(e,0,i,0,r);let s=new eo(this.field,i),a=(s=s.multiplyByMonomial(t,1)).divide(n)[1].getCoefficients(),o=t-a.length;for(let t=0;t<o;t++)e[r+t]=0;x.arraycopy(a,0,e,r+o,a.length)}}class rn{static applyMaskPenaltyRule1(e){return rn.applyMaskPenaltyRule1Internal(e,!0)+rn.applyMaskPenaltyRule1Internal(e,!1)}static applyMaskPenaltyRule2(e){let t=0,r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let e=0;e<i-1;e++){let i=r[e];for(let s=0;s<n-1;s++){let n=i[s];n===i[s+1]&&n===r[e+1][s]&&n===r[e+1][s+1]&&t++}}return rn.N2*t}static applyMaskPenaltyRule3(e){let t=0,r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let e=0;e<i;e++)for(let s=0;s<n;s++){let a=r[e];s+6<n&&1===a[s]&&0===a[s+1]&&1===a[s+2]&&1===a[s+3]&&1===a[s+4]&&0===a[s+5]&&1===a[s+6]&&(rn.isWhiteHorizontal(a,s-4,s)||rn.isWhiteHorizontal(a,s+7,s+11))&&t++,e+6<i&&1===r[e][s]&&0===r[e+1][s]&&1===r[e+2][s]&&1===r[e+3][s]&&1===r[e+4][s]&&0===r[e+5][s]&&1===r[e+6][s]&&(rn.isWhiteVertical(r,s,e-4,e)||rn.isWhiteVertical(r,s,e+7,e+11))&&t++}return t*rn.N3}static isWhiteHorizontal(e,t,r){t=Math.max(t,0),r=Math.min(r,e.length);for(let n=t;n<r;n++)if(1===e[n])return!1;return!0}static isWhiteVertical(e,t,r,n){r=Math.max(r,0),n=Math.min(n,e.length);for(let i=r;i<n;i++)if(1===e[i][t])return!1;return!0}static applyMaskPenaltyRule4(e){let t=0,r=e.getArray(),n=e.getWidth(),i=e.getHeight();for(let e=0;e<i;e++){let i=r[e];for(let e=0;e<n;e++)1===i[e]&&t++}let s=e.getHeight()*e.getWidth();return Math.floor(10*Math.abs(2*t-s)/s)*rn.N4}static getDataMaskBit(e,t,r){let n,i;switch(e){case 0:n=r+t&1;break;case 1:n=1&r;break;case 2:n=t%3;break;case 3:n=(r+t)%3;break;case 4:n=Math.floor(r/2)+Math.floor(t/3)&1;break;case 5:n=(1&(i=r*t))+i%3;break;case 6:n=(1&(i=r*t))+i%3&1;break;case 7:n=(i=r*t)%3+(r+t&1)&1;break;default:throw new D("Invalid mask pattern: "+e)}return 0===n}static applyMaskPenaltyRule1Internal(e,t){let r=0,n=t?e.getHeight():e.getWidth(),i=t?e.getWidth():e.getHeight(),s=e.getArray();for(let e=0;e<n;e++){let n=0,a=-1;for(let o=0;o<i;o++){let i=t?s[e][o]:s[o][e];i===a?n++:(n>=5&&(r+=rn.N1+(n-5)),n=1,a=i)}n>=5&&(r+=rn.N1+(n-5))}return r}}rn.N1=3,rn.N2=3,rn.N3=40,rn.N4=10;class ri{constructor(e,t){this.width=e,this.height=t;const r=Array(t);for(let n=0;n!==t;n++)r[n]=new Uint8Array(e);this.bytes=r}getHeight(){return this.height}getWidth(){return this.width}get(e,t){return this.bytes[t][e]}getArray(){return this.bytes}setNumber(e,t,r){this.bytes[t][e]=r}setBoolean(e,t,r){this.bytes[t][e]=+!!r}clear(e){for(let t of this.bytes)k.fill(t,e)}equals(e){if(!(e instanceof ri)||this.width!==e.width||this.height!==e.height)return!1;for(let t=0,r=this.height;t<r;++t){let r=this.bytes[t],n=e.bytes[t];for(let e=0,t=this.width;e<t;++e)if(r[e]!==n[e])return!1}return!0}toString(){let e=new q;for(let t=0,r=this.height;t<r;++t){let r=this.bytes[t];for(let t=0,n=this.width;t<n;++t)switch(r[t]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ")}e.append("\n")}return e.toString()}}class rs{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){let e=new q;return e.append("<<\n"),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append("\n ecLevel: "),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append("\n version: "),e.append(this.version?this.version.toString():"null"),e.append("\n maskPattern: "),e.append(this.maskPattern.toString()),this.matrix?(e.append("\n matrix:\n"),e.append(this.matrix.toString())):e.append("\n matrix: null\n"),e.append(">>\n"),e.toString()}setMode(e){this.mode=e}setECLevel(e){this.ecLevel=e}setVersion(e){this.version=e}setMaskPattern(e){this.maskPattern=e}setMatrix(e){this.matrix=e}static isValidMaskPattern(e){return e>=0&&e<rs.NUM_MASK_PATTERNS}}rs.NUM_MASK_PATTERNS=8;class ra extends v{}ra.kind="WriterException";class ro{static clearMatrix(e){e.clear(255)}static buildMatrix(e,t,r,n,i){ro.clearMatrix(i),ro.embedBasicPatterns(r,i),ro.embedTypeInfo(t,n,i),ro.maybeEmbedVersionInfo(r,i),ro.embedDataBits(e,n,i)}static embedBasicPatterns(e,t){ro.embedPositionDetectionPatternsAndSeparators(t),ro.embedDarkDotAtLeftBottomCorner(t),ro.maybeEmbedPositionAdjustmentPatterns(e,t),ro.embedTimingPatterns(t)}static embedTypeInfo(e,t,r){let n=new F;ro.makeTypeInfoBits(e,t,n);for(let e=0,t=n.getSize();e<t;++e){let t=n.get(n.getSize()-1-e),i=ro.TYPE_INFO_COORDINATES[e],s=i[0],a=i[1];if(r.setBoolean(s,a,t),e<8){let n=r.getWidth()-e-1;r.setBoolean(n,8,t)}else{let n=r.getHeight()-7+(e-8);r.setBoolean(8,n,t)}}}static maybeEmbedVersionInfo(e,t){if(7>e.getVersionNumber())return;let r=new F;ro.makeVersionInfoBits(e,r);let n=17;for(let e=0;e<6;++e)for(let i=0;i<3;++i){let s=r.get(n);n--,t.setBoolean(e,t.getHeight()-11+i,s),t.setBoolean(t.getHeight()-11+i,e,s)}}static embedDataBits(e,t,r){let n=0,i=-1,s=r.getWidth()-1,a=r.getHeight()-1;for(;s>0;){for(6===s&&(s-=1);a>=0&&a<r.getHeight();){for(let i=0;i<2;++i){let o,l=s-i;ro.isEmpty(r.get(l,a))&&(n<e.getSize()?(o=e.get(n),++n):o=!1,255!==t&&rn.getDataMaskBit(t,l,a)&&(o=!o),r.setBoolean(l,a,o))}a+=i}a+=i=-i,s-=2}if(n!==e.getSize())throw new ra("Not all bits consumed: "+n+"/"+e.getSize())}static findMSBSet(e){return 32-B.numberOfLeadingZeros(e)}static calculateBCHCode(e,t){if(0===t)throw new D("0 polynomial");let r=ro.findMSBSet(t);for(e<<=r-1;ro.findMSBSet(e)>=r;)e^=t<<ro.findMSBSet(e)-r;return e}static makeTypeInfoBits(e,t,r){if(!rs.isValidMaskPattern(t))throw new ra("Invalid mask pattern");let n=e.getBits()<<3|t;r.appendBits(n,5);let i=ro.calculateBCHCode(n,ro.TYPE_INFO_POLY);r.appendBits(i,10);let s=new F;if(s.appendBits(ro.TYPE_INFO_MASK_PATTERN,15),r.xor(s),15!==r.getSize())throw new ra("should not happen but we got: "+r.getSize())}static makeVersionInfoBits(e,t){t.appendBits(e.getVersionNumber(),6);let r=ro.calculateBCHCode(e.getVersionNumber(),ro.VERSION_INFO_POLY);if(t.appendBits(r,12),18!==t.getSize())throw new ra("should not happen but we got: "+t.getSize())}static isEmpty(e){return 255===e}static embedTimingPatterns(e){for(let t=8;t<e.getWidth()-8;++t){let r=(t+1)%2;ro.isEmpty(e.get(t,6))&&e.setNumber(t,6,r),ro.isEmpty(e.get(6,t))&&e.setNumber(6,t,r)}}static embedDarkDotAtLeftBottomCorner(e){if(0===e.get(8,e.getHeight()-8))throw new ra;e.setNumber(8,e.getHeight()-8,1)}static embedHorizontalSeparationPattern(e,t,r){for(let n=0;n<8;++n){if(!ro.isEmpty(r.get(e+n,t)))throw new ra;r.setNumber(e+n,t,0)}}static embedVerticalSeparationPattern(e,t,r){for(let n=0;n<7;++n){if(!ro.isEmpty(r.get(e,t+n)))throw new ra;r.setNumber(e,t+n,0)}}static embedPositionAdjustmentPattern(e,t,r){for(let n=0;n<5;++n){let i=ro.POSITION_ADJUSTMENT_PATTERN[n];for(let s=0;s<5;++s)r.setNumber(e+s,t+n,i[s])}}static embedPositionDetectionPattern(e,t,r){for(let n=0;n<7;++n){let i=ro.POSITION_DETECTION_PATTERN[n];for(let s=0;s<7;++s)r.setNumber(e+s,t+n,i[s])}}static embedPositionDetectionPatternsAndSeparators(e){let t=ro.POSITION_DETECTION_PATTERN[0].length;ro.embedPositionDetectionPattern(0,0,e),ro.embedPositionDetectionPattern(e.getWidth()-t,0,e),ro.embedPositionDetectionPattern(0,e.getWidth()-t,e),ro.embedHorizontalSeparationPattern(0,7,e),ro.embedHorizontalSeparationPattern(e.getWidth()-8,7,e),ro.embedHorizontalSeparationPattern(0,e.getWidth()-8,e),ro.embedVerticalSeparationPattern(7,0,e),ro.embedVerticalSeparationPattern(e.getHeight()-7-1,0,e),ro.embedVerticalSeparationPattern(7,e.getHeight()-7,e)}static maybeEmbedPositionAdjustmentPatterns(e,t){if(2>e.getVersionNumber())return;let r=e.getVersionNumber()-1,n=ro.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[r];for(let e=0,r=n.length;e!==r;e++){let i=n[e];if(i>=0)for(let e=0;e!==r;e++){let r=n[e];r>=0&&ro.isEmpty(t.get(r,i))&&ro.embedPositionAdjustmentPattern(r-2,i-2,t)}}}}ro.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),ro.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),ro.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),ro.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),ro.VERSION_INFO_POLY=7973,ro.TYPE_INFO_POLY=1335,ro.TYPE_INFO_MASK_PATTERN=21522;class rl{constructor(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class ru{static calculateMaskPenalty(e){return rn.applyMaskPenaltyRule1(e)+rn.applyMaskPenaltyRule2(e)+rn.applyMaskPenaltyRule3(e)+rn.applyMaskPenaltyRule4(e)}static encode(e,t,r=null){let n,i=ru.DEFAULT_BYTE_MODE_ENCODING,s=null!==r&&void 0!==r.get(rt.CHARACTER_SET);s&&(i=r.get(rt.CHARACTER_SET).toString());let a=this.chooseMode(e,i),o=new F;if(a===tT.BYTE&&(s||ru.DEFAULT_BYTE_MODE_ENCODING!==i)){let e=j.getCharacterSetECIByName(i);void 0!==e&&this.appendECI(e,o)}this.appendModeInfo(a,o);let l=new F;if(this.appendBytes(e,a,l,i),null!==r&&void 0!==r.get(rt.QR_VERSION)){let e=Number.parseInt(r.get(rt.QR_VERSION).toString(),10);n=tI.getVersionForNumber(e);let i=this.calculateBitsNeeded(a,o,l,n);if(!this.willFit(i,n,t))throw new ra("Data too big for requested version")}else n=this.recommendVersion(t,a,o,l);let u=new F;u.appendBitArray(o);let h=a===tT.BYTE?l.getSizeInBytes():e.length;this.appendLengthInfo(h,n,a,u),u.appendBitArray(l);let c=n.getECBlocksForLevel(t),d=n.getTotalCodewords()-c.getTotalECCodewords();this.terminateBits(d,u);let f=this.interleaveWithECBytes(u,n.getTotalCodewords(),d,c.getNumBlocks()),g=new rs;g.setECLevel(t),g.setMode(a),g.setVersion(n);let p=n.getDimensionForVersion(),m=new ri(p,p),y=this.chooseMaskPattern(f,t,n,m);return g.setMaskPattern(y),ro.buildMatrix(f,t,n,y,m),g.setMatrix(m),g}static recommendVersion(e,t,r,n){let i=this.calculateBitsNeeded(t,r,n,tI.getVersionForNumber(1)),s=this.chooseVersion(i,e),a=this.calculateBitsNeeded(t,r,n,s);return this.chooseVersion(a,e)}static calculateBitsNeeded(e,t,r,n){return t.getSize()+e.getCharacterCountBits(n)+r.getSize()}static getAlphanumericCode(e){return e<ru.ALPHANUMERIC_TABLE.length?ru.ALPHANUMERIC_TABLE[e]:-1}static chooseMode(e,t=null){if(j.SJIS.getName()===t&&this.isOnlyDoubleByteKanji(e))return tT.KANJI;let r=!1,n=!1;for(let t=0,i=e.length;t<i;++t){let i=e.charAt(t);if(ru.isDigit(i))r=!0;else{if(-1===this.getAlphanumericCode(i.charCodeAt(0)))return tT.BYTE;n=!0}}return n?tT.ALPHANUMERIC:r?tT.NUMERIC:tT.BYTE}static isOnlyDoubleByteKanji(e){let t;try{t=H.encode(e,j.SJIS)}catch(e){return!1}let r=t.length;if(r%2!=0)return!1;for(let e=0;e<r;e+=2){let r=255&t[e];if((r<129||r>159)&&(r<224||r>235))return!1}return!0}static chooseMaskPattern(e,t,r,n){let i=Number.MAX_SAFE_INTEGER,s=-1;for(let a=0;a<rs.NUM_MASK_PATTERNS;a++){ro.buildMatrix(e,t,r,a,n);let o=this.calculateMaskPenalty(n);o<i&&(i=o,s=a)}return s}static chooseVersion(e,t){for(let r=1;r<=40;r++){let n=tI.getVersionForNumber(r);if(ru.willFit(e,n,t))return n}throw new ra("Data too big")}static willFit(e,t,r){return t.getTotalCodewords()-t.getECBlocksForLevel(r).getTotalECCodewords()>=(e+7)/8}static terminateBits(e,t){let r=8*e;if(t.getSize()>r)throw new ra("data bits cannot fit in the QR Code"+t.getSize()+" > "+r);for(let e=0;e<4&&t.getSize()<r;++e)t.appendBit(!1);let n=7&t.getSize();if(n>0)for(let e=n;e<8;e++)t.appendBit(!1);let i=e-t.getSizeInBytes();for(let e=0;e<i;++e)t.appendBits((1&e)==0?236:17,8);if(t.getSize()!==r)throw new ra("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(e,t,r,n,i,s){if(n>=r)throw new ra("Block ID too large");let a=e%r,o=r-a,l=Math.floor(e/r),u=Math.floor(t/r),h=u+1,c=l-u,d=l+1-h;if(c!==d)throw new ra("EC bytes mismatch");if(r!==o+a)throw new ra("RS blocks mismatch");if(e!==(u+c)*o+(h+d)*a)throw new ra("Total bytes mismatch");n<o?(i[0]=u,s[0]=c):(i[0]=h,s[0]=d)}static interleaveWithECBytes(e,t,r,n){if(e.getSizeInBytes()!==r)throw new ra("Number of bits and data bytes does not match");let i=0,s=0,a=0,o=[];for(let l=0;l<n;++l){let u=new Int32Array(1),h=new Int32Array(1);ru.getNumDataBytesAndNumECBytesForBlockID(t,r,n,l,u,h);let c=u[0],d=new Uint8Array(c);e.toBytes(8*i,d,0,c);let f=ru.generateECBytes(d,h[0]);o.push(new rl(d,f)),s=Math.max(s,c),a=Math.max(a,f.length),i+=u[0]}if(r!==i)throw new ra("Data bytes does not match offset");let l=new F;for(let e=0;e<s;++e)for(let t of o){let r=t.getDataBytes();e<r.length&&l.appendBits(r[e],8)}for(let e=0;e<a;++e)for(let t of o){let r=t.getErrorCorrectionBytes();e<r.length&&l.appendBits(r[e],8)}if(t!==l.getSizeInBytes())throw new ra("Interleaving error: "+t+" and "+l.getSizeInBytes()+" differ.");return l}static generateECBytes(e,t){let r=e.length,n=new Int32Array(r+t);for(let t=0;t<r;t++)n[t]=255&e[t];new rr(eu.QR_CODE_FIELD_256).encode(n,t);let i=new Uint8Array(t);for(let e=0;e<t;e++)i[e]=n[r+e];return i}static appendModeInfo(e,t){t.appendBits(e.getBits(),4)}static appendLengthInfo(e,t,r,n){let i=r.getCharacterCountBits(t);if(e>=1<<i)throw new ra(e+" is bigger than "+((1<<i)-1));n.appendBits(e,i)}static appendBytes(e,t,r,n){switch(t){case tT.NUMERIC:ru.appendNumericBytes(e,r);break;case tT.ALPHANUMERIC:ru.appendAlphanumericBytes(e,r);break;case tT.BYTE:ru.append8BitBytes(e,r,n);break;case tT.KANJI:ru.appendKanjiBytes(e,r);break;default:throw new ra("Invalid mode: "+t)}}static getDigit(e){return e.charCodeAt(0)-48}static isDigit(e){let t=ru.getDigit(e);return t>=0&&t<=9}static appendNumericBytes(e,t){let r=e.length,n=0;for(;n<r;){let i=ru.getDigit(e.charAt(n));if(n+2<r){let r=ru.getDigit(e.charAt(n+1)),s=ru.getDigit(e.charAt(n+2));t.appendBits(100*i+10*r+s,10),n+=3}else if(n+1<r){let r=ru.getDigit(e.charAt(n+1));t.appendBits(10*i+r,7),n+=2}else t.appendBits(i,4),n++}}static appendAlphanumericBytes(e,t){let r=e.length,n=0;for(;n<r;){let i=ru.getAlphanumericCode(e.charCodeAt(n));if(-1===i)throw new ra;if(n+1<r){let r=ru.getAlphanumericCode(e.charCodeAt(n+1));if(-1===r)throw new ra;t.appendBits(45*i+r,11),n+=2}else t.appendBits(i,6),n++}}static append8BitBytes(e,t,r){let n;try{n=H.encode(e,r)}catch(e){throw new ra(e)}for(let e=0,r=n.length;e!==r;e++){let r=n[e];t.appendBits(r,8)}}static appendKanjiBytes(e,t){let r;try{r=H.encode(e,j.SJIS)}catch(e){throw new ra(e)}let n=r.length;for(let e=0;e<n;e+=2){let n=(255&r[e])<<8|255&r[e+1],i=-1;if(n>=33088&&n<=40956?i=n-33088:n>=57408&&n<=60351&&(i=n-49472),-1===i)throw new ra("Invalid byte sequence");let s=(i>>8)*192+(255&i);t.appendBits(s,13)}}static appendECI(e,t){t.appendBits(tT.ECI.getBits(),4),t.appendBits(e.getValue(),8)}}ru.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),ru.DEFAULT_BYTE_MODE_ENCODING=j.UTF8.getName();class rh{write(e,t,r,n=null){if(0===e.length)throw new D("Found empty contents");if(t<0||r<0)throw new D("Requested dimensions are too small: "+t+"x"+r);let i=ty.L,s=rh.QUIET_ZONE_SIZE;null!==n&&(void 0!==n.get(rt.ERROR_CORRECTION)&&(i=ty.fromString(n.get(rt.ERROR_CORRECTION).toString())),void 0!==n.get(rt.MARGIN)&&(s=Number.parseInt(n.get(rt.MARGIN).toString(),10)));let a=ru.encode(e,i,n);return this.renderResult(a,t,r,s)}writeToDom(e,t,r,n,i=null){"string"==typeof e&&(e=document.querySelector(e));let s=this.write(t,r,n,i);e&&e.appendChild(s)}renderResult(e,t,r,n){let i=e.getMatrix();if(null===i)throw new ec;let s=i.getWidth(),a=i.getHeight(),o=s+2*n,l=a+2*n,u=Math.max(t,o),h=Math.max(r,l),c=Math.min(Math.floor(u/o),Math.floor(h/l)),d=Math.floor((u-s*c)/2),f=Math.floor((h-a*c)/2),g=this.createSVGElement(u,h);for(let e=0,t=f;e<a;e++,t+=c)for(let r=0,n=d;r<s;r++,n+=c)if(1===i.get(r,e)){let e=this.createSvgRectElement(n,t,c,c);g.appendChild(e)}return g}createSVGElement(e,t){let r=document.createElementNS(rh.SVG_NS,"svg");return r.setAttributeNS(null,"height",e.toString()),r.setAttributeNS(null,"width",t.toString()),r}createSvgRectElement(e,t,r,n){let i=document.createElementNS(rh.SVG_NS,"rect");return i.setAttributeNS(null,"x",e.toString()),i.setAttributeNS(null,"y",t.toString()),i.setAttributeNS(null,"height",r.toString()),i.setAttributeNS(null,"width",n.toString()),i.setAttributeNS(null,"fill","#000000"),i}}rh.QUIET_ZONE_SIZE=4,rh.SVG_NS="http://www.w3.org/2000/svg";class rc{encode(e,t,r,n,i){if(0===e.length)throw new D("Found empty contents");if(t!==en.QR_CODE)throw new D("Can only encode QR_CODE, but got "+t);if(r<0||n<0)throw new D(`Requested dimensions are too small: ${r}x${n}`);let s=ty.L,a=rc.QUIET_ZONE_SIZE;null!==i&&(void 0!==i.get(rt.ERROR_CORRECTION)&&(s=ty.fromString(i.get(rt.ERROR_CORRECTION).toString())),void 0!==i.get(rt.MARGIN)&&(a=Number.parseInt(i.get(rt.MARGIN).toString(),10)));let o=ru.encode(e,s,i);return rc.renderResult(o,r,n,a)}static renderResult(e,t,r,n){let i=e.getMatrix();if(null===i)throw new ec;let s=i.getWidth(),a=i.getHeight(),o=s+2*n,l=a+2*n,u=Math.max(t,o),h=Math.max(r,l),c=Math.min(Math.floor(u/o),Math.floor(h/l)),d=Math.floor((u-s*c)/2),f=Math.floor((h-a*c)/2),g=new W(u,h);for(let e=0,t=f;e<a;e++,t+=c)for(let r=0,n=d;r<s;r++,n+=c)1===i.get(r,e)&&g.setRegion(n,t,c,c);return g}}rc.QUIET_ZONE_SIZE=4;class rd extends Q{constructor(e,t,r,n,i,s,a,o){if(super(s,a),this.yuvData=e,this.dataWidth=t,this.dataHeight=r,this.left=n,this.top=i,n+s>t||i+a>r)throw new D("Crop rectangle does not fit within image data.");o&&this.reverseHorizontal(s,a)}getRow(e,t){if(e<0||e>=this.getHeight())throw new D("Requested row is outside the image: "+e);let r=this.getWidth();(null==t||t.length<r)&&(t=new Uint8ClampedArray(r));let n=(e+this.top)*this.dataWidth+this.left;return x.arraycopy(this.yuvData,n,t,0,r),t}getMatrix(){let e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.yuvData;let r=e*t,n=new Uint8ClampedArray(r),i=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return x.arraycopy(this.yuvData,i,n,0,r),n;for(let r=0;r<t;r++){let t=r*e;x.arraycopy(this.yuvData,i,n,t,e),i+=this.dataWidth}return n}isCropSupported(){return!0}crop(e,t,r,n){return new rd(this.yuvData,this.dataWidth,this.dataHeight,this.left+e,this.top+t,r,n,!1)}renderThumbnail(){let e=this.getWidth()/rd.THUMBNAIL_SCALE_FACTOR,t=this.getHeight()/rd.THUMBNAIL_SCALE_FACTOR,r=new Int32Array(e*t),n=this.yuvData,i=this.top*this.dataWidth+this.left;for(let s=0;s<t;s++){let t=s*e;for(let s=0;s<e;s++){let e=255&n[i+s*rd.THUMBNAIL_SCALE_FACTOR];r[t+s]=0xff000000|65793*e}i+=this.dataWidth*rd.THUMBNAIL_SCALE_FACTOR}return r}getThumbnailWidth(){return this.getWidth()/rd.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/rd.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(e,t){let r=this.yuvData;for(let n=0,i=this.top*this.dataWidth+this.left;n<t;n++,i+=this.dataWidth){let t=i+e/2;for(let n=i,s=i+e-1;n<t;n++,s--){let e=r[n];r[n]=r[s],r[s]=e}}}invert(){return new $(this)}}rd.THUMBNAIL_SCALE_FACTOR=2;class rf extends Q{constructor(e,t,r,n,i,s,a){if(super(t,r),this.dataWidth=n,this.dataHeight=i,this.left=s,this.top=a,4===e.BYTES_PER_ELEMENT){const n=t*r,i=new Uint8ClampedArray(n);for(let t=0;t<n;t++){const r=e[t],n=r>>16&255,s=r>>7&510,a=255&r;i[t]=(n+s+a)/4&255}this.luminances=i}else this.luminances=e;if(void 0===n&&(this.dataWidth=t),void 0===i&&(this.dataHeight=r),void 0===s&&(this.left=0),void 0===a&&(this.top=0),this.left+t>this.dataWidth||this.top+r>this.dataHeight)throw new D("Crop rectangle does not fit within image data.")}getRow(e,t){if(e<0||e>=this.getHeight())throw new D("Requested row is outside the image: "+e);let r=this.getWidth();(null==t||t.length<r)&&(t=new Uint8ClampedArray(r));let n=(e+this.top)*this.dataWidth+this.left;return x.arraycopy(this.luminances,n,t,0,r),t}getMatrix(){let e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.luminances;let r=e*t,n=new Uint8ClampedArray(r),i=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return x.arraycopy(this.luminances,i,n,0,r),n;for(let r=0;r<t;r++){let t=r*e;x.arraycopy(this.luminances,i,n,t,e),i+=this.dataWidth}return n}isCropSupported(){return!0}crop(e,t,r,n){return new rf(this.luminances,r,n,this.dataWidth,this.dataHeight,this.left+e,this.top+t)}invert(){return new $(this)}}class rg extends j{static forName(e){return this.getCharacterSetECIByName(e)}}class rp{}rp.ISO_8859_1=j.ISO8859_1;class rm{isCompact(){return this.compact}setCompact(e){this.compact=e}getSize(){return this.size}setSize(e){this.size=e}getLayers(){return this.layers}setLayers(e){this.layers=e}getCodeWords(){return this.codeWords}setCodeWords(e){this.codeWords=e}getMatrix(){return this.matrix}setMatrix(e){this.matrix=e}}class ry{static singletonList(e){return[e]}static min(e,t){return e.sort(t)[0]}}class rw{constructor(e){this.previous=e}getPrevious(){return this.previous}}class rE extends rw{constructor(e,t,r){super(e),this.value=t,this.bitCount=r}appendTo(e,t){e.appendBits(this.value,this.bitCount)}add(e,t){return new rE(this,e,t)}addBinaryShift(e,t){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new rE(this,e,t)}toString(){let e=this.value&(1<<this.bitCount)-1;return e|=1<<this.bitCount,"<"+B.toBinaryString(e|1<<this.bitCount).substring(1)+">"}}class rC extends rE{constructor(e,t,r){super(e,0,0),this.binaryShiftStart=t,this.binaryShiftByteCount=r}appendTo(e,t){for(let r=0;r<this.binaryShiftByteCount;r++)(0===r||31===r&&this.binaryShiftByteCount<=62)&&(e.appendBits(31,5),this.binaryShiftByteCount>62?e.appendBits(this.binaryShiftByteCount-31,16):0===r?e.appendBits(Math.min(this.binaryShiftByteCount,31),5):e.appendBits(this.binaryShiftByteCount-31,5)),e.appendBits(t[this.binaryShiftStart+r],8)}addBinaryShift(e,t){return new rC(this,e,t)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function rI(e,t,r){return new rE(e,t,r)}let r_=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],rA=new rE(null,0,0),rS=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])],rT=function(e){for(let t of e)k.fill(t,-1);return e[0][4]=0,e[1][4]=0,e[1][0]=28,e[3][4]=0,e[2][4]=0,e[2][0]=15,e}(k.createInt32Array(6,6));class rb{constructor(e,t,r,n){this.token=e,this.mode=t,this.binaryShiftByteCount=r,this.bitCount=n}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(e,t){let r=this.bitCount,n=this.token;if(e!==this.mode){let t=rS[this.mode][e];n=rI(n,65535&t,t>>16),r+=t>>16}let i=2===e?4:5;return new rb(n=rI(n,t,i),e,0,r+i)}shiftAndAppend(e,t){let r=this.token,n=2===this.mode?4:5;return r=rI(r,rT[this.mode][e],n),new rb(r=rI(r,t,5),this.mode,0,this.bitCount+n+5)}addBinaryShiftChar(e){let t=this.token,r=this.mode,n=this.bitCount;if(4===this.mode||2===this.mode){let e=rS[r][0];t=rI(t,65535&e,e>>16),n+=e>>16,r=0}let i=0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8,s=new rb(t,r,this.binaryShiftByteCount+1,n+i);return 2078===s.binaryShiftByteCount&&(s=s.endBinaryShift(e+1)),s}endBinaryShift(e){if(0===this.binaryShiftByteCount)return this;let t=this.token;return new rb(t=new rC(t,e-this.binaryShiftByteCount,this.binaryShiftByteCount),this.mode,0,this.bitCount)}isBetterThanOrEqualTo(e){let t=this.bitCount+(rS[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?t+=rb.calculateBinaryShiftCost(e)-rb.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(t+=10),t<=e.bitCount}toBitArray(e){let t=[];for(let r=this.endBinaryShift(e.length).token;null!==r;r=r.getPrevious())t.unshift(r);let r=new F;for(let n of t)n.appendTo(r,e);return r}toString(){return G.format("%s bits=%d bytes=%d",r_[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:10*(e.binaryShiftByteCount>0)}}rb.INITIAL_STATE=new rb(rA,0,0,0);let rv=function(e){let t=G.getCharCode(" "),r=G.getCharCode("."),n=G.getCharCode(",");e[0][t]=1;let i=G.getCharCode("Z"),s=G.getCharCode("A");for(let t=s;t<=i;t++)e[0][t]=t-s+2;e[1][t]=1;let a=G.getCharCode("z"),o=G.getCharCode("a");for(let t=o;t<=a;t++)e[1][t]=t-o+2;e[2][t]=1;let l=G.getCharCode("9"),u=G.getCharCode("0");for(let t=u;t<=l;t++)e[2][t]=t-u+2;e[2][n]=12,e[2][r]=13;let h=["\0"," ","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","	","\n","\v","\f","\r","\x1b","\x1c","\x1d","\x1e","\x1f","@","\\","^","_","`","|","~",""];for(let t=0;t<h.length;t++)e[3][G.getCharCode(h[t])]=t;let c=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let t=0;t<c.length;t++)G.getCharCode(c[t])>0&&(e[4][G.getCharCode(c[t])]=t);return e}(k.createInt32Array(5,256));class rN{constructor(e){this.text=e}encode(){let e=G.getCharCode(" "),t=G.getCharCode("\n"),r=ry.singletonList(rb.INITIAL_STATE);for(let n=0;n<this.text.length;n++){let i,s=n+1<this.text.length?this.text[n+1]:0;switch(this.text[n]){case G.getCharCode("\r"):i=2*(s===t);break;case G.getCharCode("."):i=3*(s===e);break;case G.getCharCode(","):i=4*(s===e);break;case G.getCharCode(":"):i=5*(s===e);break;default:i=0}i>0?(r=rN.updateStateListForPair(r,n,i),n++):r=this.updateStateListForChar(r,n)}return ry.min(r,(e,t)=>e.getBitCount()-t.getBitCount()).toBitArray(this.text)}updateStateListForChar(e,t){let r=[];for(let n of e)this.updateStateForChar(n,t,r);return rN.simplifyStates(r)}updateStateForChar(e,t,r){let n=255&this.text[t],i=rv[e.getMode()][n]>0,s=null;for(let a=0;a<=4;a++){let o=rv[a][n];if(o>0){if(null==s&&(s=e.endBinaryShift(t)),!i||a===e.getMode()||2===a){let e=s.latchAndAppend(a,o);r.push(e)}if(!i&&rT[e.getMode()][a]>=0){let e=s.shiftAndAppend(a,o);r.push(e)}}}if(e.getBinaryShiftByteCount()>0||0===rv[e.getMode()][n]){let n=e.addBinaryShiftChar(t);r.push(n)}}static updateStateListForPair(e,t,r){let n=[];for(let i of e)this.updateStateForPair(i,t,r,n);return this.simplifyStates(n)}static updateStateForPair(e,t,r,n){let i=e.endBinaryShift(t);if(n.push(i.latchAndAppend(4,r)),4!==e.getMode()&&n.push(i.shiftAndAppend(4,r)),3===r||4===r){let e=i.latchAndAppend(2,16-r).latchAndAppend(2,1);n.push(e)}if(e.getBinaryShiftByteCount()>0){let r=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);n.push(r)}}static simplifyStates(e){let t=[];for(let r of e){let e=!0;for(let n of t){if(n.isBetterThanOrEqualTo(r)){e=!1;break}r.isBetterThanOrEqualTo(n)&&(t=t.filter(e=>e!==n))}e&&t.push(r)}return t}}class rD{static encodeBytes(e){return rD.encode(e,rD.DEFAULT_EC_PERCENT,rD.DEFAULT_AZTEC_LAYERS)}static encode(e,t,r){let n,i,s,a,o,l,u=new rN(e).encode(),h=B.truncDivision(u.getSize()*t,100)+11,c=u.getSize()+h;if(r!==rD.DEFAULT_AZTEC_LAYERS){if(n=r<0,(i=Math.abs(r))>(n?rD.MAX_NB_BITS_COMPACT:rD.MAX_NB_BITS))throw new D(G.format("Illegal value %s for layers",r));let e=(s=rD.totalBitsInLayer(i,n))-s%(a=rD.WORD_SIZE[i]);if((o=rD.stuffBits(u,a)).getSize()+h>e||n&&o.getSize()>64*a)throw new D("Data to large for user specified layer")}else{a=0,o=null;for(let e=0;;e++){if(e>rD.MAX_NB_BITS)throw new D("Data too large for an Aztec code");if(i=(n=e<=3)?e+1:e,c>(s=rD.totalBitsInLayer(i,n)))continue;(null==o||a!==rD.WORD_SIZE[i])&&(a=rD.WORD_SIZE[i],o=rD.stuffBits(u,a));let t=s-s%a;if(!(n&&o.getSize()>64*a)&&o.getSize()+h<=t)break}}let d=rD.generateCheckWords(o,s,a),f=o.getSize()/a,g=rD.generateModeMessage(n,i,f),p=(n?11:14)+4*i,m=new Int32Array(p);if(n){l=p;for(let e=0;e<m.length;e++)m[e]=e}else{l=p+1+2*B.truncDivision(B.truncDivision(p,2)-1,15);let e=B.truncDivision(p,2),t=B.truncDivision(l,2);for(let r=0;r<e;r++){let n=r+B.truncDivision(r,15);m[e-r-1]=t-n-1,m[e+r]=t+n+1}}let y=new W(l);for(let e=0,t=0;e<i;e++){let r=(i-e)*4+(n?9:12);for(let n=0;n<r;n++){let i=2*n;for(let s=0;s<2;s++)d.get(t+i+s)&&y.set(m[2*e+s],m[2*e+n]),d.get(t+2*r+i+s)&&y.set(m[2*e+n],m[p-1-2*e-s]),d.get(t+4*r+i+s)&&y.set(m[p-1-2*e-s],m[p-1-2*e-n]),d.get(t+6*r+i+s)&&y.set(m[p-1-2*e-n],m[2*e+s])}t+=8*r}if(rD.drawModeMessage(y,n,l,g),n)rD.drawBullsEye(y,B.truncDivision(l,2),5);else{rD.drawBullsEye(y,B.truncDivision(l,2),7);for(let e=0,t=0;e<B.truncDivision(p,2)-1;e+=15,t+=16)for(let e=1&B.truncDivision(l,2);e<l;e+=2)y.set(B.truncDivision(l,2)-t,e),y.set(B.truncDivision(l,2)+t,e),y.set(e,B.truncDivision(l,2)-t),y.set(e,B.truncDivision(l,2)+t)}let w=new rm;return w.setCompact(n),w.setSize(l),w.setLayers(i),w.setCodeWords(f),w.setMatrix(y),w}static drawBullsEye(e,t,r){for(let n=0;n<r;n+=2)for(let r=t-n;r<=t+n;r++)e.set(r,t-n),e.set(r,t+n),e.set(t-n,r),e.set(t+n,r);e.set(t-r,t-r),e.set(t-r+1,t-r),e.set(t-r,t-r+1),e.set(t+r,t-r),e.set(t+r,t-r+1),e.set(t+r,t+r-1)}static generateModeMessage(e,t,r){let n=new F;return e?(n.appendBits(t-1,2),n.appendBits(r-1,6),n=rD.generateCheckWords(n,28,4)):(n.appendBits(t-1,5),n.appendBits(r-1,11),n=rD.generateCheckWords(n,40,4)),n}static drawModeMessage(e,t,r,n){let i=B.truncDivision(r,2);if(t)for(let t=0;t<7;t++){let r=i-3+t;n.get(t)&&e.set(r,i-5),n.get(t+7)&&e.set(i+5,r),n.get(20-t)&&e.set(r,i+5),n.get(27-t)&&e.set(i-5,r)}else for(let t=0;t<10;t++){let r=i-5+t+B.truncDivision(t,5);n.get(t)&&e.set(r,i-7),n.get(t+10)&&e.set(i+7,r),n.get(29-t)&&e.set(r,i+7),n.get(39-t)&&e.set(i-7,r)}}static generateCheckWords(e,t,r){let n=e.getSize()/r,i=new rr(rD.getGF(r)),s=B.truncDivision(t,r),a=rD.bitsToWords(e,r,s);i.encode(a,s-n);let o=t%r,l=new F;for(let e of(l.appendBits(0,o),Array.from(a)))l.appendBits(e,r);return l}static bitsToWords(e,t,r){let n,i,s=new Int32Array(r);for(n=0,i=e.getSize()/t;n<i;n++){let r=0;for(let i=0;i<t;i++)r|=e.get(n*t+i)?1<<t-i-1:0;s[n]=r}return s}static getGF(e){switch(e){case 4:return eu.AZTEC_PARAM;case 6:return eu.AZTEC_DATA_6;case 8:return eu.AZTEC_DATA_8;case 10:return eu.AZTEC_DATA_10;case 12:return eu.AZTEC_DATA_12;default:throw new D("Unsupported word size "+e)}}static stuffBits(e,t){let r=new F,n=e.getSize(),i=(1<<t)-2;for(let s=0;s<n;s+=t){let a=0;for(let r=0;r<t;r++)(s+r>=n||e.get(s+r))&&(a|=1<<t-1-r);(a&i)===i?(r.appendBits(a&i,t),s--):(a&i)==0?(r.appendBits(1|a,t),s--):r.appendBits(a,t)}return r}static totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}rD.DEFAULT_EC_PERCENT=33,rD.DEFAULT_AZTEC_LAYERS=0,rD.MAX_NB_BITS=32,rD.MAX_NB_BITS_COMPACT=4,rD.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class rR{encode(e,t,r,n){return this.encodeWithHints(e,t,r,n,null)}encodeWithHints(e,t,r,n,i){let s=rp.ISO_8859_1,a=rD.DEFAULT_EC_PERCENT,o=rD.DEFAULT_AZTEC_LAYERS;return null!=i&&(i.has(rt.CHARACTER_SET)&&(s=rg.forName(i.get(rt.CHARACTER_SET).toString())),i.has(rt.ERROR_CORRECTION)&&(a=B.parseInt(i.get(rt.ERROR_CORRECTION).toString())),i.has(rt.AZTEC_LAYERS)&&(o=B.parseInt(i.get(rt.AZTEC_LAYERS).toString()))),rR.encodeLayers(e,t,r,n,s,a,o)}static encodeLayers(e,t,r,n,i,s,a){if(t!==en.AZTEC)throw new D("Can only encode AZTEC, but got "+t);let o=rD.encode(G.getBytes(e,i),s,a);return rR.renderResult(o,r,n)}static renderResult(e,t,r){let n=e.getMatrix();if(null==n)throw new ec;let i=n.getWidth(),s=n.getHeight(),a=Math.max(t,i),o=Math.max(r,s),l=Math.min(a/i,o/s),u=(a-i*l)/2,h=(o-s*l)/2,c=new W(a,o);for(let e=0,t=h;e<s;e++,t+=l)for(let r=0,s=u;r<i;r++,s+=l)n.get(r,e)&&c.setRegion(s,t,l,l);return c}}t.AbstractExpandedDecoder=eJ,t.ArgumentException=N,t.ArithmeticException=el,t.AztecCode=rm,t.AztecCodeReader=eb,t.AztecCodeWriter=rR,t.AztecDecoder=ef,t.AztecDetector=eT,t.AztecDetectorResult=ew,t.AztecEncoder=rD,t.AztecHighLevelEncoder=rN,t.AztecPoint=eS,t.BarcodeFormat=en,t.Binarizer=O,t.BinaryBitmap=R,t.BitArray=F,t.BitMatrix=W,t.BitSource=td,t.BrowserAztecCodeReader=class extends et{constructor(e=500){super(new eb,e)}},t.BrowserBarcodeReader=class extends et{constructor(e=500,t){super(new ta(t),e,t)}},t.BrowserCodeReader=et,t.BrowserDatamatrixCodeReader=class extends et{constructor(e=500){super(new tm,e)}},t.BrowserMultiFormatReader=class extends et{constructor(e=null,t=500){const r=new re;r.setHints(e),super(r,t)}decodeBitmap(e){return this.reader.decodeWithState(e)}},t.BrowserPDF417Reader=class extends et{constructor(e=500){super(new t7,e)}},t.BrowserQRCodeReader=class extends et{constructor(e=500){super(new tP,e)}},t.BrowserQRCodeSvgWriter=rh,t.CharacterSetECI=j,t.ChecksumException=M,t.Code128Reader=eN,t.Code39Reader=eD,t.DataMatrixDecodedBitStreamParser=tf,t.DataMatrixReader=tm,t.DecodeHintType=U,t.DecoderResult=es,t.DefaultGridSampler=e_,t.DetectorResult=ey,t.EAN13Reader=ek,t.EncodeHintType=rt,t.Exception=v,t.FormatException=V,t.GenericGF=eu,t.GenericGFPoly=eo,t.GlobalHistogramBinarizer=K,t.GridSampler=eC,t.GridSamplerInstance=eA,t.HTMLCanvasElementLuminanceSource=Z,t.HybridBinarizer=X,t.ITFReader=eR,t.IllegalArgumentException=D,t.IllegalStateException=ec,t.InvertedLuminanceSource=$,t.LuminanceSource=Q,t.MathUtils=eg,t.MultiFormatOneDReader=ta,t.MultiFormatReader=re,t.MultiFormatWriter=class{encode(e,t,r,n,i){let s;if(t===en.QR_CODE)s=new rc;else throw new D("No encoder available for format "+t);return s.encode(e,t,r,n,i)}},t.NotFoundException=Y,t.OneDReader=ev,t.PDF417DecodedBitStreamParser=t8,t.PDF417DecoderErrorCorrection=tz,t.PDF417Reader=t7,t.PDF417ResultMetadata=tZ,t.PerspectiveTransform=eI,t.PlanarYUVLuminanceSource=rd,t.QRCodeByteMatrix=ri,t.QRCodeDataMask=t_,t.QRCodeDecodedBitStreamParser=tb,t.QRCodeDecoderErrorCorrectionLevel=ty,t.QRCodeDecoderFormatInformation=tw,t.QRCodeEncoder=ru,t.QRCodeEncoderQRCode=rs,t.QRCodeMaskUtil=rn,t.QRCodeMatrixUtil=ro,t.QRCodeMode=tT,t.QRCodeReader=tP,t.QRCodeVersion=tI,t.QRCodeWriter=rc,t.RGBLuminanceSource=rf,t.RSS14Reader=ts,t.RSSExpandedReader=tn,t.ReaderException=t9,t.ReedSolomonDecoder=ed,t.ReedSolomonEncoder=rr,t.ReedSolomonException=eh,t.Result=er,t.ResultMetadataType=ei,t.ResultPoint=em,t.StringUtils=G,t.UnsupportedOperationException=z,t.VideoInputDevice=J,t.WhiteRectangleDetector=eE,t.WriterException=ra,t.ZXingArrays=k,t.ZXingCharset=rg,t.ZXingInteger=B,t.ZXingStandardCharsets=rp,t.ZXingStringBuilder=q,t.ZXingStringEncoding=H,t.ZXingSystem=x,t.createAbstractExpandedDecoder=te,Object.defineProperty(t,"__esModule",{value:!0})}(r)},45749,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var g=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(g)return g;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return T(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return v(e).length;default:if(i)return n?-1:T(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=R[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):g.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function w(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var g="",p=0;p<f;)g+=String.fromCharCode.apply(String,d.slice(p,p+=4096));return g}function E(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function I(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function _(e,t,r,n,s){return t*=1,r>>>=0,s||I(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function A(e,t,r,n,s){return t*=1,r>>>=0,s||I(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,N(T(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,N(b(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return N(b(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,N(v(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,N(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||E(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||E(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||E(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||E(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||E(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;C(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;C(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||C(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return _(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return _(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return A(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return A(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var S=/[^+/0-9A-Za-z-_]/g;function T(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function b(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function v(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(S,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var R=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,g=n?1:-1,p=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=g,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=g,a/=256,u-=8);e[r+f-g]|=128*p}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/Progetti/Dieta/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},33560,e=>{"use strict";let t,r,n;var i,s,a,o,l,u,h,c,d,f,g,p,m,y,w,E,C,I,_,A,S,T,b,v,N,D,R,M,O,x,L,P,k,B,F,U,V,j,z,H,G,q,W,Y,K,X,Q,$,Z,J,ee,et,er,en,ei,es,ea,eo,el=e.i(778),eu=e.i(78702);let eh=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),ec=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var ed={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let ef=(0,eu.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:i="",children:s,iconNode:a,...o},l)=>(0,eu.createElement)("svg",{ref:l,...ed,width:t,height:t,stroke:e,strokeWidth:n?24*Number(r)/Number(t):r,className:eh("lucide",i),...!s&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(o)&&{"aria-hidden":"true"},...o},[...a.map(([e,t])=>(0,eu.createElement)(e,t)),...Array.isArray(s)?s:[s]])),eg=(e,t)=>{let r=(0,eu.forwardRef)(({className:r,...n},i)=>(0,eu.createElement)(ef,{ref:i,iconNode:t,className:eh(`lucide-${ec(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...n}));return r.displayName=ec(e),r},ep=eg("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),em=eg("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),ey=eg("scan-barcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]),ew=eg("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),eE=eg("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),eC=eg("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),eI=eg("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function e_({mealData:e,onConfirm:t,onCancel:r}){let[n,i]=(0,eu.useState)(e.quantity||100),s=e=>{i(t=>Math.max(10,t+e))};return(0,el.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-end justify-center p-4",children:(0,el.jsxs)("div",{className:"glass-panel rounded-3xl p-6 max-w-md w-full animate-in slide-in-from-bottom-8 duration-300",children:[(0,el.jsx)("h3",{className:"text-2xl font-bold text-white mb-1",children:"Conferma pasto"}),(0,el.jsx)("p",{className:"text-gray-400 text-sm mb-6",children:"Verifica i dati prima di salvare"}),(0,el.jsxs)("div",{className:"bg-slate-800/50 rounded-2xl p-4 mb-6 border border-slate-700/50",children:[(0,el.jsx)("div",{className:"text-lg font-semibold text-white mb-3",children:e.name}),(0,el.jsxs)("div",{className:"mb-4",children:[(0,el.jsx)("label",{className:"text-xs text-gray-400 uppercase tracking-wider block mb-2",children:"Quantit (grammi)"}),(0,el.jsxs)("div",{className:"flex items-center gap-3",children:[(0,el.jsx)("button",{onClick:()=>s(-50),className:"h-10 w-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center text-white transition",children:(0,el.jsx)(eC,{size:16})}),(0,el.jsx)("input",{type:"number",value:n,onChange:e=>i(parseInt(e.target.value)||0),className:"flex-1 h-12 bg-slate-700 rounded-xl text-center text-2xl font-bold text-white border-2 border-slate-600 focus:border-primary focus:outline-none transition"}),(0,el.jsx)("button",{onClick:()=>s(50),className:"h-10 w-10 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center text-white transition",children:(0,el.jsx)(eI,{size:16})})]})]}),(0,el.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-center",children:[(0,el.jsx)(eA,{label:"Cal",value:e.calories}),(0,el.jsx)(eA,{label:"Prot",value:`${e.protein}g`}),(0,el.jsx)(eA,{label:"Carb",value:`${e.carbs}g`}),(0,el.jsx)(eA,{label:"Grass",value:`${e.fat}g`})]})]}),(0,el.jsxs)("div",{className:"flex gap-3",children:[(0,el.jsxs)("button",{onClick:r,className:"flex-1 h-14 rounded-xl bg-slate-800 hover:bg-slate-700 text-white font-medium transition flex items-center justify-center gap-2",children:[(0,el.jsx)(eE,{size:20})," Annulla"]}),(0,el.jsxs)("button",{onClick:()=>{t({...e,quantity:n})},className:"flex-1 h-14 rounded-xl glass-button text-white font-medium flex items-center justify-center gap-2",children:[(0,el.jsx)(ew,{size:20})," Salva"]})]})]})})}function eA({label:e,value:t}){return(0,el.jsxs)("div",{className:"bg-slate-700/50 rounded-lg py-2",children:[(0,el.jsx)("div",{className:"text-xs text-gray-400 uppercase",children:e}),(0,el.jsx)("div",{className:"text-sm font-bold text-white",children:t})]})}(i=v||(v={}))[i.QR_CODE=0]="QR_CODE",i[i.AZTEC=1]="AZTEC",i[i.CODABAR=2]="CODABAR",i[i.CODE_39=3]="CODE_39",i[i.CODE_93=4]="CODE_93",i[i.CODE_128=5]="CODE_128",i[i.DATA_MATRIX=6]="DATA_MATRIX",i[i.MAXICODE=7]="MAXICODE",i[i.ITF=8]="ITF",i[i.EAN_13=9]="EAN_13",i[i.EAN_8=10]="EAN_8",i[i.PDF_417=11]="PDF_417",i[i.RSS_14=12]="RSS_14",i[i.RSS_EXPANDED=13]="RSS_EXPANDED",i[i.UPC_A=14]="UPC_A",i[i.UPC_E=15]="UPC_E",i[i.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";var eS=new Map([[v.QR_CODE,"QR_CODE"],[v.AZTEC,"AZTEC"],[v.CODABAR,"CODABAR"],[v.CODE_39,"CODE_39"],[v.CODE_93,"CODE_93"],[v.CODE_128,"CODE_128"],[v.DATA_MATRIX,"DATA_MATRIX"],[v.MAXICODE,"MAXICODE"],[v.ITF,"ITF"],[v.EAN_13,"EAN_13"],[v.EAN_8,"EAN_8"],[v.PDF_417,"PDF_417"],[v.RSS_14,"RSS_14"],[v.RSS_EXPANDED,"RSS_EXPANDED"],[v.UPC_A,"UPC_A"],[v.UPC_E,"UPC_E"],[v.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]);(s=N||(N={}))[s.UNKNOWN=0]="UNKNOWN",s[s.URL=1]="URL",(a=D||(D={}))[a.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",a[a.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE";var eT=function(){function e(){}return e.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",e.SCAN_DEFAULT_FPS=2,e.DEFAULT_DISABLE_FLIP=!1,e.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,e.DEFAULT_SUPPORTED_SCAN_TYPE=[D.SCAN_TYPE_CAMERA,D.SCAN_TYPE_FILE],e}(),eb=function(){function e(e,t){this.format=e,this.formatName=t}return e.prototype.toString=function(){return this.formatName},e.create=function(t){if(!eS.has(t))throw"".concat(t," not in html5QrcodeSupportedFormatsTextMap");return new e(t,eS.get(t))},e}(),ev=function(){function e(){}return e.createFromText=function(e){return{decodedText:e,result:{text:e}}},e.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},e}();(o=R||(R={}))[o.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",o[o.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",o[o.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR";var eN=function(){function e(){}return e.createFrom=function(e){return{errorMessage:e,type:R.UNKWOWN_ERROR}},e}(),eD=function(){function e(e){this.verbose=e}return e.prototype.log=function(e){this.verbose&&console.log(e)},e.prototype.warn=function(e){this.verbose&&console.warn(e)},e.prototype.logError=function(e,t){(this.verbose||!0===t)&&console.error(e)},e.prototype.logErrors=function(e){if(0===e.length)throw"Logger#logError called without arguments";this.verbose&&console.error(e)},e}();function eR(e){return null==e}var eM=function(){function e(){}return e.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},e.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},e.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},e.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},e.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},e.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},e.scannerPaused=function(){return"Scanner paused"},e}(),eO=function(){function e(){}return e.scanningStatus=function(){return"Scanning"},e.idleStatus=function(){return"Idle"},e.errorStatus=function(){return"Error"},e.permissionStatus=function(){return"Permission"},e.noCameraFoundErrorStatus=function(){return"No Cameras"},e.lastMatch=function(e){return"Last Match: ".concat(e)},e.codeScannerTitle=function(){return"Code Scanner"},e.cameraPermissionTitle=function(){return"Request Camera Permissions"},e.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},e.noCameraFound=function(){return"No camera found"},e.scanButtonStopScanningText=function(){return"Stop Scanning"},e.scanButtonStartScanningText=function(){return"Start Scanning"},e.torchOnButton=function(){return"Switch On Torch"},e.torchOffButton=function(){return"Switch Off Torch"},e.torchOnFailedMessage=function(){return"Failed to turn on torch"},e.torchOffFailedMessage=function(){return"Failed to turn off torch"},e.scanButtonScanningStarting=function(){return"Launching Camera..."},e.textIfCameraScanSelected=function(){return"Scan an Image File"},e.textIfFileScanSelected=function(){return"Scan using camera directly"},e.selectCamera=function(){return"Select Camera"},e.fileSelectionChooseImage=function(){return"Choose Image"},e.fileSelectionChooseAnother=function(){return"Choose Another"},e.fileSelectionNoImageSelected=function(){return"No image choosen"},e.anonymousCameraPrefix=function(){return"Anonymous Camera"},e.dragAndDropMessage=function(){return"Or drop an image to scan"},e.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},e.zoom=function(){return"zoom"},e.loadingImage=function(){return"Loading image..."},e.cameraScanAltText=function(){return"Camera based scan"},e.fileScanAltText=function(){return"Fule based scan"},e}(),ex=function(){function e(){}return e.poweredBy=function(){return"Powered by "},e.reportIssues=function(){return"Report issues"},e}(),eL=function(){function e(){}return e.isMediaStreamConstraintsValid=function(e,t){if("object"!=typeof e){var r=typeof e;return t.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(r,"."),!0),!1}for(var n=new Set(["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"]),i=Object.keys(e),s=0;s<i.length;s++){var a=i[s];if(n.has(a))return t.logError("".concat(a," is not supported videoConstaints."),!0),!1}return!0},e}(),eP=e.i(21351),ek=function(){function e(e,t,r){if(this.formatMap=new Map([[v.QR_CODE,eP.BarcodeFormat.QR_CODE],[v.AZTEC,eP.BarcodeFormat.AZTEC],[v.CODABAR,eP.BarcodeFormat.CODABAR],[v.CODE_39,eP.BarcodeFormat.CODE_39],[v.CODE_93,eP.BarcodeFormat.CODE_93],[v.CODE_128,eP.BarcodeFormat.CODE_128],[v.DATA_MATRIX,eP.BarcodeFormat.DATA_MATRIX],[v.MAXICODE,eP.BarcodeFormat.MAXICODE],[v.ITF,eP.BarcodeFormat.ITF],[v.EAN_13,eP.BarcodeFormat.EAN_13],[v.EAN_8,eP.BarcodeFormat.EAN_8],[v.PDF_417,eP.BarcodeFormat.PDF_417],[v.RSS_14,eP.BarcodeFormat.RSS_14],[v.RSS_EXPANDED,eP.BarcodeFormat.RSS_EXPANDED],[v.UPC_A,eP.BarcodeFormat.UPC_A],[v.UPC_E,eP.BarcodeFormat.UPC_E],[v.UPC_EAN_EXTENSION,eP.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!eP)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=t,this.logger=r;var n=this.createZXingFormats(e),i=new Map;i.set(eP.DecodeHintType.POSSIBLE_FORMATS,n),i.set(eP.DecodeHintType.TRY_HARDER,!1),this.hints=i}return e.prototype.decodeAsync=function(e){var t=this;return new Promise(function(r,n){try{r(t.decode(e))}catch(e){n(e)}})},e.prototype.decode=function(e){var t=new eP.MultiFormatReader(this.verbose,this.hints),r=new eP.HTMLCanvasElementLuminanceSource(e),n=new eP.BinaryBitmap(new eP.HybridBinarizer(r)),i=t.decode(n);return{text:i.text,format:eb.create(this.toHtml5QrcodeSupportedFormats(i.format)),debugData:this.createDebugData()}},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(t,r,n){e.set(t,r)}),e},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createZXingFormats=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];this.formatMap.has(n)?t.push(this.formatMap.get(n)):this.logger.logError("".concat(n," is not supported by")+"ZXingHtml5QrcodeShim")}return t},e.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},e}(),eB=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},eF=function(){function e(t,r,n){if(this.formatMap=new Map([[v.QR_CODE,"qr_code"],[v.AZTEC,"aztec"],[v.CODABAR,"codabar"],[v.CODE_39,"code_39"],[v.CODE_93,"code_93"],[v.CODE_128,"code_128"],[v.DATA_MATRIX,"data_matrix"],[v.ITF,"itf"],[v.EAN_13,"ean_13"],[v.EAN_8,"ean_8"],[v.PDF_417,"pdf417"],[v.UPC_A,"upc_a"],[v.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!e.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=r,this.logger=n;var i=this.createBarcodeDetectorFormats(t);if(this.detector=new BarcodeDetector(i),!this.detector)throw"BarcodeDetector detector not supported"}return e.isSupported=function(){return"BarcodeDetector"in window&&(new BarcodeDetector({formats:["qr_code"]}),!0)},e.prototype.decodeAsync=function(e){var t,r,n,i;return t=this,r=void 0,n=void 0,i=function(){var t,r;return eB(this,function(n){switch(n.label){case 0:return[4,this.detector.detect(e)];case 1:if(!(t=n.sent())||0===t.length)throw"No barcode or QR code detected.";return[2,{text:(r=this.selectLargestBarcode(t)).rawValue,format:eb.create(this.toHtml5QrcodeSupportedFormats(r.format)),debugData:this.createDebugData()}]}})},new(n||(n=Promise))(function(e,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(t){var r;t.done?e(t.value):((r=t.value)instanceof n?r:new n(function(e){e(r)})).then(a,o)}l((i=i.apply(t,r||[])).next())})},e.prototype.selectLargestBarcode=function(e){for(var t=null,r=0,n=0;n<e.length;n++){var i=e[n],s=i.boundingBox.width*i.boundingBox.height;s>r&&(r=s,t=i)}if(!t)throw"No largest barcode found";return t},e.prototype.createBarcodeDetectorFormats=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];this.formatMap.has(n)?t.push(this.formatMap.get(n)):this.logger.warn("".concat(n," is not supported by")+"BarcodeDetectorDelegate")}return{formats:t}},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach(function(t,r,n){e.set(t,r)}),e},e.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},e}(),eU=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})},eV=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},ej=function(){function e(e,t,r,n){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=r,t&&eF.isSupported()?(this.primaryDecoder=new eF(e,r,n),this.secondaryDecoder=new ek(e,r,n)):this.primaryDecoder=new ek(e,r,n)}return e.prototype.decodeAsync=function(e){return eU(this,void 0,void 0,function(){var t;return eV(this,function(r){switch(r.label){case 0:t=performance.now(),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,r.sent()];case 3:return this.possiblyLogPerformance(t),[7];case 4:return[2]}})})},e.prototype.decodeRobustlyAsync=function(e){return eU(this,void 0,void 0,function(){var t,r;return eV(this,function(n){switch(n.label){case 0:t=performance.now(),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,n.sent()];case 3:if(r=n.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw r;case 4:return this.possiblyLogPerformance(t),[7];case 5:return[2]}})})},e.prototype.getDecoder=function(){return this.secondaryDecoder?!1===this.wasPrimaryDecoderUsedInLastDecode?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},e.prototype.possiblyLogPerformance=function(e){if(this.verbose){var t=performance.now()-e;this.executionResults.push(t),this.executions++,this.possiblyFlushPerformanceReport()}},e.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,t=0,r=this.executionResults;t<r.length;t++)e+=r[t];var n=e/this.executionResults.length;console.log("".concat(n," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},e}(),ez=(l=function(e,t){return(l=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),eH=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})},eG=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},eq=function(){function e(e,t){this.name=e,this.track=t}return e.prototype.isSupported=function(){return!!this.track.getCapabilities&&this.name in this.track.getCapabilities()},e.prototype.apply=function(e){var t={};return t[this.name]=e,this.track.applyConstraints({advanced:[t]})},e.prototype.value=function(){var e=this.track.getSettings();return this.name in e?e[this.name]:null},e}(),eW=function(e){function t(t){return e.call(this,"zoom",t)||this}return ez(t,e),t}(function(e){function t(t,r){return e.call(this,t,r)||this}return ez(t,e),t.prototype.min=function(){return this.getCapabilities().min},t.prototype.max=function(){return this.getCapabilities().max},t.prototype.step=function(){return this.getCapabilities().step},t.prototype.apply=function(e){var t={};return t[this.name]=e,this.track.applyConstraints({advanced:[t]})},t.prototype.getCapabilities=function(){this.failIfNotSupported();var e=this.track.getCapabilities()[this.name];return{min:e.min,max:e.max,step:e.step}},t.prototype.failIfNotSupported=function(){if(!this.isSupported())throw Error("".concat(this.name," capability not supported"))},t}(eq)),eY=function(e){function t(t){return e.call(this,"torch",t)||this}return ez(t,e),t}(eq),eK=function(){function e(e){this.track=e}return e.prototype.zoomFeature=function(){return new eW(this.track)},e.prototype.torchFeature=function(){return new eY(this.track)},e}(),eX=function(){function e(e,t,r){this.isClosed=!1,this.parentElement=e,this.mediaStream=t,this.callbacks=r,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return e.prototype.createVideoElement=function(e){var t=document.createElement("video");return t.style.width="".concat(e,"px"),t.style.display="block",t.muted=!0,t.setAttribute("muted","true"),t.playsInline=!0,t},e.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var t=function(){var r=e.surface.clientWidth,n=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(r,n),e.surface.removeEventListener("playing",t)};this.surface.addEventListener("playing",t),this.surface.srcObject=this.mediaStream,this.surface.play()},e.create=function(t,r,n,i){return eH(this,void 0,void 0,function(){var s,a;return eG(this,function(o){switch(o.label){case 0:if(s=new e(t,r,i),!n.aspectRatio)return[3,2];return a={aspectRatio:n.aspectRatio},[4,s.getFirstTrackOrFail().applyConstraints(a)];case 1:o.sent(),o.label=2;case 2:return s.setupSurface(),[2,s]}})})},e.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},e.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),0===this.mediaStream.getVideoTracks().length)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},e.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},e.prototype.resume=function(e){this.failIfClosed();var t=this,r=function(){setTimeout(e,200),t.surface.removeEventListener("playing",r)};this.surface.addEventListener("playing",r),this.surface.play()},e.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},e.prototype.getSurface=function(){return this.failIfClosed(),this.surface},e.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},e.prototype.applyVideoConstraints=function(e){return eH(this,void 0,void 0,function(){return eG(this,function(t){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]})})},e.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise(function(t,r){var n=e.mediaStream.getVideoTracks().length,i=0;e.mediaStream.getVideoTracks().forEach(function(r){e.mediaStream.removeTrack(r),r.stop(),++i>=n&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),t())})})},e.prototype.getCapabilities=function(){return new eK(this.getFirstTrackOrFail())},e}(),eQ=function(){function e(e){this.mediaStream=e}return e.prototype.render=function(e,t,r){return eH(this,void 0,void 0,function(){return eG(this,function(n){return[2,eX.create(e,this.mediaStream,t,r)]})})},e.create=function(t){return eH(this,void 0,void 0,function(){var r;return eG(this,function(n){switch(n.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return r={audio:!1,video:t},[4,navigator.mediaDevices.getUserMedia(r)];case 1:return[2,new e(n.sent())]}})})},e}(),e$=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})},eZ=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},eJ=function(){function e(){}return e.failIfNotSupported=function(){return e$(this,void 0,void 0,function(){return eZ(this,function(t){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new e]})})},e.prototype.create=function(e){return e$(this,void 0,void 0,function(){return eZ(this,function(t){return[2,eQ.create(e)]})})},e}(),e1=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},e0=function(){function e(){}return e.retrieve=function(){if(navigator.mediaDevices)return e.getCamerasFromMediaDevices();var t=MediaStreamTrack;return MediaStreamTrack&&t.getSources?e.getCamerasFromMediaStreamTrack():e.rejectWithError()},e.rejectWithError=function(){var t=eM.unableToQuerySupportedDevices();return e.isHttpsOrLocalhost()||(t=eM.insecureContextCameraQueryError()),Promise.reject(t)},e.isHttpsOrLocalhost=function(){if("https:"===location.protocol)return!0;var e=location.host.split(":")[0];return"127.0.0.1"===e||"localhost"===e},e.getCamerasFromMediaDevices=function(){var e,t,r,n;return e=this,t=void 0,r=void 0,n=function(){var e,t,r,n,i,s,a;return e1(this,function(o){switch(o.label){case 0:return e=function(e){for(var t=e.getVideoTracks(),r=0;r<t.length;r++){var n=t[r];n.enabled=!1,n.stop(),e.removeTrack(n)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return t=o.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(i=0,r=o.sent(),n=[],s=r;i<s.length;i++)"videoinput"===(a=s[i]).kind&&n.push({id:a.deviceId,label:a.label});return e(t),[2,n]}})},new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})},e.getCamerasFromMediaStreamTrack=function(){return new Promise(function(e,t){MediaStreamTrack.getSources(function(t){for(var r=[],n=0;n<t.length;n++){var i=t[n];"video"===i.kind&&r.push({id:i.id,label:i.label})}e(r)})})},e}();(u=M||(M={}))[u.UNKNOWN=0]="UNKNOWN",u[u.NOT_STARTED=1]="NOT_STARTED",u[u.SCANNING=2]="SCANNING",u[u.PAUSED=3]="PAUSED";var e2=function(){function e(){this.state=M.NOT_STARTED,this.onGoingTransactionNewState=M.UNKNOWN}return e.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},e.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},e.prototype.execute=function(){if(this.onGoingTransactionNewState===M.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=M.UNKNOWN,this.directTransition(e)},e.prototype.cancel=function(){if(this.onGoingTransactionNewState===M.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=M.UNKNOWN},e.prototype.getState=function(){return this.state},e.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==M.UNKNOWN)throw"Cannot transition to a new state, already under transition"},e.prototype.validateTransition=function(e){switch(this.state){case M.UNKNOWN:throw"Transition from unknown is not allowed";case M.NOT_STARTED:this.failIfNewStateIs(e,[M.PAUSED]);case M.SCANNING:case M.PAUSED:}},e.prototype.failIfNewStateIs=function(e,t){for(var r=0;r<t.length;r++)if(e===t[r])throw"Cannot transition from ".concat(this.state," to ").concat(e)},e}(),e3=function(){function e(e){this.stateManager=e}return e.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},e.prototype.directTransition=function(e){this.stateManager.directTransition(e)},e.prototype.getState=function(){return this.stateManager.getState()},e.prototype.canScanFile=function(){return this.stateManager.getState()===M.NOT_STARTED},e.prototype.isScanning=function(){return this.stateManager.getState()!==M.NOT_STARTED},e.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===M.SCANNING},e.prototype.isPaused=function(){return this.stateManager.getState()===M.PAUSED},e}(),e4=function(){function e(){}return e.create=function(){return new e3(new e2)},e}(),e6=(h=function(e,t){return(h=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e8=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return e6(t,e),t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t}(eT),e5=function(){function e(e,t){this.logger=t,this.fps=e8.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=e8.DEFAULT_DISABLE_FLIP}return e.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?eL.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},e.prototype.isShadedBoxEnabled=function(){return!eR(this.qrbox)},e.create=function(t,r){return new e(t,r)},e}(),e7=function(){function e(e,t){var r;if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(r=t,this.verbose=!0===r.verbose,r.experimentalFeatures),this.logger=new eD(this.verbose),this.qrcode=new ej(this.getSupportedFormats(t),this.getUseBarCodeDetectorIfSupported(r),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=e4.create()}return e.prototype.start=function(e,t,r,n){var i,s=this;if(!e)throw"cameraIdOrConfig is required";if(!r||"function"!=typeof r)throw"qrCodeSuccessCallback is required and should be a function.";i=n||(this.verbose?this.logger.log:function(){});var a=e5.create(t,this.logger);this.clearElement();var o=!1;a.videoConstraints&&(a.isMediaStreamConstraintsValid()?o=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var l=o,u=document.getElementById(this.elementId);u.clientWidth?u.clientWidth:e8.DEFAULT_WIDTH,u.style.position="relative",this.shouldScan=!0,this.element=u;var h=this,c=this.stateManagerProxy.startTransition(M.SCANNING);return new Promise(function(t,n){var o=l?a.videoConstraints:h.createVideoConstraints(e);if(!o){c.cancel(),n("videoConstraints should be defined");return}var u={};(!l||a.aspectRatio)&&(u.aspectRatio=a.aspectRatio);var d={onRenderSurfaceReady:function(e,t){h.setupUi(e,t,a),h.isScanning=!0,h.foreverScan(a,r,i)}};eJ.failIfNotSupported().then(function(e){e.create(o).then(function(e){return e.render(s.element,u,d).then(function(e){h.renderedCamera=e,c.execute(),t(null)}).catch(function(e){c.cancel(),n(e)})}).catch(function(e){c.cancel(),n(eM.errorGettingUserMedia(e))})}).catch(function(e){c.cancel(),n(eM.cameraStreamingNotSupported())})})},e.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(M.PAUSED),this.showPausedState(),(eR(e)||!0!==e)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},e.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,t=function(){e.stateManagerProxy.directTransition(M.SCANNING),e.hidePausedState()};this.renderedCamera.isPaused()?this.renderedCamera.resume(function(){t()}):t()},e.prototype.getState=function(){return this.stateManagerProxy.getState()},e.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var t=this.stateManagerProxy.startTransition(M.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var r=function(){if(e.element){var t=document.getElementById(e8.SHADED_REGION_ELEMENT_ID);t&&e.element.removeChild(t)}},n=this;return this.renderedCamera.close().then(function(){return n.renderedCamera=null,n.element&&(n.element.removeChild(n.canvasElement),n.canvasElement=null),r(),n.qrRegion&&(n.qrRegion=null),n.context&&(n.context=null),t.execute(),n.hidePausedState(),n.isScanning=!1,Promise.resolve()})},e.prototype.scanFile=function(e,t){return this.scanFileV2(e,t).then(function(e){return e.decodedText})},e.prototype.scanFileV2=function(e,t){var r=this;if(!e||!(e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(eR(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(n,i){r.possiblyCloseLastScanImageFile(),r.clearElement(),r.lastScanImageFile=URL.createObjectURL(e);var s=new Image;s.onload=function(){var e=s.width,a=s.height,o=document.getElementById(r.elementId),l=o.clientWidth?o.clientWidth:e8.DEFAULT_WIDTH,u=Math.max(o.clientHeight?o.clientHeight:a,e8.FILE_SCAN_MIN_HEIGHT),h=r.computeCanvasDrawConfig(e,a,l,u);if(t){var c=r.createCanvasElement(l,u,"qr-canvas-visible");c.style.display="inline-block",o.appendChild(c);var d=c.getContext("2d");if(!d)throw"Unable to get 2d context from canvas";d.canvas.width=l,d.canvas.height=u,d.drawImage(s,0,0,e,a,h.x,h.y,h.width,h.height)}var f=e8.FILE_SCAN_HIDDEN_CANVAS_PADDING,g=Math.max(s.width,h.width),p=Math.max(s.height,h.height),m=g+2*f,y=p+2*f,w=r.createCanvasElement(m,y);o.appendChild(w);var E=w.getContext("2d");if(!E)throw"Unable to get 2d context from canvas";E.canvas.width=m,E.canvas.height=y,E.drawImage(s,0,0,e,a,f,f,g,p);try{r.qrcode.decodeRobustlyAsync(w).then(function(e){n(ev.createFromQrcodeResult(e))}).catch(i)}catch(e){i("QR code parse error, error = ".concat(e))}},s.onerror=i,s.onabort=i,s.onstalled=i,s.onsuspend=i,s.src=URL.createObjectURL(e)})},e.prototype.clear=function(){this.clearElement()},e.getCameras=function(){return e0.retrieve()},e.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},e.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},e.prototype.applyVideoConstraints=function(e){if(e){if(!eL.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},e.prototype.getRenderedCameraOrFail=function(){if(null==this.renderedCamera)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},e.prototype.getSupportedFormats=function(e){var t=[v.QR_CODE,v.AZTEC,v.CODABAR,v.CODE_39,v.CODE_93,v.CODE_128,v.DATA_MATRIX,v.MAXICODE,v.ITF,v.EAN_13,v.EAN_8,v.PDF_417,v.RSS_14,v.RSS_EXPANDED,v.UPC_A,v.UPC_E,v.UPC_EAN_EXTENSION];if(!e||"boolean"==typeof e||!e.formatsToSupport)return t;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var r=[],n=0,i=e.formatsToSupport;n<i.length;n++){var s=i[n];Object.values(v).includes(s)?r.push(s):this.logger.warn("Invalid format: ".concat(s," passed in config, ignoring."))}if(0===r.length)throw"None of formatsToSupport match supported values.";return r},e.prototype.getUseBarCodeDetectorIfSupported=function(e){if(eR(e))return!0;if(!eR(e.useBarCodeDetectorIfSupported))return!1!==e.useBarCodeDetectorIfSupported;if(eR(e.experimentalFeatures))return!0;var t=e.experimentalFeatures;return!!eR(t.useBarCodeDetectorIfSupported)||!1!==t.useBarCodeDetectorIfSupported},e.prototype.validateQrboxSize=function(e,t,r){var n,i=r.qrbox;this.validateQrboxConfig(i);var s=this.toQrdimensions(e,t,i),a=function(e){if(e<e8.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(e8.MIN_QR_BOX_SIZE,"px.")};a(s.width),a(s.height),(n=s.width)>e&&(this.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),n=e),s.width=n},e.prototype.validateQrboxConfig=function(e){if("number"!=typeof e&&"function"!=typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},e.prototype.toQrdimensions=function(e,t,r){if("number"==typeof r)return{width:r,height:r};if("function"==typeof r)try{return r(e,t)}catch(e){throw Error("qrbox config was passed as a function but it failed with unknown error"+e)}return r},e.prototype.setupUi=function(e,t,r){r.isShadedBoxEnabled()&&this.validateQrboxSize(e,t,r);var n=eR(r.qrbox)?{width:e,height:t}:r.qrbox;this.validateQrboxConfig(n);var i=this.toQrdimensions(e,t,n);i.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var s=r.isShadedBoxEnabled()&&i.height<=t,a=s?this.getShadedRegionBounds(e,t,i):{x:0,y:0,width:e,height:t},o=this.createCanvasElement(a.width,a.height),l=o.getContext("2d",{willReadFrequently:!0});l.canvas.width=a.width,l.canvas.height=a.height,this.element.append(o),s&&this.possiblyInsertShadingElement(this.element,e,t,i),this.createScannerPausedUiElement(this.element),this.qrRegion=a,this.context=l,this.canvasElement=o},e.prototype.createScannerPausedUiElement=function(e){var t=document.createElement("div");t.innerText=eM.scannerPaused(),t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="rgba(9, 9, 9, 0.46)",t.style.color="#FFECEC",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t},e.prototype.scanContext=function(e,t){var r=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(t){return e(t.text,ev.createFromQrcodeResult(t)),r.possiblyUpdateShaders(!0),!0}).catch(function(e){r.possiblyUpdateShaders(!1);var n=eM.codeParseError(e);return t(n,eN.createFrom(n)),!1})},e.prototype.foreverScan=function(e,t,r){var n=this;if(this.shouldScan&&this.renderedCamera){var i=this.renderedCamera.getSurface(),s=i.videoWidth/i.clientWidth,a=i.videoHeight/i.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var o=this.qrRegion.width*s,l=this.qrRegion.height*a,u=this.qrRegion.x*s,h=this.qrRegion.y*a;this.context.drawImage(i,u,h,o,l,0,0,this.qrRegion.width,this.qrRegion.height);var c=function(){n.foreverScanTimeout=setTimeout(function(){n.foreverScan(e,t,r)},n.getTimeoutFps(e.fps))};this.scanContext(t,r).then(function(i){i||!0===e.disableFlip?c():(n.context.translate(n.context.canvas.width,0),n.context.scale(-1,1),n.scanContext(t,r).finally(function(){c()}))}).catch(function(e){n.logger.logError("Error happend while scanning context",e),c()})}},e.prototype.createVideoConstraints=function(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){var t="facingMode",r="deviceId",n={user:!0,environment:!0},i="exact",s=function(e){if(e in n)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(e,"'")},a=Object.keys(e);if(1!==a.length)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(a.length," keys");var o=Object.keys(e)[0];if(o!==t&&o!==r)throw"Only '".concat(t,"' and '").concat(r,"' ")+" are supported for 'cameraIdOrConfig'";if(o===t){var l=e.facingMode;if("string"==typeof l){if(s(l))return{facingMode:l}}else if("object"==typeof l)if(i in l){if(s(l["".concat(i)]))return{facingMode:{exact:l["".concat(i)]}}}else throw"'facingMode' should be string or object with"+" ".concat(i," as key.");else{var u=typeof l;throw"Invalid type of 'facingMode' = ".concat(u)}}else{var h=e.deviceId;if("string"==typeof h)return{deviceId:h};if("object"==typeof h)if(i in h)return{deviceId:{exact:h["".concat(i)]}};else throw"'deviceId' should be string or object with"+" ".concat(i," as key.");var c=typeof h;throw"Invalid type of 'deviceId' = ".concat(c)}}var d=typeof e;throw"Invalid type of 'cameraIdOrConfig' = ".concat(d)},e.prototype.computeCanvasDrawConfig=function(e,t,r,n){if(e<=r&&t<=n)return{x:(r-e)/2,y:(n-t)/2,width:e,height:t};var i=e,s=t;return e>r&&(t=r/e*t,e=r),t>n&&(e=n/t*e,t=n),this.logger.log("Image downsampled from "+"".concat(i,"X").concat(s)+" to ".concat(e,"X").concat(t,".")),this.computeCanvasDrawConfig(e,t,r,n)},e.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},e.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(t){t.style.backgroundColor=e?e8.BORDER_SHADER_MATCH_COLOR:e8.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=e)},e.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},e.prototype.createCanvasElement=function(e,t,r){var n=document.createElement("canvas");return n.style.width="".concat(e,"px"),n.style.height="".concat(t,"px"),n.style.display="none",n.id=eR(r)?"qr-canvas":r,n},e.prototype.getShadedRegionBounds=function(e,t,r){if(r.width>e||r.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-r.width)/2,y:(t-r.height)/2,width:r.width,height:r.height}},e.prototype.possiblyInsertShadingElement=function(e,t,r,n){if(!(t-n.width<1)&&!(r-n.height<1)){var i=document.createElement("div");i.style.position="absolute";var s=(t-n.width)/2,a=(r-n.height)/2;i.style.borderLeft="".concat(s,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderRight="".concat(s,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderTop="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),i.style.borderBottom="".concat(a,"px solid rgba(0, 0, 0, 0.48)"),i.style.boxSizing="border-box",i.style.top="0px",i.style.bottom="0px",i.style.left="0px",i.style.right="0px",i.id="".concat(e8.SHADED_REGION_ELEMENT_ID),t-n.width<11||r-n.height<11?this.hasBorderShaders=!1:(this.insertShaderBorders(i,40,5,-5,null,0,!0),this.insertShaderBorders(i,40,5,-5,null,0,!1),this.insertShaderBorders(i,40,5,null,-5,0,!0),this.insertShaderBorders(i,40,5,null,-5,0,!1),this.insertShaderBorders(i,5,45,-5,null,-5,!0),this.insertShaderBorders(i,5,45,null,-5,-5,!0),this.insertShaderBorders(i,5,45,-5,null,-5,!1),this.insertShaderBorders(i,5,45,null,-5,-5,!1),this.hasBorderShaders=!0),e.append(i)}},e.prototype.insertShaderBorders=function(e,t,r,n,i,s,a){var o=document.createElement("div");o.style.position="absolute",o.style.backgroundColor=e8.BORDER_SHADER_DEFAULT_COLOR,o.style.width="".concat(t,"px"),o.style.height="".concat(r,"px"),null!==n&&(o.style.top="".concat(n,"px")),null!==i&&(o.style.bottom="".concat(i,"px")),a?o.style.left="".concat(s,"px"):o.style.right="".concat(s,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(o),e.appendChild(o)},e.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},e.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},e.prototype.getTimeoutFps=function(e){return 1e3/e},e}(),e9="data:image/svg+xml;base64,",te=e9+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",tt=e9+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",tr=e9+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",tn=function(){function e(){}return e.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},e}(),ti=function(){function e(){this.data=tn.createDefault();var t=localStorage.getItem(e.LOCAL_STORAGE_KEY);t?this.data=JSON.parse(t):this.reset()}return e.prototype.hasCameraPermissions=function(){return this.data.hasPermission},e.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},e.prototype.setHasPermission=function(e){this.data.hasPermission=e,this.flush()},e.prototype.setLastUsedCameraId=function(e){this.data.lastUsedCameraId=e,this.flush()},e.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},e.prototype.reset=function(){this.data=tn.createDefault(),this.flush()},e.prototype.flush=function(){localStorage.setItem(e.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},e.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",e}(),ts=function(){function e(){this.infoDiv=document.createElement("div")}return e.prototype.renderInto=function(e){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=ex.poweredBy();var t=document.createElement("a");t.innerText="ScanApp",t.href="https://scanapp.org",t.target="new",t.style.color="white",this.infoDiv.appendChild(t);var r=document.createElement("br"),n=document.createElement("br");this.infoDiv.appendChild(r),this.infoDiv.appendChild(n);var i=document.createElement("a");i.innerText=ex.reportIssues(),i.href="https://github.com/mebjas/html5-qrcode/issues",i.target="new",i.style.color="white",this.infoDiv.appendChild(i),e.appendChild(this.infoDiv)},e.prototype.show=function(){this.infoDiv.style.display="block"},e.prototype.hide=function(){this.infoDiv.style.display="none"},e}(),ta=function(){function e(e,t){this.isShowingInfoIcon=!0,this.onTapIn=e,this.onTapOut=t,this.infoIcon=document.createElement("img")}return e.prototype.renderInto=function(e){var t=this;this.infoIcon.alt="Info icon",this.infoIcon.src=tr,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(e){return t.onHoverIn()},this.infoIcon.onmouseout=function(e){return t.onHoverOut()},this.infoIcon.onclick=function(e){return t.onClick()},e.appendChild(this.infoIcon)},e.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},e.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},e.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=tr,this.infoIcon.style.opacity="0.6")},e}(),to=function(){function e(){var e=this;this.infoDiv=new ts,this.infoIcon=new ta(function(){e.infoDiv.show()},function(){e.infoDiv.hide()})}return e.prototype.renderInto=function(e){this.infoDiv.renderInto(e),this.infoIcon.renderInto(e)},e}(),tl=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},tu=function(){function e(){}return e.hasPermissions=function(){var e,t,r,n;return e=this,t=void 0,r=void 0,n=function(){var e,t,r;return tl(this,function(n){switch(n.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(e=0,t=n.sent();e<t.length;e++)if("videoinput"===(r=t[e]).kind&&r.label)return[2,!0];return[2,!1]}})},new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})},e}(),th=function(){function e(e){this.supportedScanTypes=this.validateAndReturnScanTypes(e)}return e.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},e.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},e.prototype.isCameraScanRequired=function(){for(var t=0,r=this.supportedScanTypes;t<r.length;t++){var n=r[t];if(e.isCameraScanType(n))return!0}return!1},e.isCameraScanType=function(e){return e===D.SCAN_TYPE_CAMERA},e.isFileScanType=function(e){return e===D.SCAN_TYPE_FILE},e.prototype.validateAndReturnScanTypes=function(e){if(!e||0===e.length)return eT.DEFAULT_SUPPORTED_SCAN_TYPE;var t=eT.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(e.length>t)throw"Max ".concat(t," values expected for ")+"supportedScanTypes";for(var r=0;r<e.length;r++){var n=e[r];if(!eT.DEFAULT_SUPPORTED_SCAN_TYPE.includes(n))throw"Unsupported scan type ".concat(n)}return e},e}(),tc=function(){function e(){}return e.ALL_ELEMENT_CLASS="html5-qrcode-element",e.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",e.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",e.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",e.TORCH_BUTTON_ID="html5-qrcode-button-torch",e.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",e.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",e.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",e.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",e.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",e.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",e}(),td=function(){function e(){}return e.createElement=function(e,t){var r=document.createElement(e);return r.id=t,r.classList.add(tc.ALL_ELEMENT_CLASS),"button"===e&&r.setAttribute("type","button"),r},e}(),tf=function(e,t,r,n){return new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})},tg=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},tp=function(){function e(e,t,r){this.isTorchOn=!1,this.torchCapability=e,this.buttonController=t,this.onTorchActionFailureCallback=r}return e.prototype.isTorchEnabled=function(){return this.isTorchOn},e.prototype.flipState=function(){return tf(this,void 0,void 0,function(){var e,t;return tg(this,function(r){switch(r.label){case 0:this.buttonController.disable(),e=!this.isTorchOn,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.torchCapability.apply(e)];case 2:return r.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),e),[3,4];case 3:return t=r.sent(),this.propagateFailure(e,t),this.buttonController.enable(),[3,4];case 4:return[2]}})})},e.prototype.updateUiBasedOnLatestSettings=function(e,t){e===t?(this.buttonController.setText(t?eO.torchOffButton():eO.torchOnButton()),this.isTorchOn=t):this.propagateFailure(t),this.buttonController.enable()},e.prototype.propagateFailure=function(e,t){var r=e?eO.torchOnFailedMessage():eO.torchOffFailedMessage();t&&(r+="; Error = "+t),this.onTorchActionFailureCallback(r)},e.prototype.reset=function(){this.isTorchOn=!1},e}(),tm=function(){function e(e,t){this.onTorchActionFailureCallback=t,this.torchButton=td.createElement("button",tc.TORCH_BUTTON_ID),this.torchController=new tp(e,this,t)}return e.prototype.render=function(e,t){var r=this;this.torchButton.innerText=eO.torchOnButton(),this.torchButton.style.display=t.display,this.torchButton.style.marginLeft=t.marginLeft;var n=this;this.torchButton.addEventListener("click",function(e){return tf(r,void 0,void 0,function(){return tg(this,function(e){switch(e.label){case 0:return[4,n.torchController.flipState()];case 1:return e.sent(),n.torchController.isTorchEnabled()?(n.torchButton.classList.remove(tc.TORCH_BUTTON_CLASS_TORCH_OFF),n.torchButton.classList.add(tc.TORCH_BUTTON_CLASS_TORCH_ON)):(n.torchButton.classList.remove(tc.TORCH_BUTTON_CLASS_TORCH_ON),n.torchButton.classList.add(tc.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),e.appendChild(this.torchButton)},e.prototype.updateTorchCapability=function(e){this.torchController=new tp(e,this,this.onTorchActionFailureCallback)},e.prototype.getTorchButton=function(){return this.torchButton},e.prototype.hide=function(){this.torchButton.style.display="none"},e.prototype.show=function(){this.torchButton.style.display="inline-block"},e.prototype.disable=function(){this.torchButton.disabled=!0},e.prototype.enable=function(){this.torchButton.disabled=!1},e.prototype.setText=function(e){this.torchButton.innerText=e},e.prototype.reset=function(){this.torchButton.innerText=eO.torchOnButton(),this.torchController.reset()},e.create=function(t,r,n,i){var s=new e(r,i);return s.render(t,n),s},e}(),ty=function(){function e(e,t,r){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=t?"block":"none",e.appendChild(this.fileBasedScanRegion);var n=document.createElement("label");n.setAttribute("for",this.getFileScanInputId()),n.style.display="inline-block",this.fileBasedScanRegion.appendChild(n),this.fileSelectionButton=td.createElement("button",tc.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(e){n.click()}),n.append(this.fileSelectionButton),this.fileScanInput=td.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",n.appendChild(this.fileScanInput);var i=this;this.fileScanInput.addEventListener("change",function(e){if(null!=e&&null!=e.target){var t=e.target;if(!t.files||0!==t.files.length){var n=t.files[0],s=n.name;i.setImageNameToButton(s),r(n)}}});var s=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(s),this.fileBasedScanRegion.addEventListener("dragenter",function(e){i.fileBasedScanRegion.style.border=i.fileBasedScanRegionActiveBorder(),e.stopPropagation(),e.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(e){i.fileBasedScanRegion.style.border=i.fileBasedScanRegionDefaultBorder(),e.stopPropagation(),e.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(e){i.fileBasedScanRegion.style.border=i.fileBasedScanRegionActiveBorder(),e.stopPropagation(),e.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),i.fileBasedScanRegion.style.border=i.fileBasedScanRegionDefaultBorder();var t=e.dataTransfer;if(t){var n=t.files;if(!n||0===n.length)return;for(var a=!1,o=0;o<n.length;++o){var l=n.item(o);if(l){var u=/image.*/;if(l.type.match(u)){a=!0;var h=l.name;i.setImageNameToButton(h),r(l),s.innerText=eO.dragAndDropMessage();break}}}a||(s.innerText=eO.dragAndDropMessageOnlyImages())}})}return e.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},e.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},e.prototype.isShowing=function(){return"block"===this.fileBasedScanRegion.style.display},e.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},e.prototype.createFileBasedScanRegion=function(){var e=document.createElement("div");return e.style.textAlign="center",e.style.margin="auto",e.style.width="80%",e.style.maxWidth="600px",e.style.border=this.fileBasedScanRegionDefaultBorder(),e.style.padding="10px",e.style.marginBottom="10px",e},e.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},e.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},e.prototype.createDragAndDropMessage=function(){var e=document.createElement("div");return e.innerText=eO.dragAndDropMessage(),e.style.fontWeight="400",e},e.prototype.setImageNameToButton=function(e){if(e.length>20){var t=e.substring(0,8),r=e.length,n=e.substring(r-8,r);e="".concat(t,"....").concat(n)}var i=eO.fileSelectionChooseAnother()+" - "+e;this.fileSelectionButton.innerText=i},e.prototype.setInitialValueToButton=function(){var e=eO.fileSelectionChooseImage()+" - "+eO.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=e},e.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},e.create=function(t,r,n){return new e(t,r,n)},e}(),tw=function(){function e(e){this.selectElement=td.createElement("select",tc.CAMERA_SELECTION_SELECT_ID),this.cameras=e,this.options=[]}return e.prototype.render=function(e){var t=document.createElement("span");t.style.marginRight="10px";var r=this.cameras.length;if(0===r)throw Error("No cameras found");if(1===r)t.style.display="none";else{var n=eO.selectCamera();t.innerText="".concat(n," (").concat(this.cameras.length,")  ")}for(var i=1,s=0,a=this.cameras;s<a.length;s++){var o=a[s],l=o.id,u=null==o.label?l:o.label;u&&""!==u||(u=[eO.anonymousCameraPrefix(),i++].join(" "));var h=document.createElement("option");h.value=l,h.innerText=u,this.options.push(h),this.selectElement.appendChild(h)}t.appendChild(this.selectElement),e.appendChild(t)},e.prototype.disable=function(){this.selectElement.disabled=!0},e.prototype.isDisabled=function(){return!0===this.selectElement.disabled},e.prototype.enable=function(){this.selectElement.disabled=!1},e.prototype.getValue=function(){return this.selectElement.value},e.prototype.hasValue=function(e){for(var t=0,r=this.options;t<r.length;t++)if(r[t].value===e)return!0;return!1},e.prototype.setValue=function(e){if(!this.hasValue(e))throw Error("".concat(e," is not present in the camera list."));this.selectElement.value=e},e.prototype.hasSingleItem=function(){return 1===this.cameras.length},e.prototype.numCameras=function(){return this.cameras.length},e.create=function(t,r){var n=new e(r);return n.render(t),n},e}(),tE=function(){function e(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=td.createElement("input",tc.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return e.prototype.render=function(e,t){this.zoomElementContainer.style.display=t?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",e.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var r=eO.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(r),this.rangeText.style.marginRight="10px";var n=this;this.rangeInput.addEventListener("input",function(){return n.onValueChange()}),this.rangeInput.addEventListener("change",function(){return n.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},e.prototype.onValueChange=function(){var e=eO.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(e),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},e.prototype.setValues=function(e,t,r,n){this.rangeInput.min=e.toString(),this.rangeInput.max=t.toString(),this.rangeInput.step=n.toString(),this.rangeInput.value=r.toString(),this.onValueChange()},e.prototype.show=function(){this.zoomElementContainer.style.display="block"},e.prototype.hide=function(){this.zoomElementContainer.style.display="none"},e.prototype.setOnCameraZoomValueChangeCallback=function(e){this.onChangeCallback=e},e.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},e.create=function(t,r){var n=new e;return n.render(t,r),n},e}();(c=O||(O={}))[c.STATUS_DEFAULT=0]="STATUS_DEFAULT",c[c.STATUS_SUCCESS=1]="STATUS_SUCCESS",c[c.STATUS_WARNING=2]="STATUS_WARNING",c[c.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION";var tC=function(){function e(e,t,r){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=e,this.config=this.createConfig(t),this.verbose=!0===r,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.scanTypeSelector=new th(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new eD(this.verbose),this.persistedDataManager=new ti,!0!==t.rememberLastUsedCamera&&this.persistedDataManager.reset()}return e.prototype.render=function(e,t){var r,n,i=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(t,r){if(e)e(t,r);else{if(i.lastMatchFound===t)return;i.lastMatchFound=t,i.setHeaderMessage(eO.lastMatch(t),O.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(e,r){t&&t(e,r)};var s=document.getElementById(this.elementId);if(!s)throw"HTML Element with id=".concat(this.elementId," not found");s.innerHTML="",this.createBasicLayout(s),this.html5Qrcode=new e7(this.getScanRegionId(),(r=this.config,n=this.verbose,{formatsToSupport:r.formatsToSupport,useBarCodeDetectorIfSupported:r.useBarCodeDetectorIfSupported,experimentalFeatures:r.experimentalFeatures,verbose:n}))},e.prototype.pause=function(e){(eR(e)||!0!==e)&&(e=!1),this.getHtml5QrcodeOrFail().pause(e)},e.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},e.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},e.prototype.clear=function(){var e=this,t=function(){var t=document.getElementById(e.elementId);t&&(t.innerHTML="",e.resetBasicLayout(t))};return this.html5Qrcode?new Promise(function(r,n){e.html5Qrcode?e.html5Qrcode.isScanning?e.html5Qrcode.stop().then(function(n){e.html5Qrcode&&(e.html5Qrcode.clear(),t()),r()}).catch(function(t){e.verbose&&e.logger.logError("Unable to stop qrcode scanner",t),n(t)}):(e.html5Qrcode.clear(),t(),r()):r()}):Promise.resolve()},e.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},e.prototype.applyVideoConstraints=function(e){return this.getHtml5QrcodeOrFail().applyVideoConstraints(e)},e.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},e.prototype.createConfig=function(e){return e?(e.fps||(e.fps=eT.SCAN_DEFAULT_FPS),!eT.DEFAULT_REMEMBER_LAST_CAMERA_USED!==e.rememberLastUsedCamera&&(e.rememberLastUsedCamera=eT.DEFAULT_REMEMBER_LAST_CAMERA_USED),e.supportedScanTypes||(e.supportedScanTypes=eT.DEFAULT_SUPPORTED_SCAN_TYPE),e):{fps:eT.SCAN_DEFAULT_FPS,rememberLastUsedCamera:eT.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:eT.DEFAULT_SUPPORTED_SCAN_TYPE}},e.prototype.createBasicLayout=function(e){e.style.position="relative",e.style.padding="0px",e.style.border="1px solid silver",this.createHeader(e);var t=document.createElement("div");t.id=this.getScanRegionId(),t.style.width="100%",t.style.minHeight="100px",t.style.textAlign="center",e.appendChild(t),th.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var r=document.createElement("div");r.id=this.getDashboardId(),r.style.width="100%",e.appendChild(r),this.setupInitialDashboard(r)},e.prototype.resetBasicLayout=function(e){e.style.border="none"},e.prototype.setupInitialDashboard=function(e){this.createSection(e),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},e.prototype.createHeader=function(e){var t=document.createElement("div");t.style.textAlign="left",t.style.margin="0px",e.appendChild(t),new to().renderInto(t);var r=document.createElement("div");r.id=this.getHeaderMessageContainerId(),r.style.display="none",r.style.textAlign="center",r.style.fontSize="14px",r.style.padding="2px 10px",r.style.margin="4px",r.style.borderTop="1px solid #f6f6f6",t.appendChild(r)},e.prototype.createSection=function(e){var t=document.createElement("div");t.id=this.getDashboardSectionId(),t.style.width="100%",t.style.padding="10px 0px 10px 0px",t.style.textAlign="left",e.appendChild(t)},e.prototype.createCameraListUi=function(e,t,r){var n=this;n.showHideScanTypeSwapLink(!1),n.setHeaderMessage(eO.cameraPermissionRequesting());var i=function(){r||n.createPermissionButton(e,t)};e7.getCameras().then(function(r){n.persistedDataManager.setHasPermission(!0),n.showHideScanTypeSwapLink(!0),n.resetHeaderMessage(),r&&r.length>0?(e.removeChild(t),n.renderCameraSelection(r)):(n.setHeaderMessage(eO.noCameraFound(),O.STATUS_WARNING),i())}).catch(function(e){n.persistedDataManager.setHasPermission(!1),r?r.disabled=!1:i(),n.setHeaderMessage(e,O.STATUS_WARNING),n.showHideScanTypeSwapLink(!0)})},e.prototype.createPermissionButton=function(e,t){var r=this,n=td.createElement("button",this.getCameraPermissionButtonId());n.innerText=eO.cameraPermissionTitle(),n.addEventListener("click",function(){n.disabled=!0,r.createCameraListUi(e,t,n)}),t.appendChild(n)},e.prototype.createPermissionsUi=function(e,t){var r=this;th.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()?tu.hasPermissions().then(function(n){n?r.createCameraListUi(e,t):(r.persistedDataManager.setHasPermission(!1),r.createPermissionButton(e,t))}).catch(function(n){r.persistedDataManager.setHasPermission(!1),r.createPermissionButton(e,t)}):this.createPermissionButton(e,t)},e.prototype.createSectionControlPanel=function(){var e=document.getElementById(this.getDashboardSectionId()),t=document.createElement("div");e.appendChild(t);var r=document.createElement("div");r.id=this.getDashboardSectionCameraScanRegionId(),r.style.display=th.isCameraScanType(this.currentScanType)?"block":"none",t.appendChild(r);var n=document.createElement("div");n.style.textAlign="center",r.appendChild(n),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(r,n),this.renderFileScanUi(t)},e.prototype.renderFileScanUi=function(e){var t=th.isFileScanType(this.currentScanType),r=this;this.fileSelectionUi=ty.create(e,t,function(e){if(!r.html5Qrcode)throw"html5Qrcode not defined";th.isFileScanType(r.currentScanType)&&(r.setHeaderMessage(eO.loadingImage()),r.html5Qrcode.scanFileV2(e,!0).then(function(e){r.resetHeaderMessage(),r.qrCodeSuccessCallback(e.decodedText,e)}).catch(function(e){r.setHeaderMessage(e,O.STATUS_WARNING),r.qrCodeErrorCallback(e,eN.createFrom(e))}))})},e.prototype.renderCameraSelection=function(e){var t,r=this,n=this,i=document.getElementById(this.getDashboardSectionCameraScanRegionId());i.style.textAlign="center";var s=tE.create(i,!1),a=function(e){var t=e.zoomFeature();if(t.isSupported()){s.setOnCameraZoomValueChangeCallback(function(e){t.apply(e)});var n,i,a,o=1;r.config.defaultZoomValueIfSupported&&(o=r.config.defaultZoomValueIfSupported),n=o,i=t.min(),o=n>(a=t.max())?a:n<i?i:n,s.setValues(t.min(),t.max(),o,t.step()),s.show()}},o=tw.create(i,e),l=document.createElement("span"),u=td.createElement("button",tc.CAMERA_START_BUTTON_ID);u.innerText=eO.scanButtonStartScanningText(),l.appendChild(u);var h=td.createElement("button",tc.CAMERA_STOP_BUTTON_ID);h.innerText=eO.scanButtonStopScanningText(),h.style.display="none",h.disabled=!0,l.appendChild(h);var c=function(e){if(!e.torchFeature().isSupported()){t&&t.hide();return}t?t.updateTorchCapability(e.torchFeature()):t=tm.create(l,e.torchFeature(),{display:"none",marginLeft:"5px"},function(e){n.setHeaderMessage(e,O.STATUS_WARNING)}),t.show()};i.appendChild(l);var d=function(e){e||(u.style.display="none"),u.innerText=eO.scanButtonStartScanningText(),u.style.opacity="1",u.disabled=!1,e&&(u.style.display="inline-block")};if(u.addEventListener("click",function(e){u.innerText=eO.scanButtonScanningStarting(),o.disable(),u.disabled=!0,u.style.opacity="0.5",r.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!1),n.resetHeaderMessage();var t,i=o.getValue();n.persistedDataManager.setLastUsedCameraId(i),n.html5Qrcode.start(i,{fps:(t=n.config).fps,qrbox:t.qrbox,aspectRatio:t.aspectRatio,disableFlip:t.disableFlip,videoConstraints:t.videoConstraints},n.qrCodeSuccessCallback,n.qrCodeErrorCallback).then(function(e){h.disabled=!1,h.style.display="inline-block",d(!1);var t=n.html5Qrcode.getRunningTrackCameraCapabilities();!0===r.config.showTorchButtonIfSupported&&c(t),!0===r.config.showZoomSliderIfSupported&&a(t)}).catch(function(e){n.showHideScanTypeSwapLink(!0),o.enable(),d(!0),n.setHeaderMessage(e,O.STATUS_WARNING)})}),o.hasSingleItem()&&u.click(),h.addEventListener("click",function(e){if(!n.html5Qrcode)throw"html5Qrcode not defined";h.disabled=!0,n.html5Qrcode.stop().then(function(e){r.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!0),o.enable(),u.disabled=!1,h.style.display="none",u.style.display="inline-block",t&&(t.reset(),t.hide()),s.removeOnCameraZoomValueChangeCallback(),s.hide(),n.insertCameraScanImageToScanRegion()}).catch(function(e){h.disabled=!1,n.setHeaderMessage(e,O.STATUS_WARNING)})}),n.persistedDataManager.getLastUsedCameraId()){var f=n.persistedDataManager.getLastUsedCameraId();o.hasValue(f)?(o.setValue(f),u.click()):n.persistedDataManager.resetLastUsedCameraId()}},e.prototype.createSectionSwap=function(){var e=this,t=eO.textIfCameraScanSelected(),r=eO.textIfFileScanSelected(),n=document.getElementById(this.getDashboardSectionId()),i=document.createElement("div");i.style.textAlign="center";var s=td.createElement("span",this.getDashboardSectionSwapLinkId());s.style.textDecoration="underline",s.style.cursor="pointer",s.innerText=th.isCameraScanType(this.currentScanType)?t:r,s.addEventListener("click",function(){if(!e.sectionSwapAllowed){e.verbose&&e.logger.logError("Section swap called when not allowed");return}e.resetHeaderMessage(),e.fileSelectionUi.resetValue(),e.sectionSwapAllowed=!1,th.isCameraScanType(e.currentScanType)?(e.clearScanRegion(),e.getCameraScanRegion().style.display="none",e.fileSelectionUi.show(),s.innerText=r,e.currentScanType=D.SCAN_TYPE_FILE,e.insertFileScanImageToScanRegion()):(e.clearScanRegion(),e.getCameraScanRegion().style.display="block",e.fileSelectionUi.hide(),s.innerText=t,e.currentScanType=D.SCAN_TYPE_CAMERA,e.insertCameraScanImageToScanRegion(),e.startCameraScanIfPermissionExistsOnSwap()),e.sectionSwapAllowed=!0}),i.appendChild(s),n.appendChild(i)},e.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var e=this,t=this;if(this.persistedDataManager.hasCameraPermissions())return void tu.hasPermissions().then(function(r){if(r){var n=document.getElementById(t.getCameraPermissionButtonId());if(!n)throw e.logger.logError("Permission button not found, fail;"),"Permission button not found";n.click()}else t.persistedDataManager.setHasPermission(!1)}).catch(function(e){t.persistedDataManager.setHasPermission(!1)})},e.prototype.resetHeaderMessage=function(){document.getElementById(this.getHeaderMessageContainerId()).style.display="none"},e.prototype.setHeaderMessage=function(e,t){t||(t=O.STATUS_DEFAULT);var r=this.getHeaderMessageDiv();switch(r.innerText=e,r.style.display="block",t){case O.STATUS_SUCCESS:r.style.background="rgba(106, 175, 80, 0.26)",r.style.color="#477735";break;case O.STATUS_WARNING:r.style.background="rgba(203, 36, 49, 0.14)",r.style.color="#cb2431";break;case O.STATUS_DEFAULT:default:r.style.background="rgba(0, 0, 0, 0)",r.style.color="rgb(17, 17, 17)"}},e.prototype.showHideScanTypeSwapLink=function(e){this.scanTypeSelector.hasMoreThanOneScanType()&&(!0!==e&&(e=!1),this.sectionSwapAllowed=e,this.getDashboardSectionSwapLink().style.display=e?"inline-block":"none")},e.prototype.insertCameraScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.cameraScanImage){t.innerHTML="<br>",t.appendChild(this.cameraScanImage);return}this.cameraScanImage=new Image,this.cameraScanImage.onload=function(r){t.innerHTML="<br>",t.appendChild(e.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=te,this.cameraScanImage.alt=eO.cameraScanAltText()},e.prototype.insertFileScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.fileScanImage){t.innerHTML="<br>",t.appendChild(this.fileScanImage);return}this.fileScanImage=new Image,this.fileScanImage.onload=function(r){t.innerHTML="<br>",t.appendChild(e.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=tt,this.fileScanImage.alt=eO.fileScanAltText()},e.prototype.clearScanRegion=function(){document.getElementById(this.getScanRegionId()).innerHTML=""},e.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},e.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},e.prototype.getDashboardSectionSwapLinkId=function(){return tc.SCAN_TYPE_CHANGE_ANCHOR_ID},e.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},e.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},e.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},e.prototype.getCameraPermissionButtonId=function(){return tc.CAMERA_PERMISSION_BUTTON_ID},e.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},e.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},e.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},e}();function tI({onDetected:e,onClose:t}){(0,eu.useRef)(null);let[r,n]=(0,eu.useState)(null);return(0,eu.useEffect)(()=>{let t=new tC("reader",{fps:10,qrbox:{width:250,height:250},aspectRatio:1},!1);return t.render(function(r,n){console.log(`Scan result: ${r}`,n),t&&t.clear().catch(e=>console.error(e)),e(r)},function(e){}),n(t),()=>{t&&t.clear().catch(e=>console.error("Failed to clear scanner",e))}},[]),(0,el.jsxs)("div",{className:"fixed inset-0 z-[60] bg-black text-white flex flex-col",children:[(0,el.jsxs)("div",{className:"flex justify-between items-center p-4",children:[(0,el.jsx)("h3",{className:"font-bold text-lg",children:"Scan Barcode"}),(0,el.jsx)("button",{onClick:t,className:"p-2 bg-gray-800 rounded-full",children:(0,el.jsx)(eE,{size:24})})]}),(0,el.jsx)("div",{id:"reader",className:"w-full flex-1"}),(0,el.jsx)("p",{className:"p-4 text-center text-sm text-gray-400",children:"Point camera at a barcode to scan."})]})}var t_=e.i(2032);(d=x||(x={})).STRING="string",d.NUMBER="number",d.INTEGER="integer",d.BOOLEAN="boolean",d.ARRAY="array",d.OBJECT="object",(f=L||(L={})).LANGUAGE_UNSPECIFIED="language_unspecified",f.PYTHON="python",(g=P||(P={})).OUTCOME_UNSPECIFIED="outcome_unspecified",g.OUTCOME_OK="outcome_ok",g.OUTCOME_FAILED="outcome_failed",g.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let tA=["user","model","function","system"];(p=k||(k={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",p.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",p.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",p.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",p.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",p.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(m=B||(B={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",m.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",m.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",m.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",m.BLOCK_NONE="BLOCK_NONE",(y=F||(F={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",y.NEGLIGIBLE="NEGLIGIBLE",y.LOW="LOW",y.MEDIUM="MEDIUM",y.HIGH="HIGH",(w=U||(U={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",w.SAFETY="SAFETY",w.OTHER="OTHER",(E=V||(V={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",E.STOP="STOP",E.MAX_TOKENS="MAX_TOKENS",E.SAFETY="SAFETY",E.RECITATION="RECITATION",E.LANGUAGE="LANGUAGE",E.BLOCKLIST="BLOCKLIST",E.PROHIBITED_CONTENT="PROHIBITED_CONTENT",E.SPII="SPII",E.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",E.OTHER="OTHER",(C=j||(j={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",C.RETRIEVAL_QUERY="RETRIEVAL_QUERY",C.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",C.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",C.CLASSIFICATION="CLASSIFICATION",C.CLUSTERING="CLUSTERING",(I=z||(z={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",I.AUTO="AUTO",I.ANY="ANY",I.NONE="NONE",(_=H||(H={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",_.MODE_DYNAMIC="MODE_DYNAMIC";class tS extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class tT extends tS{constructor(e,t){super(e),this.response=t}}class tb extends tS{constructor(e,t,r,n){super(e),this.status=t,this.statusText=r,this.errorDetails=n}}class tv extends tS{}class tN extends tS{}(A=G||(G={})).GENERATE_CONTENT="generateContent",A.STREAM_GENERATE_CONTENT="streamGenerateContent",A.COUNT_TOKENS="countTokens",A.EMBED_CONTENT="embedContent",A.BATCH_EMBED_CONTENTS="batchEmbedContents";class tD{constructor(e,t,r,n,i){this.model=e,this.task=t,this.apiKey=r,this.stream=n,this.requestOptions=i}toString(){var e,t;let r=(null==(e=this.requestOptions)?void 0:e.apiVersion)||"v1beta",n=(null==(t=this.requestOptions)?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",i=`${n}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}async function tR(e){var t,r;let n,i=new Headers;i.append("Content-Type","application/json"),i.append("x-goog-api-client",(r=e.requestOptions,n=[],(null==r?void 0:r.apiClient)&&n.push(r.apiClient),n.push("genai-js/0.24.1"),n.join(" "))),i.append("x-goog-api-key",e.apiKey);let s=null==(t=e.requestOptions)?void 0:t.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(e){throw new tv(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${e.message}`)}for(let[e,t]of s.entries()){if("x-goog-api-key"===e)throw new tv(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new tv(`Header name ${e} can only be set using the apiClient field`);i.append(e,t)}}return i}async function tM(e,t,r,n,i,s){let a=new tD(e,t,r,n,s);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let r=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>r.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{r.abort()}),t.signal=r.signal}return t}(s)),{method:"POST",headers:await tR(a),body:i})}}async function tO(e,t,r,n,i,s={},a=fetch){let{url:o,fetchOptions:l}=await tM(e,t,r,n,i,s);return tx(o,l,a)}async function tx(e,t,r=fetch){let n;try{n=await r(e,t)}catch(r){var i=r,s=e;let t=i;throw"AbortError"===t.name?(t=new tN(`Request aborted when fetching ${s.toString()}: ${i.message}`)).stack=i.stack:i instanceof tb||i instanceof tv||((t=new tS(`Error fetching from ${s.toString()}: ${i.message}`)).stack=i.stack),t}return n.ok||await tL(n,e),n}async function tL(e,t){let r,n="";try{let t=await e.json();n=t.error.message,t.error.details&&(n+=` ${JSON.stringify(t.error.details)}`,r=t.error.details)}catch(e){}throw new tb(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,r)}function tP(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),tF(e.candidates[0]))throw new tT(`${tU(e)}`,e);return function(e){var t,r,n,i;let s=[];if(null==(r=null==(t=e.candidates)?void 0:t[0].content)?void 0:r.parts)for(let t of null==(i=null==(n=e.candidates)?void 0:n[0].content)?void 0:i.parts)t.text&&s.push(t.text),t.executableCode&&s.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&s.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}(e)}if(e.promptFeedback)throw new tT(`Text not available. ${tU(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),tF(e.candidates[0]))throw new tT(`${tU(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),tk(e)[0]}if(e.promptFeedback)throw new tT(`Function call not available. ${tU(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),tF(e.candidates[0]))throw new tT(`${tU(e)}`,e);return tk(e)}if(e.promptFeedback)throw new tT(`Function call not available. ${tU(e)}`,e)},e}function tk(e){var t,r,n,i;let s=[];if(null==(r=null==(t=e.candidates)?void 0:t[0].content)?void 0:r.parts)for(let t of null==(i=null==(n=e.candidates)?void 0:n[0].content)?void 0:i.parts)t.functionCall&&s.push(t.functionCall);return s.length>0?s:void 0}let tB=[V.RECITATION,V.SAFETY,V.LANGUAGE];function tF(e){return!!e.finishReason&&tB.includes(e.finishReason)}function tU(e){var t,r,n;let i="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)i+="Response was blocked",(null==(t=e.promptFeedback)?void 0:t.blockReason)&&(i+=` due to ${e.promptFeedback.blockReason}`),(null==(r=e.promptFeedback)?void 0:r.blockReasonMessage)&&(i+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null==(n=e.candidates)?void 0:n[0]){let t=e.candidates[0];tF(t)&&(i+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(i+=`: ${t.finishMessage}`))}return i}function tV(e){return this instanceof tV?(this.v=e,this):new tV(e)}"function"==typeof SuppressedError&&SuppressedError;let tj=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function tz(e){let t=[],r=e.getReader();for(;;){let{done:e,value:n}=await r.read();if(e)return tP(function(e){let t=e[e.length-1],r={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let n of t.candidates)if(r.candidates||(r.candidates=[]),r.candidates[e]||(r.candidates[e]={index:e}),r.candidates[e].citationMetadata=n.citationMetadata,r.candidates[e].groundingMetadata=n.groundingMetadata,r.candidates[e].finishReason=n.finishReason,r.candidates[e].finishMessage=n.finishMessage,r.candidates[e].safetyRatings=n.safetyRatings,n.content&&n.content.parts){r.candidates[e].content||(r.candidates[e].content={role:n.content.role||"user",parts:[]});let t={};for(let i of n.content.parts)i.text&&(t.text=i.text),i.functionCall&&(t.functionCall=i.functionCall),i.executableCode&&(t.executableCode=i.executableCode),i.codeExecutionResult&&(t.codeExecutionResult=i.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),r.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(r.usageMetadata=t.usageMetadata)}return r}(t));t.push(n)}}async function tH(e,t,r,n){return function(e){let t,[r,n]=(t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(e){let r="";return function n(){return t.read().then(({value:t,done:i})=>{let s;if(i)return r.trim()?void e.error(new tS("Failed to parse stream")):void e.close();let a=(r+=t).match(tj);for(;a;){try{s=JSON.parse(a[1])}catch(t){e.error(new tS(`Error parsing JSON response: "${a[1]}"`));return}e.enqueue(s),a=(r=r.substring(a[0].length)).match(tj)}return n()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new tN("Request aborted when reading from the stream"):new tS("Error reading from the stream")})}()}})).tee();return{stream:function(e){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){i[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||o(e,t)})})}function o(e,t){try{var r;(r=i[e](t)).value instanceof tV?Promise.resolve(r.value.v).then(l,u):h(s[0][2],r)}catch(e){h(s[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function h(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:r}=yield tV(t.read());if(r)break;yield yield tV(tP(e))}})}(r),response:tz(n)}}(await tO(t,G.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(r),n))}async function tG(e,t,r,n){let i=await tO(t,G.GENERATE_CONTENT,e,!1,JSON.stringify(r),n);return{response:tP(await i.json())}}function tq(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)if(!e.role)return{role:"system",parts:e.parts};else return e}}function tW(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let r of e)"string"==typeof r?t.push({text:r}):t.push(r);var r=t;let n={role:"user",parts:[]},i={role:"function",parts:[]},s=!1,a=!1;for(let e of r)"functionResponse"in e?(i.parts.push(e),a=!0):(n.parts.push(e),s=!0);if(s&&a)throw new tS("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!a)throw new tS("No content is provided for sending chat message.");return s?n:i}function tY(e){let t;return t=e.contents?e:{contents:[tW(e)]},e.systemInstruction&&(t.systemInstruction=tq(e.systemInstruction)),t}let tK=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],tX={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function tQ(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let r=null==(t=e.candidates[0])?void 0:t.content;if(void 0===r||void 0===r.parts||0===r.parts.length)return!1;for(let e of r.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let t$="SILENT_ERROR";class tZ{constructor(e,t,r,n={}){this.model=t,this.params=r,this._requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==r?void 0:r.history)&&(!function(e){let t=!1;for(let r of e){let{role:e,parts:n}=r;if(!t&&"user"!==e)throw new tS(`First content should be with role 'user', got ${e}`);if(!tA.includes(e))throw new tS(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(tA)}`);if(!Array.isArray(n))throw new tS("Content should have 'parts' property with an array of Parts");if(0===n.length)throw new tS("Each Content should have at least one part");let i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of n)for(let t of tK)t in e&&(i[t]+=1);let s=tX[e];for(let t of tK)if(!s.includes(t)&&i[t]>0)throw new tS(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,n,i,s,a,o;let l;await this._sendPromise;let u=tW(e),h={safetySettings:null==(r=this.params)?void 0:r.safetySettings,generationConfig:null==(n=this.params)?void 0:n.generationConfig,tools:null==(i=this.params)?void 0:i.tools,toolConfig:null==(s=this.params)?void 0:s.toolConfig,systemInstruction:null==(a=this.params)?void 0:a.systemInstruction,cachedContent:null==(o=this.params)?void 0:o.cachedContent,contents:[...this._history,u]},c=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>tG(this._apiKey,this.model,h,c)).then(e=>{var t;if(tQ(e.response)){this._history.push(u);let r=Object.assign({parts:[],role:"model"},null==(t=e.response.candidates)?void 0:t[0].content);this._history.push(r)}else{let t=tU(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var r,n,i,s,a,o;await this._sendPromise;let l=tW(e),u={safetySettings:null==(r=this.params)?void 0:r.safetySettings,generationConfig:null==(n=this.params)?void 0:n.generationConfig,tools:null==(i=this.params)?void 0:i.tools,toolConfig:null==(s=this.params)?void 0:s.toolConfig,systemInstruction:null==(a=this.params)?void 0:a.systemInstruction,cachedContent:null==(o=this.params)?void 0:o.cachedContent,contents:[...this._history,l]},h=Object.assign(Object.assign({},this._requestOptions),t),c=tH(this._apiKey,this.model,u,h);return this._sendPromise=this._sendPromise.then(()=>c).catch(e=>{throw Error(t$)}).then(e=>e.response).then(e=>{if(tQ(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=tU(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==t$&&console.error(e)}),c}}async function tJ(e,t,r,n){return(await tO(t,G.COUNT_TOKENS,e,!1,JSON.stringify(r),n)).json()}async function t1(e,t,r,n){return(await tO(t,G.EMBED_CONTENT,e,!1,JSON.stringify(r),n)).json()}async function t0(e,t,r,n){let i=r.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await tO(t,G.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:i}),n)).json()}class t2{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=tq(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;let n=tY(e),i=Object.assign(Object.assign({},this._requestOptions),t);return tG(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(r=this.cachedContent)?void 0:r.name},n),i)}async generateContentStream(e,t={}){var r;let n=tY(e),i=Object.assign(Object.assign({},this._requestOptions),t);return tH(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(r=this.cachedContent)?void 0:r.name},n),i)}startChat(e){var t;return new tZ(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(t=this.cachedContent)?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let r=function(e,t){var r;let n={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null==(r=null==t?void 0:t.cachedContent)?void 0:r.name,contents:[]},i=null!=e.generateContentRequest;if(e.contents){if(i)throw new tv("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=e.contents}else if(i)n=Object.assign(Object.assign({},n),e.generateContentRequest);else{let t=tW(e);n.contents=[t]}return{generateContentRequest:n}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),n=Object.assign(Object.assign({},this._requestOptions),t);return tJ(this.apiKey,this.model,r,n)}async embedContent(e,t={}){let r="string"==typeof e||Array.isArray(e)?{content:tW(e)}:e,n=Object.assign(Object.assign({},this._requestOptions),t);return t1(this.apiKey,this.model,r,n)}async batchEmbedContents(e,t={}){let r=Object.assign(Object.assign({},this._requestOptions),t);return t0(this.apiKey,this.model,e,r)}}let t3=new class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new tS("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new t2(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new tv("Cached content must contain a `name` field.");if(!e.model)throw new tv("Cached content must contain a `model` field.");for(let r of["model","systemInstruction"])if((null==t?void 0:t[r])&&e[r]&&(null==t?void 0:t[r])!==e[r]){if("model"===r&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new tv(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${e[r]})`)}let n=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new t2(this.apiKey,n,r)}}("AIzaSyDb0049K3rxp946cyUiLqZRty-A7MBXYCI");async function t4(e,t="image/jpeg"){try{let r=t3.getGenerativeModel({model:"gemini-flash-latest"}),n=`
        Analizza questa immagine di cibo e fornisci i seguenti dati nutrizionali stimati in formato JSON puro (senza markdown, senza backticks).
        Identifica il piatto principale o i piatti presenti.
        
        Rispondi ESCLUSIVAMENTE con un oggetto JSON con questa struttura:
        {
            "name": "Nome del piatto",
            "quantity": quantit\xe0 in grammi (numero intero stimato),
            "calories": calorie totali (numero intero),
            "protein": proteine in grammi (numero intero),
            "carbs": carboidrati in grammi (numero intero),
            "fat": grassi in grammi (numero intero),
            "analysis": "Breve descrizione nutrizionale e commenti sulla salubrit\xe0 del pasto (max 2 frasi, in italiano)"
        }
        `,i=await r.generateContent([n,{inlineData:{data:e,mimeType:t}}]),s=(await i.response).text();console.log("--- RAW GEMINI RESPONSE ---"),console.log(s),console.log("---------------------------");let a=s.replace(/```json/gi,"").replace(/```/g,"").trim(),o=a.indexOf("{"),l=a.lastIndexOf("}");-1!==o&&-1!==l&&(a=a.substring(o,l+1));try{return JSON.parse(a)}catch(e){throw console.error("JSON Parse Error:",e),console.error("Failed to parse text:",a),Error("Invalid JSON response from AI")}}catch(e){throw console.error("Gemini Analysis Error:",e),e}}let t6=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},t8=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},t5={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(t6(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):t8(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new t7;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class t7 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let t9=function(e){let t=t6(e);return t5.encodeByteArray(t,!0)},re=function(e){return t9(e).replace(/\./g,"")},rt=function(e){try{return t5.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function rr(){return"u">typeof self?self:"u">typeof window?window:e.g}let rn=()=>{try{return rr().__FIREBASE_DEFAULTS__||(()=>{if(void 0===t_.default||void 0===t_.default.env)return;let e=t_.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&rt(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},ri=e=>{let t=rn()?.emulatorHosts?.[e];if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},rs=()=>rn()?.config;class ra{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function ro(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function rl(e){return(await fetch(e,{credentials:"include"})).ok}function ru(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[re(JSON.stringify({alg:"none",type:"JWT"})),re(JSON.stringify(s)),""].join(".")}let rh={},rc=!1;function rd(e,t){if("u"<typeof window||"u"<typeof document||!ro(window.location.host)||rh[e]===t||rh[e]||rc)return;function r(e){return`__firebase__banner__${e}`}rh[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(rh))rh[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=r("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;rc=!0,(e=document.getElementById(n))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function rf(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function rg(){let t=rn()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function rp(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function rm(){return!rg()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ry(){return!rg()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function rw(){try{return"object"==typeof indexedDB}catch(e){return!1}}class rE extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,rE.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,rC.prototype.create)}}class rC{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(rI,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new rE(s,l,i)}}let rI=/\{\$([^}]+)}/g;function r_(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(rA(r)&&rA(s)){if(!r_(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function rA(e){return null!==e&&"object"==typeof e}function rS(e){return e&&e._delegate?e._delegate:e}class rT{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let rb="[DEFAULT]";class rv{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new ra;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:rb})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=rb){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=rb){return this.instances.has(e)}getOptions(e=rb){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===rb?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=rb){return this.component?this.component.multipleInstances?e:rb:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class rN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new rv(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let rD=[];(S=q||(q={}))[S.DEBUG=0]="DEBUG",S[S.VERBOSE=1]="VERBOSE",S[S.INFO=2]="INFO",S[S.WARN=3]="WARN",S[S.ERROR=4]="ERROR",S[S.SILENT=5]="SILENT";let rR={debug:q.DEBUG,verbose:q.VERBOSE,info:q.INFO,warn:q.WARN,error:q.ERROR,silent:q.SILENT},rM=q.INFO,rO={[q.DEBUG]:"log",[q.VERBOSE]:"log",[q.INFO]:"info",[q.WARN]:"warn",[q.ERROR]:"error"},rx=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=rO[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class rL{constructor(e){this.name=e,this._logLevel=rM,this._logHandler=rx,this._userLogHandler=null,rD.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in q))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?rR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,q.DEBUG,...e),this._logHandler(this,q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,q.VERBOSE,...e),this._logHandler(this,q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,q.INFO,...e),this._logHandler(this,q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,q.WARN,...e),this._logHandler(this,q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,q.ERROR,...e),this._logHandler(this,q.ERROR,...e)}}let rP=new WeakMap,rk=new WeakMap,rB=new WeakMap,rF=new WeakMap,rU=new WeakMap,rV={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return rk.get(e);if("objectStoreNames"===t)return e.objectStoreNames||rB.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return rj(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function rj(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(rj(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&rP.set(t,e)}).catch(()=>{}),rU.set(t,e),t}if(rF.has(e))return rF.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(rz(this),t),rj(rP.get(this))}:function(...t){return rj(e.apply(rz(this),t))}:function(t,...r){let n=e.call(rz(this),t,...r);return rB.set(n,t.sort?t.sort():[t]),rj(n)};return e instanceof IDBTransaction&&function(e){if(rk.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});rk.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,rV):e}(e);return n!==e&&(rF.set(e,n),rU.set(n,e)),n}let rz=e=>rU.get(e),rH=["get","getKey","getAll","getAllKeys","count"],rG=["put","add","delete","clear"],rq=new Map;function rW(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(rq.get(t))return rq.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=rG.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||rH.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return rq.set(t,s),s}rV={...n=rV,get:(e,t,r)=>rW(e,t)||n.get(e,t,r),has:(e,t)=>!!rW(e,t)||n.has(e,t)};class rY{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let rK="@firebase/app",rX="0.14.7",rQ=new rL("@firebase/app"),r$="[DEFAULT]",rZ={[rK]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},rJ=new Map,r1=new Map,r0=new Map;function r2(e,t){try{e.container.addComponent(t)}catch(r){rQ.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function r3(e,t){e.container.addOrOverwriteComponent(t)}function r4(e){let t=e.name;if(r0.has(t))return rQ.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(r0.set(t,e),rJ.values()))r2(r,e);for(let t of r1.values())r2(t,e);return!0}function r6(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function r8(e,t,r=r$){r6(e,t).clearInstance(r)}function r5(e){return void 0!==e.options}function r7(e){return!r5(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function r9(e){return null!=e&&void 0!==e.settings}function ne(){r0.clear()}let nt=new rC("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class nr{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new rT("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw nt.create("app-deleted",{appName:this._name})}}function nn(e,t){let r=rt(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class ni extends nr{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&nn(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&nn(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,nc(rK,rX,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){nh(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw nt.create("server-app-deleted")}}let ns="12.8.0";function na(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:r$,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw nt.create("bad-app-name",{appName:String(i)});if(r||(r=rs()),!r)throw nt.create("no-options");let s=rJ.get(i);if(s)if(r_(r,s.options)&&r_(n,s.config))return s;else throw nt.create("duplicate-app",{appName:i});let a=new rN(i);for(let e of r0.values())a.addComponent(e);let o=new nr(r,n,a);return rJ.set(i,o),o}function no(e,t={}){let r;if(("u">typeof window||rp())&&!rp())throw nt.create("invalid-server-app-environment");let n=t||{};if(e&&(r5(e)?r=e.options:r7(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=rs()),!r)throw nt.create("no-options");let i={...n,...r};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw nt.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=r1.get(s);if(a)return a.incRefCount(n.releaseOnDeref),a;let o=new rN(s);for(let e of r0.values())o.addComponent(e);let l=new ni(r,n,s,o);return r1.set(s,l),l}function nl(e=r$){let t=rJ.get(e);if(!t&&e===r$&&rs())return na();if(!t)throw nt.create("no-app",{appName:e});return t}function nu(){return Array.from(rJ.values())}async function nh(e){let t=!1,r=e.name;rJ.has(r)?(t=!0,rJ.delete(r)):r1.has(r)&&0>=e.decRefCount()&&(r1.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function nc(e,t,r){let n=rZ[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),rQ.warn(e.join(" "));return}r4(new rT(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function nd(e,t){if(null!==e&&"function"!=typeof e)throw nt.create("invalid-log-argument");for(let r of rD){let n=null;t&&t.level&&(n=rR[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:q[r].toLowerCase(),message:s,args:i,type:t.name})}}}function nf(e){rD.forEach(t=>{t.setLogLevel(e)})}let ng="firebase-heartbeat-store",np=null;function nm(){return np||(np=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=rj(a);return n&&a.addEventListener("upgradeneeded",e=>{n(rj(a.result),e.oldVersion,e.newVersion,rj(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ng)}catch(e){console.warn(e)}}}).catch(e=>{throw nt.create("idb-open",{originalErrorMessage:e.message})})),np}async function ny(e){try{let t=(await nm()).transaction(ng),r=await t.objectStore(ng).get(nE(e));return await t.done,r}catch(e){if(e instanceof rE)rQ.warn(e.message);else{let t=nt.create("idb-get",{originalErrorMessage:e?.message});rQ.warn(t.message)}}}async function nw(e,t){try{let r=(await nm()).transaction(ng,"readwrite"),n=r.objectStore(ng);await n.put(t,nE(e)),await r.done}catch(e){if(e instanceof rE)rQ.warn(e.message);else{let t=nt.create("idb-set",{originalErrorMessage:e?.message});rQ.warn(t.message)}}}function nE(e){return`${e.name}!${e.options.appId}`}class nC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new n_(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=nI();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){rQ.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=nI(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),nA(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),nA(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=re(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return rQ.warn(e),""}}}function nI(){return new Date().toISOString().substring(0,10)}class n_{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!rw()&&new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await ny(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return nw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return nw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function nA(e){return re(JSON.stringify({version:2,heartbeats:e})).length}r4(new rT("platform-logger",e=>new rY(e),"PRIVATE")),r4(new rT("heartbeat",e=>new nC(e),"PRIVATE")),nc(rK,rX,""),nc(rK,rX,"esm2020"),nc("fire-js",""),e.s(["SDK_VERSION",()=>ns,"_DEFAULT_ENTRY_NAME",()=>r$,"_addComponent",()=>r2,"_addOrOverwriteComponent",()=>r3,"_apps",()=>rJ,"_clearComponents",()=>ne,"_components",()=>r0,"_getProvider",()=>r6,"_isFirebaseApp",()=>r5,"_isFirebaseServerApp",()=>r9,"_isFirebaseServerAppSettings",()=>r7,"_registerComponent",()=>r4,"_removeServiceInstance",()=>r8,"_serverApps",()=>r1,"deleteApp",()=>nh,"getApp",()=>nl,"getApps",()=>nu,"initializeApp",()=>na,"initializeServerApp",()=>no,"onLog",()=>nd,"registerVersion",()=>nc,"setLogLevel",()=>nf],68020),nc("firebase","12.8.0","app"),e.i(68020);var nS=e.i(45749),nT="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,nb={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var s,a={};function o(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return g(l(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var u=o(0),h=o(1),c=o(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function g(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(h)}function p(e,t){return e.add(g(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function w(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(u,u);if(f(e))return t=w(g(e),t),new y(g(t.g),g(t.h));if(f(t))return t=w(e,g(t)),new y(g(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=h,n=t;0>=n.l(e);)r=E(r),n=E(n);var i=C(r,1),s=C(n,1);for(n=C(n,2),r=C(r,2);!d(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=C(n,1),r=C(r,1)}return t=p(e,i.j(t)),new y(i,t)}for(i=u;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=l(r)).j(t);f(a)||a.l(e)>0;)r-=n,a=(s=l(r)).j(t);d(s)&&(s=h),i=i.add(s),e=p(e,a)}return new y(i,e)}function E(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function C(e,t){let r=t>>5;t%=32;let n=e.g.length-r,s=[];for(let i=0;i<n;i++)s[i]=t>0?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(f(this))return-g(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+g(this).toString(e);let t=l(Math.pow(e,6));var r=this;let n="";for(;;){let i=w(r,t).g,s=(((r=p(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(d(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=p(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?g(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return u;if(f(this))return f(e)?g(this).j(g(e)):g(g(this).j(e));if(f(e))return g(this.j(g(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,m(r,2*n+2*t),r[2*n+2*t+1]+=i*o,m(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,m(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,m(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new i(r,0)},s.B=function(e){return w(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,Y=nb.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=l(Math.pow(r,8)),i=u;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=l(Math.pow(r,s)),i=i.j(s).add(l(a))):i=(i=i.j(n)).add(l(a))}return i},W=nb.Integer=i}).apply(void 0!==nT?nT:"u">typeof self?self:"u">typeof window?window:{});var nv="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,nN={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof nv&&nv];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,r){return e.call.apply(e.bind,arguments)}function u(e,t,r){return(u=l).apply(null,arguments)}function h(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function c(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var d="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function f(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function g(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var p=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new m,e=>e.reset());class m{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,w=!1,E=new class{constructor(){this.h=this.g=null}add(e,t){let r=p.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},C=()=>{let e=Promise.resolve(void 0);y=()=>{e.then(I)}};function I(){let e;for(var t;e=null,E.g&&(e=E.g,E.g=E.g.next,E.g||(E.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}p.j(t),p.h<100&&(p.h++,t.next=p.g,p.g=t)}w=!1}function _(){this.u=this.u,this.C=this.C}function A(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}_.prototype.u=!1,_.prototype.dispose=function(){this.u||(this.u=!0,this.N())},_.prototype[Symbol.dispose]=function(){this.dispose()},_.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},A.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function T(e){return/^[\s\xa0]*$/.test(e)}function b(e,t){A.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}c(b,A),b.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&b.Z.h.call(this)},b.prototype.h=function(){b.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var v="closure_listenable_"+(1e6*Math.random()|0),N=0;function D(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++N,this.da=this.fa=!1}function R(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function M(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function O(e){let t={};for(let r in e)t[r]=e[r];return t}let x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<x.length;t++)r=x[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function P(e){this.src=e,this.g={},this.h=0}function k(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(R(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function B(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}P.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=B(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new D(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var F="closure_lm_"+(1e6*Math.random()|0),U={};function V(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=G(e);if(l||(e[F]=l=new P(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return H.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)S||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(z(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function j(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[v])k(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(z(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=G(t))?(k(r,e),0==r.h&&(r.src=null,t[F]=null)):R(e)}}}function z(e){return e in U?U[e]:U[e]="on"+e}function H(e,t){if(e.da)e=!0;else{t=new b(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&j(e),e=r.call(n,t)}return e}function G(e){return(e=e[F])instanceof P?e:null}var q="__closure_events_fn_"+(1e9*Math.random()>>>0);function W(e){return"function"==typeof e?e:(e[q]||(e[q]=function(t){return e.handleEvent(t)}),e[q])}function Y(){_.call(this),this.i=new P(this),this.M=this,this.G=null}function er(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new A(t,e);else if(t instanceof A)t.target=t.target||e;else{var a=t;L(t=new A(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=en(r=t.g=i[n],s,!0,t)&&a;if(a=en(r=t.g=e,s,!0,t)&&a,a=en(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=en(r=t.g=i[n],s,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&k(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}c(Y,_),Y.prototype[v]=!0,Y.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=o(i)?!!i.capture:!!i,n=W(n),t&&t[v])?(t=t.i,(a=String(r).toString())in t.g&&(n=B(r=t.g[a],n,i,s))>-1&&(R(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=G(t))&&(r=t.g[r.toString()],t=-1,r&&(t=B(r,n,i,s)),(n=t>-1?r[t]:null)&&j(n))}(this,e,t,r,n)},Y.prototype.N=function(){if(Y.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)R(r[e]);delete e.g[t],e.h--}}this.G=null},Y.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},Y.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ei extends _{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=u(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){_.call(this),this.h=e,this.g={}}c(es,_);var ea=[];function eo(e){M(e.g,function(e,t){this.g.hasOwnProperty(t)&&j(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eu=a.JSON.parse,eh=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function eg(){A.call(this,"d")}function ep(){A.call(this,"c")}c(eg,A),c(ep,A);var em={},ey=null;function ew(){return ey=ey||new Y}function eE(e){A.call(this,em.Ia,e)}function eC(e){let t=ew();er(t,new eE(t))}function eI(e,t){A.call(this,em.STAT_EVENT,e),this.stat=t}function e_(e){let t=ew();er(t,new eI(t,e))}function eA(e,t){A.call(this,em.Ja,e),this.size=t}function eS(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eT(){this.g=!0}function eb(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}em.Ia="serverreachability",c(eE,A),em.STAT_EVENT="statevent",c(eI,A),em.Ja="timingevent",c(eA,A),eT.prototype.ua=function(){this.g=!1},eT.prototype.info=function(){};var ev={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eN={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eD(){}function eR(e){return encodeURIComponent(String(e))}function eM(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eO}function eO(){this.i=null,this.g="",this.h=!1}c(eD,ec),eD.prototype.g=function(){return new XMLHttpRequest},e=new eD;var ex={},eL={};function eP(e,t,r){e.M=1,e.A=e6(e1(t)),e.u=r,e.R=!0,ek(e,null)}function ek(e,t){e.F=Date.now(),eF(e),e.B=e1(e.A);var r,n,i,s,a,l,h=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),tu(h.i,"t",c),e.C=0,h=e.j.L,e.h=new eO,e.g=tX(e.j,h?t:null,!e.u),e.P>0&&(e.O=new ei(u(e.Y,e,e.g),e.P)),t=e.V,h=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(ea[0]=d.toString()),d=ea);for(let e=0;e<d.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=W(n),t&&t[v]?t.K(r,n,o(i)?!!i.capture:!!i,s):V(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=W(n),t&&t[v]?t.J(r,n,o(i)?!!i.capture:!!i,s):V(t,r,n,!1,i,s)}(h,d[e],c||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?O(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eC(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eB(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eF(e){e.T=Date.now()+e.H,eU(e,e.H)}function eU(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eS(u(e.aa,e),t)}function eV(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function ej(e){0==e.j.I||e.K||tG(e.j,e)}function ez(e){eV(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eH(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eK(r.h,e))){if(!e.L&&eK(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tH(r),tx(r);else break e;tV(r),e_(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eS(u(r.Va,r),6e3));1>=eY(r.h)&&r.ta&&(r.ta=void 0)}else tW(r,11)}else if((e.L||r.g==e)&&tH(r),!T(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eX(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e4(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tK(n,n.L?n.ba:null,n.W),e.L){eQ(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eV(e),eF(e)),n.g=e}else tU(n);r.i.length>0&&tP(r)}else"stop"!=o[0]&&"close"!=o[0]||tW(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tW(r,7):tO(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}eC(4)}catch(e){}}eM.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tN(e)?t.j():this.Y(e)},eM.prototype.Y=function(e){try{if(e==this.g)e:{let f=tN(this.g),g=this.g.ya(),p=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tD(this.g)))){this.K||4!=f||7==g||(8==g||p<=0?eC(3):eC(2)),eV(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eB(e))return e.g.la();let t=tD(e.g);if(""===t)return"";let r="",n=t.length,i=4==tN(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return ez(e),ej(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,o,l,u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(u)){var c=u;break t}}c=null}if(e=c)eb(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eH(this,e);else{this.o=!1,this.m=3,e_(12),ez(this),ej(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eL:isNaN(r=Number(t.substring(r,n)))?ex:(n+=1)+r>t.length?eL:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eL){4==f&&(this.m=4,e_(14),e=!1),eb(this.i,this.l,null,"[Incomplete Response]");break}else if(t==ex){this.m=4,e_(15),eb(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eb(this.i,this.l,t,null),eH(this,t);if(eB(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,e_(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tj(d),d.P=!0,e_(11))}}else eb(this.i,this.l,r,"[Invalid Chunked Response]"),ez(this),ej(this)}else eb(this.i,this.l,r,null),eH(this,r);4==f&&ez(this),this.o&&!this.K&&(4==f?tG(this.j,this):(this.o=!1,eF(this)))}else(function(e){let t={};e=(e.g&&tN(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(T(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,e_(12)):(this.m=0,e_(13)),ez(this),ej(this)}}}catch(e){}finally{}},eM.prototype.cancel=function(){this.K=!0,ez(this)},eM.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eC(),e_(17)),ez(this),this.m=2,ej(this)):eU(this,this.T-r)};var eG=class{constructor(e,t){this.g=e,this.map=t}};function eq(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eW(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eY(e){return e.h?1:e.g?e.g.size:0}function eK(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eX(e,t){e.g?e.g.add(t):e.h=t}function eQ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e$(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return f(e.i)}eq.prototype.cancel=function(){if(this.i=e$(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eZ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eJ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eJ?(this.l=e.l,e0(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e3(this,th(e.i)),this.m=e.m):e&&(t=String(e).match(eZ))?(this.l=!1,e0(this,t[1]||"",!0),this.o=e8(t[2]||""),this.g=e8(t[3]||"",!0),e2(this,t[4]),this.h=e8(t[5]||"",!0),e3(this,t[6]||"",!0),this.m=e8(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e1(e){return new eJ(e)}function e0(e,t,r){e.j=r?e8(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e3(e,t,r){var n,i;t instanceof ti?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(ts(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(ta(this,t),tu(this,r,e))},n)),n.j=i):(r||(t=e5(t,tr)),e.i=new ti(t,e.l))}function e4(e,t,r){e.i.set(t,r)}function e6(e){return e4(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e8(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e5(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eJ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e5(t,e9,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e5(t,e9,!0),"@"),e.push(eR(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e5(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e5(r,tn)),e.join("")},eJ.prototype.resolve=function(e){let t=e1(this),r=!!e.j;r?e0(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e3(t,th(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,tn=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ta(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let r=[];if("string"==typeof t)to(e,t)&&(r=r.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tu(e,t,r){ta(e,t),r.length>0&&(e.i=null,e.g.set(tc(e,t),f(r)),e.h+=r.length)}function th(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tf(){this.g=new eh}function tg(e){this.i=e.Sb||null,this.h=e.ab||!1}function tp(e,t){Y.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tm(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tw(e)}function tw(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tE(e){let t="";return M(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tC(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tE(r),"string"==typeof e?null!=r&&eR(r):e4(e,t,r))}function tI(e){Y.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eR(r);r=tl(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eR(r[t])),e.push(n)}}return this.i=e.join("&")},c(tg,ec),tg.prototype.g=function(){return new tp(this.i,this.h)},c(tp,Y),(t=tp.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tw(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tw(this)),this.g&&(this.readyState=3,tw(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tm(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tw(this),3==this.readyState&&tm(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tp.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),c(tI,Y);var t_=/^https?$/i,tA=["POST","PUT"];function tS(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tT(e),tv(e)}function tT(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tb(e){if(e.h&&void 0!==s){if(e.v&&4==tN(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tN(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(eZ)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!t_.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var i=tN(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tT(e)}}finally{tv(e)}}}}function tv(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tN(e){return e.g?e.g.readyState:0}function tD(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tM(e){this.za=0,this.i=[],this.j=new eT,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eq(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tO(e){if(tL(e),3==e.I){var t=e.V++,r=e1(e.J);if(e4(r,"SID",e.M),e4(r,"RID",t),e4(r,"TYPE","terminate"),tB(e,r),(t=new eM(e,e.j,t)).M=2,t.A=e6(e1(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tX(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eF(t)}tY(e)}function tx(e){e.g&&(tj(e),e.g.cancel(),e.g=null)}function tL(e){tx(e),e.v&&(a.clearTimeout(e.v),e.v=null),tH(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tP(e){if(!eW(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||C(),w||(y(),w=!0),E.add(t,e),e.D=0}}function tk(e,t){var r;r=t?t.l:e.V++;let n=e1(e.J);e4(n,"SID",e.M),e4(n,"RID",r),e4(n,"AID",e.K),tB(e,n),e.u&&e.o&&tC(n,e.u,e.o),r=new eM(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tF(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eX(e.h,r),eP(r,n,t)}function tB(e,t){e.H&&M(e.H,function(e,r){e4(t,r,e)}),e.l&&M({},function(e,r){e4(t,r,e)})}function tF(e,t,r){r=Math.min(e.i.length,r);let n=e.l?u(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<r;u++){var s=i[u].g;let r=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tU(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||C(),w||(y(),w=!0),E.add(t,e),e.A=0}}function tV(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eS(u(e.Da,e),tq(e,e.A)),e.A++,!0)}function tj(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function tz(e){e.g=new eM(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e1(e.na);e4(t,"RID","rpc"),e4(t,"SID",e.M),e4(t,"AID",e.K),e4(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e4(t,"TO",e.ia),e4(t,"TYPE","xmlhttp"),tB(e,t),e.u&&e.o&&tC(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e6(e1(t)),r.u=null,r.R=!0,ek(r,e)}function tH(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tG(e,t){var r,n=null;if(e.g==t){tH(e),tj(e),e.g=null;var i=2}else{if(!eK(e.h,t))return;n=t.G,eQ(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;er(i=ew(),new eA(i,n)),tP(e)}else tU(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eY(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eS(u(e.Ea,e,r),tq(e,e.D)),e.D++,!0)))||2==i&&tV(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tW(e,5);break;case 4:tW(e,10);break;case 3:tW(e,6);break;default:tW(e,2)}}}function tq(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tW(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var r,n=u(e.bb,e),i=e.Ua;let l=!i;i=new eJ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e0(i,"https"),e6(i),l?function(e,t){let r=new eT;if(a.Image){let n=new Image;n.onload=h(td,r,"TestLoadImage: loaded",!0,t,n),n.onerror=h(td,r,"TestLoadImage: error",!1,t,n),n.onabort=h(td,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=h(td,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eT,s=new AbortController,o=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,n):td(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,n)}))}else e_(2);e.I=0,e.l&&e.l.pa(t),tY(e),tL(e)}function tY(e){if(e.I=0,e.ja=[],e.l){let t=e$(e.h);(0!=t.length||0!=e.i.length)&&(g(e.ja,t),g(e.ja,e.i),e.h.i.length=0,f(e.i),e.i.length=0),e.l.oa()}}function tK(e,t,r){var n=r instanceof eJ?e1(r):new eJ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eJ(null);n&&e0(e,n),t&&(e.g=t),i&&e2(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e4(n,r,t),e4(n,"VER",e.ka),tB(e,n),n}function tX(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tI(e.Aa&&!e.ma?new tg({ab:r}):e.ma)).Fa(e.L),t}function tQ(){}function t$(){}function tZ(e,t){Y.call(this),this.g=new tM(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!T(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!T(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t0(this)}function tJ(e){eg.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t1(){ep.call(this),this.status=1}function t0(e){this.g=e}(t=tI.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=d(u(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tS(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tA,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tS(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tv(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tv(this,!0)),tI.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tb(this):this.Xa())},t.Xa=function(){tb(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tN(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tM.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){e_(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tK(this,null,this.W),tP(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eM(this,this.j,e),s=this.o;if(this.U&&(s?L(s=O(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tF(this,i,t),e4(r=e1(this.J),"RID",e),e4(r,"CVER",22),this.G&&e4(r,"X-HTTP-Session-Id",this.G),tB(this,r),s&&(this.R?t="headers="+eR(tE(s))+"&"+t:this.u&&tC(r,this.u,s)),eX(this.h,i),this.Ra&&e4(r,"TYPE","init"),this.S?(e4(r,"$req",t),e4(r,"SID","null"),i.U=!0,eP(i,r,null)):eP(i,r,t),this.I=2}}else 3==this.I&&(e?tk(this,e):0==this.i.length||eW(this.h)||tk(this))},t.Da=function(){if(this.v=null,tz(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eS(u(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,e_(10),tx(this),tz(this))},t.Va=function(){null!=this.C&&(this.C=null,tx(this),tV(this),e_(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),e_(2)):(this.j.info("Failed to ping google.com"),e_(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tQ.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},t$.prototype.g=function(e,t){return new tZ(e,t)},c(tZ,Y),tZ.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tZ.prototype.close=function(){tO(this.g)},tZ.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new eG(t.Ya++,e)),3==t.I&&tP(t)},tZ.prototype.N=function(){this.g.l=null,delete this.j,tO(this.g),delete this.g,tZ.Z.N.call(this)},c(tJ,eg),c(t1,ep),c(t0,tQ),t0.prototype.ra=function(){er(this.g,"a")},t0.prototype.qa=function(e){er(this.g,new tJ(e))},t0.prototype.pa=function(e){er(this.g,new t1)},t0.prototype.oa=function(){er(this.g,"b")},t$.prototype.createWebChannel=t$.prototype.g,tZ.prototype.send=tZ.prototype.o,tZ.prototype.open=tZ.prototype.m,tZ.prototype.close=tZ.prototype.close,et=nN.createWebChannelTransport=function(){return new t$},ee=nN.getStatEventTarget=function(){return ew()},J=nN.Event=em,Z=nN.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ev.NO_ERROR=0,ev.TIMEOUT=8,ev.HTTP_ERROR=6,$=nN.ErrorCode=ev,eN.COMPLETE="complete",Q=nN.EventType=eN,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",Y.prototype.listen=Y.prototype.J,X=nN.WebChannel=ed,nN.FetchXmlHttpFactory=tg,tI.prototype.listenOnce=tI.prototype.K,tI.prototype.getLastError=tI.prototype.Ha,tI.prototype.getLastErrorCode=tI.prototype.ya,tI.prototype.getStatus=tI.prototype.ca,tI.prototype.getResponseJson=tI.prototype.La,tI.prototype.getResponseText=tI.prototype.la,tI.prototype.send=tI.prototype.ea,tI.prototype.setWithCredentials=tI.prototype.Fa,K=nN.XhrIo=tI}).apply(void 0!==nv?nv:"u">typeof self?self:"u">typeof window?window:{});class nD{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}nD.UNAUTHENTICATED=new nD(null),nD.GOOGLE_CREDENTIALS=new nD("google-credentials-uid"),nD.FIRST_PARTY=new nD("first-party-uid"),nD.MOCK_USER=new nD("mock-user");let nR="12.8.0",nM=new rL("@firebase/firestore");function nO(){return nM.logLevel}function nx(e,...t){if(nM.logLevel<=q.DEBUG){let r=t.map(nk);nM.debug(`Firestore (${nR}): ${e}`,...r)}}function nL(e,...t){if(nM.logLevel<=q.ERROR){let r=t.map(nk);nM.error(`Firestore (${nR}): ${e}`,...r)}}function nP(e,...t){if(nM.logLevel<=q.WARN){let r=t.map(nk);nM.warn(`Firestore (${nR}): ${e}`,...r)}}function nk(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function nB(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,nF(e,n,r)}function nF(e,t,r){let n=`FIRESTORE (${nR}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw nL(n),Error(n)}function nU(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||nF(t,i,n)}let nV={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nj extends rE{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nz{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class nH{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nG{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(nD.UNAUTHENTICATED))}shutdown(){}}class nq{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class nW{constructor(e){this.t=e,this.currentUser=nD.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){nU(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new nz;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new nz,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{nx("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(nx("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new nz)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(nx("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(nU("string"==typeof t.accessToken,31837,{l:t}),new nH(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return nU(null===e||"string"==typeof e,2055,{h:e}),new nD(e)}}class nY{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=nD.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class nK{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new nY(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(nD.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class nX{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nQ{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,r9(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){nU(void 0===this.o,3512);let r=e=>{null!=e.error&&nx("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,nx("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{nx("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):nx("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new nX(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(nU("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new nX(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class n${static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function nZ(e,t){return e<t?-1:+(e>t)}function nJ(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return n1(r)===n1(i)?nZ(r,i):n1(r)?1:-1}return nZ(e.length,t.length)}function n1(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function n0(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let n2="__name__";class n3{constructor(e,t,r){void 0===t?t=0:t>e.length&&nB(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&nB(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===n3.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n3?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=n3.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return nZ(e.length,t.length)}static compareSegments(e,t){let r=n3.isNumericId(e),n=n3.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?n3.extractNumericId(e).compare(n3.extractNumericId(t)):nJ(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return W.fromString(e.substring(4,e.length-2))}}class n4 extends n3{construct(e,t,r){return new n4(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new nj(nV.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new n4(t)}static emptyPath(){return new n4([])}}let n6=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class n8 extends n3{construct(e,t,r){return new n8(e,t,r)}static isValidIdentifier(e){return n6.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n8.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===n2}static keyField(){return new n8([n2])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new nj(nV.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new nj(nV.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new nj(nV.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new nj(nV.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n8(t)}static emptyPath(){return new n8([])}}class n5{constructor(e){this.path=e}static fromPath(e){return new n5(n4.fromString(e))}static fromName(e){return new n5(n4.fromString(e).popFirst(5))}static empty(){return new n5(n4.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===n4.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return n4.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n5(new n4(e.slice()))}}function n7(e,t,r){if(!r)throw new nj(nV.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function n9(e){if(!n5.isDocumentKey(e))throw new nj(nV.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ie(e){if(n5.isDocumentKey(e))throw new nj(nV.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function it(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ir(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":nB(12329,{type:typeof e})}function ii(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new nj(nV.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=ir(e);throw new nj(nV.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function is(e,t){if(t<=0)throw new nj(nV.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function ia(e,t){let r={typeString:e};return t&&(r.value=t),r}function io(e,t){let r;if(!it(e))throw new nj(nV.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new nj(nV.INVALID_ARGUMENT,r);return!0}class il{static now(){return il.fromMillis(Date.now())}static fromDate(e){return il.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new il(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new nj(nV.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new nj(nV.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?nZ(this.nanoseconds,e.nanoseconds):nZ(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:il._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(io(e,il._jsonSchema))return new il(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}il._jsonSchemaVersion="firestore/timestamp/1.0",il._jsonSchema={type:ia("string",il._jsonSchemaVersion),seconds:ia("number"),nanoseconds:ia("number")};class iu{static fromTimestamp(e){return new iu(e)}static min(){return new iu(new il(0,0))}static max(){return new iu(new il(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ih{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function ic(e){return e.fields.find(e=>2===e.kind)}function id(e){return e.fields.filter(e=>2!==e.kind)}function ig(e,t){let r=nZ(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=n8.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:nZ(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return nZ(e.fields.length,t.fields.length)}ih.UNKNOWN_ID=-1;class ip{constructor(e,t){this.fieldPath=e,this.kind=t}}class im{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new im(0,iE.min())}}function iy(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new iE(iu.fromTimestamp(1e9===n?new il(r+1,0):new il(r,n)),n5.empty(),t)}function iw(e){return new iE(e.readTime,e.key,-1)}class iE{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new iE(iu.min(),n5.empty(),-1)}static max(){return new iE(iu.max(),n5.empty(),-1)}}function iC(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=n5.comparator(e.documentKey,t.documentKey))?r:nZ(e.largestBatchId,t.largestBatchId)}let iI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class i_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function iA(e){if(e.code!==nV.FAILED_PRECONDITION||e.message!==iI)throw e;nx("LocalStore","Unexpectedly lost primary lease")}class iS{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&nB(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new iS((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof iS?t:iS.resolve(t)}catch(e){return iS.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):iS.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):iS.reject(t)}static resolve(e){return new iS((t,r)=>{t(e)})}static reject(e){return new iS((t,r)=>{r(e)})}static waitFor(e){return new iS((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=iS.resolve(!1);for(let r of e)t=t.next(e=>e?iS.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new iS((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new iS((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let iT="SimpleDb";class ib{static open(e,t,r,n){try{return new ib(t,e.transaction(n,r))}catch(e){throw new iR(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new nz,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new iR(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=iP(t.target.error);this.S.reject(new iR(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(nx(iT,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new iO(this.transaction.objectStore(e))}}class iv{static delete(e){return nx(iT,"Removing database:",e),ix(rr().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!rw())return!1;if(iv.F())return!0;let e=rf(),t=iv.M(e),r=iN(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==t_.default&&"YES"===t_.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===iv.M(rf())&&nL("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(nx(iT,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new iR(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new nj(nV.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new nj(nV.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new iR(e,n))},n.onupgradeneeded=e=>{nx(iT,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{nx(iT,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=ib.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),iS.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(nx(iT,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function iN(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class iD{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return ix(this.U.delete())}}class iR extends nj{constructor(e,t){super(nV.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function iM(e){return"IndexedDbTransactionError"===e.name}class iO{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(nx(iT,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(nx(iT,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ix(r)}add(e){return nx(iT,"ADD",this.store.name,e,e),ix(this.store.add(e))}get(e){return ix(this.store.get(e)).next(t=>(void 0===t&&(t=null),nx(iT,"GET",this.store.name,e,t),t))}delete(e){return nx(iT,"DELETE",this.store.name,e),ix(this.store.delete(e))}count(){return nx(iT,"COUNT",this.store.name),ix(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new iS((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new iS((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){nx(iT,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new iS((r,n)=>{t.onerror=e=>{n(iP(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new iS((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new iD(i),a=t(i.primaryKey,i.value,s);if(a instanceof iS){let e=a.catch(e=>(s.done(),iS.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>iS.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ix(e){return new iS((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(iP(e.target.error))}})}let iL=!1;function iP(e){let t=iv.M(rf());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new nj("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return iL||(iL=!0,setTimeout(()=>{throw e},0)),e}}return e}let ik="IndexBackfiller";class iB{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){nx(ik,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();nx(ik,`Documents written: ${e}`)}catch(e){iM(e)?nx(ik,"Ignoring IndexedDB error during index backfill: ",e):await iA(e)}await this.re(6e4)})}}class iF{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return iS.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return nx(ik,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(nx(ik,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=iw(t);iC(n,r)>0&&(r=n)}),new iE(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class iU{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function iV(e){return null==e}function ij(e){return 0===e&&1/e==-1/0}function iz(e){return"number"==typeof e&&Number.isInteger(e)&&!ij(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function iH(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}iU.ce=-1;function iG(e){let t=e.length;if(nU(t>=2,64408,{path:e}),2===t)return nU("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),n4.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&nB(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:nB(61167,{path:e})}s=t+2}return new n4(n)}let iq="remoteDocuments",iW="owner",iY="owner",iK="mutationQueues",iX="mutations",iQ="batchId",i$="userMutationsIndex",iZ=["userId","batchId"],iJ={},i1="documentMutations",i0="remoteDocumentsV14",i2=["prefixPath","collectionGroup","readTime","documentId"],i3="documentKeyIndex",i4=["prefixPath","collectionGroup","documentId"],i6="collectionGroupIndex",i8=["collectionGroup","readTime","prefixPath","documentId"],i5="remoteDocumentGlobal",i7="remoteDocumentGlobalKey",i9="targets",se="queryTargetsIndex",st=["canonicalId","targetId"],sr="targetDocuments",sn=["targetId","path"],si="documentTargetsIndex",ss=["path","targetId"],sa="targetGlobalKey",so="targetGlobal",sl="collectionParents",su=["collectionId","parent"],sh="clientMetadata",sc="bundles",sd="namedQueries",sf="indexConfiguration",sg="collectionGroupIndex",sp="indexState",sm=["indexId","uid"],sy="sequenceNumberIndex",sw=["uid","sequenceNumber"],sE="indexEntries",sC=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sI="documentKeyIndex",s_=["indexId","uid","orderedDocumentKey"],sA="documentOverlays",sS=["userId","collectionPath","documentId"],sT="collectionPathOverlayIndex",sb=["userId","collectionPath","largestBatchId"],sv="collectionGroupOverlayIndex",sN=["userId","collectionGroup","largestBatchId"],sD="globals",sR=[iK,iX,i1,iq,i9,iW,so,sr,sh,i5,sl,sc,sd],sM=[...sR,sA],sO=[iK,iX,i1,i0,i9,iW,so,sr,sh,i5,sl,sc,sd,sA],sx=[...sO,sf,sp,sE],sL=[...sx,sD];class sP extends i_{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function sk(e,t){return iv.O(e.le,t)}function sB(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function sF(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function sU(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class sV{constructor(e,t){this.comparator=e,this.root=t||sz.EMPTY}insert(e,t){return new sV(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sz.BLACK,null,null))}remove(e){return new sV(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sz.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sj(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sj(this.root,e,this.comparator,!1)}getReverseIterator(){return new sj(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sj(this.root,e,this.comparator,!0)}}class sj{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sz{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:sz.RED,this.left=null!=n?n:sz.EMPTY,this.right=null!=i?i:sz.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new sz(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return sz.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return sz.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,sz.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,sz.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw nB(43730,{key:this.key,value:this.value});if(this.right.isRed())throw nB(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw nB(27949);return e+ +!this.isRed()}}sz.EMPTY=null,sz.RED=!0,sz.BLACK=!1,sz.EMPTY=new class{constructor(){this.size=0}get key(){throw nB(57766)}get value(){throw nB(16141)}get color(){throw nB(16727)}get left(){throw nB(29726)}get right(){throw nB(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new sz(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class sH{constructor(e){this.comparator=e,this.data=new sV(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sG(this.data.getIterator())}getIteratorFrom(e){return new sG(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sH)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new sH(this.comparator);return t.data=e,t}}class sG{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sq(e){return e.hasNext()?e.getNext():void 0}class sW{constructor(e){this.fields=e,e.sort(n8.comparator)}static empty(){return new sW([])}unionWith(e){let t=new sH(n8.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new sW(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return n0(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class sY extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class sK{constructor(e){this.binaryString=e}static fromBase64String(e){return new sK(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new sY("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new sK(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return nZ(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sK.EMPTY_BYTE_STRING=new sK("");let sX=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sQ(e){if(nU(!!e,39018),"string"==typeof e){let t=0,r=sX.exec(e);if(nU(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:s$(e.seconds),nanos:s$(e.nanos)}}function s$(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sZ(e){return"string"==typeof e?sK.fromBase64String(e):sK.fromUint8Array(e)}let sJ="server_timestamp",s1="__type__",s0="__previous_value__",s2="__local_write_time__";function s3(e){return(e?.mapValue?.fields||{})[s1]?.stringValue===sJ}function s4(e){let t=e.mapValue.fields[s0];return s3(t)?s4(t):t}function s6(e){let t=sQ(e.mapValue.fields[s2].timestampValue);return new il(t.seconds,t.nanos)}class s8{constructor(e,t,r,n,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let s5="(default)";class s7{constructor(e,t){this.projectId=e,this.database=t||s5}static empty(){return new s7("","")}get isDefaultDatabase(){return this.database===s5}isEqual(e){return e instanceof s7&&e.projectId===this.projectId&&e.database===this.database}}let s9="__type__",ae="__max__",at={mapValue:{fields:{__type__:{stringValue:ae}}}},ar="__vector__",an="value",ai={nullValue:"NULL_VALUE"};function as(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?s3(e)?4:aC(e)?0x1fffffffffffff:aw(e)?10:11:nB(28295,{value:e})}function aa(e,t){if(e===t)return!0;let r=as(e);if(r!==as(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return s6(e).isEqual(s6(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=sQ(e.timestampValue),i=sQ(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return sZ(e.bytesValue).isEqual(sZ(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return s$(e.geoPointValue.latitude)===s$(t.geoPointValue.latitude)&&s$(e.geoPointValue.longitude)===s$(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return s$(e.integerValue)===s$(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=s$(e.doubleValue),n=s$(t.doubleValue);return r===n?ij(r)===ij(n):isNaN(r)&&isNaN(n)}return!1;case 9:return n0(e.arrayValue.values||[],t.arrayValue.values||[],aa);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(sB(s)!==sB(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!aa(s[e],a[e])))return!1;return!0;default:return nB(52216,{left:e})}}function ao(e,t){return void 0!==(e.values||[]).find(e=>aa(e,t))}function al(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=as(e),u=as(t);if(l!==u)return nZ(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return nZ(e.booleanValue,t.booleanValue);case 2:let h,c;return h=s$(e.integerValue||e.doubleValue),h<(c=s$(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return au(e.timestampValue,t.timestampValue);case 4:return au(s6(e),s6(t));case 5:return nJ(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=sZ(r),f=sZ(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=nZ(r[e],n[e]);if(0!==t)return t}return nZ(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let g;return i=e.geoPointValue,s=t.geoPointValue,0!==(g=nZ(s$(i.latitude),s$(s.latitude)))?g:nZ(s$(i.longitude),s$(s.longitude));case 9:return ah(e.arrayValue,t.arrayValue);case 10:let p,m,y,w,E;return a=e.mapValue,o=t.mapValue,p=a.fields||{},m=o.fields||{},y=p[an]?.arrayValue,w=m[an]?.arrayValue,0!==(E=nZ(y?.values?.length||0,w?.values?.length||0))?E:ah(y,w);case 11:return function(e,t){if(e===at.mapValue&&t===at.mapValue)return 0;if(e===at.mapValue)return 1;if(t===at.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=nJ(n[e],s[e]);if(0!==t)return t;let a=al(r[n[e]],i[s[e]]);if(0!==a)return a}return nZ(n.length,s.length)}(e.mapValue,t.mapValue);default:throw nB(23264,{he:l})}}function au(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return nZ(e,t);let r=sQ(e),n=sQ(t),i=nZ(r.seconds,n.seconds);return 0!==i?i:nZ(r.nanos,n.nanos)}function ah(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=al(r[e],n[e]);if(t)return t}return nZ(r.length,n.length)}function ac(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=sQ(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?sZ(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,n5.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=ac(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${ac(e.fields[i])}`;return r+"}"}(e.mapValue):nB(61005,{value:e})}function ad(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function af(e){return!!e&&"integerValue"in e}function ag(e){return!!e&&"arrayValue"in e}function ap(e){return!!e&&"nullValue"in e}function am(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ay(e){return!!e&&"mapValue"in e}function aw(e){return(e?.mapValue?.fields||{})[s9]?.stringValue===ar}function aE(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return sF(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=aE(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=aE(e.arrayValue.values[r]);return t}return{...e}}function aC(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ae}let aI={mapValue:{fields:{[s9]:{stringValue:ar},[an]:{arrayValue:{}}}}};function a_(e,t){let r=al(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function aA(e,t){let r=al(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class aS{constructor(e){this.value=e}static empty(){return new aS({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!ay(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=aE(t)}setAll(e){let t=n8.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=aE(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());ay(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return aa(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];ay(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(sF(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new aS(aE(this.value))}}class aT{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new aT(e,0,iu.min(),iu.min(),iu.min(),aS.empty(),0)}static newFoundDocument(e,t,r,n){return new aT(e,1,t,iu.min(),r,n,0)}static newNoDocument(e,t){return new aT(e,2,t,iu.min(),iu.min(),aS.empty(),0)}static newUnknownDocument(e,t){return new aT(e,3,t,iu.min(),iu.min(),aS.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(iu.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=aS.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=aS.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=iu.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof aT&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new aT(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ab{constructor(e,t){this.position=e,this.inclusive=t}}function av(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?n5.comparator(n5.fromName(a.referenceValue),r.key):al(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function aN(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!aa(e.position[r],t.position[r]))return!1;return!0}class aD{constructor(e,t="asc"){this.field=e,this.dir=t}}class aR{}class aM extends aR{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new aF(e,t,r):"array-contains"===t?new az(e,r):"in"===t?new aH(e,r):"not-in"===t?new aG(e,r):"array-contains-any"===t?new aq(e,r):new aM(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new aU(e,r):new aV(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(al(t,this.value)):null!==t&&as(this.value)===as(t)&&this.matchesComparison(al(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return nB(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class aO extends aR{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new aO(e,t)}matches(e){return ax(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ax(e){return"and"===e.op}function aL(e){return"or"===e.op}function aP(e){return ak(e)&&ax(e)}function ak(e){for(let t of e.filters)if(t instanceof aO)return!1;return!0}function aB(e,t){let r=e.filters.concat(t);return aO.create(r,e.op)}class aF extends aM{constructor(e,t,r){super(e,t,r),this.key=n5.fromName(r.referenceValue)}matches(e){let t=n5.comparator(e.key,this.key);return this.matchesComparison(t)}}class aU extends aM{constructor(e,t){super(e,"in",t),this.keys=aj("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class aV extends aM{constructor(e,t){super(e,"not-in",t),this.keys=aj("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function aj(e,t){return(t.arrayValue?.values||[]).map(e=>n5.fromName(e.referenceValue))}class az extends aM{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ag(t)&&ao(t.arrayValue,this.value)}}class aH extends aM{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&ao(this.value.arrayValue,t)}}class aG extends aM{constructor(e,t){super(e,"not-in",t)}matches(e){if(ao(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!ao(this.value.arrayValue,t)}}class aq extends aM{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ag(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>ao(this.value.arrayValue,e))}}class aW{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function aY(e,t=null,r=[],n=[],i=null,s=null,a=null){return new aW(e,t,r,n,i,s,a)}function aK(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof aM)return t.field.canonicalString()+t.op.toString()+ac(t.value);if(aP(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),iV(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>ac(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>ac(e)).join(",")),e.Te=t}return e.Te}function aX(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof aM?r instanceof aM&&t.op===r.op&&t.field.isEqual(r.field)&&aa(t.value,r.value):t instanceof aO?r instanceof aO&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void nB(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!aN(e.startAt,t.startAt)&&aN(e.endAt,t.endAt)}function aQ(e){return n5.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function a$(e,t){return e.filters.filter(e=>e instanceof aM&&e.field.isEqual(t))}function aZ(e,t,r){let n=ai,i=!0;for(let r of a$(e,t)){let e=ai,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?ai:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?ad(s7.empty(),n5.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?aw(s)?aI:{mapValue:{}}:nB(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=ai}0>a_({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>a_({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function aJ(e,t,r){let n=at,i=!0;for(let r of a$(e,t)){let e=at,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?ad(s7.empty(),n5.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?aI:"mapValue"in s?aw(s)?{mapValue:{}}:at:nB(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=at}aA({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];aA({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class a1{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function a0(e){return new a1(e)}function a2(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function a3(e){return null!==e.collectionGroup}function a4(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new sH(n8.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new aD(t,n))}),r.has(n8.keyField().canonicalString())||e.Ie.push(new aD(n8.keyField(),n))}return e.Ie}function a6(e){return e.Ee||(e.Ee=a8(e,a4(e))),e.Ee}function a8(e,t){if("F"===e.limitType)return aY(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new aD(e.field,t)});let r=e.endAt?new ab(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new ab(e.startAt.position,e.startAt.inclusive):null;return aY(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function a5(e,t){let r=e.filters.concat([t]);return new a1(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function a7(e,t,r){return new a1(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function a9(e,t){return aX(a6(e),a6(t))&&e.limitType===t.limitType}function oe(e){return`${aK(a6(e))}|lt:${e.limitType}`}function ot(e){var t;let r;return`Query(target=${r=(t=a6(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof aM?`${t.field.canonicalString()} ${t.op} ${ac(t.value)}`:t instanceof aO?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),iV(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>ac(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>ac(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function or(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):n5.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of a4(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=av(i,a4(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=av(s,a4(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function on(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function oi(e){return(t,r)=>{let n=!1;for(let i of a4(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?n5.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?al(i,s):nB(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return nB(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class os{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){sF(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return sU(this.inner)}size(){return this.innerSize}}let oa=new sV(n5.comparator),oo=new sV(n5.comparator);function ol(...e){let t=oo;for(let r of e)t=t.insert(r.key,r);return t}function ou(e){let t=oo;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function oh(){return new os(e=>e.toString(),(e,t)=>e.isEqual(t))}let oc=new sV(n5.comparator),od=new sH(n5.comparator);function of(...e){let t=od;for(let r of e)t=t.add(r);return t}let og=new sH(nZ);function op(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ij(t)?"-0":t}}function om(e){return{integerValue:""+e}}class oy{constructor(){this._=void 0}}function ow(e,t){return e instanceof oS?af(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class oE extends oy{}class oC extends oy{constructor(e){super(),this.elements=e}}function oI(e,t){let r=ob(t);for(let t of e.elements)r.some(e=>aa(e,t))||r.push(t);return{arrayValue:{values:r}}}class o_ extends oy{constructor(e){super(),this.elements=e}}function oA(e,t){let r=ob(t);for(let t of e.elements)r=r.filter(e=>!aa(e,t));return{arrayValue:{values:r}}}class oS extends oy{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function oT(e){return s$(e.integerValue||e.doubleValue)}function ob(e){return ag(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ov{constructor(e,t){this.field=e,this.transform=t}}class oN{constructor(e,t){this.version=e,this.transformResults=t}}class oD{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oD}static exists(e){return new oD(void 0,e)}static updateTime(e){return new oD(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oR(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class oM{}function oO(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new oV(e.key,oD.none()):new oP(e.key,e.data,oD.none());{let r=e.data,n=aS.empty(),i=new sH(n8.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new ok(e.key,n,new sW(i.toArray()),oD.none())}}function ox(e,t,r,n){return e instanceof oP?function(e,t,r,n){if(!oR(e.precondition,t))return r;let i=e.value.clone(),s=oU(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof ok?function(e,t,r,n){if(!oR(e.precondition,t))return r;let i=oU(e.fieldTransforms,n,t),s=t.data;return(s.setAll(oB(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):oR(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function oL(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&n0(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof oC&&n instanceof oC||r instanceof o_&&n instanceof o_?n0(r.elements,n.elements,aa):r instanceof oS&&n instanceof oS?aa(r.Ae,n.Ae):r instanceof oE&&n instanceof oE)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class oP extends oM{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class ok extends oM{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function oB(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function oF(e,t,r){let n=new Map;nU(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof oC?oI(o,l):o instanceof o_?oA(o,l):i))}return n}function oU(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof oE?(n=t,i={fields:{[s1]:{stringValue:sJ},[s2]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&s3(n)&&(n=s4(n)),n&&(i.fields[s0]=n),{mapValue:i}):e instanceof oC?oI(e,t):e instanceof o_?oA(e,t):(a=oT(s=ow(e,t))+oT(e.Ae),af(s)&&af(e.Ae)?om(a):op(e.serializer,a))}(e,s,t))}return n}class oV extends oM{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class oj extends oM{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class oz{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof oP?(n=e.value.clone(),i=oF(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof ok?function(e,t,r){if(!oR(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=oF(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(oB(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=ox(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=ox(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=oh();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=oO(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(iu.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),of())}isEqual(e){return this.batchId===e.batchId&&n0(this.mutations,e.mutations,(e,t)=>oL(e,t))&&n0(this.baseMutations,e.baseMutations,(e,t)=>oL(e,t))}}class oH{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){nU(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=oc,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new oH(e,t,r,n)}}class oG{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class oq{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class oW{constructor(e,t){this.count=e,this.unchangedNames=t}}function oY(e){switch(e){case nV.OK:return nB(64938);case nV.CANCELLED:case nV.UNKNOWN:case nV.DEADLINE_EXCEEDED:case nV.RESOURCE_EXHAUSTED:case nV.INTERNAL:case nV.UNAVAILABLE:case nV.UNAUTHENTICATED:return!1;case nV.INVALID_ARGUMENT:case nV.NOT_FOUND:case nV.ALREADY_EXISTS:case nV.PERMISSION_DENIED:case nV.FAILED_PRECONDITION:case nV.ABORTED:case nV.OUT_OF_RANGE:case nV.UNIMPLEMENTED:case nV.DATA_LOSS:return!0;default:return nB(15467,{code:e})}}function oK(e){if(void 0===e)return nL("GRPC error has no .code"),nV.UNKNOWN;switch(e){case er.OK:return nV.OK;case er.CANCELLED:return nV.CANCELLED;case er.UNKNOWN:return nV.UNKNOWN;case er.DEADLINE_EXCEEDED:return nV.DEADLINE_EXCEEDED;case er.RESOURCE_EXHAUSTED:return nV.RESOURCE_EXHAUSTED;case er.INTERNAL:return nV.INTERNAL;case er.UNAVAILABLE:return nV.UNAVAILABLE;case er.UNAUTHENTICATED:return nV.UNAUTHENTICATED;case er.INVALID_ARGUMENT:return nV.INVALID_ARGUMENT;case er.NOT_FOUND:return nV.NOT_FOUND;case er.ALREADY_EXISTS:return nV.ALREADY_EXISTS;case er.PERMISSION_DENIED:return nV.PERMISSION_DENIED;case er.FAILED_PRECONDITION:return nV.FAILED_PRECONDITION;case er.ABORTED:return nV.ABORTED;case er.OUT_OF_RANGE:return nV.OUT_OF_RANGE;case er.UNIMPLEMENTED:return nV.UNIMPLEMENTED;case er.DATA_LOSS:return nV.DATA_LOSS;default:return nB(39323,{code:e})}}(en=er||(er={}))[en.OK=0]="OK",en[en.CANCELLED=1]="CANCELLED",en[en.UNKNOWN=2]="UNKNOWN",en[en.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",en[en.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",en[en.NOT_FOUND=5]="NOT_FOUND",en[en.ALREADY_EXISTS=6]="ALREADY_EXISTS",en[en.PERMISSION_DENIED=7]="PERMISSION_DENIED",en[en.UNAUTHENTICATED=16]="UNAUTHENTICATED",en[en.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",en[en.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",en[en.ABORTED=10]="ABORTED",en[en.OUT_OF_RANGE=11]="OUT_OF_RANGE",en[en.UNIMPLEMENTED=12]="UNIMPLEMENTED",en[en.INTERNAL=13]="INTERNAL",en[en.UNAVAILABLE=14]="UNAVAILABLE",en[en.DATA_LOSS=15]="DATA_LOSS";let oX=null;function oQ(){return new TextEncoder}let o$=new W([0xffffffff,0xffffffff],0);function oZ(e){let t=oQ().encode(e),r=new Y;return r.update(t),new Uint8Array(r.digest())}function oJ(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new W([r,n],0),new W([i,s],0)]}class o1{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new o0(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new o0(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new o0(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=W.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(W.fromNumber(r)));return 1===n.compare(o$)&&(n=new W([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=oJ(oZ(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new o1(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=oJ(oZ(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class o0 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class o2{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,o3.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new o2(iu.min(),n,new sV(nZ),oa,of())}}class o3{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new o3(r,t,of(),of(),of())}}class o4{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class o6{constructor(e,t){this.targetId=e,this.Ce=t}}class o8{constructor(e,t,r=sK.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class o5{constructor(){this.ve=0,this.Fe=le(),this.Me=sK.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=of(),t=of(),r=of();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:nB(38017,{changeType:i})}}),new o3(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=le()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,nU(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class o7{constructor(e){this.Ge=e,this.ze=new Map,this.je=oa,this.He=o9(),this.Je=o9(),this.Ze=new sV(nZ)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:nB(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(aQ(a))if(0===r){let e=new n5(a.path);this.et(t,e,aT.newNoDocument(e,iu.min()))}else nU(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),oX?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=sZ(i).toUint8Array()}catch(e){if(e instanceof sY)return nP("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new o1(t,s,a)}catch(e){return nP(e instanceof o0?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&aQ(i.target)){let t=new n5(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,aT.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=of();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new o2(e,t,this.Ze,this.je,r);return this.je=oa,this.He=o9(),this.Je=o9(),this.Ze=new sV(nZ),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new o5,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new sH(nZ),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new sH(nZ),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||nx("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new o5),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function o9(){return new sV(n5.comparator)}function le(){return new sV(n5.comparator)}let lt={asc:"ASCENDING",desc:"DESCENDING"},lr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ln={and:"AND",or:"OR"};class li{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ls(e,t){return e.useProto3Json||iV(t)?t:{value:t}}function la(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lo(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ll(e){let t;return nU(!!e,49232),iu.fromTimestamp(new il((t=sQ(e)).seconds,t.nanos))}function lu(e,t){return lh(e,t).canonicalString()}function lh(e,t){let r=new n4(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function lc(e){let t=n4.fromString(e);return nU(lv(t),10190,{key:t.toString()}),t}function ld(e,t){return lu(e.databaseId,t.path)}function lf(e,t){let r=lc(t);if(r.get(1)!==e.databaseId.projectId)throw new nj(nV.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new nj(nV.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new n5(ly(r))}function lg(e,t){return lu(e.databaseId,t)}function lp(e){let t=lc(e);return 4===t.length?n4.emptyPath():ly(t)}function lm(e){return new n4(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ly(e){return nU(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function lw(e,t,r){return{name:ld(e,t),fields:r.value.mapValue.fields}}function lE(e,t,r){let n=lf(e,t.name),i=ll(t.updateTime),s=t.createTime?ll(t.createTime):iu.min(),a=new aS({mapValue:{fields:t.fields}}),o=aT.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function lC(e,t){var r,n;let i;if(t instanceof oP)i={update:lw(e,t.key,t.value)};else if(t instanceof oV)i={delete:ld(e,t.key)};else if(t instanceof ok){let r;i={update:lw(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof oj))return nB(16599,{dt:t.type});i={verify:ld(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof oE)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof oC)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof o_)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof oS)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw nB(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:la(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:nB(27497)),i}function lI(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?oD.updateTime(ll(r.updateTime)):void 0!==r.exists?oD.exists(r.exists):oD.none():oD.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(nU("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new oE):"appendMissingElements"in t?r=new oC(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new o_(t.removeAllFromArray.values||[]):"increment"in t?r=new oS(e,t.increment):nB(16584,{proto:t}),new ov(n8.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=lf(e,t.update.name),s=new aS({mapValue:{fields:t.update.fields}});return t.updateMask?new ok(r,s,new sW((t.updateMask.fieldPaths||[]).map(e=>n8.fromServerFormat(e))),n,i):new oP(r,s,n,i)}return t.delete?new oV(lf(e,t.delete),n):t.verify?new oj(lf(e,t.verify),n):nB(1463,{proto:t})}function l_(e,t){return{documents:[lg(e,t.path)]}}function lA(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=lg(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof aM?function(e){if("=="===e.op){if(am(e.value))return{unaryFilter:{field:lT(e.field),op:"IS_NAN"}};if(ap(e.value))return{unaryFilter:{field:lT(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(am(e.value))return{unaryFilter:{field:lT(e.field),op:"IS_NOT_NAN"}};if(ap(e.value))return{unaryFilter:{field:lT(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:lT(e.field),op:lr[e.op],value:e.value}}}(t):t instanceof aO?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:ln[r.op],filters:n}}:nB(54877,{filter:t})}(aO.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:lT(e.field),direction:lt[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=ls(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function lS(e){var t,r,n;let i,s,a,o,l=lp(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){nU(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=lb(e.unaryFilter.field);return aM.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=lb(e.unaryFilter.field);return aM.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=lb(e.unaryFilter.field);return aM.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=lb(e.unaryFilter.field);return aM.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return nB(61313);default:return nB(60726)}}(t):void 0!==t.fieldFilter?aM.create(lb(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return nB(58110);default:return nB(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?aO.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return nB(1026)}}(t.compositeFilter.op)):nB(30097,{filter:t})}(u.where))instanceof aO&&aP(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new aD(lb(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;u.limit&&(g=iV(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let p=null;u.startAt&&(a=!!(r=u.startAt).before,p=new ab(r.values||[],a));let m=null;return u.endAt&&(o=!(n=u.endAt).before,m=new ab(n.values||[],o)),new a1(l,c,f,d,g,"F",p,m)}function lT(e){return{fieldPath:e.canonicalString()}}function lb(e){return n8.fromServerFormat(e.fieldPath)}function lv(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function lN(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class lD{constructor(e,t,r,n,i=iu.min(),s=iu.min(),a=sK.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new lD(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new lD(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new lD(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new lD(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class lR{constructor(e){this.yt=e}}function lM(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:lO(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:ld(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:la(i,t.version.toTimestamp()),createTime:la(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:lx(t.version)};else{if(!t.isUnknownDocument())return nB(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:lx(t.version)}}return n}function lO(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function lx(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function lL(e){let t=new il(e.seconds,e.nanoseconds);return iu.fromTimestamp(t)}function lP(e,t){let r=(t.baseMutations||[]).map(t=>lI(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>lI(e.yt,t)),i=il.fromMillis(t.localWriteTimeMs);return new oz(t.batchId,i,r,n)}function lk(e){var t;let r,n=lL(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?lL(e.lastLimboFreeSnapshotVersion):iu.min();return new lD(void 0!==e.query.documents?(nU(1===(r=(t=e.query).documents.length),1966,{count:r}),a6(a0(lp(t.documents[0])))):a6(lS(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,sK.fromBase64String(e.resumeToken))}function lB(e,t){let r,n=lx(t.snapshotVersion),i=lx(t.lastLimboFreeSnapshotVersion);r=aQ(t.target)?l_(e.yt,t.target):lA(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:aK(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function lF(e){let t=lS({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?a7(t,t.limit,"L"):t}function lU(e,t){return new oG(t.largestBatchId,lI(e.yt,t.overlayMutation))}function lV(e,t){let r=t.path.lastSegment();return[e,iH(t.path.popLast()),r]}function lj(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:lx(n.readTime),documentKey:iH(n.documentKey.path),largestBatchId:n.largestBatchId}}class lz{getBundleMetadata(e,t){return sk(e,sc).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:lL(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return sk(e,sc).put({bundleId:t.id,createTime:lx(ll(t.createTime)),version:t.version})}getNamedQuery(e,t){return sk(e,sd).get(t).next(e=>{if(e)return{name:e.name,query:lF(e.bundledQuery),readTime:lL(e.readTime)}})}saveNamedQuery(e,t){return sk(e,sd).put({name:t.name,readTime:lx(ll(t.readTime)),bundledQuery:t.bundledQuery})}}class lH{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new lH(e,t.uid||"")}getOverlay(e,t){return sk(e,sA).get(lV(this.userId,t)).next(e=>e?lU(this.serializer,e):null)}getOverlays(e,t){let r=oh();return iS.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new oG(t,i);n.push(this.bt(e,s))}),iS.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(iH(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(sk(e,sA).X(sT,n))}),iS.waitFor(i)}getOverlaysForCollection(e,t,r){let n=oh(),i=iH(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return sk(e,sA).H(sT,s).next(e=>{for(let t of e){let e=lU(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=oh(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return sk(e,sA).ee({index:sv,range:a},(e,t,r)=>{let a=lU(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}bt(e,t){return sk(e,sA).put(function(e,t,r){let[n,i,s]=lV(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:lC(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class lG{St(e){return sk(e,sD)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?sK.fromUint8Array(t):sK.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class lq{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(s$(e.integerValue));else if("doubleValue"in e){let r=s$(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),ij(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=sQ(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(sZ(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?aC(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):aw(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):nB(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[an].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(s$(n)),this.Ot(an,t),this.Ct(r[an],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),n5.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function lW(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}lq.Wt=new lq;class lY{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=lW(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=lW(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class lK{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class lX{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class lQ{constructor(){this.cn=new lY,this.ascending=new lK(this.cn),this.descending=new lX(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class l${constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new l$(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:l1(this.Tn),directionalValue:l1(this.In),orderedDocumentKey:l1(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function lZ(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=lJ(e.Tn,t.Tn))||0!==(r=lJ(e.In,t.In))?r:n5.comparator(e.Pn,t.Pn)}function lJ(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function l1(e){return ry()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function l0(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class l2{constructor(e){for(const t of(this.Vn=new sH((e,t)=>n8.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(nU(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=ic(e);if(void 0!==t&&!this.pn(t))return!1;let r=id(e),n=new Set,i=0,s=0;for(;i<r.length&&this.pn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new sH(n8.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new ip(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ip(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ip(r.field,+("asc"!==r.dir))));return new ih(ih.UNKNOWN_ID,this.collectionId,t,im.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function l3(e){return e instanceof aM}function l4(e){return e instanceof aO&&aP(e)}function l6(e){return l3(e)||l4(e)||function(e){if(e instanceof aO&&aL(e)){for(let t of e.getFilters())if(!l3(t)&&!l4(t))return!1;return!0}return!1}(e)}function l8(e,t){return nU(e instanceof aM||e instanceof aO,38388),nU(t instanceof aM||t instanceof aO,25473),l7(e instanceof aM?t instanceof aM?aO.create([e,t],"and"):l5(e,t):t instanceof aM?l5(t,e):function(e,t){if(nU(e.filters.length>0&&t.filters.length>0,48005),ax(e)&&ax(t))return aB(e,t.getFilters());let r=aL(e)?e:t,n=aL(e)?t:e,i=r.filters.map(e=>l8(e,n));return aO.create(i,"or")}(e,t))}function l5(e,t){if(ax(t))return aB(t,e.getFilters());{let r=t.filters.map(t=>l8(e,t));return aO.create(r,"or")}}function l7(e){if(nU(e instanceof aM||e instanceof aO,11850),e instanceof aM)return e;let t=e.getFilters();if(1===t.length)return l7(t[0]);if(ak(e))return e;let r=t.map(e=>l7(e)),n=[];return r.forEach(t=>{t instanceof aM?n.push(t):t instanceof aO&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:aO.create(n,e.op)}class l9{constructor(){this.Sn=new ue}addToCollectionParentIndex(e,t){return this.Sn.add(t),iS.resolve()}getCollectionParents(e,t){return iS.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return iS.resolve()}deleteFieldIndex(e,t){return iS.resolve()}deleteAllFieldIndexes(e){return iS.resolve()}createTargetIndexes(e,t){return iS.resolve()}getDocumentsMatchingTarget(e,t){return iS.resolve(null)}getIndexType(e,t){return iS.resolve(0)}getFieldIndexes(e,t){return iS.resolve([])}getNextCollectionGroupToUpdate(e){return iS.resolve(null)}getMinOffset(e,t){return iS.resolve(iE.min())}getMinOffsetFromCollectionGroup(e,t){return iS.resolve(iE.min())}updateCollectionGroup(e,t,r){return iS.resolve()}updateIndexEntries(e,t){return iS.resolve()}}class ue{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new sH(n4.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new sH(n4.comparator)).toArray()}}let ut="IndexedDbIndexManager",ur=new Uint8Array(0);class un{constructor(e,t){this.databaseId=t,this.Dn=new ue,this.Cn=new os(e=>aK(e),(e,t)=>aX(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:r,parent:iH(n)};return sk(e,sl).put(i)}return iS.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return sk(e,sl).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(iG(n.parent))}return r})}addFieldIndex(e,t){let r=sk(e,sf),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=sk(e,sp);return i.next(e=>{r.put(lj(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=sk(e,sf),n=sk(e,sp),i=sk(e,sE);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=sk(e,sf),r=sk(e,sE),n=sk(e,sp);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return iS.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new l2(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=sk(e,sE),n=!0,i=new Map;return iS.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=of(),n=[];return iS.forEach(i,(i,s)=>{nx(ut,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${aK(t)}`);let a=function(e,t){let r=ic(t);if(void 0===r)return null;for(let t of a$(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of id(t))for(let t of a$(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of id(t)){let t=0===i.kind?aZ(e,i.fieldPath,e.startAt):aJ(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new ab(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of id(t)){let t=0===i.kind?aJ(e,i.fieldPath,e.endAt):aZ(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new ab(r,n)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return iS.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=n5.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return iS.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(nU(t instanceof aM||t instanceof aO,34018),t instanceof aM)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=aO.create(r,t.op);return l6(n=l7(n))?n:(nU(n instanceof aO,64498),nU(ax(n),40251),nU(n.filters.length>1,57927),n.filters.reduce((e,t)=>l8(e,t)))}(function e(t){if(nU(t instanceof aM||t instanceof aO,20012),t instanceof aM){if(t instanceof aH){let e=t.value.arrayValue?.values?.map(e=>aM.create(t.field,"==",e))||[];return aO.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return aO.create(r,t.op)}(e));return nU(l6(t),7391),l3(t)||l4(t)?[t]:t.getFilters()})(aO.create(e.filters,"and")).map(t=>aY(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):ur,c=this.Bn(e,o,r[h%l],n),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,r,n){let i=new l$(e,n5.empty(),t,r);return n?i:i.En()}Ln(e,t,r,n){let i=new l$(e,n5.empty(),t,r);return n?i.En():i}Fn(e,t){let r=new l2(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return iS.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new sH(n8.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new lQ;for(let n of id(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.ln(n.kind);lq.Wt.Dt(e,i)}return r.un()}Nn(e){let t=new lQ;return lq.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new lQ;return lq.Wt.Dt(ad(this.databaseId,t),n.ln(0===(r=id(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new lQ);let i=0;for(let s of id(e)){let e=r[i++];for(let r of n)if(this.qn(t,s.fieldPath)&&ag(e))n=this.Un(n,s,e);else{let t=r.ln(s.kind);lq.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new lQ;n.seed(r.un()),lq.Wt.Dt(e,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof aM&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=sk(e,sf),n=sk(e,sp);return(t?r.H(sg,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return iS.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new im(r.sequenceNumber,new iE(lL(r.readTime),new n5(iG(r.documentKey)),r.largestBatchId)):im.empty(),i=e.fields.map(([e,t])=>new ip(n8.fromServerFormat(e),t)),new ih(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:nZ(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=sk(e,sf),i=sk(e,sp);return this.Wn(e).next(e=>n.H(sg,IDBKeyRange.bound(t,t)).next(t=>iS.forEach(t,t=>i.put(lj(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return iS.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?iS.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),iS.forEach(i,r=>this.Qn(e,t,r).next(t=>{let i=this.Gn(n,r);return t.isEqual(i)?iS.resolve():this.zn(e,n,r,t,i)}))))})}jn(e,t,r,n){return sk(e,sE).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return sk(e,sE).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=sk(e,sE),i=new sH(lZ);return n.ee({index:sI,range:IDBKeyRange.only([r.indexId,this.uid,l1(this.Kn(r,t))])},(e,n)=>{i=i.add(new l$(r.indexId,t,l0(n.arrayValue),l0(n.directionalValue)))}).next(()=>i)}Gn(e,t){let r=new sH(lZ),n=this.kn(t,e);if(null==n)return r;let i=ic(t);if(null!=i){let s=e.data.field(i.fieldPath);if(ag(s))for(let i of s.arrayValue.values||[])r=r.add(new l$(t.indexId,e.key,this.Nn(i),n))}else r=r.add(new l$(t.indexId,e.key,ur,n));return r}zn(e,t,r,n,i){nx(ut,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=sq(s),l=sq(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=sq(a)):t?(i(o),o=sq(s)):(o=sq(s),l=sq(a))}}(n,i,lZ,n=>{s.push(this.jn(e,t,r,n))},n=>{s.push(this.Hn(e,t,r,n))}),iS.waitFor(s)}Wn(e){let t=1;return sk(e,sp).ee({index:sy,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>lZ(e,t)).filter((e,t,r)=>!t||0!==lZ(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=lZ(i,e),s=lZ(i,t);if(0===r)n[0]=e.En();else if(r>0&&s<0)n.push(i),n.push(i.En());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,ur,n5.empty()),r=n[e+1].An(this.uid,ur,n5.empty());i.push(IDBKeyRange.bound(t,r))}return i}Jn(e,t){return lZ(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ui)}getMinOffset(e,t){return iS.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||nB(44426))).next(ui)}}function ui(e){nU(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>iC(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new iE(t.readTime,t.documentKey,r)}let us={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ua{static withCacheSize(e){return new ua(e,ua.DEFAULT_COLLECTION_PERCENTILE,ua.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function uo(e,t,r){let n=e.store(iX),i=e.store(i1),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{nU(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,iH(h),c]);s.push(i.delete(n)),u.push(e.key)}return iS.waitFor(s).next(()=>u)}function ul(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw nB(14731);t=e.noDocument}return JSON.stringify(t).length}ua.DEFAULT_COLLECTION_PERCENTILE=10,ua.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ua.DEFAULT=new ua(0x2800000,ua.DEFAULT_COLLECTION_PERCENTILE,ua.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ua.DISABLED=new ua(-1,0,0);class uu{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return nU(""!==e.uid,64387),new uu(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return uc(e).ee({index:i$,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=sk(e,i1),s=uc(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;nU("number"==typeof a,49019);let f=new oz(a,t,r,n),g=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>lC(o.yt,e)),d=f.mutations.map(e=>lC(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),p=[],m=new sH((e,t)=>nZ(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,iH(h),a]);m=m.add(e.key.path.popLast()),p.push(s.put(g)),p.push(i.put(t,iJ))}return m.forEach(t=>{p.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),iS.waitFor(p).next(()=>f)})}lookupMutationBatch(e,t){return uc(e).get(t).next(e=>e?(nU(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),lP(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?iS.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return uc(e).ee({index:i$,range:n},(e,t,n)=>{t.userId===this.userId&&(nU(t.batchId>=r,47524,{Yn:r}),i=lP(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return uc(e).ee({index:i$,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return uc(e).H(i$,t).next(e=>e.map(e=>lP(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,iH(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return sk(e,i1).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=iG(o);if(a===this.userId&&t.path.isEqual(u))return uc(e).get(l).next(e=>{if(!e)throw nB(61480,{er:r,batchId:l});nU(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(lP(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new sH(nZ),n=[];return t.forEach(t=>{let i=[this.userId,iH(t.path)],s=IDBKeyRange.lowerBound(i),a=sk(e,i1).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=iG(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),iS.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,iH(r)],s=IDBKeyRange.lowerBound(i),a=new sH(nZ);return sk(e,i1).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=iG(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(uc(e).get(t).next(e=>{if(null===e)throw nB(35274,{batchId:t});nU(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(lP(this.serializer,e))}))}),iS.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return uo(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),iS.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return iS.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return sk(e,i1).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=iG(e[1]);n.push(t)}else r.done()}).next(()=>{nU(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return uh(e,this.userId,t)}ir(e){return sk(e,iK).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function uh(e,t,r){let n=[t,iH(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return sk(e,i1).ee({range:s,Y:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function uc(e){return sk(e,iX)}class ud{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new ud(0)}static ar(){return new ud(-1)}}class uf{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new ud(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>iu.fromTimestamp(new il(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>sk(e,i9).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(nU(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return sk(e,i9).ee((s,a)=>{let o=lk(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>iS.waitFor(i)).next(()=>n)}forEachTarget(e,t){return sk(e,i9).ee((e,r)=>{t(lk(r))})}ur(e){return sk(e,so).get(sa).next(e=>(nU(null!==e,2888),e))}cr(e,t){return sk(e,so).put(sa,t)}lr(e,t){return sk(e,i9).put(lB(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=aK(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return sk(e,i9).ee({range:n,index:se},(e,r,n)=>{let s=lk(r);aX(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=ug(e);return t.forEach(t=>{let s=iH(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),iS.waitFor(n)}removeMatchingKeys(e,t,r){let n=ug(e);return iS.forEach(t,t=>{let i=iH(t.path);return iS.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=ug(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=ug(e),i=of();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new n5(iG(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=iH(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return ug(e).ee({index:si,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return sk(e,i9).get(t).next(e=>e?lk(e):null)}}function ug(e){return sk(e,sr)}let up="LruGarbageCollector";function um([e,t],[r,n]){let i=nZ(e,r);return 0===i?nZ(t,n):i}class uy{constructor(e){this.Pr=e,this.buffer=new sH(um),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>um(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class uw{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){nx(up,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){iM(e)?nx(up,"Ignoring IndexedDB error during garbage collection: ",e):await iA(e)}await this.Ar(3e5)})}}class uE{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return iS.resolve(iU.ce);let r=new uy(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(nx("LruGarbageCollector","Garbage collection skipped; disabled"),iS.resolve(us)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(nx("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),us):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(nx("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),nO()<=q.DEBUG&&nx("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),iS.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class uC{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new uE(e,t)}(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return uI(e,r)}removeReference(e,t,r){return uI(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return uI(e,t)}wr(e,t){let r;return r=!1,sk(e,iK).te(n=>uh(e,n,t).next(e=>(e&&(r=!0),iS.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,iu.min()),ug(e).delete([0,iH(s.path)])))});n.push(t)}}).next(()=>iS.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return uI(e,t)}yr(e,t){let r=ug(e),n,i=iU.ce;return r.ee({index:si},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==iU.ce&&t(new n5(iG(n)),i),i=a,n=s):i=iU.ce}).next(()=>{i!==iU.ce&&t(new n5(iG(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function uI(e,t){var r;return ug(e).put((r=e.currentSequenceNumber,{targetId:0,path:iH(t.path),sequenceNumber:r}))}class u_{constructor(){this.changes=new os(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,aT.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?iS.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class uA{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return sk(e,i0).put(r)}removeEntry(e,t,r){let n;return sk(e,i0).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],lO(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=aT.newInvalidDocument(t);return sk(e,i0).ee({index:i3,range:IDBKeyRange.only(uT(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:aT.newInvalidDocument(t)};return sk(e,i0).ee({index:i3,range:IDBKeyRange.only(uT(t))},(e,n)=>{r={document:this.Sr(t,n),size:ul(n)}}).next(()=>r)}getEntries(e,t){let r=oa;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=oa,n=new sV(n5.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);r=r.insert(e,i),n=n.insert(e,ul(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return iS.resolve();let n=new sH(uv);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(uT(n.first()),uT(n.last())),s=n.getIterator(),a=s.getNext();return sk(e,i0).ee({index:i3,range:i},(e,t,n)=>{let i=n5.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>uv(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(uT(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),lO(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return sk(e,i0).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=oa;for(let i of e){let e=this.Sr(n5.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(or(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=oa,s=ub(t,r),a=ub(t,iE.max());return sk(e,i0).ee({index:i6,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Sr(n5.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new uS(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return sk(e,i5).get(i7).next(e=>(nU(!!e,20021),e))}br(e,t){return sk(e,i5).put(i7,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=lE(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=n5.fromSegments(t.noDocument.path),r=lL(t.noDocument.readTime);n=aT.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return nB(56709);{let e=n5.fromSegments(t.unknownDocument.path),r=lL(t.unknownDocument.version);n=aT.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new il((r=t.readTime)[0],r[1]),iu.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(iu.min())))return e}return aT.newInvalidDocument(e)}}class uS extends u_{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new os(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new sH((e,t)=>nZ(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=lM(this.Mr.serializer,s);n=n.add(i.path.popLast());let l=ul(o);r+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=lM(this.Mr.serializer,s.convertToNoDocument(iu.min()));t.push(this.Mr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),iS.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function uT(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ub(e,t){let r=t.documentKey.path.toArray();return[e,lO(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function uv(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=nZ(r[e],n[e]))return i;return(i=nZ(r.length,n.length))||(i=nZ(r[r.length-2],n[n.length-2]))||nZ(r[r.length-1],n[n.length-1])}class uN{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class uD{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&ox(r.mutation,e,sW.empty(),il.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,of()).next(()=>t))}getLocalViewOfDocuments(e,t,r=of()){let n=oh();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=ol();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=oh();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,of()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=oa,s=oh(),a=oh();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof ok)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),ox(a.mutation,t,a.mutation.getFieldMask(),il.now())):s.set(t.key,sW.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new uN(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=oh(),n=new sV((e,t)=>e-t),i=of();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||sW.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||of()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=oh();l.forEach(e=>{if(!i.has(e)){let n=oO(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return iS.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return n5.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):a3(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):iS.resolve(oh()),a=-1,o=i;return s.next(t=>iS.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?iS.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,of())).next(e=>({batchId:a,changes:ou(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new n5(t)).next(e=>{let t=ol();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=ol();return this.indexManager.getCollectionParents(e,i).next(a=>iS.forEach(a,a=>{let o=new a1(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,aT.newInvalidDocument(n)))});let r=ol();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&ox(s.mutation,n,sW.empty(),il.now()),or(t,n)&&(r=r.insert(e,n))}),r})}}class uR{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return iS.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:ll(t.createTime)}),iS.resolve()}getNamedQuery(e,t){return iS.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:lF(t.bundledQuery),readTime:ll(t.readTime)}),iS.resolve()}}class uM{constructor(){this.overlays=new sV(n5.comparator),this.Lr=new Map}getOverlay(e,t){return iS.resolve(this.overlays.get(t))}getOverlays(e,t){let r=oh();return iS.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),iS.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),iS.resolve()}getOverlaysForCollection(e,t,r){let n=oh(),i=t.length+1,s=new n5(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return iS.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new sV((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=oh(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=oh(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return iS.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new oG(t,r));let i=this.Lr.get(t);void 0===i&&(i=of(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class uO{constructor(){this.sessionToken=sK.EMPTY_BYTE_STRING}getSessionToken(e){return iS.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,iS.resolve()}}class ux{constructor(){this.kr=new sH(uL.Kr),this.qr=new sH(uL.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new uL(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new uL(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new n5(new n4([])),r=new uL(t,e),n=new uL(t,e+1),i=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new n5(new n4([])),r=new uL(t,e),n=new uL(t,e+1),i=of();return this.qr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new uL(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class uL{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return n5.comparator(e.key,t.key)||nZ(e.Hr,t.Hr)}static Ur(e,t){return nZ(e.Hr,t.Hr)||n5.comparator(e.key,t.key)}}class uP{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new sH(uL.Kr)}checkEmpty(e){return iS.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new oz(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Jr=this.Jr.add(new uL(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return iS.resolve(s)}lookupMutationBatch(e,t){return iS.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return iS.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return iS.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return iS.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new uL(t,0),n=new uL(t,1/0),i=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),iS.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new sH(nZ);return t.forEach(e=>{let t=new uL(e,0),n=new uL(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),iS.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;n5.isDocumentKey(i)||(i=i.child(""));let s=new uL(new n5(i),0),a=new sH(nZ);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},s),iS.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){nU(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return iS.forEach(t.mutations,n=>{let i=new uL(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new uL(t,0),n=this.Jr.firstAfterOrEqual(r);return iS.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,iS.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class uk{constructor(e){this.ti=e,this.docs=new sV(n5.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return iS.resolve(r?r.document.mutableCopy():aT.newInvalidDocument(t))}getEntries(e,t){let r=oa;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():aT.newInvalidDocument(e))}),iS.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=oa,s=t.path,a=new n5(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=iC(iw(a),r)||(n.has(a.key)||or(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return iS.resolve(i)}getAllFromCollectionGroup(e,t,r,n){nB(9500)}ni(e,t){return iS.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new uB(this)}getSize(e){return iS.resolve(this.size)}}class uB extends u_{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),iS.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class uF{constructor(e){this.persistence=e,this.ri=new os(e=>aK(e),aX),this.lastRemoteSnapshotVersion=iu.min(),this.highestTargetId=0,this.ii=0,this.si=new ux,this.targetCount=0,this.oi=ud._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),iS.resolve()}getLastRemoteSnapshotVersion(e){return iS.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return iS.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),iS.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),iS.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new ud(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,iS.resolve()}updateTargetData(e,t){return this.lr(t),iS.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,iS.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),iS.waitFor(i).next(()=>n)}getTargetCount(e){return iS.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return iS.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),iS.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),iS.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),iS.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return iS.resolve(r)}containsKey(e,t){return iS.resolve(this.si.containsKey(t))}}class uU{constructor(e,t){this._i={},this.overlays={},this.ai=new iU(0),this.ui=!1,this.ui=!0,this.ci=new uO,this.referenceDelegate=e(this),this.li=new uF(this),this.indexManager=new l9,this.remoteDocumentCache=function(e){return new uk(e)}(e=>this.referenceDelegate.hi(e)),this.serializer=new lR(t),this.Pi=new uR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uM,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new uP(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){nx("MemoryPersistence","Starting transaction:",e);let n=new uV(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return iS.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class uV extends i_{constructor(e){super(),this.currentSequenceNumber=e}}class uj{constructor(e){this.persistence=e,this.Ri=new ux,this.Ai=null}static Vi(e){return new uj(e)}get di(){if(this.Ai)return this.Ai;throw nB(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),iS.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),iS.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),iS.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return iS.forEach(this.di,r=>{let n=n5.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,iu.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return iS.or([()=>iS.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class uz{constructor(e,t){this.persistence=e,this.fi=new os(e=>iH(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new uE(e,t)}(this,t)}static Vi(e,t){return new uz(e,t)}Ti(){}Ii(e){return iS.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return iS.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?iS.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,iu.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),iS.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),iS.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),iS.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),iS.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(as(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=s4(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return sZ(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,sF(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw nB(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return iS.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return iS.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class uH{constructor(e){this.serializer=e}k(e,t,r,n){let i=new ib("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(iW),e.createObjectStore(iK,{keyPath:"userId"}),e.createObjectStore(iX,{keyPath:iQ,autoIncrement:!0}).createIndex(i$,iZ,{unique:!0}),e.createObjectStore(i1),uG(e),e.createObjectStore(iq));let s=iS.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(sr),e.deleteObjectStore(i9),e.deleteObjectStore(so),uG(e)),s=s.next(()=>{let e,t;return e=i.store(so),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:iu.min().toTimestamp(),targetCount:0},e.put(sa,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(iX).H().next(t=>{e.deleteObjectStore(iX),e.createObjectStore(iX,{keyPath:iQ,autoIncrement:!0}).createIndex(i$,iZ,{unique:!0});let r=i.store(iX),n=t.map(e=>r.put(e));return iS.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(sh,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.gi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(i5),this.pi(i)))),r<7&&n>=7&&(s=s.next(()=>this.yi(i))),r<8&&n>=8&&(s=s.next(()=>this.wi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.bi(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(sc,{keyPath:"bundleId"}),e.createObjectStore(sd,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(sA,{keyPath:sS})).createIndex(sT,sb,{unique:!1}),t.createIndex(sv,sN,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(i0,{keyPath:i2})).createIndex(i3,i4),t.createIndex(i6,i8)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(iq))),r<14&&n>=14&&(s=s.next(()=>this.Di(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(sf,{keyPath:"indexId",autoIncrement:!0}).createIndex(sg,"collectionGroup",{unique:!1}),e.createObjectStore(sp,{keyPath:sm}).createIndex(sy,sw,{unique:!1}),e.createObjectStore(sE,{keyPath:sC}).createIndex(sI,s_,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(sp).clear()}).next(()=>{t.objectStore(sE).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(sD,{keyPath:"name"})})),r<18&&n>=18&&ry()&&(s=s.next(()=>{t.objectStore(sp).clear()}).next(()=>{t.objectStore(sE).clear()})),s}pi(e){let t=0;return e.store(iq).ee((e,r)=>{t+=ul(r)}).next(()=>{let r={byteSize:t};return e.store(i5).put(i7,r)})}gi(e){let t=e.store(iK),r=e.store(iX);return t.H().next(t=>iS.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(i$,n).next(r=>iS.forEach(r,r=>{nU(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=lP(this.serializer,r);return uo(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(sr),r=e.store(iq);return e.store(so).get(sa).next(e=>{let n=[];return r.ee((r,i)=>{let s=new n4(r),a=[0,iH(s)];n.push(t.get(a).next(r=>r?iS.resolve():t.put({targetId:0,path:iH(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>iS.waitFor(n))})}wi(e,t){e.createObjectStore(sl,{keyPath:su});let r=t.store(sl),n=new ue,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:iH(n)})}};return t.store(iq).ee({Y:!0},(e,t)=>i(new n4(e).popLast())).next(()=>t.store(i1).ee({Y:!0},([e,t,r],n)=>i(iG(t).popLast())))}bi(e){let t=e.store(i9);return t.ee((e,r)=>{let n=lk(r),i=lB(this.serializer,n);return t.put(i)})}Si(e,t){let r=t.store(iq),n=[];return r.ee((e,r)=>{let i=t.store(i0),s=(r.document?new n5(n4.fromString(r.document.name).popFirst(5)):r.noDocument?n5.fromSegments(r.noDocument.path):r.unknownDocument?n5.fromSegments(r.unknownDocument.path):nB(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>iS.waitFor(n))}Di(e,t){let r=t.store(iX),n=new uA(this.serializer),i=new uU(uj.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??of();lP(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),iS.forEach(r,(e,r)=>{let s=new nD(r),a=lH.wt(this.serializer,s),o=i.getIndexManager(s);return new uD(n,uu.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new sP(t,iU.ce),e).next()})})}}function uG(e){e.createObjectStore(sr,{keyPath:sn}).createIndex(si,ss,{unique:!0}),e.createObjectStore(i9,{keyPath:"targetId"}).createIndex(se,st,{unique:!0}),e.createObjectStore(so)}let uq="IndexedDbPersistence",uW="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class uY{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!uY.v())throw new nj(nV.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new uC(this,n),this.Ki=t+"main",this.serializer=new lR(o),this.qi=new iv(this.Ki,this.xi,new uH(this.serializer)),this.ci=new lG,this.li=new uf(this.referenceDelegate,this.serializer),this.remoteDocumentCache=function(e){return new uA(e)}(this.serializer),this.Pi=new lz,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&nL(uq,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new nj(nV.FAILED_PRECONDITION,uW);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new iU(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>sk(e,sh).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(iM(e))return nx(uq,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return nx(uq,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return sk(e,iW).get(iY).next(e=>iS.resolve(this.Xi(e)))}Yi(e){return sk(e,sh).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=sk(e,sh);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return iS.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?iS.resolve(!0):sk(e,iW).get(iY).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new nj(nV.FAILED_PRECONDITION,uW);return!1}}return!(!this.networkEnabled||!this.inForeground)||sk(e,sh).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&nx(uq,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[iW,sh],e=>{let t=new sP(e,iU.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>sk(e,sh).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return uu.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new un(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return lH.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let i;nx(uq,"Starting transaction:",e);let s=18===(n=this.xi)||17===n?sL:16===n||15===n?sx:14===n||13===n?sO:12===n?sM:11===n?sR:void nB(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new sP(n,this.ai?this.ai.next():iU.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw nL(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new nj(nV.FAILED_PRECONDITION,iI);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return sk(e,iW).get(iY).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new nj(nV.FAILED_PRECONDITION,uW)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return sk(e,iW).put(iY,t)}static v(){return iv.v()}Ji(e){let t=sk(e,iW);return t.get(iY).next(e=>this.Xi(e)?(nx(uq,"Releasing primary lease."),t.delete(iY)):iS.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(nL(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;rm()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return nx(uq,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return nL(uq,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){nL("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function uK(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class uX{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=of(),n=of();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new uX(e,t.fromCache,r,n)}}class uQ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class u${constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=rm()?8:iN(rf())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new uQ;return this.ys(e,t,r).next(n=>{if(i.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>i.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(nO()<=q.DEBUG&&nx("QueryEngine","SDK will not create cache indexes for query:",ot(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),iS.resolve()):(nO()<=q.DEBUG&&nx("QueryEngine","Query:",ot(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(nO()<=q.DEBUG&&nx("QueryEngine","The SDK decides to create cache indexes for query:",ot(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,a6(t))):iS.resolve())}gs(e,t){if(a2(t))return iS.resolve(null);let r=a6(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=a6(t=a7(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=of(...n);return this.fs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.bs(t,n);return this.Ss(t,s,i,r.readTime)?this.gs(e,a7(t,null,"F")):this.Ds(e,s,t,r)}))})))}ps(e,t,r,n){return a2(t)||n.isEqual(iu.min())?iS.resolve(null):this.fs.getDocuments(e,r).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,r,n)?iS.resolve(null):(nO()<=q.DEBUG&&nx("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ot(t)),this.Ds(e,s,t,iy(n,-1)).next(e=>e))})}bs(e,t){let r=new sH(oi(e));return t.forEach((t,n)=>{or(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ys(e,t,r){return nO()<=q.DEBUG&&nx("QueryEngine","Using full collection scan to execute query:",ot(t)),this.fs.getDocumentsMatchingQuery(e,t,iE.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let uZ="LocalStore";class uJ{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new sV(nZ),this.Fs=new os(e=>aK(e),aX),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new uD(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function u1(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=of();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function u0(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function u2(e,t,r){let n=of(),i=of();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=oa;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(iu.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):nx(uZ,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Bs:n,Ls:i}})}function u3(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(i=>i?(n=i,iS.resolve(n)):e.li.allocateTargetId(r).next(i=>(n=new lD(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function u4(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!iM(e))throw e;nx(uZ,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function u6(e,t,r){let n=iu.min(),i=of();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=a6(t),void 0!==(o=e.Fs.get(a))?iS.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,r?n:iu.min(),r?i:of())).next(r=>(u7(e,on(t),r),{documents:r,ks:i}))})}function u8(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function u5(e,t){let r=e.Ms.get(t)||iu.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,iy(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(u7(e,t,r),r))}function u7(e,t,r){let n=e.Ms.get(t)||iu.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function u9(e,t,r,n){let i=of(),s=oa;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(i=i.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await u3(e,a6(a0(n4.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>u2(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function he(e,t,r=of()){let n=await u3(e,a6(lF(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=ll(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=n.withResumeToken(sK.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.li.addMatchingKeys(i,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let ht="firestore_clients";function hr(e,t){return`${ht}_${e}_${t}`}let hn="firestore_mutations";function hi(e,t,r){let n=`${hn}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let hs="firestore_targets";function ha(e,t){return`${hs}_${e}_${t}`}let ho="SharedClientState";class hl{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new nj(n.error.code,n.error.message)),s?new hl(e,t,n.state,i):(nL(ho,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new nj(r.error.code,r.error.message)),i?new hu(e,r.state,n):(nL(ho,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=og;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=iz(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new hh(e,i):(nL(ho,`Failed to parse client data for instance '${e}': ${t}`),null)}}class hc{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new hc(t.clientId,t.onlineState):(nL(ho,`Failed to parse online state: ${e}`),null)}}class hd{constructor(){this.activeTargetIds=og}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class hf{constructor(e,t,r,n,i){this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new sV(nZ),this.started=!1,this.Zs=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=hr(this.persistenceKey,this.zs),this.Ys=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Js=this.Js.insert(this.zs,new hd),this.eo=RegExp(`^${ht}_${s}_([^_]*)$`),this.no=RegExp(`^${hn}_${s}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${hs}_${s}_(\\d+)$`),this.io=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.so=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(hr(this.persistenceKey,e));if(t){let r=hh.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(ha(this.persistenceKey,e));if(t){let n=hu.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ha(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return nx(ho,"READ",e,t),t}setItem(e,t){nx(ho,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){nx(ho,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(nx(ho,"EVENT",e.key,e.newValue),e.key===this.Xs)return void nL("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=iU.ce;if(null!=e)try{let r=JSON.parse(e);nU("number"==typeof r,30636,{yo:e}),t=r}catch(e){nL(ho,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==iU.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new hl(this.currentUser,e,t,r),i=hi(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}lo(e){let t=hi(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=ha(this.persistenceKey,e),i=new hu(e,t,r);this.setItem(n,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return hh.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return hl.$s(new nD(i),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return hu.$s(r,t)}_o(e){return hc.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);nx(ho,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),i=this.uo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=og;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class hg{constructor(){this.vo=new hd,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new hd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class hp{Mo(e){}shutdown(){}}let hm="ConnectivityMonitor";class hy{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(nx(hm,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(nx(hm,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let hw=null;function hE(){return null===hw?hw=0x10000000+Math.round(0x80000000*Math.random()):hw++,"0x"+hw.toString(16)}let hC="RestConnection",hI={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class h_{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===s5?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let s=hE(),a=this.Qo(e,t.toUriEncodedString());nx(hC,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,i);let{host:l}=new URL(a),u=ro(l);return this.zo(e,a,o,r,u).then(t=>(nx(hC,`Received RPC '${e}' ${s}: `,t),t),t=>{throw nP(hC,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,i,s){return this.Wo(e,t,r,n,i)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+nR,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=hI[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class hA{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let hS="WebChannelConnection",hT=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class hb extends h_{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){hb.c_||(hT(ee(),J.STAT_EVENT,e=>{e.stat===Z.PROXY?nx(hS,"STAT_EVENT: detected buffering proxy"):e.stat===Z.NOPROXY&&nx(hS,"STAT_EVENT: detected no buffering proxy")}),hb.c_=!0)}zo(e,t,r,n,i){let s=hE();return new Promise((i,a)=>{let o=new K;o.setWithCredentials(!0),o.listenOnce(Q.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case $.NO_ERROR:let t=o.getResponseJson();nx(hS,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case $.TIMEOUT:nx(hS,`RPC '${e}' ${s} timed out`),a(new nj(nV.DEADLINE_EXCEEDED,"Request time out"));break;case $.HTTP_ERROR:let r=o.getStatus();if(nx(hS,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(nV).indexOf(e)>=0?e:nV.UNKNOWN);a(new nj(r,t.message))}else a(new nj(nV.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new nj(nV.UNAVAILABLE,"Connection failed."));break;default:nB(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{nx(hS,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(n);nx(hS,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",l,r,15)})}T_(e,t,r){let n=hE(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;let l=i.join("");nx(hS,`Creating RPC '${e}' stream ${n}: ${l}`,a);let u=s.createWebChannel(l,a);this.I_(u);let h=!1,c=!1,d=new hA({Ho:t=>{c?nx(hS,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(h||(nx(hS,`Opening RPC '${e}' stream ${n} transport.`),u.open(),h=!0),nx(hS,`RPC '${e}' stream ${n} sending:`,t),u.send(t))},Jo:()=>u.close()});return hT(u,X.EventType.OPEN,()=>{c||(nx(hS,`RPC '${e}' stream ${n} transport opened.`),d.i_())}),hT(u,X.EventType.CLOSE,()=>{c||(c=!0,nx(hS,`RPC '${e}' stream ${n} transport closed`),d.o_(),this.E_(u))}),hT(u,X.EventType.ERROR,t=>{c||(c=!0,nP(hS,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),d.o_(new nj(nV.UNAVAILABLE,"The operation could not be completed")))}),hT(u,X.EventType.MESSAGE,t=>{if(!c){let r=t.data[0];nU(!!r,16349);let i=r?.error||r[0]?.error;if(i){nx(hS,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=er[e];if(void 0!==t)return oK(t)}(t),s=i.message;void 0===r&&(r=nV.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),c=!0,d.o_(new nj(r,s)),u.close()}else nx(hS,`RPC '${e}' stream ${n} received:`,r),d.__(r)}}),hb.u_(),setTimeout(()=>{d.s_()},0),d}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return et()}}function hv(){return"u">typeof window?window:null}function hN(){return"u">typeof document?document:null}function hD(e){return new li(e,!0)}hb.c_=!1;class hR{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&nx("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let hM="PersistentStream";class hO{constructor(e,t,r,n,i,s,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new hR(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===nV.RESOURCE_EXHAUSTED?(nL(t.toString()),nL("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===nV.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new nj(nV.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return nx(hM,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(nx(hM,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hx extends hO{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:nB(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(nU(void 0===i||"string"==typeof i,58123),sK.fromBase64String(i||"")):(nU(void 0===i||i instanceof nS.Buffer||i instanceof Uint8Array,16193),sK.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new o8(s,a,o,l&&new nj(void 0===l.code?nV.UNKNOWN:oK(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=lf(e,n.document.name),s=ll(n.document.updateTime),a=n.document.createTime?ll(n.document.createTime):iu.min(),o=new aS({mapValue:{fields:n.document.fields}}),l=aT.newFoundDocument(i,s,a,o);r=new o4(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=lf(e,n.document),s=n.readTime?ll(n.readTime):iu.min(),a=aT.newNoDocument(i,s);r=new o4([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=lf(e,n.document);r=new o4([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return nB(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new oW(n,i);r=new o6(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return iu.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?iu.min():t.readTime?ll(t.readTime):iu.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=lm(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=aQ(n)?{documents:l_(e,n)}:{query:lA(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=lo(e,t.resumeToken);let n=ls(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(iu.min())>0){r.readTime=la(e,t.snapshotVersion.toTimestamp());let n=ls(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return nB(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=lm(this.serializer),t.removeTarget=e,this.K_(t)}}class hL extends hO{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return nU(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,nU(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;nU(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(nU(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?ll(e.updateTime):ll(r)).isEqual(iu.min())&&(t=ll(r)),new oN(t,e.transformResults||[])})):[]),i=ll(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=lm(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>lC(this.serializer,e))};this.K_(t)}}class hP{}class hk extends hP{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new nj(nV.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,lh(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nV.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nj(nV.UNKNOWN,e.toString())})}jo(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,lh(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nV.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nj(nV.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class hB{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(nL(t),this.aa=!1):nx("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let hF="RemoteStore";class hU{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{hK(this)&&(nx(hF,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await hj(e),e.Va.set("Unknown"),e.Ea.delete(4),await hV(e)}(this))})}),this.Va=new hB(r,n)}}async function hV(e){if(hK(e))for(let t of e.Ra)await t(!0)}async function hj(e){for(let t of e.Ra)await t(!1)}function hz(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),hY(e)?hW(e):ce(e).O_()&&hG(e,t))}function hH(e,t){let r=ce(e);e.Ia.delete(t),r.O_()&&hq(e,t),0===e.Ia.size&&(r.O_()?r.L_():hK(e)&&e.Va.set("Unknown"))}function hG(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(iu.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}ce(e).Z_(t)}function hq(e,t){e.da.$e(t),ce(e).X_(t)}function hW(e){e.da=new o7({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),ce(e).start(),e.Va.ua()}function hY(e){return hK(e)&&!ce(e).x_()&&e.Ia.size>0}function hK(e){return 0===e.Ea.size}async function hX(e){e.Va.set("Online")}async function hQ(e){e.Ia.forEach((t,r)=>{hG(e,t)})}async function h$(e,t){e.da=void 0,hY(e)?(e.Va.ha(t),hW(e)):e.Va.set("Unknown")}async function hZ(e,t,r){if(e.Va.set("Online"),t instanceof o8&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){nx(hF,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await hJ(e,r)}else if(t instanceof o4?e.da.Xe(t):t instanceof o6?e.da.st(t):e.da.tt(t),!r.isEqual(iu.min()))try{let t,n=await u0(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(sK.EMPTY_BYTE_STRING,n.snapshotVersion)),hq(e,t);let i=new lD(n.target,t,r,n.sequenceNumber);hG(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){nx(hF,"Failed to raise snapshot:",t),await hJ(e,t)}}async function hJ(e,t,r){if(!iM(t))throw t;e.Ea.add(1),await hj(e),e.Va.set("Offline"),r||(r=()=>u0(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{nx(hF,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await hV(e)})}function h1(e,t){return t().catch(r=>hJ(e,r,t))}async function h0(e){var t;let r=ct(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;hK(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=ct(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await hJ(e,t)}h2(e)&&h3(e)}function h2(e){return hK(e)&&!ct(e).x_()&&e.Ta.length>0}function h3(e){ct(e).start()}async function h4(e){ct(e).ra()}async function h6(e){let t=ct(e);for(let r of e.Ta)t.ea(r.mutations)}async function h8(e,t,r){let n=e.Ta.shift(),i=oH.from(n,t,r);await h1(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await h0(e)}async function h5(e,t){t&&ct(e).Y_&&await async function(e,t){var r;if(oY(r=t.code)&&r!==nV.ABORTED){let r=e.Ta.shift();ct(e).B_(),await h1(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await h0(e)}}(e,t),h2(e)&&h3(e)}async function h7(e,t){e.asyncQueue.verifyOperationInProgress(),nx(hF,"RemoteStore received new credentials");let r=hK(e);e.Ea.add(3),await hj(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await hV(e)}async function h9(e,t){t?(e.Ea.delete(2),await hV(e)):t||(e.Ea.add(2),await hj(e),e.Va.set("Unknown"))}function ce(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:hX.bind(null,e),Yo:hQ.bind(null,e),t_:h$.bind(null,e),J_:hZ.bind(null,e)},t.sa(),e.ma=new hx(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),hY(e)?hW(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function ct(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:h4.bind(null,e),t_:h5.bind(null,e),ta:h6.bind(null,e),na:h8.bind(null,e)},t.sa(),e.fa=new hL(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await h0(e)):(await e.fa.stop(),e.Ta.length>0&&(nx(hF,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class cr{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new nz,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new cr(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new nj(nV.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cn(e,t){if(nL("AsyncQueue",`${t}: ${e}`),iM(e))return new nj(nV.UNAVAILABLE,`${t}: ${e}`);throw e}class ci{static emptySet(e){return new ci(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||n5.comparator(t.key,r.key):(e,t)=>n5.comparator(e.key,t.key),this.keyedMap=ol(),this.sortedSet=new sV(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ci)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new ci;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class cs{constructor(){this.ga=new sV(n5.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):nB(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class ca{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ca(e,t,ci.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&a9(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class co{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class cl{constructor(){this.queries=cu(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new nj(nV.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=cu(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function cu(){return new os(e=>oe(e),a9)}async function ch(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.Da()&&(r=2):(i=new co,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=cn(r,`Initialization of query '${ot(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&cg(e)}async function cc(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?n=+!t.Da():!i.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function cd(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(n)&&(r=!0);i.wa=n}}r&&cg(e)}function cf(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function cg(e){e.Ca.forEach(e=>{e.next()})}(es=ei||(ei={})).Ma="default",es.Cache="cache";class cp{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new ca(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=ca.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ei.Cache}}class cm{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class cy{constructor(e){this.serializer=e}Ks(e){return lf(this.serializer,e)}qs(e){return e.metadata.exists?lE(this.serializer,e.document,!1):aT.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return ll(e)}}class cw{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=cE(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=n4.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new cy(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||of()).add(e);t.set(r,n)}}return t}async ja(e){let t=await u9(e,new cy(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await he(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function cE(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class cC{constructor(e){this.key=e}}class cI{constructor(e){this.key=e}}class c_{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=of(),this.mutatedKeys=of(),this.eu=oi(e),this.tu=new ci(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new cs,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=or(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return nB(20277,{Vt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new ca(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new cs,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=of(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new cI(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new cC(r))}),t}cu(e){this.Za=e.ks,this.Ya=of();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ca.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let cA="SyncEngine";class cS{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class cT{constructor(e){this.key=e,this.hu=!1}}class cb{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new os(e=>oe(e),a9),this.Iu=new Map,this.Eu=new Set,this.Ru=new sV(n5.comparator),this.Au=new Map,this.Vu=new ux,this.du={},this.mu=new Map,this.fu=ud.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function cv(e,t,r=!0){let n,i=c3(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await cD(i,t,r,!0),n}async function cN(e,t){let r=c3(e);await cD(r,t,!0,!1)}async function cD(e,t,r,n){let i,s=await u3(e.localStore,a6(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await cR(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&hz(e.remoteStore,s),i}async function cR(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Ss&&(i=await u6(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return cH(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await u6(e.localStore,t,!0),a=new c_(t,s.ks),o=a.ru(s.documents),l=o3.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);cH(e,r,u.au);let h=new cS(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function cM(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!a9(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await u4(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&hH(e.remoteStore,n.targetId),cj(e,n.targetId)}).catch(iA)):(cj(e,n.targetId),await u4(e.localStore,n.targetId,!0))}async function cO(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),hH(e.remoteStore,r.targetId))}async function cx(e,t,r){let n=c4(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=il.now(),l=t.reduce((e,t)=>e.add(t.key),of()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=oa,s=of();return i.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=ow(n.transform,e||null);null!=i&&(null===r&&(r=aS.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new ok(r.key,t,function e(t){let r=[];return sF(t.fields,(t,n)=>{let i=new n8([t]);if(ay(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new sW(r)}(t.value.mapValue),oD.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:ou(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.du[n.currentUser.toKey()])||(u=new sV(nZ)),u=u.insert(s,r),n.du[n.currentUser.toKey()]=u,await cq(n,h.changes),await h0(n.remoteStore)}catch(t){let e=cn(t,"Failed to persist write");r.reject(e)}}async function cL(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.xs.newChangeBuffer({trackRemovals:!0});i=r.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(sK.EMPTY_BYTE_STRING,iu.min()).withLastLimboFreeSnapshotVersion(iu.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,h))});let o=oa,l=of();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(u2(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(iu.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return iS.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(nU(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?nU(n.hu,14607):t.removedDocuments.size>0&&(nU(n.hu,42227),n.hu=!1))}),await cq(e,s,t)}catch(e){await iA(e)}}function cP(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&cg(n),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function ck(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new sV(n5.comparator);r=r.insert(i,aT.newNoDocument(i,iu.min()));let n=of().add(i),s=new o2(iu.min(),new Map,new sV(nZ),r,n);await cL(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),cG(e)}else await u4(e.localStore,t,!1).then(()=>cj(e,t,r)).catch(iA)}async function cB(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=iS.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);nU(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=of();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));cV(e,n,null),cU(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await cq(e,i)}catch(e){await iA(e)}}async function cF(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(nU(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));cV(e,t,r),cU(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await cq(e,i)}catch(e){await iA(e)}}function cU(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function cV(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function cj(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||cz(e,t)})}function cz(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(hH(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),cG(e))}function cH(e,t,r){for(let n of r)n instanceof cC?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(nx(cA,"New document in limbo: "+r),e.Eu.add(n),cG(e))}(e,n)):n instanceof cI?(nx(cA,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||cz(e,n.key)):nB(19791,{wu:n})}function cG(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new n5(n4.fromString(t)),n=e.fu.next();e.Au.set(n,new cT(r)),e.Ru=e.Ru.insert(r,n),hz(e.remoteStore,new lD(a6(a0(r.path)),n,"TargetPurposeLimboResolution",iU.ce))}}async function cq(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=uX.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>iS.forEach(t,t=>iS.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>iS.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!iM(e))throw e;nx(uZ,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function cW(e,t){if(!e.currentUser.isEqual(t)){nx(cA,"User change. New user:",t.toKey());let r=await u1(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new nj(nV.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await cq(e,r.Ns)}}function cY(e,t){let r=e.Au.get(t);if(r&&r.hu)return of().add(r.key);{let r=of(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function cK(e,t){let r=await u6(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&cH(e,t.targetId,n.au),n}async function cX(e,t){return u5(e.localStore,t).then(t=>cq(e,t))}async function cQ(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):iS.resolve(null))));null!==o?("pending"===r?await h0(e.remoteStore):"acknowledged"===r||"rejected"===r?(cV(e,t,n||null),cU(e,t),s=e.localStore,s.mutationQueue.nr(t)):nB(6720,"Unknown batchState",{bu:r}),await cq(e,o)):nx(cA,"Cannot apply mutation batch with id: "+t)}async function c$(e,t){if(c3(e),c4(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await cZ(e,t.toArray());for(let t of(e.gu=!0,await h9(e.remoteStore,!0),r))hz(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(cj(e,i),u4(e.localStore,i,!0))),hH(e.remoteStore,i)}),await r,await cZ(e,t),e.Au.forEach((t,r)=>{hH(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new sV(n5.comparator),e.gu=!1,await h9(e.remoteStore,!1)}}async function cZ(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await u3(e.localStore,a6(s[0])),s)){let t=e.Tu.get(r),n=await cK(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await u8(e.localStore,r);t=await u3(e.localStore,n),await cR(e,cJ(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(i),n}function cJ(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new a1(t,r,n,i,s,"F",e.startAt,e.endAt)}function c1(e){return e.localStore.persistence.hs()}async function c0(e,t,r,n){if(e.gu)return void nx(cA,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await u5(e.localStore,on(i[0])),s=o2.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,sK.EMPTY_BYTE_STRING);await cq(e,n,s);break}case"rejected":await u4(e.localStore,t,!0),cj(e,t,n);break;default:nB(64155,r)}}async function c2(e,t,r){let n=c3(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){nx(cA,"Adding an already active target "+e);continue}let t=await u8(n.localStore,e),r=await u3(n.localStore,t);await cR(n,cJ(t),r.targetId,!1,r.resumeToken),hz(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await u4(n.localStore,e,!1).then(()=>{hH(n.remoteStore,e),cj(n,e)}).catch(iA)}}function c3(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=cL.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=cY.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ck.bind(null,e),e.Pu.J_=cd.bind(null,e.eventManager),e.Pu.yu=cf.bind(null,e.eventManager),e}function c4(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=cB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=cF.bind(null,e),e}class c6{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=hD(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new u$,new uJ(t,r,e.initialUser,this.serializer)}Cu(e){return new uU(uj.Vi,this.serializer)}Du(e){return new hg}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}c6.provider={build:()=>new c6};class c8 extends c6{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return nU(this.persistence.referenceDelegate instanceof uz,46915),new uw(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?ua.withCacheSize(this.cacheSizeBytes):ua.DEFAULT;return new uU(e=>uz.Vi(e,t),this.serializer)}}class c5 extends c6{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await c4(this.xu.syncEngine),await h0(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new u$,new uJ(t,r,e.initialUser,this.serializer)}Fu(e,t){return new uw(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new iF(t,this.persistence);return new iB(e.asyncQueue,r)}Cu(e){let t=uK(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?ua.withCacheSize(this.cacheSizeBytes):ua.DEFAULT;return new uY(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,hv(),hN(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new hg}}class c7 extends c5{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof hf&&(this.sharedClientState.syncEngine={So:cQ.bind(null,t),Do:c0.bind(null,t),Co:c2.bind(null,t),hs:c1.bind(null,t),bo:cX.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await c$(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=hv();if(!hf.v(t))throw new nj(nV.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=uK(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new hf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class c9{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>cP(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=cW.bind(null,this.syncEngine),await h9(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new cl}createDatastore(e){var t;let r=hD(e.databaseInfo.databaseId),n=new hb(e.databaseInfo);return t=e.authCredentials,new hk(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new hU(t,r,e.asyncQueue,e=>cP(this.syncEngine,e,0),hy.v()?new hy:new hp)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new cb(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){nx(hF,"RemoteStore shutting down."),e.Ea.add(5),await hj(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function de(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}c9.provider={build:()=>new c9};class dt{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):nL("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class dr{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new nz,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new cm(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class dn{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new cm(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new nj(nV.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class di{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new nj(nV.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>ld(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,n4.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(nU(!!t.found,43571),t.found.name,t.found.updateTime,n=lf(r,t.found.name),s=ll(t.found.updateTime),a=t.found.createTime?ll(t.found.createTime):iu.min(),o=new aS({mapValue:{fields:t.found.fields}}),aT.newFoundDocument(n,s,a,o)):"missing"in t?(nU(!!t.missing,3894),nU(!!t.readTime,22933),l=lf(r,t.missing),u=ll(t.readTime),aT.newNoDocument(l,u)):nB(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());nU(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new oV(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=n5.fromPath(t);this.mutations.push(new oj(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>lC(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,n4.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw nB(50498,{Gu:e.constructor.name});t=iu.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new nj(nV.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(iu.min())?oD.exists(!1):oD.updateTime(t):oD.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(iu.min()))throw new nj(nV.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return oD.updateTime(t)}return oD.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ds{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new hR(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new di(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!iV(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!oY(t)}return!1}}let da="FirestoreClient";class dl{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=nD.UNAUTHENTICATED,this.clientId=n$.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{nx(da,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(nx(da,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new nz;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=cn(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function du(e,t){e.asyncQueue.verifyOperationInProgress(),nx(da,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await u1(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function dh(e,t){e.asyncQueue.verifyOperationInProgress();let r=await dc(e);nx(da,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>h7(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>h7(t.remoteStore,r)),e._onlineComponents=t}async function dc(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){nx(da,"Using user provided OfflineComponentProvider");try{await du(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===nV.FAILED_PRECONDITION||t.code===nV.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;nP("Error using user provided cache. Falling back to memory cache: "+t),await du(e,new c6)}}else nx(da,"Using default OfflineComponentProvider"),await du(e,new c8(void 0));return e._offlineComponents}async function dd(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(nx(da,"Using user provided OnlineComponentProvider"),await dh(e,e._uninitializedComponentsProvider._online)):(nx(da,"Using default OnlineComponentProvider"),await dh(e,new c9))),e._onlineComponents}function df(e){return dc(e).then(e=>e.localStore)}function dg(e){return dd(e).then(e=>e.syncEngine)}function dp(e){return dd(e).then(e=>e.datastore)}async function dm(e){let t=await dd(e),r=t.eventManager;return r.onListen=cv.bind(null,t.syncEngine),r.onUnlisten=cM.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=cN.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=cO.bind(null,t.syncEngine),r}function dy(e,t,r={}){let n=new nz;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await dm(e),s=e.asyncQueue,a=new dt({next:e=>{a.Nu(),s.enqueueAndForget(()=>cc(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new nj(nV.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new nj(nV.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),ch(i,o=new cp(a0(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function dw(e,t,r={}){let n=new nz;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await dm(e),s=e.asyncQueue,o=new cp(t,a=new dt({next:e=>{a.Nu(),s.enqueueAndForget(()=>cc(i,o)),e.fromCache&&"server"===r.source?n.reject(new nj(nV.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),ch(i,o)}),n.promise}function dE(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let dC=new Map,dI="firestore.googleapis.com";class d_{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new nj(nV.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=dI,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new nj(nV.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new nj(nV.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dE(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new nj(nV.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new nj(nV.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new nj(nV.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class dA{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new d_({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new nj(nV.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new nj(nV.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new d_(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new nG;switch(e.type){case"firstParty":return new nK(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new nj(nV.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=dC.get(this))&&(nx("ComponentProvider","Removing Datastore"),dC.delete(this),e.terminate()),Promise.resolve()}}class dS{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dS(this.firestore,e,this._query)}}class dT{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new db(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new dT(this.firestore,e,this._key)}toJSON(){return{type:dT._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(io(t,dT._jsonSchema))return new dT(e,r||null,new n5(n4.fromString(t.referencePath)))}}dT._jsonSchemaVersion="firestore/documentReference/1.0",dT._jsonSchema={type:ia("string",dT._jsonSchemaVersion),referencePath:ia("string")};class db extends dS{constructor(e,t,r){super(e,t,a0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new dT(this.firestore,null,new n5(e))}withConverter(e){return new db(this.firestore,e,this._path)}}function dv(e,t,...r){if(e=rS(e),n7("collection","path",t),e instanceof dA){let n=n4.fromString(t,...r);return ie(n),new db(e,null,n)}{if(!(e instanceof dT||e instanceof db))throw new nj(nV.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(n4.fromString(t,...r));return ie(n),new db(e.firestore,null,n)}}function dN(e,t){return e=rS(e),t=rS(t),e instanceof dS&&t instanceof dS&&e.firestore===t.firestore&&a9(e._query,t._query)&&e.converter===t.converter}let dD="AsyncQueue";class dR{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new hR(this,"async_queue_retry"),this._c=()=>{let e=hN();e&&nx(dD,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=hN();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=hN();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new nz;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!iM(e))throw e;nx(dD,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,nL("INTERNAL UNHANDLED ERROR: ",dM(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=cr.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&nB(47125,{Pc:dM(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function dM(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class dO{constructor(){this._progressObserver={},this._taskCompletionResolver=new nz,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class dx extends dA{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new dR,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new dR(e),this._firestoreClient=void 0,await e}}}function dL(e){if(e._terminated)throw new nj(nV.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,i=e._app?.options.apiKey,new s8(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,dE(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new dl(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function dP(e,t){let r=dL(e=ii(e,dx)),n=new dO;return function(e,t,r,n){var i;let s=(i=hD(t),new dr(function(e,t){if(e instanceof Uint8Array)return de(e,void 0);if(e instanceof ArrayBuffer)return de(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?oQ().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=ll(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(cE(a));let o=new cw(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await cq(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return nP(cA,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await dg(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}class dk{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dk(sK.fromBase64String(e))}catch(e){throw new nj(nV.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new dk(sK.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:dk._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(io(e,dk._jsonSchema))return dk.fromBase64String(e.bytes)}}dk._jsonSchemaVersion="firestore/bytes/1.0",dk._jsonSchema={type:ia("string",dk._jsonSchemaVersion),bytes:ia("string")};class dB{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new nj(nV.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new n8(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class dF{constructor(e){this._methodName=e}}class dU{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new nj(nV.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new nj(nV.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return nZ(this._lat,e._lat)||nZ(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:dU._jsonSchemaVersion}}static fromJSON(e){if(io(e,dU._jsonSchema))return new dU(e.latitude,e.longitude)}}dU._jsonSchemaVersion="firestore/geoPoint/1.0",dU._jsonSchema={type:ia("string",dU._jsonSchemaVersion),latitude:ia("number"),longitude:ia("number")};class dV{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:dV._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(io(e,dV._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new dV(e.vectorValues);throw new nj(nV.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}dV._jsonSchemaVersion="firestore/vectorValue/1.0",dV._jsonSchema={type:ia("string",dV._jsonSchemaVersion),vectorValues:ia("object")};let dj=/^__.*__$/;class dz{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new ok(e,this.data,this.fieldMask,t,this.fieldTransforms):new oP(e,this.data,t,this.fieldTransforms)}}class dH{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ok(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dG(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw nB(40011,{dataSource:e})}}class dq{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new dq({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return d8(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(dG(this.dataSource)&&dj.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class dW{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||hD(e)}createContext(e,t,r,n=!1){return new dq({dataSource:e,methodName:t,targetDoc:r,path:n8.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function dY(e){let t=e._freezeSettings(),r=hD(e._databaseId);return new dW(e._databaseId,!!t.ignoreUndefinedProperties,r)}function dK(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);d2("Data must be an object, but it was:",l,n);let u=d1(n,l);if(s.merge)a=new sW(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=d3(t,n,r);if(!l.contains(i))throw new nj(nV.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);d5(e,i)||e.push(i)}a=new sW(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new dz(new aS(u),a,o)}class dX extends dF{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof dX}}function dQ(e,t,r,n){let i=e.createContext(1,t,r);d2("Data must be an object, but it was:",i,n);let s=[],a=aS.empty();return sF(n,(e,n)=>{let o=d6(t,e,r);n=rS(n);let l=i.childContextForFieldPath(o);if(n instanceof dX)s.push(o);else{let e=dJ(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new dH(a,new sW(s),i.fieldTransforms)}function d$(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[d3(t,n,r)],l=[i];if(s.length%2!=0)throw new nj(nV.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(d3(t,s[e])),l.push(s[e+1]);let u=[],h=aS.empty();for(let e=o.length-1;e>=0;--e)if(!d5(u,o[e])){let t=o[e],r=l[e];r=rS(r);let n=a.childContextForFieldPath(t);if(r instanceof dX)u.push(t);else{let e=dJ(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new dH(h,new sW(u),a.fieldTransforms)}function dZ(e,t,r,n=!1){return dJ(r,e.createContext(n?4:3,t))}function dJ(e,t){if(d0(e=rS(e)))return d2("Unsupported field value:",t,e),d1(e,t);if(e instanceof dF)return function(e,t){if(!dG(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=dJ(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,i;if(null===(e=rS(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,iz(n=e)?om(n):op(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=il.fromDate(e);return{timestampValue:la(t.serializer,r)}}if(e instanceof il){let r=new il(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:la(t.serializer,r)}}if(e instanceof dU)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof dk)return{bytesValue:lo(t.serializer,e._byteString)};if(e instanceof dT){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:lu(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof dV)return{mapValue:{fields:{[s9]:{stringValue:ar},[an]:{arrayValue:{values:((i=e)instanceof dV?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return op(t.serializer,e)})}}}}};if(lN(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${ir(e)}`)}(e,t)}function d1(e,t){let r={};return sU(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sF(e,(e,n)=>{let i=dJ(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function d0(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof il||e instanceof dU||e instanceof dk||e instanceof dT||e instanceof dF||e instanceof dV||lN(e))}function d2(e,t,r){if(!d0(r)||!it(r)){let n=ir(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function d3(e,t,r){if((t=rS(t))instanceof dB)return t._internalPath;if("string"==typeof t)return d6(e,t);throw d8("Field path arguments must be of type string or ",e,!1,void 0,r)}let d4=RegExp("[~\\*/\\[\\]]");function d6(e,t,r){if(t.search(d4)>=0)throw d8(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new dB(...t.split("."))._internalPath}catch(n){throw d8(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function d8(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new nj(nV.INVALID_ARGUMENT,o+e+l)}function d5(e,t){return e.some(e=>e.isEqual(t))}class d7{convertValue(e,t="none"){switch(as(e)){case 0:return null;case 1:return e.booleanValue;case 2:return s$(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sZ(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw nB(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return sF(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new dV(e.fields?.[an].arrayValue?.values?.map(e=>s$(e.doubleValue)))}convertGeoPoint(e){return new dU(s$(e.latitude),s$(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=s4(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(s6(e));default:return null}}convertTimestamp(e){let t=sQ(e);return new il(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=n4.fromString(e);nU(lv(r),9688,{name:e});let n=new s7(r.get(1),r.get(3)),i=new n5(r.popFirst(5));return n.isEqual(t)||nL(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class d9 extends d7{constructor(e){super(),this.firestore=e}convertBytes(e){return new dk(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new dT(this.firestore,null,t)}}let fe="@firebase/firestore",ft="4.10.0";function fr(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class fn{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class fi{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new aS({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class fs{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new dT(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new fa(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(d3("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class fa extends fs{data(){return super.data()}}function fo(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new nj(nV.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class fl{}class fu extends fl{}function fh(e,t,...r){let n=[];for(let i of(t instanceof fl&&n.push(t),function(e){let t=e.filter(e=>e instanceof ff).length,r=e.filter(e=>e instanceof fc).length;if(t>1||t>0&&r>0)throw new nj(nV.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class fc extends fu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new fc(e,t,r)}_apply(e){let t=this._parse(e);return fR(e._query,t),new dS(e.firestore,e.converter,a5(e._query,t))}_parse(e){let t=dY(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new nj(nV.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){fD(a,s);let t=[];for(let r of a)t.push(fN(n,e,r));o={arrayValue:{values:t}}}else o=fN(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||fD(a,s),o=dZ(r,t,a,"in"===s||"not-in"===s);return aM.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function fd(e,t,r){let n=d3("where",e);return fc._create(n,t,r)}class ff extends fl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ff(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:aO.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())fR(r,e),r=a5(r,e)}(e._query,t),new dS(e.firestore,e.converter,a5(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function fg(...e){return e.forEach(e=>fM("or",e)),ff._create("or",e)}function fp(...e){return e.forEach(e=>fM("and",e)),ff._create("and",e)}class fm extends fu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new fm(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new nj(nV.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new nj(nV.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new aD(t,r)}(e._query,this._field,this._direction);return new dS(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new a1(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function fy(e,t="asc"){let r=d3("orderBy",e);return fm._create(r,t)}class fw extends fu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new fw(e,t,r)}_apply(e){return new dS(e.firestore,e.converter,a7(e._query,this._limit,this._limitType))}}function fE(e){return is("limit",e),fw._create("limit",e,"F")}function fC(e){return is("limitToLast",e),fw._create("limitToLast",e,"L")}class fI extends fu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new fI(e,t,r)}_apply(e){var t;let r=fv(e,this.type,this._docOrFields,this._inclusive);return new dS(e.firestore,e.converter,(t=e._query,new a1(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function f_(...e){return fI._create("startAt",e,!0)}function fA(...e){return fI._create("startAfter",e,!1)}class fS extends fu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new fS(e,t,r)}_apply(e){var t;let r=fv(e,this.type,this._docOrFields,this._inclusive);return new dS(e.firestore,e.converter,(t=e._query,new a1(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function fT(...e){return fS._create("endBefore",e,!1)}function fb(...e){return fS._create("endAt",e,!0)}function fv(e,t,r,n){if(r[0]=rS(r[0]),r[0]instanceof fs)return function(e,t,r,n,i){if(!n)throw new nj(nV.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of a4(e))if(r.field.isKeyField())s.push(ad(t,n.key));else{let e=n.data.field(r.field);if(s3(e))throw new nj(nV.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new nj(nV.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new ab(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=dY(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new nj(nV.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new nj(nV.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!a3(e)&&-1!==l.indexOf("/"))throw new nj(nV.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(n4.fromString(l));if(!n5.isDocumentKey(r))throw new nj(nV.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new n5(r);o.push(ad(t,i))}else{let e=dZ(r,n,l);o.push(e)}}return new ab(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function fN(e,t,r){if("string"==typeof(r=rS(r))){if(""===r)throw new nj(nV.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!a3(t)&&-1!==r.indexOf("/"))throw new nj(nV.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(n4.fromString(r));if(!n5.isDocumentKey(n))throw new nj(nV.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ad(e,new n5(n))}if(r instanceof dT)return ad(e,r._key);throw new nj(nV.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ir(r)}.`)}function fD(e,t){if(!Array.isArray(e)||0===e.length)throw new nj(nV.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function fR(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new nj(nV.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new nj(nV.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function fM(e,t){if(!(t instanceof fc||t instanceof ff))throw new nj(nV.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function fO(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class fx extends d7{constructor(e){super(),this.firestore=e}convertBytes(e){return new dk(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new dT(this.firestore,null,t)}}function fL(e){return new fn("sum",d3("sum",e))}function fP(e){return new fn("avg",d3("average",e))}function fk(){return new fn("count")}function fB(e,t){return e instanceof fn&&t instanceof fn&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function fF(e,t){return dN(e.query,t.query)&&r_(e.data(),t.data())}function fU(e){return fV(e,{count:fk()})}function fV(e,t){var r;let n,i=ii(e.firestore,dx),s=dL(i),a=function(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(t,(e,t)=>new oq(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new nz,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await dp(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=function(e,t,r,n){let{ft:i,parent:s}=lA(e,t),a={},o=[],l=0;return r.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:lT(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:lT(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=a8(t,t.explicitOrderBy)),t.Re),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);nU(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new fi(e,new d9(i),t))}class fj{constructor(e){this.kind="memory",this._onlineComponentProvider=c9.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new c8(void 0)}}toJSON(){return{kind:this.kind}}}class fz{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=f$(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class fH{constructor(){this.kind="memoryEager",this._offlineComponentProvider=c6.provider}toJSON(){return{kind:this.kind}}}class fG{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new c8(e)}}toJSON(){return{kind:this.kind}}}function fq(){return new fH}function fW(e){return new fG(e?.cacheSizeBytes)}function fY(e){return new fj(e)}function fK(e){return new fz(e)}class fX{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=c9.provider,this._offlineComponentProvider={build:t=>new c5(t,e?.cacheSizeBytes,this.forceOwnership)}}}class fQ{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=c9.provider,this._offlineComponentProvider={build:t=>new c7(t,e?.cacheSizeBytes)}}}function f$(e){return new fX(e?.forceOwnership)}function fZ(){return new fQ}let fJ="NOT SUPPORTED";class f1{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class f0 extends fs{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new f3(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(d3("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new nj(nV.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=f0._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function f2(e,t,r){if(io(t,f0._jsonSchema)){var n;if(t.bundle===fJ)throw new nj(nV.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=hD(e._databaseId),s=(n=t.bundle,new dn(n,i)),a=s.t(),o=new cw(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new nj(nV.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=lE(i,l[0].document),h=new n5(n4.fromString(t.bundleName));return new f0(e,new fx(e),h,u,new f1(!1,!1),r||null)}}f0._jsonSchemaVersion="firestore/documentSnapshot/1.0",f0._jsonSchema={type:ia("string",f0._jsonSchemaVersion),bundleSource:ia("string","DocumentSnapshot"),bundleName:ia("string"),bundle:ia("string")};class f3 extends f0{data(e={}){return super.data(e)}}class f4{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new f1(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new f3(this._firestore,this._userDataWriter,r.key,r,new f1(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new nj(nV.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new f3(e._firestore,e._userDataWriter,r.doc.key,r.doc,new f1(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new f3(e._firestore,e._userDataWriter,t.doc.key,t.doc,new f1(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return nB(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new nj(nV.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=f4._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=n$.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function f6(e,t,r){if(io(t,f4._jsonSchema)){var n;if(t.bundle===fJ)throw new nj(nV.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=hD(e._databaseId),s=(n=t.bundle,new dn(n,i)),a=s.t(),o=new cw(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new nj(nV.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=lF(o.queries[0].bundledQuery),u=o.documents,h=new ci;u.map(e=>{let t=lE(i,e.document);h=h.add(t)});let c=ca.fromInitialDocuments(l,h,of(),!1,!1),d=new dS(e,r||null,l);return new f4(e,new fx(e),d,c)}}function f8(e,t){return e instanceof f0&&t instanceof f0?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof f4&&t instanceof f4&&e._firestore===t._firestore&&dN(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}f4._jsonSchemaVersion="firestore/querySnapshot/1.0",f4._jsonSchema={type:ia("string",f4._jsonSchemaVersion),bundleSource:ia("string","QuerySnapshot"),bundleName:ia("string"),bundle:ia("string")};let f5={maxAttempts:5};class f7{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=dY(e)}set(e,t,r){this._verifyNotCommitted();let n=f9(e,this._firestore),i=fO(n.converter,t,r),s=dK(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,oD.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=f9(e,this._firestore);return i="string"==typeof(t=rS(t))||t instanceof dB?d$(this._dataReader,"WriteBatch.update",s._key,t,r,n):dQ(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,oD.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=f9(e,this._firestore);return this._mutations=this._mutations.concat(new oV(t._key,oD.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new nj(nV.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function f9(e,t){if((e=rS(e)).firestore!==t)throw new nj(nV.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class ge{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=dY(e)}get(e){let t=f9(e,this._firestore),r=new fx(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return nB(24041);let n=e[0];if(n.isFoundDocument())return new fs(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new fs(this._firestore,r,t._key,null,t.converter);throw nB(18433,{doc:n})})}set(e,t,r){let n=f9(e,this._firestore),i=fO(n.converter,t,r),s=dK(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=f9(e,this._firestore);return i="string"==typeof(t=rS(t))||t instanceof dB?d$(this._dataReader,"Transaction.update",s._key,t,r,n):dQ(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=f9(e,this._firestore);return this._transaction.delete(t._key),this}}class gt extends ge{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=f9(e,this._firestore),r=new d9(this._firestore);return super.get(e).then(e=>new f0(this._firestore,r,t._key,e._document,new f1(!1,!1),t.converter))}}function gr(e,t,r){var n,i;let s;e=ii(e,dx);let a={...f5,...r};if(a.maxAttempts<1)throw new nj(nV.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=dL(e),i=r=>t(new gt(e,r)),s=new nz,n.asyncQueue.enqueueAndForget(async()=>{let e=await dp(n);new ds(n.asyncQueue,e,a,i,s).ju()}),s.promise}function gn(e){e=ii(e,dT);let t=ii(e.firestore,dx);return dy(dL(t),e._key).then(r=>gy(t,e,r))}function gi(e){var t;let r;e=ii(e,dT);let n=ii(e.firestore,dx),i=dL(n),s=new d9(n);return(t=e._key,r=new nz,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new nj(nV.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=cn(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await df(i),t,r)),r.promise).then(t=>new f0(n,s,e._key,t,new f1(null!==t&&t.hasLocalMutations,!0),e.converter))}function gs(e){e=ii(e,dT);let t=ii(e.firestore,dx);return dy(dL(t),e._key,{source:"server"}).then(r=>gy(t,e,r))}function ga(e){e=ii(e,dS);let t=ii(e.firestore,dx),r=dL(t),n=new d9(t);return fo(e._query),dw(r,e._query).then(r=>new f4(t,n,e,r))}function go(e){var t;let r;e=ii(e,dS);let n=ii(e.firestore,dx),i=dL(n),s=new d9(n);return(t=e._query,r=new nz,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await u6(e,t,!0),i=new c_(t,n.ks),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=cn(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await df(i),t,r)),r.promise).then(t=>new f4(n,s,e,t))}function gl(e){e=ii(e,dS);let t=ii(e.firestore,dx),r=dL(t),n=new d9(t);return dw(r,e._query,{source:"server"}).then(r=>new f4(t,n,e,r))}function gu(e,t,r){e=ii(e,dT);let n=ii(e.firestore,dx),i=fO(e.converter,t,r),s=dY(n);return gm(n,[dK(s,"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,oD.none())])}function gh(e,t,r,...n){e=ii(e,dT);let i=ii(e.firestore,dx),s=dY(i);return gm(i,[("string"==typeof(t=rS(t))||t instanceof dB?d$(s,"updateDoc",e._key,t,r,n):dQ(s,"updateDoc",e._key,t)).toMutation(e._key,oD.exists(!0))])}function gc(e){return gm(ii(e.firestore,dx),[new oV(e._key,oD.none())])}function gd(e,t){let r=ii(e.firestore,dx),n=function(e,t,...r){if(e=rS(e),1==arguments.length&&(t=n$.newId()),n7("doc","path",t),e instanceof dA){let n=n4.fromString(t,...r);return n9(n),new dT(e,null,new n5(n))}{if(!(e instanceof dT||e instanceof db))throw new nj(nV.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(n4.fromString(t,...r));return n9(n),new dT(e.firestore,e instanceof db?e.converter:null,new n5(n))}}(e),i=fO(e.converter,t);return gm(r,[dK(dY(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,oD.exists(!1))]).then(()=>n)}function gf(e,...t){var r;let n,i,s,a,o;e=rS(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||fr(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(fr(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof dT)i=ii(e.firestore,dx),s=a0(e._key.path),n={next:r=>{t[u]&&t[u](gy(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=ii(e,dS);i=ii(r.firestore,dx),s=r._query;let a=new d9(i);n={next:e=>{t[u]&&t[u](new f4(i,a,r,e))},error:t[u+1],complete:t[u+2]},fo(e._query)}return r=dL(i),o=new cp(s,a=new dt(n),h),r.asyncQueue.enqueueAndForget(async()=>ch(await dm(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>cc(await dm(r),o))}}function gg(e,t,...r){var n,i,s,a,o,l;let u=rS(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new nj(nV.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||fr(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&fr(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,dP(u,h.bundle).then(()=>{var e,t,r;return e=u,t=h.bundleName,(r=dL(e=ii(e,dx)),r.asyncQueue.enqueue(async()=>{var e;return e=await df(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new dS(e,null,t.query):null)}).then(r=>{r&&!t&&(s&&r.withConverter(s),e=gf(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&fr(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,dP(u,h.bundle).then(()=>{t||(e=gf(new dT(u,l||null,n5.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new nj(nV.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function gp(e,t){let r,n=dL(e=ii(e,dx));return r=new dt(fr(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await dm(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await dm(n),void e.Ca.delete(r)})}}function gm(e,t){var r;let n;return r=dL(e),n=new nz,r.asyncQueue.enqueueAndForget(async()=>cx(await dg(r),t,n)),n.promise}function gy(e,t,r){let n=r.docs.get(t._key),i=new d9(e);return new f0(e,i,t._key,n,new f1(r.hasPendingWrites,r.fromCache),t.converter)}function gw(e){return dL(e=ii(e,dx)),new f7(e,t=>gm(e,t))}function gE(e,t){let r=dL(e=ii(e,dx));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return nP("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new nj(nV.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=gC(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=d6("setIndexConfiguration",gC(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new ip(e,2)):"ASCENDING"===t.order?n.push(new ip(e,0)):"DESCENDING"===t.order&&n.push(new ip(e,1))}r.push(new ih(ih.UNKNOWN_ID,t,n,im.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,ig,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>iS.waitFor(n)))})(await df(r),n))}function gC(e,t){if("string"!=typeof e[t])throw new nj(nV.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class gI{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function g_(e){e=ii(e,dx);let t=gv.get(e);if(t)return t;let r=dL(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new gI(e);return gv.set(e,n),n}function gA(e){gb(e,!0)}function gS(e){gb(e,!1)}function gT(e){var t;(t=dL(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await df(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>nx("deleting all persistent cache indexes succeeded")).catch(e=>nP("deleting all persistent cache indexes failed",e))}function gb(e,t){var r;(r=dL(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await df(r),void(e.Cs.As=t)})).then(e=>nx(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>nP(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let gv=new WeakMap;class gN{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return gD.instance.onExistenceFilterMismatch(e)}}class gD{constructor(){this.i=new Map}static get instance(){return gR||function(e){if(oX)throw Error("a TestingHooksSpi instance is already set");oX=e}(gR=new gD),gR}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let gR=null;!function(e=!0){nR=ns,r4(new rT("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new dx(new nW(t.getProvider("auth-internal")),new nQ(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new nj(nV.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new s7(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),nc(fe,ft,void 0),nc(fe,ft,"esm2020")}(),e.s(["AggregateField",()=>fn,"AggregateQuerySnapshot",()=>fi,"DocumentSnapshot",()=>f0,"PersistentCacheIndexManager",()=>gI,"QueryCompositeFilterConstraint",()=>ff,"QueryConstraint",()=>fu,"QueryDocumentSnapshot",()=>f3,"QueryEndAtConstraint",()=>fS,"QueryFieldFilterConstraint",()=>fc,"QueryLimitConstraint",()=>fw,"QueryOrderByConstraint",()=>fm,"QuerySnapshot",()=>f4,"QueryStartAtConstraint",()=>fI,"SnapshotMetadata",()=>f1,"Transaction",()=>gt,"WriteBatch",()=>f7,"_TestingHooks",()=>gN,"addDoc",()=>gd,"aggregateFieldEqual",()=>fB,"aggregateQuerySnapshotEqual",()=>fF,"and",()=>fp,"average",()=>fP,"count",()=>fk,"deleteAllPersistentCacheIndexes",()=>gT,"deleteDoc",()=>gc,"disablePersistentCacheIndexAutoCreation",()=>gS,"documentSnapshotFromJSON",()=>f2,"enablePersistentCacheIndexAutoCreation",()=>gA,"endAt",()=>fb,"endBefore",()=>fT,"executeWrite",()=>gm,"getAggregateFromServer",()=>fV,"getCountFromServer",()=>fU,"getDoc",()=>gn,"getDocFromCache",()=>gi,"getDocFromServer",()=>gs,"getDocs",()=>ga,"getDocsFromCache",()=>go,"getDocsFromServer",()=>gl,"getPersistentCacheIndexManager",()=>g_,"limit",()=>fE,"limitToLast",()=>fC,"memoryEagerGarbageCollector",()=>fq,"memoryLocalCache",()=>fY,"memoryLruGarbageCollector",()=>fW,"onSnapshot",()=>gf,"onSnapshotResume",()=>gg,"onSnapshotsInSync",()=>gp,"or",()=>fg,"orderBy",()=>fy,"persistentLocalCache",()=>fK,"persistentMultipleTabManager",()=>fZ,"persistentSingleTabManager",()=>f$,"query",()=>fh,"querySnapshotFromJSON",()=>f6,"runTransaction",()=>gr,"setDoc",()=>gu,"setIndexConfiguration",()=>gE,"snapshotEqual",()=>f8,"startAfter",()=>fA,"startAt",()=>f_,"sum",()=>fL,"updateDoc",()=>gh,"where",()=>fd,"writeBatch",()=>gw],26192),e.i(26192);let gM="firebasestorage.googleapis.com",gO="storageBucket";class gx extends rE{constructor(e,t,r=0){super(gL(e),`Firebase Storage: ${t} (${gL(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,gx.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return gL(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function gL(e){return"storage/"+e}function gP(){return new gx(ea.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function gk(e){return new gx(ea.INVALID_ARGUMENT,e)}function gB(){return new gx(ea.APP_DELETED,"The Firebase app was deleted.")}function gF(e,t){return new gx(ea.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function gU(e){throw new gx(ea.INTERNAL_ERROR,"Internal error: "+e)}(T=ea||(ea={})).UNKNOWN="unknown",T.OBJECT_NOT_FOUND="object-not-found",T.BUCKET_NOT_FOUND="bucket-not-found",T.PROJECT_NOT_FOUND="project-not-found",T.QUOTA_EXCEEDED="quota-exceeded",T.UNAUTHENTICATED="unauthenticated",T.UNAUTHORIZED="unauthorized",T.UNAUTHORIZED_APP="unauthorized-app",T.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",T.INVALID_CHECKSUM="invalid-checksum",T.CANCELED="canceled",T.INVALID_EVENT_NAME="invalid-event-name",T.INVALID_URL="invalid-url",T.INVALID_DEFAULT_BUCKET="invalid-default-bucket",T.NO_DEFAULT_BUCKET="no-default-bucket",T.CANNOT_SLICE_BLOB="cannot-slice-blob",T.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",T.NO_DOWNLOAD_URL="no-download-url",T.INVALID_ARGUMENT="invalid-argument",T.INVALID_ARGUMENT_COUNT="invalid-argument-count",T.APP_DELETED="app-deleted",T.INVALID_ROOT_OPERATION="invalid-root-operation",T.INVALID_FORMAT="invalid-format",T.INTERNAL_ERROR="internal-error",T.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class gV{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=gV.makeFromUrl(e,t)}catch(t){return new gV(e,"")}if(""===r.path)return r;throw new gx(ea.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let r=null,n="([A-Za-z0-9.\\-_]+)",i=RegExp("^gs://"+n+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}let a=t.replace(/[.]/g,"\\."),o=RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${n}/o(/([^?#]*).*)?$`,"i"),l=t===gM?"(?:storage.googleapis.com|storage.cloud.google.com)":t,u=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:RegExp(`^https?://${l}/${n}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<u.length;t++){let n=u[t],i=n.regex.exec(e);if(i){let e=i[n.indices.bucket],t=i[n.indices.path];t||(t=""),r=new gV(e,t),n.postModify(r);break}}if(null==r)throw new gx(ea.INVALID_URL,"Invalid URL '"+e+"'.");return r}}class gj{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function gz(e){return"string"==typeof e||e instanceof String}function gH(e){return gG()&&e instanceof Blob}function gG(){return"u">typeof Blob}function gq(e,t,r,n){if(n<t)throw gk(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>r)throw gk(`Invalid value for '${e}'. Expected ${r} or less.`)}function gW(e,t,r){let n=t;return null==r&&(n=`https://${t}`),`${r}://${n}/v0${e}`}function gY(e){let t=encodeURIComponent,r="?";for(let n in e)e.hasOwnProperty(n)&&(r=r+(t(n)+"=")+t(e[n])+"&");return r.slice(0,-1)}(b=eo||(eo={}))[b.NO_ERROR=0]="NO_ERROR",b[b.NETWORK_ERROR=1]="NETWORK_ERROR",b[b.ABORT=2]="ABORT";class gK{constructor(e,t,r,n,i,s,a,o,l,u,h,c=!0,d=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.retry=c,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new gX(!1,null,!0));let r=this.connectionFactory_();this.pendingConnection_=r;let n=e=>{let t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{var t;let i,s,a;null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;let o=r.getErrorCode()===eo.NO_ERROR,l=r.getStatus();!o||(t=this.additionalRetryCodes_,i=l>=500&&l<600,s=-1!==[408,429].indexOf(l),a=-1!==t.indexOf(l),(i||s||a)&&this.retry)?e(!1,new gX(!1,null,r.getErrorCode()===eo.ABORT)):e(!0,new gX(-1!==this.successCodes_.indexOf(l),r))})},t=(e,t)=>{let r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?r(e):r()}catch(e){n(e)}else if(null!==i){let e=gP();e.serverResponse=i.getErrorText(),n(this.errorCallback_?this.errorCallback_(i,e):e)}else n(t.canceled?this.appDelete_?gB():new gx(ea.CANCELED,"User canceled the upload/download."):new gx(ea.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(!1,new gX(!1,null,!0)):this.backoffId_=function(e,t,r){let n=1,i=null,s=null,a=!1,o=0,l=!1;function u(...e){l||(l=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(d,2===o)},t)}function c(){s&&clearTimeout(s)}function d(e,...t){let r;if(l)return void c();if(e||2===o||a){c(),u.call(null,e,...t);return}n<64&&(n*=2),1===o?(o=2,r=0):r=(n+Math.random())*1e3,h(r)}let f=!1;function g(e){f||(f=!0,c(),!l&&(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,g(!0)},r),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class gX{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function gQ(...e){let t="u">typeof BlobBuilder?BlobBuilder:"u">typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){let r=new t;for(let t=0;t<e.length;t++)r.append(e[t]);return r.getBlob()}if(gG())return new Blob(e);throw new gx(ea.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}let g$="base64",gZ="base64url",gJ="data_url";class g1{constructor(e,t){this.data=e,this.contentType=t||null}}function g0(e,t){switch(e){case"raw":return new g1(g2(t));case g$:case gZ:return new g1(g3(e,t));case gJ:return new g1(function(e){let t,r=new g4(e);if(r.base64)return g3(g$,r.rest);var n=r.rest;try{t=decodeURIComponent(n)}catch(e){throw gF(gJ,"Malformed data URL.")}return g2(t)}(t),new g4(t).contentType)}throw gP()}function g2(e){let t=[];for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<=127?t.push(n):n<=2047?t.push(192|n>>6,128|63&n):(64512&n)==55296?r<e.length-1&&(64512&e.charCodeAt(r+1))==56320?(n=65536|(1023&n)<<10|1023&e.charCodeAt(++r),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n)):t.push(239,191,189):(64512&n)==56320?t.push(239,191,189):t.push(224|n>>12,128|n>>6&63,128|63&n)}return new Uint8Array(t)}function g3(e,t){let r;switch(e){case g$:{let r=-1!==t.indexOf("-"),n=-1!==t.indexOf("_");if(r||n)throw gF(e,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case gZ:{let r=-1!==t.indexOf("+"),n=-1!==t.indexOf("/");if(r||n)throw gF(e,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{r=function(e){if("u"<typeof atob)throw new gx(ea.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw gF(e,"Invalid character found")}let n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);return n}class g4{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw gF(gJ,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;null!=r&&(this.base64=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}class g6{constructor(e,t){let r=0,n="";gH(e)?(this.data_=e,r=e.size,n=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){if(!gH(this.data_))return new g6(new Uint8Array(this.data_.buffer,e,t-e),!0);{var r,n,i;let s=(r=this.data_,n=e,i=t,r.webkitSlice?r.webkitSlice(n,i):r.mozSlice?r.mozSlice(n,i):r.slice?r.slice(n,i):null);return null===s?null:new g6(s)}}static getBlob(...e){if(gG()){let t=e.map(e=>e instanceof g6?e.data_:e);return new g6(gQ.apply(null,t))}{let t=e.map(e=>gz(e)?g0("raw",e).data:e.data_),r=0;t.forEach(e=>{r+=e.byteLength});let n=new Uint8Array(r),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)n[i++]=e[t]}),new g6(n,!0)}}uploadData(){return this.data_}}function g8(e){var t;let r;try{r=JSON.parse(e)}catch(e){return null}return"object"!=typeof(t=r)||Array.isArray(t)?null:r}function g5(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}function g7(e,t){return t}class g9{constructor(e,t,r,n){this.server=e,this.local=t||e,this.writable=!!r,this.xform=n||g7}}let pe=null;function pt(){if(pe)return pe;let e=[];e.push(new g9("bucket")),e.push(new g9("generation")),e.push(new g9("metageneration")),e.push(new g9("name","fullPath",!0));let t=new g9("name");t.xform=function(e,t){return!gz(t)||t.length<2?t:g5(t)},e.push(t);let r=new g9("size");return r.xform=function(e,t){return void 0!==t?Number(t):t},e.push(r),e.push(new g9("timeCreated")),e.push(new g9("updated")),e.push(new g9("md5Hash",null,!0)),e.push(new g9("cacheControl",null,!0)),e.push(new g9("contentDisposition",null,!0)),e.push(new g9("contentEncoding",null,!0)),e.push(new g9("contentLanguage",null,!0)),e.push(new g9("contentType",null,!0)),e.push(new g9("metadata","customMetadata",!0)),pe=e}function pr(e,t,r){let n=g8(t);return null===n?null:function(e,t,r){let n={};n.type="file";let i=r.length;for(let e=0;e<i;e++){let i=r[e];n[i.local]=i.xform(n,t[i.server])}return Object.defineProperty(n,"ref",{get:function(){let t=new gV(n.bucket,n.fullPath);return e._makeStorageReference(t)}}),n}(e,n,r)}class pn{constructor(e,t,r,n){this.url=e,this.method=t,this.handler=r,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function pi(e){if(!e)throw gP()}function ps(e){return function(t,r){var n,i;let s;return 401===t.getStatus()?s=t.getErrorText().includes("Firebase App Check token is invalid")?new gx(ea.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new gx(ea.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(n=e.bucket,s=new gx(ea.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,s=new gx(ea.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}}class pa{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=eo.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=eo.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=eo.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,n,i){if(this.sent_)throw gU("cannot .send() more than once");if(ro(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(let e in i)i.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,i[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw gU("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw gU("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return -1}}getResponse(){if(!this.sent_)throw gU("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw gU("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class po extends pa{initXhr(){this.xhr_.responseType="text"}}function pl(){return new po}class pu{constructor(e,t){this._service=e,t instanceof gV?this._location=t:this._location=gV.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new pu(e,t)}get root(){let e=new gV(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return g5(this._location.path)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new gV(this._location.bucket,e);return new pu(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new gx(ea.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function ph(e,t){let r=t?.[gO];return null==r?null:gV.makeFromBucketSpec(r,e)}class pc{constructor(e,t,r,n,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=gM,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=n?this._bucket=gV.makeFromBucketSpec(n,this._host):this._bucket=ph(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=gV.makeFromBucketSpec(this._url,e):this._bucket=ph(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){gq("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){gq("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(r9(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new pu(this,e)}_makeRequest(e,t,r,n,i=!0){if(this._deleted)return new gj(gB());{let s=function(e,t,r,n,i,s,a=!0,o=!1){let l=gY(e.urlParams),u=e.url+l,h=Object.assign({},e.headers);return t&&(h["X-Firebase-GMPID"]=t),null!==r&&r.length>0&&(h.Authorization="Firebase "+r),h["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager"),null!==n&&(h["X-Firebase-AppCheck"]=n),new gK(u,e.method,h,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,o)}(e,this._appId,r,n,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let pd="@firebase/storage",pf="0.14.0",pg="storage";r4(new rT(pg,function(e,{instanceIdentifier:t}){return new pc(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,ns)},"PUBLIC").setMultipleInstances(!0)),nc(pd,pf,""),nc(pd,pf,"esm2020");let pp=nu().length?nl():na({apiKey:"AIzaSyC4IeM4fq3BcX_LwOg1mEpYMPV9p8nRVA4",authDomain:"sentieri-cortina-web-app.firebaseapp.com",projectId:"sentieri-cortina-web-app",storageBucket:"sentieri-cortina-web-app.firebasestorage.app",messagingSenderId:"191250415086",appId:"1:191250415086:web:7554dc94148f690538a2ff"}),pm=function(e,t){let r=r6("object"==typeof e?e:nl(),"firestore").getImmediate({identifier:"string"==typeof e?e:s5});if(!r._initialized){let e=ri("firestore");e&&function(e,t,r,n={}){e=ii(e,dA);let i=ro(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(rl(`https://${o}`),rd("Firestore",!0)),s.host!==dI&&s.host!==o&&nP("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!r_(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=nD.MOCK_USER;else{t=ru(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new nj(nV.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new nD(i)}e._authCredentials=new nq(new nH(t,r))}}(r,...e)}return r}(pp),py=function(e=nl(),t){let r=r6(e=rS(e),pg).getImmediate({identifier:void 0}),n=ri("storage");return n&&function(e,t,r,n={}){!function(e,t,r,n={}){e.host=`${t}:${r}`;let i=ro(t);i&&(rl(`https://${e.host}/b`),rd("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=n;s&&(e._overrideAuthToken="string"==typeof s?s:ru(s,e.app.options.projectId))}(e,t,r,n)}(r,...n),r}(pp),pw="meals";async function pE(){let e=fh(dv(pm,pw),fy("created_at","desc")),t=await ga(e),r=new Date().toISOString().split("T")[0];return t.docs.map(e=>{let t=e.data();return{id:e.id,...t,created_at:t.created_at?.toDate?.()||new Date(t.created_at)}}).filter(e=>{try{return e.created_at.toISOString().split("T")[0]===r}catch(e){return!1}})}async function pC(e){return{id:(await gd(dv(pm,pw),{...e,created_at:il.now()})).id,...e}}async function pI(e){try{let t=await fetch(`https://world.openfoodfacts.org/api/v2/product/${e}.json`);if(!t.ok)throw Error("Product not found");let r=await t.json();if(1!==r.status||!r.product)throw Error("Product not found or invalid data");let n=r.product,i=n.nutriments;return{name:n.product_name||"Sconosciuto",quantity:100,calories:Math.round(i["energy-kcal_100g"]||0),protein:Math.round(i.proteins_100g||0),carbs:Math.round(i.carbohydrates_100g||0),fat:Math.round(i.fat_100g||0),analysis:`Prodotto scansionato: ${n.brands||""} ${n.product_name||""}. Valori per 100g.`}}catch(e){throw console.error("OpenFoodFacts Error:",e),e}}function p_({onMealAdded:e}){let[t,r]=(0,eu.useState)(!1),[n,i]=(0,eu.useState)(null),[s,a]=(0,eu.useState)(null),[o,l]=(0,eu.useState)(!1),u=(0,eu.useRef)(null),h=async e=>{let t=e.target.files?.[0];if(!t)return;let r=new FileReader;r.onloadend=()=>{let e=new window.Image;e.onload=()=>{let t=document.createElement("canvas"),r=e.width,n=e.height;r>n?r>1024&&(n=Math.round(1024*n/r),r=1024):n>1024&&(r=Math.round(1024*r/n),n=1024),t.width=r,t.height=n,t.getContext("2d").drawImage(e,0,0,r,n);let i=t.toDataURL("image/jpeg",.7);a(i),c(i)},e.src=r.result},r.readAsDataURL(t)},c=async e=>{r(!0);try{let t=e.split(",")[1]||e,n=await t4(t);i(n),r(!1)}catch(e){console.error(e),alert("Failed to analyze image. Please try again."),r(!1)}},d=async e=>{l(!1),r(!0);try{let t=await pI(e);i(t)}catch(e){console.error(e),alert("Prodotto non trovato o errore di scansione.")}finally{r(!1)}},f=async t=>{try{let c=null;if(s){var r,n,o,l,u,h;let e,t,i,a,d,f=`meals/${Date.now()}.jpg`,g=function(e,t){var r=e=rS(e);if(!(t&&/^[A-Za-z]+:\/\//.test(t)))return function e(t,r){var n;let i,s,a;if(t instanceof pc){if(null==t._bucket)throw new gx(ea.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+gO+"' property when initializing the app?");let n=new pu(t,t._bucket);return null!=r?e(n,r):n}if(void 0===r)return t;return n=t._location.path,i=r.split("/").filter(e=>e.length>0).join("/"),s=0===n.length?i:n+"/"+i,a=new gV(t._location.bucket,s),new pu(t.storage,a)}(r,t);if(r instanceof pc)return new pu(r,t);throw gk("To use ref(service, url), the first argument must be a Storage instance.")}(py,f);await (r=g,function(e,t,r="raw",n){var i;let s;e._throwIfRoot("uploadString");let a=g0(r,t),o={...n};return null==o.contentType&&null!=a.contentType&&(o.contentType=a.contentType),i=a.data,e._throwIfRoot("uploadBytes"),s=function(e,t,r,n,i){let s,a=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},l=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+l;let u=((s=Object.assign({},i)).fullPath=t.path,s.size=n.size(),s.contentType||(s.contentType=n&&n.type()||"application/octet-stream"),s),h="--"+l+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(e,t){let r={},n=t.length;for(let i=0;i<n;i++){let n=t[i];n.writable&&(r[n.server]=e[n.local])}return JSON.stringify(r)}(u,r)+"\r\n--"+l+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",c=g6.getBlob(h,n,"\r\n--"+l+"--");if(null===c)throw new gx(ea.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");let d={name:u.fullPath},f=gW(a,e.host,e._protocol),g=e.maxUploadRetryTime,p=new pn(f,"POST",function(t,n){let i=pr(e,n,r);return pi(null!==i),i},g);return p.urlParams=d,p.headers=o,p.body=c.uploadData(),p.errorHandler=ps(t),p}(e.storage,e._location,pt(),new g6(i,!0),o),e.storage.makeRequestWithTokens(s,pl).then(t=>({metadata:t,ref:e}))}(r=rS(r),s,"data_url",void 0)),c=await (n=g,(o=n=rS(n))._throwIfRoot("getDownloadURL"),l=o.storage,u=o._location,h=pt(),e=gW(u.fullServerUrl(),l.host,l._protocol),t=l.maxOperationRetryTime,i=new pn(e,"GET",function(e,t){let r=pr(l,t,h);return pi(null!==r),function(e,t,r,n){let i=g8(t);if(null===i||!gz(i.downloadTokens))return null;let s=i.downloadTokens;if(0===s.length)return null;let a=encodeURIComponent;return s.split(",").map(t=>{let i=e.bucket,s=e.fullPath;return gW("/b/"+a(i)+"/o/"+a(s),r,n)+gY({alt:"media",token:t})})[0]}(r,t,l.host,l._protocol)},t),a=ps(u),i.errorHandler=function(e,t){var r;let n=a(e,t);return 404===e.getStatus()&&(r=u.path,n=new gx(ea.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")),n.serverResponse=t.serverResponse,n},d=i,o.storage.makeRequestWithTokens(d,pl).then(e=>{if(null===e)throw new gx(ea.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}let d={...t,image_path:c,created_at:void 0},f=await pC(d);e(f),i(null),a(null)}catch(e){console.error(e),alert("Failed to save meal.")}};return(0,el.jsxs)(el.Fragment,{children:[(0,el.jsxs)("div",{className:"fixed bottom-0 left-0 right-0 p-6 z-50 flex justify-center gap-6 bg-gradient-to-t from-slate-900 via-slate-900/90 to-transparent pb-8 pt-10 safe-area-inset-bottom",children:[(0,el.jsx)("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",ref:u,onChange:h}),t?(0,el.jsxs)("div",{className:"h-16 px-6 glass-panel rounded-full flex items-center gap-3 animate-pulse",children:[(0,el.jsx)(em,{className:"w-6 h-6 text-primary animate-spin"}),(0,el.jsx)("span",{className:"text-sm font-medium text-white",children:"Processing..."})]}):(0,el.jsxs)(el.Fragment,{children:[(0,el.jsx)("button",{onClick:()=>u.current?.click(),className:"h-16 w-16 rounded-full glass-button flex items-center justify-center text-white hover:scale-105 active:scale-95 transition-all shadow-2xl shadow-blue-500/30",children:(0,el.jsx)(ep,{className:"w-8 h-8"})}),(0,el.jsx)("button",{onClick:()=>l(!0),className:"h-16 w-16 rounded-full glass-button flex items-center justify-center text-white hover:scale-105 active:scale-95 transition-all shadow-2xl shadow-green-500/30",children:(0,el.jsx)(ey,{className:"w-8 h-8"})})]})]}),o&&(0,el.jsx)(tI,{onDetected:d,onClose:()=>l(!1)}),n&&(0,el.jsx)(e_,{mealData:n,onConfirm:f,onCancel:()=>{i(null)}})]})}function pA({meal:e}){return e?(0,el.jsxs)("div",{className:"glass-panel rounded-2xl p-5 mb-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,el.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,el.jsxs)("div",{children:[(0,el.jsx)("h3",{className:"text-xl font-bold text-white capitalize",children:e.name}),(0,el.jsxs)("p",{className:"text-xs text-gray-400",children:[e.quantity?`${e.quantity}g  `:"",new Date(e.created_at||Date.now()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,el.jsxs)("div",{className:"text-right",children:[(0,el.jsx)("span",{className:"text-2xl font-bold gradient-text",children:e.calories}),(0,el.jsx)("span",{className:"text-xs text-gray-400 block uppercase tracking-wider",children:"Kcal"})]})]}),(0,el.jsxs)("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[(0,el.jsx)(pS,{label:"Protein",value:e.protein,color:"bg-blue-500"}),(0,el.jsx)(pS,{label:"Carbs",value:e.carbs,color:"bg-emerald-500"}),(0,el.jsx)(pS,{label:"Fat",value:e.fat,color:"bg-amber-500"})]}),e.analysis&&(0,el.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700/50",children:(0,el.jsxs)("p",{className:"text-sm text-gray-300 italic",children:['"',e.analysis,'"']})})]}):null}function pS({label:e,value:t,color:r}){return(0,el.jsxs)("div",{className:"bg-slate-800/50 rounded-xl p-3 text-center border border-slate-700/50",children:[(0,el.jsxs)("div",{className:"text-lg font-semibold text-white",children:[t,"g"]}),(0,el.jsx)("div",{className:"text-[10px] text-gray-400 uppercase tracking-widest mb-1",children:e}),(0,el.jsxs)("div",{className:"h-1.5 w-full bg-slate-700 rounded-full overflow-hidden",children:[(0,el.jsx)("div",{className:`h-full ${r} w-full rounded-full opacity-80`,style:{width:"60%"}})," "]})]})}let pT=eg("utensils-crossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]),pb=eg("flame",[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]]);function pv(){let[e,t]=(0,eu.useState)([]),[r,n]=(0,eu.useState)(!0);(0,eu.useEffect)(()=>{i()},[]);let i=async()=>{try{let e=await pE();t(e)}catch(e){console.error("Failed to load meals",e)}finally{n(!1)}},s=e.reduce((e,t)=>e+(t.calories||0),0),a=e.reduce((e,t)=>e+(t.protein||0),0),o=e.reduce((e,t)=>e+(t.carbs||0),0),l=e.reduce((e,t)=>e+(t.fat||0),0);return(0,el.jsxs)("div",{className:"min-h-screen pb-32 px-4 pt-8 safe-area-inset-bottom",children:[(0,el.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,el.jsxs)("div",{children:[(0,el.jsxs)("h1",{className:"text-3xl font-bold text-white tracking-tight",children:["Today's ",(0,el.jsx)("span",{className:"gradient-text",children:"Macros"})]}),(0,el.jsx)("p",{className:"text-gray-400 text-sm",children:"Track your nutrition journey"})]}),(0,el.jsx)("div",{className:"h-10 w-10 glass-panel rounded-full flex items-center justify-center text-primary",children:(0,el.jsx)(pT,{size:20})})]}),(0,el.jsxs)("div",{className:"glass-panel p-6 rounded-3xl mb-8 relative overflow-hidden group",children:[(0,el.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:(0,el.jsx)(pb,{size:120})}),(0,el.jsxs)("div",{className:"relative z-10 text-center",children:[(0,el.jsx)("h2",{className:"text-sm font-medium text-gray-400 uppercase tracking-widest mb-1",children:"Total Calories"}),(0,el.jsx)("div",{className:"text-5xl font-black text-white mb-6 tabular-nums",children:s}),(0,el.jsxs)("div",{className:"flex justify-between gap-4 px-2",children:[(0,el.jsx)(pN,{label:"Protein",value:a,color:"text-blue-400"}),(0,el.jsx)("div",{className:"w-[1px] bg-gray-700/50"}),(0,el.jsx)(pN,{label:"Carbs",value:o,color:"text-emerald-400"}),(0,el.jsx)("div",{className:"w-[1px] bg-gray-700/50"}),(0,el.jsx)(pN,{label:"Fat",value:l,color:"text-amber-400"})]})]})]}),(0,el.jsxs)("div",{className:"space-y-4",children:[(0,el.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:["Recent Meals",(0,el.jsx)("span",{className:"bg-slate-800 text-slate-400 text-xs px-2 py-0.5 rounded-full",children:e.length})]}),r?(0,el.jsx)("div",{className:"text-center py-10 text-gray-500 animate-pulse",children:"Loading meals..."}):0===e.length?(0,el.jsxs)("div",{className:"text-center py-10 rounded-2xl border border-dashed border-gray-700",children:[(0,el.jsx)("p",{className:"text-gray-400",children:"No meals tracked today."}),(0,el.jsx)("p",{className:"text-gray-600 text-sm mt-1",children:"Tap the camera to start!"})]}):e.map(e=>(0,el.jsx)(pA,{meal:e},e.id))]}),(0,el.jsx)(p_,{onMealAdded:e=>{t(t=>[e,...t])}})]})}function pN({label:e,value:t,color:r}){return(0,el.jsxs)("div",{className:"text-center flex-1",children:[(0,el.jsxs)("div",{className:`text-xl font-bold ${r}`,children:[Math.round(t),"g"]}),(0,el.jsx)("div",{className:"text-[10px] text-gray-500 uppercase",children:e})]})}e.s(["default",()=>pv],33560)}]);