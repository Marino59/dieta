(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5587:(e,t,a)=>{Promise.resolve().then(a.bind(a,947))},947:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var r=a(5155),l=a(2115),s=a(1190),i=a(3580),n=a(1697),o=a(4505),c=a(7650),d=a(767),u=a(6527),x=a(3473),m=a(8867);let b=new(a(4624)).ij("AIzaSyDb0049K3rxp946cyUiLqZRty-A7MBXYCI");async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg";try{let a=b.getGenerativeModel({model:"gemini-flash-latest"}),r=await a.generateContent(['\n        Analizza questa immagine di cibo e fornisci i seguenti dati nutrizionali stimati in formato JSON puro (senza markdown, senza backticks).\n        Identifica il piatto principale o i piatti presenti.\n        \n        Rispondi ESCLUSIVAMENTE con un oggetto JSON con questa struttura:\n        {\n            "name": "Nome del piatto",\n            "quantity": quantit\xe0 in grammi (numero intero stimato),\n            "calories": calorie totali (numero intero),\n            "protein": proteine in grammi (numero intero),\n            "carbs": carboidrati in grammi (numero intero),\n            "fat": grassi in grammi (numero intero),\n            "analysis": "Breve descrizione nutrizionale e commenti sulla salubrit\xe0 del pasto (max 2 frasi, in italiano)"\n        }\n        ',{inlineData:{data:e,mimeType:t}}]),l=(await r.response).text();console.log("--- RAW GEMINI RESPONSE ---"),console.log(l),console.log("---------------------------");let s=l.replace(/```json/gi,"").replace(/```/g,"").trim(),i=s.indexOf("{"),n=s.lastIndexOf("}");-1!==i&&-1!==n&&(s=s.substring(i,n+1));try{return JSON.parse(s)}catch(e){throw console.error("JSON Parse Error:",e),console.error("Failed to parse text:",s),Error("Invalid JSON response from AI")}}catch(e){throw console.error("Gemini Analysis Error:",e),e}}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;try{let a=b.getGenerativeModel({model:"gemini-flash-latest"}),r=t.toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),l='\n        Analizza questa descrizione di cibo: "'.concat(e,'"\n        Data di riferimento (oggi): ').concat(r,'\n        \n        Compiti:\n        1. Estrai i valori nutrizionali stimati.\n        2. Se l\'utente specifica un orario (es. "ore 7", "pranzo") o un giorno relativo (es. "ieri", "stamattina", "due giorni fa"), calcola la data e l\'ora precise.\n        \n        Rispondi ESCLUSIVAMENTE con un oggetto JSON:\n        {\n            "name": "Nome del piatto",\n            "quantity": 100 (intero, grammi),\n            "calories": 0 (intero),\n            "protein": 0 (intero),\n            "carbs": 0 (intero),\n            "fat": 0 (intero),\n            "analysis": "Breve commento (max 2 frasi)",\n            "time": "HH:MM" (opzionale, o null),\n            "date": "YYYY-MM-DD" (data calcolata in base alla descrizione e alla data di riferimento)\n        }\n        '),s=await a.generateContent(l),i=(await s.response).text(),n=i.replace(/```json/gi,"").replace(/```/g,"").trim(),o=n.indexOf("{"),c=n.lastIndexOf("}");-1!==o&&-1!==c&&(n=n.substring(o,c+1));try{return JSON.parse(n)}catch(t){let e=i.match(/\{[\s\S]*\}/);if(e)return JSON.parse(e[0]);throw t}}catch(e){var a,r,l,s,i,n;if(console.error("Gemini Text Analysis Error:",e),(null===(a=e.message)||void 0===a?void 0:a.includes("429"))||(null===(r=e.message)||void 0===r?void 0:r.includes("Too Many Requests"))||(null===(l=e.message)||void 0===l?void 0:l.includes("Quota exceeded"))){let t=null===(n=e.message)||void 0===n?void 0:n.match(/retryDelay[\":]+(\\d+)s/),a=t?t[1]:"60";throw Error("Limite richieste raggiunto. Attendi ".concat(a," secondi e riprova."))}if((null===(s=e.message)||void 0===s?void 0:s.includes("404"))||(null===(i=e.message)||void 0===i?void 0:i.includes("not found")))throw Error("Modello AI non disponibile. Contatta il supporto.");throw Error("L'IA non \xe8 riuscita a capire questa frase. Riprova con qualcosa di pi\xf9 semplice.")}}function p(e){let{mealData:t,onConfirm:a,onCancel:s,isLoading:i,defaultDate:n}=e,[b,g]=(0,l.useState)(t.quantity||100),[h,p]=(0,l.useState)(t.analysis||""),[v,j]=(0,l.useState)(!1),w=(()=>{if(t.date)return new Date(t.date);let e=n?new Date(n):new Date;if(n){let t=new Date;e.setHours(t.getHours(),t.getMinutes())}return e})();isNaN(w.getTime())&&(w=new Date);let[y,N]=(0,l.useState)(w.toISOString().split("T")[0]),[k,S]=(0,l.useState)(w.toTimeString().slice(0,5));(0,l.useEffect)(()=>(j(!0),document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]);let D=e=>{g(t=>Math.max(10,t+e))},[C,A]=(0,l.useState)(!1);if(!v)return null;let z=(0,r.jsx)("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center p-4 sm:p-6",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.85)",backdropFilter:"blur(8px)"},children:(0,r.jsxs)("div",{className:"bg-slate-900/90 border border-slate-700/50 w-full max-w-lg max-h-[85vh] rounded-3xl flex flex-col shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,r.jsxs)("div",{className:"p-5 border-b border-slate-700/50 flex justify-between items-center bg-slate-800/30",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-white tracking-tight",children:"Modifica Pasto"}),(0,r.jsx)("p",{className:"text-slate-400 text-xs font-medium",children:"Aggiorna i dettagli nutrizionali"})]}),(0,r.jsx)("button",{onClick:s,className:"p-2.5 bg-slate-800/80 rounded-full text-slate-400 hover:text-white hover:bg-slate-700 transition-colors border border-slate-700/50",children:(0,r.jsx)(d.A,{size:20})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 custom-scrollbar",children:[(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-white leading-tight",children:t.name}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-6 bg-slate-800/30 p-3 rounded-2xl border border-slate-700/30 mx-auto max-w-[280px]",children:[(0,r.jsx)("button",{onClick:()=>D(-50),className:"w-12 h-12 rounded-xl bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-white transition active:scale-95 border border-slate-700",children:(0,r.jsx)(u.A,{size:20})}),(0,r.jsxs)("div",{className:"flex flex-col items-center min-w-[80px]",children:[(0,r.jsx)("span",{className:"text-3xl font-black text-blue-400",children:b}),(0,r.jsx)("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-widest",children:"GRAMMI"})]}),(0,r.jsx)("button",{onClick:()=>D(50),className:"w-12 h-12 rounded-xl bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-white transition active:scale-95 border border-slate-700",children:(0,r.jsx)(x.A,{size:20})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"bg-slate-800/40 p-3 rounded-2xl border border-slate-700/30",children:[(0,r.jsx)("label",{className:"text-[10px] text-slate-400 font-bold uppercase mb-2 block tracking-wider",children:"Data"}),(0,r.jsx)("input",{type:"date",value:y,onChange:e=>N(e.target.value),className:"w-full bg-slate-700/50 text-white text-sm font-medium rounded-lg px-2 py-1 outline-none cursor-pointer [color-scheme:dark]"})]}),(0,r.jsxs)("div",{className:"bg-slate-800/40 p-3 rounded-2xl border border-slate-700/30",children:[(0,r.jsx)("label",{className:"text-[10px] text-slate-400 font-bold uppercase mb-2 block tracking-wider",children:"Ora"}),(0,r.jsx)("input",{type:"time",value:k,onChange:e=>S(e.target.value),className:"w-full bg-slate-700/50 text-white text-sm font-medium rounded-lg px-2 py-1 outline-none cursor-pointer [color-scheme:dark]"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,r.jsx)(f,{label:"KCAL",val:Math.round(t.calories/100*b),color:"text-white",border:"bg-slate-800/50 border-slate-700"}),(0,r.jsx)(f,{label:"PROT",val:Math.round(t.protein/100*b),color:"text-blue-400",border:"bg-blue-500/10 border-blue-500/20"}),(0,r.jsx)(f,{label:"CARB",val:Math.round(t.carbs/100*b),color:"text-emerald-400",border:"bg-emerald-500/10 border-emerald-500/20"}),(0,r.jsx)(f,{label:"GRAS",val:Math.round(t.fat/100*b),color:"text-amber-400",border:"bg-amber-500/10 border-amber-500/20"})]})]}),(0,r.jsxs)("div",{className:"p-5 border-t border-slate-700/50 bg-slate-800/30 flex flex-col gap-3",children:[(0,r.jsxs)("button",{onClick:()=>{if(i)return;let[e,r,l]=y.split("-").map(Number),[s,n]=k.split(":").map(Number),o=new Date(e,r-1,l,s,n);a({...t,quantity:b,analysis:h,date:o})},disabled:i,className:"w-full h-14 rounded-2xl bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold text-lg shadow-lg shadow-blue-900/20 transition-all flex items-center justify-center gap-3 disabled:opacity-50 disabled:grayscale",children:[i?(0,r.jsx)(o.A,{className:"animate-spin w-6 h-6"}):(0,r.jsx)(m.A,{size:24,strokeWidth:3}),i?"SALVATAGGIO...":"SALVA MODIFICHE"]}),(0,r.jsx)("button",{onClick:s,className:"text-xs text-slate-500 hover:text-slate-300 transition-colors font-medium py-2",children:"Annulla"})]})]})});return(0,c.createPortal)(z,document.body)}function f(e){let{label:t,val:a,color:l,border:s}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-3 rounded-2xl border ".concat(s," transition hover:scale-105"),children:[(0,r.jsx)("span",{className:"text-[9px] font-black text-slate-500 tracking-widest mb-0.5",children:t}),(0,r.jsx)("span",{className:"text-sm font-black ".concat(l),children:a})]})}var v=a(8129);function j(e){let{onDetected:t,onClose:a}=e;(0,l.useRef)(null);let[s,i]=(0,l.useState)(null);return(0,l.useEffect)(()=>{let e=new v.TF("reader",{fps:10,qrbox:{width:250,height:250},aspectRatio:1},!1);return e.render(function(a,r){console.log("Scan result: ".concat(a),r),e&&e.clear().catch(e=>console.error(e)),t(a)},function(e){}),i(e),()=>{e&&e.clear().catch(e=>console.error("Failed to clear scanner",e))}},[]),(0,r.jsxs)("div",{className:"fixed inset-0 z-[60] bg-black text-white flex flex-col",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4",children:[(0,r.jsx)("h3",{className:"font-bold text-lg",children:"Scan Barcode"}),(0,r.jsx)("button",{onClick:a,className:"p-2 bg-gray-800 rounded-full",children:(0,r.jsx)(d.A,{size:24})})]}),(0,r.jsx)("div",{id:"reader",className:"w-full flex-1"}),(0,r.jsx)("p",{className:"p-4 text-center text-sm text-gray-400",children:"Point camera at a barcode to scan."})]})}var w=a(1020);async function y(e){try{let t=await fetch("https://world.openfoodfacts.org/api/v2/product/".concat(e,".json"));if(!t.ok)throw Error("Product not found");let a=await t.json();if(1!==a.status||!a.product)throw Error("Product not found or invalid data");let r=a.product,l=r.nutriments;return{name:r.product_name||"Sconosciuto",quantity:100,calories:Math.round(l["energy-kcal_100g"]||0),protein:Math.round(l.proteins_100g||0),carbs:Math.round(l.carbohydrates_100g||0),fat:Math.round(l.fat_100g||0),analysis:"Prodotto scansionato: ".concat(r.brands||""," ").concat(r.product_name||"",". Valori per 100g.")}}catch(e){throw console.error("OpenFoodFacts Error:",e),e}}function N(e){let{onMealAdded:t,hideButtons:a,defaultDate:c,initialMode:d}=e,[u,x]=(0,l.useState)(d||"text"),[m,b]=(0,l.useState)(!1),[f,v]=(0,l.useState)(null),[N,k]=(0,l.useState)(null),[S,D]=(0,l.useState)(""),[C,A]=(0,l.useState)(!1),z=(0,l.useRef)(null),[M,E]=(0,l.useState)(!1);(0,l.useEffect)(()=>{"barcode"===u?E(!0):E(!1),"camera"!==u||f||m||setTimeout(()=>{var e;null===(e=z.current)||void 0===e||e.click()},100)},[u,f,m]);let I=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let r=new FileReader;r.onloadend=()=>{let e=new window.Image;e.onload=()=>{let t=document.createElement("canvas"),a=e.width,r=e.height;a>r?a>1024&&(r=Math.round(1024*r/a),a=1024):r>1024&&(a=Math.round(1024*a/r),r=1024),t.width=a,t.height=r,t.getContext("2d").drawImage(e,0,0,a,r);let l=t.toDataURL("image/jpeg",.7);k(l),_(l)},e.src=r.result},r.readAsDataURL(a)},_=async e=>{b(!0);try{let t=e.split(",")[1]||e,a=await g(t);v(a),b(!1)}catch(e){console.error(e),alert("Errore durante l'analisi dell'immagine. Riprova o usa l'inserimento manuale."),b(!1)}},q=async()=>{if(S.trim()){b(!0);try{console.log("Analyzing text:",S);let e=await h(S,c||new Date);if(console.log("Analysis result:",e),!e)throw Error("No data returned");let t=c?new Date(c):new Date;if(e.date){let[a,r,l]=e.date.split("-").map(Number);t.setFullYear(a,r-1,l)}if(e.time&&/^\d{2}:\d{2}$/.test(e.time)){let[a,r]=e.time.split(":").map(Number);t.setHours(a,r,0,0)}v({...e,date:t}),D("")}catch(e){console.error("Text analysis failed:",e),alert("Errore AI: ".concat(e.message||"Riprova con una descrizione pi\xf9 semplice"))}finally{b(!1)}}},P=async e=>{E(!1),b(!0);try{let t=await y(e);v(t)}catch(e){console.error(e),alert("Prodotto non trovato o errore di scansione.")}finally{b(!1)}},R=async e=>{A(!0);try{let a=e=>{let t=parseFloat(e);return isNaN(t)?0:Math.round(t)},r={name:e.name||"Pasto sconosciuto",quantity:a(e.quantity)||100,calories:a(e.calories),protein:a(e.protein),carbs:a(e.carbs),fat:a(e.fat),analysis:e.analysis||""},l=e.date?new Date(e.date):new Date,s={...r,image_path:N,created_at:l},i=await (0,w.addMeal)(s);t(i),v(null),k(null)}catch(e){console.error(e),alert("Errore durante il salvataggio: ".concat(e.message))}finally{A(!1)}};return(0,r.jsxs)("div",{className:"w-full flex flex-col items-center",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",ref:z,onChange:I}),!f&&!m&&(0,r.jsxs)("div",{className:"grid grid-cols-3 w-full gap-4 mb-6",children:[(0,r.jsxs)("button",{onClick:()=>x("camera"),className:"aspect-square rounded-2xl flex flex-col items-center justify-center transition-all ".concat("camera"===u?"shadow-xl scale-105 z-10":"opacity-80 hover:opacity-100 scale-100"),style:{background:"camera"===u?"linear-gradient(135deg, #2563eb 0%, #06b6d4 100%)":"rgba(30, 41, 59, 0.5)",border:"camera"===u?"none":"1px solid rgba(255,255,255,0.1)",color:"camera"===u?"white":"#94a3b8"},children:[(0,r.jsx)(s.A,{size:32,strokeWidth:"camera"===u?2:1.5}),(0,r.jsx)("span",{className:"text-xs font-bold mt-2 tracking-wider uppercase",children:"Foto"})]}),(0,r.jsxs)("button",{onClick:()=>x("text"),className:"aspect-square rounded-2xl flex flex-col items-center justify-center transition-all ".concat("text"===u?"shadow-xl scale-105 z-10":"opacity-80 hover:opacity-100 scale-100"),style:{background:"text"===u?"linear-gradient(135deg, #f97316 0%, #fbbf24 100%)":"rgba(30, 41, 59, 0.5)",border:"text"===u?"none":"1px solid rgba(255,255,255,0.1)",color:"text"===u?"white":"#94a3b8"},children:[(0,r.jsx)(i.A,{size:32,strokeWidth:"text"===u?2:1.5}),(0,r.jsx)("span",{className:"text-xs font-bold mt-2 tracking-wider uppercase",children:"Testo"})]}),(0,r.jsxs)("button",{onClick:()=>x("barcode"),className:"aspect-square rounded-2xl flex flex-col items-center justify-center transition-all ".concat("barcode"===u?"shadow-xl scale-105 z-10":"opacity-80 hover:opacity-100 scale-100"),style:{background:"barcode"===u?"linear-gradient(135deg, #10b981 0%, #34d399 100%)":"rgba(30, 41, 59, 0.5)",border:"barcode"===u?"none":"1px solid rgba(255,255,255,0.1)",color:"barcode"===u?"white":"#94a3b8"},children:[(0,r.jsx)(n.A,{size:32,strokeWidth:"barcode"===u?2:1.5}),(0,r.jsx)("span",{className:"text-xs font-bold mt-2 tracking-wider uppercase",children:"Codice"})]})]}),m&&(0,r.jsxs)("div",{className:"w-full mb-8 h-32 glass-panel rounded-2xl flex flex-col items-center justify-center gap-4 animate-pulse border border-blue-500/30",children:[(0,r.jsx)(o.A,{className:"w-12 h-12 text-blue-400 animate-spin"}),(0,r.jsx)("span",{className:"text-xl font-bold text-white",children:"Analisi con AI in corso..."})]}),!f&&!m&&(0,r.jsxs)("div",{className:"w-full animate-in fade-in slide-in-from-bottom-4 duration-500",children:["camera"===u&&(0,r.jsx)("div",{className:"flex flex-col items-center",children:(0,r.jsxs)("button",{onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},className:"w-full aspect-video rounded-3xl flex flex-col items-center justify-center border-2 border-dashed border-blue-500/30 bg-blue-500/10 hover:bg-blue-500/20 transition-all group",children:[(0,r.jsx)("div",{className:"p-6 rounded-full bg-blue-500 shadow-xl shadow-blue-500/40 mb-4 group-hover:scale-110 transition-transform duration-300",children:(0,r.jsx)(s.A,{size:48,color:"white"})}),(0,r.jsx)("span",{className:"text-xl font-bold text-blue-200",children:"Scatta una Foto"}),(0,r.jsx)("span",{className:"text-sm text-blue-400 mt-2",children:"o carica dalla galleria"})]})}),"text"===u&&(0,r.jsxs)("div",{className:"flex flex-col w-full",children:[(0,r.jsx)("textarea",{autoFocus:!0,placeholder:"Cosa hai mangiato? Es: 2 uova strapazzate con pane tostato...",className:"w-full h-48 bg-slate-800/50 border-2 border-orange-500/30 rounded-3xl p-6 text-white placeholder-slate-500 focus:outline-none focus:border-orange-500 transition-colors resize-none mb-4",style:{fontSize:"1.5rem",lineHeight:"1.5"},value:S,onChange:e=>D(e.target.value)}),(0,r.jsx)("button",{onClick:q,disabled:!S.trim(),className:"w-full py-5 rounded-2xl font-black text-xl tracking-wide shadow-xl shadow-orange-500/20 active:scale-95 transition-all text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(135deg, #f97316 0%, #fbbf24 100%)"},children:"ANALIZZA TESTO"})]}),"barcode"===u&&(0,r.jsxs)("div",{className:"rounded-3xl overflow-hidden border-2 border-emerald-500/30 bg-black relative aspect-square",children:[(0,r.jsx)(j,{onDetected:P,onClose:()=>x("text")}),(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none border-[3px] border-emerald-500/50 rounded-3xl z-10"}),(0,r.jsx)("div",{className:"absolute bottom-4 left-0 right-0 text-center z-20",children:(0,r.jsx)("span",{className:"bg-black/60 text-white px-4 py-2 rounded-full text-sm font-bold backdrop-blur-md",children:"Inquadra il codice a barre"})})]})]}),f&&(0,r.jsx)(p,{mealData:f,onConfirm:R,onCancel:()=>{v(null),k(null)},isLoading:C,defaultDate:c})]})}var k=a(872),S=a(5686);function D(e){let{meal:t,onEdit:a,onDelete:l}=e;return t?(0,r.jsxs)("div",{className:"glass-panel rounded-2xl p-5 mb-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"font-bold text-white capitalize truncate",style:{fontSize:"1.75rem",marginBottom:"8px"},children:t.name}),(0,r.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",marginTop:"8px"},children:[(0,r.jsx)("div",{style:{backgroundColor:"rgba(59, 130, 246, 0.2)",padding:"6px 14px",borderRadius:"10px",border:"1px solid rgba(59, 130, 246, 0.3)",marginRight:"12px"},children:(0,r.jsx)("span",{style:{fontSize:"1.1rem",color:"#93c5fd",fontWeight:"bold"},children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",fontSize:"1.1rem",color:"#9ca3af"},children:[t.quantity&&(0,r.jsxs)("span",{style:{color:"#d1d5db",fontWeight:600,marginRight:"10px"},children:[t.quantity,"g"]}),t.quantity&&(0,r.jsx)("span",{style:{width:"5px",height:"5px",backgroundColor:"#6b7280",borderRadius:"50%",marginRight:"10px"}}),(0,r.jsx)("span",{children:new Date(t.created_at).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"2-digit"}).replace(/\//g,"-")})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("span",{className:"font-bold gradient-text",style:{fontSize:"2.5rem",lineHeight:1},children:t.calories}),(0,r.jsx)("span",{className:"text-gray-400 block uppercase tracking-wider font-bold",style:{fontSize:"0.9rem"},children:"Kcal"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),a(t)},className:"p-2 rounded-full bg-slate-800/50 text-gray-400 hover:text-white hover:bg-slate-700 transition",children:(0,r.jsx)(k.A,{size:18})}),(0,r.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),l(t)},className:"p-2 rounded-full bg-slate-800/50 text-gray-400 hover:text-red-400 hover:bg-slate-700 transition",children:(0,r.jsx)(S.A,{size:18})})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-3 mt-4",children:[(0,r.jsx)(C,{label:"Proteine",value:t.protein,color:"bg-blue-500",bgColor:"rgba(30, 64, 175, 0.3)",iconColor:"#60a5fa"}),(0,r.jsx)(C,{label:"Carbi",value:t.carbs,color:"bg-emerald-500",bgColor:"rgba(6, 95, 70, 0.3)",iconColor:"#34d399"}),(0,r.jsx)(C,{label:"Grassi",value:t.fat,color:"bg-amber-500",bgColor:"rgba(146, 64, 14, 0.3)",iconColor:"#fbbf24"})]}),t.analysis&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-700/50",children:(0,r.jsxs)("p",{className:"text-base text-gray-300 italicLeading-relaxed",children:['"',t.analysis,'"']})})]}):null}function C(e){let{label:t,value:a,color:l,bgColor:s,iconColor:i}=e;return(0,r.jsxs)("div",{className:"rounded-2xl p-4 text-center border transition hover:scale-[1.02]",style:{backgroundColor:s,borderColor:"".concat(i,"30")},children:[(0,r.jsxs)("div",{className:"text-white mb-0.5 font-black",style:{fontSize:"1.5rem",lineHeight:1},children:[a,"g"]}),(0,r.jsx)("div",{className:"uppercase tracking-widest mb-3 font-bold",style:{color:i,fontSize:"0.85rem"},children:t}),(0,r.jsx)("div",{className:"h-2.5 w-full rounded-full overflow-hidden",style:{backgroundColor:"".concat(i,"20"),border:"1px solid rgba(255, 255, 255, 0.1)"},children:(0,r.jsx)("div",{className:"h-full ".concat(l," w-full rounded-full opacity-90")})})]})}function A(e){let{calories:t,targetCalories:a,protein:l,targetProtein:s,carbs:i,targetCarbs:n,fat:o,targetFat:c}=e,d=[{label:"Calorie",value:t,target:a,color:"#3b82f6",radius:90},{label:"Proteine",value:l,target:s,color:"#ef4444",radius:74},{label:"Carboidrati",value:i,target:n,color:"#10b981",radius:58},{label:"Grassi",value:o,target:c,color:"#f59e0b",radius:42}];return(0,r.jsxs)("div",{className:"relative flex flex-col items-center justify-center p-6",children:[(0,r.jsx)("div",{className:"relative mb-8",style:{width:200,height:200},children:(0,r.jsx)("svg",{width:200,height:200,className:"transform -rotate-90",children:d.map((e,t)=>{let a=2*Math.PI*e.radius,l=Math.min(Math.max(e.value/e.target,0),1);return(0,r.jsxs)("g",{children:[(0,r.jsx)("circle",{cx:100,cy:100,r:e.radius,fill:"transparent",stroke:"#1e293b",strokeWidth:12,strokeLinecap:"round"}),(0,r.jsx)("circle",{cx:100,cy:100,r:e.radius,fill:"transparent",stroke:e.color,strokeWidth:12,strokeDasharray:a,strokeDashoffset:a-l*a,strokeLinecap:"round",className:"transition-all duration-1000 ease-out"})]},e.label)})})}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-4 w-full",children:d.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-4 bg-slate-900/60 p-4 rounded-3xl border border-white/5 shadow-lg backdrop-blur-sm",children:[(0,r.jsx)("div",{className:"w-5 h-16 rounded-full shrink-0",style:{backgroundColor:e.color,boxShadow:"0 0 15px ".concat(e.color,"50")}}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-black tabular-nums leading-none mb-1",style:{fontSize:"2.25rem",color:e.color},children:[Math.round(e.value),(0,r.jsx)("span",{style:{fontSize:"1rem",color:"#94a3b8",marginLeft:"2px"},children:"Calorie"===e.label?"":"g"})]}),(0,r.jsx)("div",{className:"text-sm font-bold uppercase tracking-wider opacity-90",style:{color:e.color},children:e.label})]})]},e.label))})]})}var z=a(3518),M=a(1466),E=a(5236),I=a(2423),_=a(6967),q=a(8907),P=a(1731),R=a(6046);function O(){var e,t;let s=(0,P.A)(),i=null==s?void 0:s.user,n=null===(t=null==s?void 0:s.loading)||void 0===t||t,c=null==s?void 0:s.logOut,d=(0,R.useRouter)(),[u,m]=(0,l.useState)("dashboard"),[b,g]=(0,l.useState)(null),[h,f]=(0,l.useState)([]),[v,j]=(0,l.useState)(null),[y,k]=(0,l.useState)(!0),[S,C]=(0,l.useState)(null),[O,U]=(0,l.useState)(new Date);(0,l.useEffect)(()=>{n||i||d.push("/login")},[i,n,d]),(0,l.useEffect)(()=>{i&&L()},[i,O]);let L=async()=>{try{k(!0);let[e,t]=await Promise.all([(0,w.getMeals)(O),Promise.resolve().then(a.bind(a,1020)).then(e=>e.getUserProfile())]);f(e),j(t)}catch(e){console.error("Failed to load data",e)}finally{k(!1)}},F=e=>{let t=new Date(O);t.setDate(t.getDate()+e),t>new Date||U(t)},T=O.toDateString()===new Date().toDateString(),G=async e=>{if(confirm("Sei sicuro di voler eliminare questo pasto?"))try{await (0,w.deleteMeal)(e.id),f(t=>t.filter(t=>t.id!==e.id))}catch(e){alert("Errore eliminazione: "+e.message)}},H=e=>{C({...e,date:e.created_at||e.date||new Date})},W=async e=>{try{let t=S.quantity||100,a=e.quantity,r=a/t,l={quantity:a,analysis:e.analysis,calories:Math.round(S.calories*r),protein:Math.round(S.protein*r),carbs:Math.round(S.carbs*r),fat:Math.round(S.fat*r)};e.date&&(l.created_at=e.date),await (0,w.updateMeal)(S.id,l),f(e=>e.map(e=>e.id===S.id?{...e,...l}:e)),C(null),L()}catch(e){alert("Errore aggiornamento: "+e.message)}};if(n||!i)return(0,r.jsx)("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})});let B=h.reduce((e,t)=>e+(t.calories||0),0),J=h.reduce((e,t)=>e+(t.protein||0),0),Y=h.reduce((e,t)=>e+(t.carbs||0),0),V=h.reduce((e,t)=>e+(t.fat||0),0),K=(null==v?void 0:v.targetCalories)||2e3,Z=(null==v?void 0:v.weight)?2*v.weight:150,X=(null==v?void 0:v.targetCalories)?Math.round(.45*v.targetCalories/4):250,Q=(null==v?void 0:v.targetCalories)?Math.round(.25*v.targetCalories/9):65;return"add-meal"===u?(0,r.jsx)("div",{className:"min-h-screen bg-slate-950 text-white pb-safe",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("button",{onClick:()=>m("dashboard"),className:"flex items-center gap-2 text-slate-400 hover:text-white mb-8 transition",children:[(0,r.jsx)(z.A,{})," Indietro"]}),(0,r.jsx)("h1",{className:"text-3xl font-black mb-2",children:"Aggiungi Pasto"}),(0,r.jsx)("p",{className:"text-slate-400 mb-10",children:"Scegli come inserire il tuo alimento"}),(0,r.jsx)("div",{className:"flex flex-col gap-4",children:(0,r.jsx)(N,{onMealAdded:e=>{new Date(e.created_at||Date.now()).toDateString()===O.toDateString()&&f(t=>[e,...t]),m("dashboard")},defaultDate:O,initialMode:"text"})})]})}):(0,r.jsxs)("div",{className:"min-h-screen pb-safe px-4 pt-6 bg-slate-900 text-white",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold tracking-tight",children:["Ciao, ",(0,r.jsx)("span",{className:"text-blue-400",children:(null===(e=i.displayName)||void 0===e?void 0:e.split(" ")[0])||"Utente"})," \uD83D\uDC4B"]}),(0,r.jsxs)("p",{className:"text-slate-400 text-sm",children:["Ecco i tuoi progressi di oggi ",(0,r.jsx)("span",{className:"ml-2 text-[10px] bg-blue-900 border border-blue-500 px-2 py-0.5 rounded text-blue-200",children:"v2.0 SUPER"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>d.push("/profile"),className:"p-2 bg-slate-800 rounded-full hover:bg-slate-700 transition",children:(0,r.jsx)(M.A,{size:20})}),(0,r.jsx)("button",{onClick:c,className:"p-2 bg-slate-800 rounded-full hover:bg-red-900/50 text-red-400 transition",children:(0,r.jsx)(E.A,{size:20})})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8 bg-slate-800/50 p-1 rounded-2xl",children:[(0,r.jsx)("button",{onClick:()=>F(-1),className:"p-3 hover:bg-slate-700 rounded-xl transition text-slate-400",children:(0,r.jsx)(z.A,{size:20})}),(0,r.jsxs)("div",{className:"font-bold flex items-center gap-2",children:[(0,r.jsx)(I.A,{size:16,className:"text-blue-500"}),(e=>{let t=new Date;if(e.toDateString()===t.toDateString())return"Oggi";let a=new Date;if(a.setDate(t.getDate()-1),e.toDateString()===a.toDateString())return"Ieri";let r=String(e.getDate()).padStart(2,"0"),l=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getFullYear()).slice(-2);return"".concat(r,"-").concat(l,"-").concat(s)})(O)]}),(0,r.jsx)("button",{onClick:()=>F(1),disabled:T,className:"p-3 rounded-xl transition ".concat(T?"opacity-20":"hover:bg-slate-700 text-slate-400"),children:(0,r.jsx)(_.A,{size:20})})]}),(0,r.jsx)("div",{className:"mb-8 bg-slate-800/50 border border-slate-700/50 rounded-[2rem] shadow-2xl backdrop-blur-sm",children:(0,r.jsx)(A,{calories:B,targetCalories:K,protein:J,targetProtein:Z,carbs:Y,targetCarbs:X,fat:V,targetFat:Q})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6 mb-8",children:[(0,r.jsxs)("button",{onClick:()=>m("add-meal"),className:"aspect-square rounded-[3rem] text-white flex flex-col items-center justify-center relative overflow-hidden shadow-2xl active:scale-95 transition-all group",style:{background:"linear-gradient(135deg, #2563eb 0%, #06b6d4 100%)",boxShadow:"0 25px 50px -12px rgba(37, 99, 235, 0.5)"},children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity"}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center transition-transform duration-500 group-hover:scale-110",children:(0,r.jsx)(x.A,{size:150,strokeWidth:1.5,color:"white",style:{filter:"drop-shadow(0 4px 6px rgba(0,0,0,0.3))"}})}),(0,r.jsx)("div",{className:"absolute bottom-8 font-black tracking-tighter bg-black/20 backdrop-blur-sm px-6 py-2 rounded-full border border-white/10",style:{fontSize:"1.875rem",lineHeight:"2.25rem"},children:"AGGIUNGI"})]}),(0,r.jsxs)("button",{onClick:()=>alert("Funzione Grafici in arrivo!"),className:"aspect-square rounded-[3rem] text-white flex flex-col items-center justify-center relative overflow-hidden shadow-2xl active:scale-95 transition-all group",style:{background:"linear-gradient(135deg, #7c3aed 0%, #c026d3 100%)",boxShadow:"0 25px 50px -12px rgba(124, 58, 237, 0.5)"},children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity"}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center transition-transform duration-500 group-hover:scale-110",children:(0,r.jsx)(q.A,{size:130,strokeWidth:1.5,color:"white",style:{filter:"drop-shadow(0 4px 6px rgba(0,0,0,0.3))"}})}),(0,r.jsx)("div",{className:"absolute bottom-8 font-black tracking-tighter bg-black/20 backdrop-blur-sm px-6 py-2 rounded-full border border-white/10",style:{fontSize:"1.875rem",lineHeight:"2.25rem"},children:"GRAFICI"})]})]}),(0,r.jsxs)("div",{className:"mb-20",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-white mb-4 px-2",children:"Diario di Oggi"}),y?(0,r.jsx)("div",{className:"flex justify-center p-8",children:(0,r.jsx)(o.A,{className:"animate-spin text-blue-500"})}):0===h.length?(0,r.jsxs)("div",{className:"text-center py-12 bg-slate-800/30 rounded-3xl border border-dashed border-slate-700 mx-2",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"\uD83C\uDF7Dï¸"}),(0,r.jsx)("p",{className:"text-slate-500 font-medium",children:"Ancora nessun pasto"})]}):(0,r.jsx)("div",{className:"space-y-3",children:h.map(e=>(0,r.jsx)(D,{meal:e,onEdit:H,onDelete:G},e.id))})]}),S&&(0,r.jsx)(p,{mealData:S,onConfirm:W,onCancel:()=>C(null),isLoading:!1})]})}},1731:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,AuthContextProvider:()=>o});var r=a(5155),l=a(2115),s=a(5877),i=a(4674);let n=(0,l.createContext)(),o=e=>{let{children:t}=e,[a,o]=(0,l.useState)(null),[c,d]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let e=(0,s.hg)(i.j2,e=>{o(e),d(!1)});return()=>e()},[]),(0,r.jsx)(n.Provider,{value:{user:a,googleSignIn:()=>{let e=new s.HF;(0,s.df)(i.j2,e)},logOut:()=>{(0,s.CI)(i.j2)},loading:c},children:t})},c=()=>(0,l.useContext)(n)},4674:(e,t,a)=>{"use strict";a.d(t,{db:()=>o,j2:()=>c});var r=a(9904),l=a(3935),s=a(6802),i=a(5877);let n=(0,r.Dk)().length?(0,r.Sx)():(0,r.Wp)({apiKey:"AIzaSyC4IeM4fq3BcX_LwOg1mEpYMPV9p8nRVA4",authDomain:"sentieri-cortina-web-app.firebaseapp.com",projectId:"sentieri-cortina-web-app",storageBucket:"sentieri-cortina-web-app.firebasestorage.app",messagingSenderId:"191250415086",appId:"1:191250415086:web:7554dc94148f690538a2ff"}),o=(0,l.aU)(n);(0,s.c7)(n);let c=(0,i.xI)(n)},1020:(e,t,a)=>{"use strict";a.r(t),a.d(t,{addMeal:()=>o,deleteMeal:()=>c,getMeals:()=>n,getUserProfile:()=>u,saveUserProfile:()=>x,updateMeal:()=>d});var r=a(4674),l=a(3935);let s="meals",i="profiles";async function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!r.j2.currentUser)return[];let t=e||new Date,a=new Date(t);a.setHours(0,0,0,0);let i=new Date(t);i.setHours(23,59,59,999);let n=(0,l.P)((0,l.rJ)(r.db,s),(0,l._M)("userId","==",r.j2.currentUser.uid),(0,l._M)("created_at",">=",l.Dc.fromDate(a)),(0,l._M)("created_at","<=",l.Dc.fromDate(i)),(0,l.My)("created_at","desc"));return(await (0,l.GG)(n)).docs.map(e=>{var t,a;let r=e.data();return{id:e.id,...r,created_at:(null===(a=r.created_at)||void 0===a?void 0:null===(t=a.toDate)||void 0===t?void 0:t.call(a))||new Date(r.created_at)}}).reverse()}async function o(e){if(!r.j2.currentUser)throw Error("User not authenticated");let t=e.created_at?l.Dc.fromDate(new Date(e.created_at)):l.Dc.now();return{id:(await (0,l.gS)((0,l.rJ)(r.db,s),{...e,userId:r.j2.currentUser.uid,created_at:t})).id,...e,created_at:t.toDate()}}async function c(e){await (0,l.kd)((0,l.H9)(r.db,s,e))}async function d(e,t){let a=(0,l.H9)(r.db,s,e);await (0,l.mZ)(a,t)}async function u(){if(!r.j2.currentUser)return null;let e=(0,l.H9)(r.db,i,r.j2.currentUser.uid),t=await (0,l.x7)(e);return t.exists()?t.data():null}async function x(e){if(!r.j2.currentUser)throw Error("User not authenticated");let t=(0,l.H9)(r.db,i,r.j2.currentUser.uid);return await (0,l.BN)(t,{...e,updatedAt:l.Dc.now()}),e}}},e=>{var t=t=>e(e.s=t);e.O(0,[399,563,604,215,390,441,517,358],()=>t(5587)),_N_E=e.O()}]);